import"@eox/map";import"@eox/map/src/plugins/advancedLayersAndSources";import{mapPosition as O,mapEl as V,mapCompareEl as $,datetime as j}from"@/store/states";import{s as B}from"./pinia.VG4EcYuH.js";import{useSTAcStore as I}from"@/store/stac";import{eodashCompareCollections as D,eodashCollections as z,layerControlFormValue as Z}from"@/utils/states";import{useHandleMapMoveEnd as G,useInitMap as W,useUpdateTooltipProperties as Q}from"@/composables/EodashMap";import{p as _,aK as q,h as F,v as X,o as Y,c as ee,j as U,N as te,k as J}from"./framework.DmpuTMbk.js";function re(r){return 3*r*r-2*r*r*r}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var ne=Object.prototype.toString,E=Array.isArray||function(e){return ne.call(e)==="[object Array]"};function A(r){return typeof r=="function"}function ae(r){return E(r)?"array":typeof r}function N(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function H(r,e){return r!=null&&typeof r=="object"&&e in r}function se(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var oe=RegExp.prototype.test;function ie(r,e){return oe.call(r,e)}var le=/\S/;function ue(r){return!ie(le,r)}var ce={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function pe(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return ce[t]})}var fe=/\s*/,he=/\s+/,K=/\s*=/,de=/\s*\}/,ve=/#|\^|\/|>|\{|&|=|!/;function ye(r,e){if(!r)return[];var t=!1,n=[],a=[],s=[],o=!1,l=!1,i="",u=0;function h(){if(o&&!l)for(;s.length;)delete a[s.pop()];else s=[];o=!1,l=!1}var w,C,M;function T(S){if(typeof S=="string"&&(S=S.split(he,2)),!E(S)||S.length!==2)throw new Error("Invalid tags: "+S);w=new RegExp(N(S[0])+"\\s*"),C=new RegExp("\\s*"+N(S[1])),M=new RegExp("\\s*"+N("}"+S[1]))}T(e||g.tags);for(var c=new P(r),m,p,d,f,b,y;!c.eos();){if(m=c.pos,d=c.scanUntil(w),d)for(var R=0,L=d.length;R<L;++R)f=d.charAt(R),ue(f)?(s.push(a.length),i+=f):(l=!0,t=!0,i+=" "),a.push(["text",f,m,m+1]),m+=1,f===`
`&&(h(),i="",u=0,t=!1);if(!c.scan(w))break;if(o=!0,p=c.scan(ve)||"name",c.scan(fe),p==="="?(d=c.scanUntil(K),c.scan(K),c.scanUntil(C)):p==="{"?(d=c.scanUntil(M),c.scan(de),c.scanUntil(C),p="&"):d=c.scanUntil(C),!c.scan(C))throw new Error("Unclosed tag at "+c.pos);if(p==">"?b=[p,d,m,c.pos,i,u,t]:b=[p,d,m,c.pos],u++,a.push(b),p==="#"||p==="^")n.push(b);else if(p==="/"){if(y=n.pop(),!y)throw new Error('Unopened section "'+d+'" at '+m);if(y[1]!==d)throw new Error('Unclosed section "'+y[1]+'" at '+m)}else p==="name"||p==="{"||p==="&"?l=!0:p==="="&&T(d)}if(h(),y=n.pop(),y)throw new Error('Unclosed section "'+y[1]+'" at '+c.pos);return we(ge(a))}function ge(r){for(var e=[],t,n,a=0,s=r.length;a<s;++a)t=r[a],t&&(t[0]==="text"&&n&&n[0]==="text"?(n[1]+=t[1],n[3]=t[3]):(e.push(t),n=t));return e}function we(r){for(var e=[],t=e,n=[],a,s,o=0,l=r.length;o<l;++o)switch(a=r[o],a[0]){case"#":case"^":t.push(a),n.push(a),t=a[4]=[];break;case"/":s=n.pop(),s[5]=a[2],t=n.length>0?n[n.length-1][4]:e;break;default:t.push(a)}return e}function P(r){this.string=r,this.tail=r,this.pos=0}P.prototype.eos=function(){return this.tail===""};P.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};P.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n};function k(r,e){this.view=r,this.cache={".":this.view},this.parent=e}k.prototype.push=function(e){return new k(e,this)};k.prototype.lookup=function(e){var t=this.cache,n;if(t.hasOwnProperty(e))n=t[e];else{for(var a=this,s,o,l,i=!1;a;){if(e.indexOf(".")>0)for(s=a.view,o=e.split("."),l=0;s!=null&&l<o.length;)l===o.length-1&&(i=H(s,o[l])||se(s,o[l])),s=s[o[l++]];else s=a.view[e],i=H(a.view,e);if(i){n=s;break}a=a.parent}t[e]=n}return A(n)&&(n=n.call(this.view)),n};function v(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}v.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};v.prototype.parse=function(e,t){var n=this.templateCache,a=e+":"+(t||g.tags).join(":"),s=typeof n<"u",o=s?n.get(a):void 0;return o==null&&(o=ye(e,t),s&&n.set(a,o)),o};v.prototype.render=function(e,t,n,a){var s=this.getConfigTags(a),o=this.parse(e,s),l=t instanceof k?t:new k(t,void 0);return this.renderTokens(o,l,n,e,a)};v.prototype.renderTokens=function(e,t,n,a,s){for(var o="",l,i,u,h=0,w=e.length;h<w;++h)u=void 0,l=e[h],i=l[0],i==="#"?u=this.renderSection(l,t,n,a,s):i==="^"?u=this.renderInverted(l,t,n,a,s):i===">"?u=this.renderPartial(l,t,n,s):i==="&"?u=this.unescapedValue(l,t):i==="name"?u=this.escapedValue(l,t,s):i==="text"&&(u=this.rawValue(l)),u!==void 0&&(o+=u);return o};v.prototype.renderSection=function(e,t,n,a,s){var o=this,l="",i=t.lookup(e[1]);function u(C){return o.render(C,t,n,s)}if(i){if(E(i))for(var h=0,w=i.length;h<w;++h)l+=this.renderTokens(e[4],t.push(i[h]),n,a,s);else if(typeof i=="object"||typeof i=="string"||typeof i=="number")l+=this.renderTokens(e[4],t.push(i),n,a,s);else if(A(i)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");i=i.call(t.view,a.slice(e[3],e[5]),u),i!=null&&(l+=i)}else l+=this.renderTokens(e[4],t,n,a,s);return l}};v.prototype.renderInverted=function(e,t,n,a,s){var o=t.lookup(e[1]);if(!o||E(o)&&o.length===0)return this.renderTokens(e[4],t,n,a,s)};v.prototype.indentPartial=function(e,t,n){for(var a=t.replace(/[^ \t]/g,""),s=e.split(`
`),o=0;o<s.length;o++)s[o].length&&(o>0||!n)&&(s[o]=a+s[o]);return s.join(`
`)};v.prototype.renderPartial=function(e,t,n,a){if(n){var s=this.getConfigTags(a),o=A(n)?n(e[1]):n[e[1]];if(o!=null){var l=e[6],i=e[5],u=e[4],h=o;i==0&&u&&(h=this.indentPartial(o,u,l));var w=this.parse(h,s);return this.renderTokens(w,t,n,h,a)}}};v.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(n!=null)return n};v.prototype.escapedValue=function(e,t,n){var a=this.getConfigEscape(n)||g.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&a===g.escape?String(s):a(s)};v.prototype.rawValue=function(e){return e[1]};v.prototype.getConfigTags=function(e){return E(e)?e:e&&typeof e=="object"?e.tags:void 0};v.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!E(e))return e.escape};var g={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){x.templateCache=r},get templateCache(){return x.templateCache}},x=new v;g.clearCache=function(){return x.clearCache()};g.parse=function(e,t){return x.parse(e,t)};g.render=function(e,t,n,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+ae(e)+'" was given as the first argument for mustache#render(template, view, partials)');return x.render(e,t,n,a)};g.escape=pe;g.Scanner=P;g.Context=k;g.Writer=v;const me=[".enabled"],be=[".center",".zoom",".layers"],Ce=[".layers"],Me={__name:"EodashMap",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>[15,48]},zoom:{type:Number,default:4},zoomToExtent:{type:Boolean,default:!0}},setup(r){var T,c,m,p,d;const e=r,t=_([]),n=q([((T=O.value)==null?void 0:T[0])??((c=e.center)==null?void 0:c[0]),((m=O.value)==null?void 0:m[1])??((p=e.center)==null?void 0:p[1])]),a=q(((d=O.value)==null?void 0:d[2])??e.zoom),s=_([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),o=_([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),l={duration:1200,easing:re},i=_(null),u=_(null),{selectedCompareStac:h}=B(I()),w=F(()=>e.enableCompare&&h.value?"":"first");G(i,O),X(()=>{const{selectedCompareStac:f,selectedStac:b}=B(I());V.value=i.value,e.enableCompare&&($.value=u.value),e.enableCompare&&W(u,f,D,j,o,i,!1),W(i,b,z,j,s,u,e.zoomToExtent)}),Q(z,t);const C=F(()=>({visibility:t.value.length?"visible":"hidden"})),M=f=>{const b=JSON.parse(g.render(JSON.stringify(t.value),{...Z.value??{}})),y=b==null?void 0:b.find(R=>R.id===f.key);if(y)return typeof f.value=="object"&&(f.value=JSON.stringify(f.value)),isNaN(Number(f.value))||(f.value=Number(f.value).toFixed(4).toString()),{key:y.title||y.id,value:f.value+" "+(y.appendix||"")}};return(f,b)=>(Y(),ee("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":w.value},[U("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:i,id:"main",".animationOptions":l,".center":J(n),".zoom":J(a),".layers":s.value},[U("eox-map-tooltip",{style:te(C.value),".propertyTransform":M},null,36)],40,be),U("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:u,".layers":o.value},null,40,Ce)],40,me))}};export{Me as default};
