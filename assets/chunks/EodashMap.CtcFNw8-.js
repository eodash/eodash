function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/chunks/raw-CcGKjn8q.DfNmvAus.js","assets/chunks/basedecoder-Qm25PwVp.gdlnpIMU.js","assets/chunks/lzw-BOMhmEDy.vdrfOEDr.js","assets/chunks/jpeg-DNfUpLwy.DZg5Y_av.js","assets/chunks/deflate-Be2Arps5.xxsQaVdl.js","assets/chunks/pako.esm-C3kYPGGQ.DQSVoCko.js","assets/chunks/packbits-DaUD6MLm.Crl47xZx.js","assets/chunks/lerc-C9VL9kri.CKqttqR3.js","assets/chunks/framework.DwvztmCA.js","assets/chunks/webimage-D2c098k3.D_Ac3USc.js","assets/chunks/decoder-kAoyGIq9.ZS5A9fiJ.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{aj as F1,ak as N1,al as D1,am as k1,Y as Nn,O as G1,o as j1,b as z1,y as U1}from"./framework.DwvztmCA.js";import{EodashCollection as B1}from"@/utils/eodashSTAC";import{eodashKey as X1}from"@/utils/keys";import{mapPosition as _i,datetime as q1}from"@/store/States";import W1 from"@/components/DynamicWebComponent.vue";var ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Z1(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var xm={exports:{}},mo={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */mo.exports;var Gf;function $1(){return Gf||(Gf=1,function(r,t){(function(e){var n=t&&!t.nodeType&&t,i=r&&!r.nodeType&&r,s=typeof ws=="object"&&ws;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,l=36,h=1,c=26,u=38,f=700,p=72,m=128,_="-",x=/^xn--/,v=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,T=Math.floor,R=String.fromCharCode,C;function I(L){throw new RangeError(S[L])}function F(L,D){for(var X=L.length,K=[];X--;)K[X]=D(L[X]);return K}function U(L,D){var X=L.split("@"),K="";X.length>1&&(K=X[0]+"@",L=X[1]),L=L.replace(w,".");var G=L.split("."),H=F(G,D).join(".");return K+H}function j(L){for(var D=[],X=0,K=L.length,G,H;X<K;)G=L.charCodeAt(X++),G>=55296&&G<=56319&&X<K?(H=L.charCodeAt(X++),(H&64512)==56320?D.push(((G&1023)<<10)+(H&1023)+65536):(D.push(G),X--)):D.push(G);return D}function B(L){return F(L,function(D){var X="";return D>65535&&(D-=65536,X+=R(D>>>10&1023|55296),D=56320|D&1023),X+=R(D),X}).join("")}function d(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:l}function g(L,D){return L+22+75*(L<26)-((D!=0)<<5)}function y(L,D,X){var K=0;for(L=X?T(L/f):L>>1,L+=T(L/D);L>E*c>>1;K+=l)L=T(L/E);return T(K+(E+1)*L/(L+u))}function b(L){var D=[],X=L.length,K,G=0,H=m,Q=p,nt,xt,dt,Tt,St,Dt,Yt,ue,Ht;for(nt=L.lastIndexOf(_),nt<0&&(nt=0),xt=0;xt<nt;++xt)L.charCodeAt(xt)>=128&&I("not-basic"),D.push(L.charCodeAt(xt));for(dt=nt>0?nt+1:0;dt<X;){for(Tt=G,St=1,Dt=l;dt>=X&&I("invalid-input"),Yt=d(L.charCodeAt(dt++)),(Yt>=l||Yt>T((a-G)/St))&&I("overflow"),G+=Yt*St,ue=Dt<=Q?h:Dt>=Q+c?c:Dt-Q,!(Yt<ue);Dt+=l)Ht=l-ue,St>T(a/Ht)&&I("overflow"),St*=Ht;K=D.length+1,Q=y(G-Tt,K,Tt==0),T(G/K)>a-H&&I("overflow"),H+=T(G/K),G%=K,D.splice(G++,0,H)}return B(D)}function M(L){var D,X,K,G,H,Q,nt,xt,dt,Tt,St,Dt=[],Yt,ue,Ht,He;for(L=j(L),Yt=L.length,D=m,X=0,H=p,Q=0;Q<Yt;++Q)St=L[Q],St<128&&Dt.push(R(St));for(K=G=Dt.length,G&&Dt.push(_);K<Yt;){for(nt=a,Q=0;Q<Yt;++Q)St=L[Q],St>=D&&St<nt&&(nt=St);for(ue=K+1,nt-D>T((a-X)/ue)&&I("overflow"),X+=(nt-D)*ue,D=nt,Q=0;Q<Yt;++Q)if(St=L[Q],St<D&&++X>a&&I("overflow"),St==D){for(xt=X,dt=l;Tt=dt<=H?h:dt>=H+c?c:dt-H,!(xt<Tt);dt+=l)He=xt-Tt,Ht=l-Tt,Dt.push(R(g(Tt+He%Ht,0))),xt=T(He/Ht);Dt.push(R(g(xt,0))),H=y(X,ue,K==G),X=0,++K}++X,++D}return Dt.join("")}function P(L){return U(L,function(D){return x.test(D)?b(D.slice(4).toLowerCase()):D})}function A(L){return U(L,function(D){return v.test(D)?"xn--"+M(D):D})}if(o={version:"1.3.2",ucs2:{decode:j,encode:B},decode:b,encode:M,toASCII:A,toUnicode:P},n&&i)if(r.exports==n)i.exports=o;else for(C in o)o.hasOwnProperty(C)&&(n[C]=o[C]);else e.punycode=o})(ws)}(mo,mo.exports)),mo.exports}var Zh={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var jf;function V1(){return jf||(jf=1,function(r){(function(t,e){r.exports?r.exports=e():t.IPv6=e(t)})(ws,function(t){var e=t&&t.IPv6;function n(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,h=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&a[c]!=="";c++);if(c<h)for(a.splice(c,1,"0000");a.length<h;)a.splice(c,0,"0000");for(var u,f=0;f<h;f++){u=a[f].split("");for(var p=0;p<3&&(u[0]==="0"&&u.length>1);p++)u.splice(0,1);a[f]=u.join("")}var m=-1,_=0,x=0,v=-1,w=!1;for(f=0;f<h;f++)w?a[f]==="0"?x+=1:(w=!1,x>_&&(m=v,_=x)):a[f]==="0"&&(w=!0,v=f,x=1);x>_&&(m=v,_=x),_>1&&a.splice(m,_,""),l=a.length;var S="";for(a[0]===""&&(S=":"),f=0;f<l&&(S+=a[f],f!==l-1);f++)S+=":";return a[l-1]===""&&(S+=":"),S}function i(){return t.IPv6===this&&(t.IPv6=e),this}return{best:n,noConflict:i}})}(Zh)),Zh.exports}var $h={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var zf;function Y1(){return zf||(zf=1,function(r){(function(t,e){r.exports?r.exports=e():t.SecondLevelDomains=e(t)})(ws,function(t){var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(o+1,s)+" ")>=0:!1},is:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o>=0)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(0,s)+" ")>=0:!1},get:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return null;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=n.list[i.slice(s+1)];return!a||a.indexOf(" "+i.slice(o+1,s)+" ")<0?null:i.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})}($h)),$h.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(t,e){r.exports?r.exports=e($1(),V1(),Y1()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(ws,function(t,e,n,i){var s=i&&i.URI;function o(d,g){var y=arguments.length>=1,b=arguments.length>=2;if(!(this instanceof o))return y?b?new o(d,g):new o(d):new o;if(d===void 0){if(y)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?d=location.href+"":d=""}if(d===null&&y)throw new TypeError("null is not a valid argument for URI");return this.href(d),g!==void 0?this.absoluteTo(g):this}function a(d){return/^[0-9]+$/.test(d)}o.version="1.19.11";var l=o.prototype,h=Object.prototype.hasOwnProperty;function c(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(d){return d===void 0?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function f(d){return u(d)==="Array"}function p(d,g){var y={},b,M;if(u(g)==="RegExp")y=null;else if(f(g))for(b=0,M=g.length;b<M;b++)y[g[b]]=!0;else y[g]=!0;for(b=0,M=d.length;b<M;b++){var P=y&&y[d[b]]!==void 0||!y&&g.test(d[b]);P&&(d.splice(b,1),M--,b--)}return d}function m(d,g){var y,b;if(f(g)){for(y=0,b=g.length;y<b;y++)if(!m(d,g[y]))return!1;return!0}var M=u(g);for(y=0,b=d.length;y<b;y++)if(M==="RegExp"){if(typeof d[y]=="string"&&d[y].match(g))return!0}else if(d[y]===g)return!0;return!1}function _(d,g){if(!f(d)||!f(g)||d.length!==g.length)return!1;d.sort(),g.sort();for(var y=0,b=d.length;y<b;y++)if(d[y]!==g[y])return!1;return!0}function x(d){var g=/^\/+|\/+$/g;return d.replace(g,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(d){if(!(!d||!d.nodeName)){var g=d.nodeName.toLowerCase();if(!(g==="input"&&d.type!=="image"))return o.domAttributes[g]}};function v(d){return escape(d)}function w(d){return encodeURIComponent(d).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}o.encode=w,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=w,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(d,g){var y=o.encode(d+"");return g===void 0&&(g=o.escapeQuerySpace),g?y.replace(/%20/g,"+"):y},o.decodeQuery=function(d,g){d+="",g===void 0&&(g=o.escapeQuerySpace);try{return o.decode(g?d.replace(/\+/g,"%20"):d)}catch{return d}};var S={encode:"encode",decode:"decode"},E,T=function(d,g){return function(y){try{return o[g](y+"").replace(o.characters[d][g].expression,function(b){return o.characters[d][g].map[b]})}catch{return y}}};for(E in S)o[E+"PathSegment"]=T("pathname",S[E]),o[E+"UrnPathSegment"]=T("urnpath",S[E]);var R=function(d,g,y){return function(b){var M;y?M=function(D){return o[g](o[y](D))}:M=o[g];for(var P=(b+"").split(d),A=0,L=P.length;A<L;A++)P[A]=M(P[A]);return P.join(d)}};o.decodePath=R("/","decodePathSegment"),o.decodeUrnPath=R(":","decodeUrnPathSegment"),o.recodePath=R("/","encodePathSegment","decode"),o.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),o.encodeReserved=T("reserved","encode"),o.parse=function(d,g){var y;return g||(g={preventInvalidHostname:o.preventInvalidHostname}),d=d.replace(o.leading_whitespace_expression,""),d=d.replace(o.ascii_tab_whitespace,""),y=d.indexOf("#"),y>-1&&(g.fragment=d.substring(y+1)||null,d=d.substring(0,y)),y=d.indexOf("?"),y>-1&&(g.query=d.substring(y+1)||null,d=d.substring(0,y)),d=d.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),d=d.replace(/^[/\\]{2,}/i,"//"),d.substring(0,2)==="//"?(g.protocol=null,d=d.substring(2),d=o.parseAuthority(d,g)):(y=d.indexOf(":"),y>-1&&(g.protocol=d.substring(0,y)||null,g.protocol&&!g.protocol.match(o.protocol_expression)?g.protocol=void 0:d.substring(y+1,y+3).replace(/\\/g,"/")==="//"?(d=d.substring(y+3),d=o.parseAuthority(d,g)):(d=d.substring(y+1),g.urn=!0))),g.path=d,g},o.parseHost=function(d,g){d||(d=""),d=d.replace(/\\/g,"/");var y=d.indexOf("/"),b,M;if(y===-1&&(y=d.length),d.charAt(0)==="[")b=d.indexOf("]"),g.hostname=d.substring(1,b)||null,g.port=d.substring(b+2,y)||null,g.port==="/"&&(g.port=null);else{var P=d.indexOf(":"),A=d.indexOf("/"),L=d.indexOf(":",P+1);L!==-1&&(A===-1||L<A)?(g.hostname=d.substring(0,y)||null,g.port=null):(M=d.substring(0,y).split(":"),g.hostname=M[0]||null,g.port=M[1]||null)}return g.hostname&&d.substring(y).charAt(0)!=="/"&&(y++,d="/"+d),g.preventInvalidHostname&&o.ensureValidHostname(g.hostname,g.protocol),g.port&&o.ensureValidPort(g.port),d.substring(y)||"/"},o.parseAuthority=function(d,g){return d=o.parseUserinfo(d,g),o.parseHost(d,g)},o.parseUserinfo=function(d,g){var y=d,b=d.indexOf("\\");b!==-1&&(d=d.replace(/\\/g,"/"));var M=d.indexOf("/"),P=d.lastIndexOf("@",M>-1?M:d.length-1),A;return P>-1&&(M===-1||P<M)?(A=d.substring(0,P).split(":"),g.username=A[0]?o.decode(A[0]):null,A.shift(),g.password=A[0]?o.decode(A.join(":")):null,d=y.substring(P+1)):(g.username=null,g.password=null),d},o.parseQuery=function(d,g){if(!d)return{};if(d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!d)return{};for(var y={},b=d.split("&"),M=b.length,P,A,L,D=0;D<M;D++)P=b[D].split("="),A=o.decodeQuery(P.shift(),g),L=P.length?o.decodeQuery(P.join("="),g):null,A!=="__proto__"&&(h.call(y,A)?((typeof y[A]=="string"||y[A]===null)&&(y[A]=[y[A]]),y[A].push(L)):y[A]=L);return y},o.build=function(d){var g="",y=!1;return d.protocol&&(g+=d.protocol+":"),!d.urn&&(g||d.hostname)&&(g+="//",y=!0),g+=o.buildAuthority(d)||"",typeof d.path=="string"&&(d.path.charAt(0)!=="/"&&y&&(g+="/"),g+=d.path),typeof d.query=="string"&&d.query&&(g+="?"+d.query),typeof d.fragment=="string"&&d.fragment&&(g+="#"+d.fragment),g},o.buildHost=function(d){var g="";if(d.hostname)o.ip6_expression.test(d.hostname)?g+="["+d.hostname+"]":g+=d.hostname;else return"";return d.port&&(g+=":"+d.port),g},o.buildAuthority=function(d){return o.buildUserinfo(d)+o.buildHost(d)},o.buildUserinfo=function(d){var g="";return d.username&&(g+=o.encode(d.username)),d.password&&(g+=":"+o.encode(d.password)),g&&(g+="@"),g},o.buildQuery=function(d,g,y){var b="",M,P,A,L;for(P in d)if(P!=="__proto__"&&h.call(d,P))if(f(d[P]))for(M={},A=0,L=d[P].length;A<L;A++)d[P][A]!==void 0&&M[d[P][A]+""]===void 0&&(b+="&"+o.buildQueryParameter(P,d[P][A],y),g!==!0&&(M[d[P][A]+""]=!0));else d[P]!==void 0&&(b+="&"+o.buildQueryParameter(P,d[P],y));return b.substring(1)},o.buildQueryParameter=function(d,g,y){return o.encodeQuery(d,y)+(g!==null?"="+o.encodeQuery(g,y):"")},o.addQuery=function(d,g,y){if(typeof g=="object")for(var b in g)h.call(g,b)&&o.addQuery(d,b,g[b]);else if(typeof g=="string"){if(d[g]===void 0){d[g]=y;return}else typeof d[g]=="string"&&(d[g]=[d[g]]);f(y)||(y=[y]),d[g]=(d[g]||[]).concat(y)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(d,g,y){if(typeof g=="object")for(var b in g)h.call(g,b)&&o.setQuery(d,b,g[b]);else if(typeof g=="string")d[g]=y===void 0?null:y;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(d,g,y){var b,M,P;if(f(g))for(b=0,M=g.length;b<M;b++)d[g[b]]=void 0;else if(u(g)==="RegExp")for(P in d)g.test(P)&&(d[P]=void 0);else if(typeof g=="object")for(P in g)h.call(g,P)&&o.removeQuery(d,P,g[P]);else if(typeof g=="string")y!==void 0?u(y)==="RegExp"?!f(d[g])&&y.test(d[g])?d[g]=void 0:d[g]=p(d[g],y):d[g]===String(y)&&(!f(y)||y.length===1)?d[g]=void 0:f(d[g])&&(d[g]=p(d[g],y)):d[g]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(d,g,y,b){switch(u(g)){case"String":break;case"RegExp":for(var M in d)if(h.call(d,M)&&g.test(M)&&(y===void 0||o.hasQuery(d,M,y)))return!0;return!1;case"Object":for(var P in g)if(h.call(g,P)&&!o.hasQuery(d,P,g[P]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(y)){case"Undefined":return g in d;case"Boolean":var A=!!(f(d[g])?d[g].length:d[g]);return y===A;case"Function":return!!y(d[g],g,d);case"Array":if(!f(d[g]))return!1;var L=b?m:_;return L(d[g],y);case"RegExp":return f(d[g])?b?m(d[g],y):!1:!!(d[g]&&d[g].match(y));case"Number":y=String(y);case"String":return f(d[g])?b?m(d[g],y):!1:d[g]===y;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var d=[],g=[],y=0,b=0;b<arguments.length;b++){var M=new o(arguments[b]);d.push(M);for(var P=M.segment(),A=0;A<P.length;A++)typeof P[A]=="string"&&g.push(P[A]),P[A]&&y++}if(!g.length||!y)return new o("");var L=new o("").segment(g);return(d[0].path()===""||d[0].path().slice(0,1)==="/")&&L.path("/"+L.path()),L.normalize()},o.commonPath=function(d,g){var y=Math.min(d.length,g.length),b;for(b=0;b<y;b++)if(d.charAt(b)!==g.charAt(b)){b--;break}return b<1?d.charAt(0)===g.charAt(0)&&d.charAt(0)==="/"?"/":"":((d.charAt(b)!=="/"||g.charAt(b)!=="/")&&(b=d.substring(0,b).lastIndexOf("/")),d.substring(0,b+1))},o.withinString=function(d,g,y){y||(y={});var b=y.start||o.findUri.start,M=y.end||o.findUri.end,P=y.trim||o.findUri.trim,A=y.parens||o.findUri.parens,L=/[a-z0-9-]=["']?$/i;for(b.lastIndex=0;;){var D=b.exec(d);if(!D)break;var X=D.index;if(y.ignoreHtml){var K=d.slice(Math.max(X-3,0),X);if(K&&L.test(K))continue}for(var G=X+d.slice(X).search(M),H=d.slice(X,G),Q=-1;;){var nt=A.exec(H);if(!nt)break;var xt=nt.index+nt[0].length;Q=Math.max(Q,xt)}if(Q>-1?H=H.slice(0,Q)+H.slice(Q).replace(P,""):H=H.replace(P,""),!(H.length<=D[0].length)&&!(y.ignore&&y.ignore.test(H))){G=X+H.length;var dt=g(H,X,G,d);if(dt===void 0){b.lastIndex=G;continue}dt=String(dt),d=d.slice(0,X)+dt+d.slice(G),b.lastIndex=X+dt.length}}return b.lastIndex=0,d},o.ensureValidHostname=function(d,g){var y=!!d,b=!!g,M=!1;if(b&&(M=m(o.hostProtocols,g)),M&&!y)throw new TypeError("Hostname cannot be empty, if protocol is "+g);if(d&&d.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(d).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(d){if(d){var g=Number(d);if(!(a(g)&&g>0&&g<65536))throw new TypeError('Port "'+d+'" is not a valid port')}},o.noConflict=function(d){if(d){var g={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(g.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(g.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(g.SecondLevelDomains=i.SecondLevelDomains.noConflict()),g}else i.URI===this&&(i.URI=s);return this},l.build=function(d){return d===!0?this._deferred_build=!0:(d===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(d){return function(g,y){return g===void 0?this._parts[d]||"":(this._parts[d]=g||null,this.build(!y),this)}}function I(d,g){return function(y,b){return y===void 0?this._parts[d]||"":(y!==null&&(y=y+"",y.charAt(0)===g&&(y=y.substring(1))),this._parts[d]=y,this.build(!b),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=I("query","?"),l.fragment=I("fragment","#"),l.search=function(d,g){var y=this.query(d,g);return typeof y=="string"&&y.length?"?"+y:y},l.hash=function(d,g){var y=this.fragment(d,g);return typeof y=="string"&&y.length?"#"+y:y},l.pathname=function(d,g){if(d===void 0||d===!0){var y=this._parts.path||(this._parts.hostname?"/":"");return d?(this._parts.urn?o.decodeUrnPath:o.decodePath)(y):y}else return this._parts.urn?this._parts.path=d?o.recodeUrnPath(d):"":this._parts.path=d?o.recodePath(d):"/",this.build(!g),this},l.path=l.pathname,l.href=function(d,g){var y;if(d===void 0)return this.toString();this._string="",this._parts=o._parts();var b=d instanceof o,M=typeof d=="object"&&(d.hostname||d.path||d.pathname);if(d.nodeName){var P=o.getDomAttribute(d);d=d[P]||"",M=!1}if(!b&&M&&d.pathname!==void 0&&(d=d.toString()),typeof d=="string"||d instanceof String)this._parts=o.parse(String(d),this._parts);else if(b||M){var A=b?d._parts:d;for(y in A)y!=="query"&&h.call(this._parts,y)&&(this._parts[y]=A[y]);A.query&&this.query(A.query,!1)}else throw new TypeError("invalid input");return this.build(!g),this},l.is=function(d){var g=!1,y=!1,b=!1,M=!1,P=!1,A=!1,L=!1,D=!this._parts.urn;switch(this._parts.hostname&&(D=!1,y=o.ip4_expression.test(this._parts.hostname),b=o.ip6_expression.test(this._parts.hostname),g=y||b,M=!g,P=M&&n&&n.has(this._parts.hostname),A=M&&o.idn_expression.test(this._parts.hostname),L=M&&o.punycode_expression.test(this._parts.hostname)),d.toLowerCase()){case"relative":return D;case"absolute":return!D;case"domain":case"name":return M;case"sld":return P;case"ip":return g;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return b;case"idn":return A;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return L}return null};var F=l.protocol,U=l.port,j=l.hostname;l.protocol=function(d,g){if(d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(o.protocol_expression)))throw new TypeError('Protocol "'+d+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return F.call(this,d,g)},l.scheme=l.protocol,l.port=function(d,g){return this._parts.urn?d===void 0?"":this:(d!==void 0&&(d===0&&(d=null),d&&(d+="",d.charAt(0)===":"&&(d=d.substring(1)),o.ensureValidPort(d))),U.call(this,d,g))},l.hostname=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d!==void 0){var y={preventInvalidHostname:this._parts.preventInvalidHostname},b=o.parseHost(d,y);if(b!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');d=y.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(d,this._parts.protocol)}return j.call(this,d,g)},l.origin=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=this.protocol(),b=this.authority();return b?(y?y+"://":"")+this.authority():""}else{var M=o(d);return this.protocol(M.protocol()).authority(M.authority()).build(!g),this}},l.host=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var y=o.parseHost(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!g),this},l.authority=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var y=o.parseAuthority(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!g),this},l.userinfo=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=o.buildUserinfo(this._parts);return y&&y.substring(0,y.length-1)}else return d[d.length-1]!=="@"&&(d+="@"),o.parseUserinfo(d,this._parts),this.build(!g),this},l.resource=function(d,g){var y;return d===void 0?this.path()+this.search()+this.hash():(y=o.parse(d),this._parts.path=y.path,this._parts.query=y.query,this._parts.fragment=y.fragment,this.build(!g),this)},l.subdomain=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,y)||""}else{var b=this._parts.hostname.length-this.domain().length,M=this._parts.hostname.substring(0,b),P=new RegExp("^"+c(M));if(d&&d.charAt(d.length-1)!=="."&&(d+="."),d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return d&&o.ensureValidHostname(d,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(P,d),this.build(!g),this}},l.domain=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(g=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.match(/\./g);if(y&&y.length<2)return this._parts.hostname;var b=this._parts.hostname.length-this.tld(g).length-1;return b=this._parts.hostname.lastIndexOf(".",b-1)+1,this._parts.hostname.substring(b)||""}else{if(!d)throw new TypeError("cannot set domain empty");if(d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(d,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=d;else{var M=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(M,d)}return this.build(!g),this}},l.tld=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(g=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(y+1);return g!==!0&&n&&n.list[b.toLowerCase()]&&n.get(this._parts.hostname)||b}else{var M;if(d)if(d.match(/[^a-zA-Z0-9-]/))if(n&&n.is(d))M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d);else throw new TypeError('TLD "'+d+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d)}else throw new TypeError("cannot set TLD empty");return this.build(!g),this}},l.directory=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var y=this._parts.path.length-this.filename().length-1,b=this._parts.path.substring(0,y)||(this._parts.hostname?"/":"");return d?o.decodePath(b):b}else{var M=this._parts.path.length-this.filename().length,P=this._parts.path.substring(0,M),A=new RegExp("^"+c(P));return this.is("relative")||(d||(d="/"),d.charAt(0)!=="/"&&(d="/"+d)),d&&d.charAt(d.length-1)!=="/"&&(d+="/"),d=o.recodePath(d),this._parts.path=this._parts.path.replace(A,d),this.build(!g),this}},l.filename=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d!="string"){if(!this._parts.path||this._parts.path==="/")return"";var y=this._parts.path.lastIndexOf("/"),b=this._parts.path.substring(y+1);return d?o.decodePathSegment(b):b}else{var M=!1;d.charAt(0)==="/"&&(d=d.substring(1)),d.match(/\.?\//)&&(M=!0);var P=new RegExp(c(this.filename())+"$");return d=o.recodePath(d),this._parts.path=this._parts.path.replace(P,d),M?this.normalizePath(g):this.build(!g),this}},l.suffix=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path||this._parts.path==="/")return"";var y=this.filename(),b=y.lastIndexOf("."),M,P;return b===-1?"":(M=y.substring(b+1),P=/^[a-z0-9%]+$/i.test(M)?M:"",d?o.decodePathSegment(P):P)}else{d.charAt(0)==="."&&(d=d.substring(1));var A=this.suffix(),L;if(A)d?L=new RegExp(c(A)+"$"):L=new RegExp(c("."+A)+"$");else{if(!d)return this;this._parts.path+="."+o.recodePath(d)}return L&&(d=o.recodePath(d),this._parts.path=this._parts.path.replace(L,d)),this.build(!g),this}},l.segment=function(d,g,y){var b=this._parts.urn?":":"/",M=this.path(),P=M.substring(0,1)==="/",A=M.split(b);if(d!==void 0&&typeof d!="number"&&(y=g,g=d,d=void 0),d!==void 0&&typeof d!="number")throw new Error('Bad segment "'+d+'", must be 0-based integer');if(P&&A.shift(),d<0&&(d=Math.max(A.length+d,0)),g===void 0)return d===void 0?A:A[d];if(d===null||A[d]===void 0)if(f(g)){A=[];for(var L=0,D=g.length;L<D;L++)!g[L].length&&(!A.length||!A[A.length-1].length)||(A.length&&!A[A.length-1].length&&A.pop(),A.push(x(g[L])))}else(g||typeof g=="string")&&(g=x(g),A[A.length-1]===""?A[A.length-1]=g:A.push(g));else g?A[d]=x(g):A.splice(d,1);return P&&A.unshift(""),this.path(A.join(b),y)},l.segmentCoded=function(d,g,y){var b,M,P;if(typeof d!="number"&&(y=g,g=d,d=void 0),g===void 0){if(b=this.segment(d,g,y),!f(b))b=b!==void 0?o.decode(b):void 0;else for(M=0,P=b.length;M<P;M++)b[M]=o.decode(b[M]);return b}if(!f(g))g=typeof g=="string"||g instanceof String?o.encode(g):g;else for(M=0,P=g.length;M<P;M++)g[M]=o.encode(g[M]);return this.segment(d,g,y)};var B=l.query;return l.query=function(d,g){if(d===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="function"){var y=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),b=d.call(this,y);return this._parts.query=o.buildQuery(b||y,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!g),this}else return d!==void 0&&typeof d!="string"?(this._parts.query=o.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!g),this):B.call(this,d,g)},l.setQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="string"||d instanceof String)b[d]=g!==void 0?g:null;else if(typeof d=="object")for(var M in d)h.call(d,M)&&(b[M]=d[M]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=g),this.build(!y),this},l.addQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(b,d,g===void 0?null:g),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=g),this.build(!y),this},l.removeQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(b,d,g),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=g),this.build(!y),this},l.hasQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(b,d,g,y)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(d){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d)),this},l.normalizeHostname=function(d){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d)),this},l.normalizePort=function(d){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d)),this},l.normalizePath=function(d){var g=this._parts.path;if(!g)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!d),this;if(this._parts.path==="/")return this;g=o.recodePath(g);var y,b="",M,P;for(g.charAt(0)!=="/"&&(y=!0,g="/"+g),(g.slice(-3)==="/.."||g.slice(-2)==="/.")&&(g+="/"),g=g.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),y&&(b=g.substring(1).match(/^(\.\.\/)+/)||"",b&&(b=b[0]));M=g.search(/\/\.\.(\/|$)/),M!==-1;){if(M===0){g=g.substring(3);continue}P=g.substring(0,M).lastIndexOf("/"),P===-1&&(P=M),g=g.substring(0,P)+g.substring(M+3)}return y&&this.is("relative")&&(g=b+g.substring(1)),this._parts.path=g,this.build(!d),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(d){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d)),this},l.normalizeFragment=function(d){return this._parts.fragment||(this._parts.fragment=null,this.build(!d)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var d=o.encode,g=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=d,o.decode=g}return this},l.unicode=function(){var d=o.encode,g=o.decode;o.encode=w,o.decode=unescape;try{this.normalize()}finally{o.encode=d,o.decode=g}return this},l.readable=function(){var d=this.clone();d.username("").password("").normalize();var g="";if(d._parts.protocol&&(g+=d._parts.protocol+"://"),d._parts.hostname&&(d.is("punycode")&&t?(g+=t.toUnicode(d._parts.hostname),d._parts.port&&(g+=":"+d._parts.port)):g+=d.host()),d._parts.hostname&&d._parts.path&&d._parts.path.charAt(0)!=="/"&&(g+="/"),g+=d.path(!0),d._parts.query){for(var y="",b=0,M=d._parts.query.split("&"),P=M.length;b<P;b++){var A=(M[b]||"").split("=");y+="&"+o.decodeQuery(A[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),A[1]!==void 0&&(y+="="+o.decodeQuery(A[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}g+="?"+y.substring(1)}return g+=o.decodeQuery(d.hash(),!0),g},l.absoluteTo=function(d){var g=this.clone(),y=["protocol","username","password","hostname","port"],b,M,P;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d instanceof o||(d=new o(d)),g._parts.protocol||(g._parts.protocol=d._parts.protocol,this._parts.hostname))return g;for(M=0;P=y[M];M++)g._parts[P]=d._parts[P];return g._parts.path?(g._parts.path.substring(-2)===".."&&(g._parts.path+="/"),g.path().charAt(0)!=="/"&&(b=d.directory(),b=b||(d.path().indexOf("/")===0?"/":""),g._parts.path=(b?b+"/":"")+g._parts.path,g.normalizePath())):(g._parts.path=d._parts.path,g._parts.query||(g._parts.query=d._parts.query)),g.build(),g},l.relativeTo=function(d){var g=this.clone().normalize(),y,b,M,P,A;if(g._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d=new o(d).normalize(),y=g._parts,b=d._parts,P=g.path(),A=d.path(),P.charAt(0)!=="/")throw new Error("URI is already relative");if(A.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(y.protocol===b.protocol&&(y.protocol=null),y.username!==b.username||y.password!==b.password||y.protocol!==null||y.username!==null||y.password!==null)return g.build();if(y.hostname===b.hostname&&y.port===b.port)y.hostname=null,y.port=null;else return g.build();if(P===A)return y.path="",g.build();if(M=o.commonPath(P,A),!M)return g.build();var L=b.path.substring(M.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return y.path=L+y.path.substring(M.length)||"./",g.build()},l.equals=function(d){var g=this.clone(),y=new o(d),b={},M={},P={},A,L,D;if(g.normalize(),y.normalize(),g.toString()===y.toString())return!0;if(A=g.query(),L=y.query(),g.query(""),y.query(""),g.toString()!==y.toString()||A.length!==L.length)return!1;b=o.parseQuery(A,this._parts.escapeQuerySpace),M=o.parseQuery(L,this._parts.escapeQuerySpace);for(D in b)if(h.call(b,D)){if(f(b[D])){if(!_(b[D],M[D]))return!1}else if(b[D]!==M[D])return!1;P[D]=!0}for(D in M)if(h.call(M,D)&&!P[D])return!1;return!0},l.preventInvalidHostname=function(d){return this._parts.preventInvalidHostname=!!d,this},l.duplicateQueryParameters=function(d){return this._parts.duplicateQueryParameters=!!d,this},l.escapeQuerySpace=function(d){return this._parts.escapeQuerySpace=!!d,this},o})})(xm);var H1=xm.exports;const Uf=Z1(H1);function K1(r){return typeof r=="string"&&r.startsWith("/vsi")&&!r.startsWith("/vsicurl/")}function Bf(r,t,e=!0){return Q1(r,t,!1,e)}function Q1(r,t=null,e=!1,n=!0){typeof r=="string"&&r.startsWith("/vsicurl/")&&(r=r.replace(/^\/vsicurl\//,""));let i=Uf(r);if(t&&i.is("relative")&&!K1(r)){let s=Uf(t),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),e&&(i.query(""),i.fragment("")),n?i.toString():i}/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */var Xf;(function(r){r.direct="direct",r.patchObject="patch object",r.patchFunction="patch function"})(Xf||(Xf={}));function J1(r){{r=F1(r);const t={};for(const e in r){const n=r[e];(N1(n)||D1(n))&&(t[e]=k1(r,e))}return t}}var tx=Object.defineProperty,ex=(r,t,e)=>t in r?tx(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,vu=(r,t,e)=>(ex(r,typeof t!="symbol"?t+"":t,e),e);class cn{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const wu={PROPERTYCHANGE:"propertychange"};class bu{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function rx(r,t,e){let n,i;e=e||rn;let s=0,o=r.length,a=!1;for(;s<o;)n=s+(o-s>>1),i=+e(r[n],t),i<0?s=n+1:(o=n,a=!i);return a?s:~s}function rn(r,t){return r>t?1:r<t?-1:0}function nx(r,t){return r<t?1:r>t?-1:0}function Ql(r,t,e){if(r[0]<=t)return 0;const n=r.length;if(t<=r[n-1])return n-1;if(typeof e=="function"){for(let i=1;i<n;++i){const s=r[i];if(s===t)return i;if(s<t)return e(t,r[i-1],s)>0?i-1:i}return n-1}if(e>0){for(let i=1;i<n;++i)if(r[i]<t)return i-1;return n-1}if(e<0){for(let i=1;i<n;++i)if(r[i]<=t)return i;return n-1}for(let i=1;i<n;++i){if(r[i]==t)return i;if(r[i]<t)return r[i-1]-t<t-r[i]?i-1:i}return n-1}function ix(r,t,e){for(;t<e;){const n=r[t];r[t]=r[e],r[e]=n,++t,--e}}function Ot(r,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let i=0;i<n;i++)r[r.length]=e[i]}function ji(r,t){const e=r.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}function sx(r,t,e){const n=t||rn;return r.every(function(i,s){if(s===0)return!0;const o=n(r[s-1],i);return!(o>0||e&&o===0)})}function ox(){return!0}function zo(){}function vm(r){let t=!1,e,n,i;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==i||!ji(s,n))&&(t=!0,i=this,n=s,e=r.apply(this,arguments)),e}}function wm(r){function t(){let e;try{e=r()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Xs(r){for(const t in r)delete r[t]}function Pn(r){let t;for(t in r)return!1;return!t}class ha extends bu{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(e)||i.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const s=e?new cn(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=i.length;h<c;++h)if("handleEvent"in i[h]?l=i[h].handleEvent(s):l=i[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,zo);delete o[n]}return l}disposeInternal(){this.listeners_&&Xs(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const i=n.indexOf(e);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=zo,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}}const Lt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function le(r,t,e,n,i){if(n&&n!==r&&(e=e.bind(n)),i){const o=e;e=function(){r.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:r,type:t,listener:e};return r.addEventListener(t,e),s}function Uo(r,t,e,n){return le(r,t,e,n,!0)}function ve(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),Xs(r))}class ca extends ha{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Lt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=le(this,t[s],e);return i}return le(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const i=t.length;n=new Array(i);for(let s=0;s<i;++s)n[s]=Uo(this,t[s],e)}else n=Uo(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)ax(n);else if(Array.isArray(t))for(let i=0,s=t.length;i<s;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}}ca.prototype.on;ca.prototype.once;ca.prototype.un;function ax(r){if(Array.isArray(r))for(let t=0,e=r.length;t<e;++t)ve(r[t]);else ve(r)}function ct(){throw new Error("Unimplemented abstract method.")}let lx=0;function it(r){return r.ol_uid||(r.ol_uid=String(++lx))}class qf extends cn{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class zi extends ca{constructor(t){super(),this.on,this.once,this.un,it(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new qf(n,t,e)),n=wu.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new qf(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const i=this.values_||(this.values_={});if(n)i[t]=e;else{const s=i[t];i[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],Pn(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}function At(r,t){if(!r)throw new Error(t)}class Se extends zi{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Se(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ve(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=le(t,Lt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?hx(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function hx(r){if(typeof r=="function")return r;let t;return Array.isArray(r)?t=r:(At(typeof r.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[r]),function(){return t}}const Su=new Array(6);function pe(){return[1,0,0,1,0,0]}function Ac(r){return Jl(r,1,0,0,1,0,0)}function qs(r,t){const e=r[0],n=r[1],i=r[2],s=r[3],o=r[4],a=r[5],l=t[0],h=t[1],c=t[2],u=t[3],f=t[4],p=t[5];return r[0]=e*l+i*h,r[1]=n*l+s*h,r[2]=e*c+i*u,r[3]=n*c+s*u,r[4]=e*f+i*p+o,r[5]=n*f+s*p+a,r}function Jl(r,t,e,n,i,s,o){return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r[4]=s,r[5]=o,r}function cx(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function ae(r,t){const e=t[0],n=t[1];return t[0]=r[0]*e+r[2]*n+r[4],t[1]=r[1]*e+r[3]*n+r[5],t}function ux(r,t){const e=Math.cos(t),n=Math.sin(t);return qs(r,Jl(Su,e,n,-n,e,0,0))}function Mo(r,t,e){return qs(r,Jl(Su,t,0,0,e,0,0))}function Eu(r,t,e){return qs(r,Jl(Su,1,0,0,1,t,e))}function or(r,t,e,n,i,s,o,a){const l=Math.sin(s),h=Math.cos(s);return r[0]=n*h,r[1]=i*l,r[2]=-n*l,r[3]=i*h,r[4]=o*n*h-a*n*l+t,r[5]=o*i*l+a*i*h+e,r}function th(r,t){const e=dx(t);At(e!==0,"Transformation matrix cannot be inverted");const n=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return r[0]=o/e,r[1]=-i/e,r[2]=-s/e,r[3]=n/e,r[4]=(s*l-o*a)/e,r[5]=-(n*l-i*a)/e,r}function dx(r){return r[0]*r[3]-r[1]*r[2]}const Wf=[1e6,1e6,1e6,1e6,2,2];function Tu(r){return"matrix("+r.map((t,e)=>Math.round(t*Wf[e])/Wf[e]).join(", ")+")"}const Te={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Is(r){const t=je();for(let e=0,n=r.length;e<n;++e)Ro(t,r[e]);return t}function fx(r,t,e){const n=Math.min.apply(null,r),i=Math.min.apply(null,t),s=Math.max.apply(null,r),o=Math.max.apply(null,t);return jr(n,i,s,o,e)}function Mr(r,t,e){return e?(e[0]=r[0]-t,e[1]=r[1]-t,e[2]=r[2]+t,e[3]=r[3]+t,e):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function gx(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function Ui(r,t,e){let n,i;return t<r[0]?n=r[0]-t:r[2]<t?n=t-r[2]:n=0,e<r[1]?i=r[1]-e:r[3]<e?i=e-r[3]:i=0,n*n+i*i}function mr(r,t){return Mu(r,t[0],t[1])}function We(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function Mu(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function Lc(r,t){const e=r[0],n=r[1],i=r[2],s=r[3],o=t[0],a=t[1];let l=Te.UNKNOWN;return o<e?l=l|Te.LEFT:o>i&&(l=l|Te.RIGHT),a<n?l=l|Te.BELOW:a>s&&(l=l|Te.ABOVE),l===Te.UNKNOWN&&(l=Te.INTERSECTING),l}function je(){return[1/0,1/0,-1/0,-1/0]}function jr(r,t,e,n,i){return i?(i[0]=r,i[1]=t,i[2]=e,i[3]=n,i):[r,t,e,n]}function ua(r){return jr(1/0,1/0,-1/0,-1/0,r)}function Ru(r,t){const e=r[0],n=r[1];return jr(e,n,e,n,t)}function Cu(r,t,e,n,i){const s=ua(i);return Sm(s,r,t,e,n)}function An(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function px(r,t,e){return Math.abs(r[0]-t[0])<e&&Math.abs(r[2]-t[2])<e&&Math.abs(r[1]-t[1])<e&&Math.abs(r[3]-t[3])<e}function bm(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function Ro(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function Sm(r,t,e,n,i){for(;e<n;e+=i)mx(r,t[e],t[e+1]);return r}function mx(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function Em(r,t){let e;return e=t(da(r)),e||(e=t(eh(r)),e)||(e=t(fa(r)),e)||(e=t(Dn(r)),e)?e:!1}function Bo(r){let t=0;return kn(r)||(t=yt(r)*Vt(r)),t}function da(r){return[r[0],r[1]]}function eh(r){return[r[2],r[1]]}function Re(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function _x(r,t){let e;if(t==="bottom-left")e=da(r);else if(t==="bottom-right")e=eh(r);else if(t==="top-left")e=Dn(r);else if(t==="top-right")e=fa(r);else throw new Error("Invalid corner");return e}function Iu(r,t,e,n,i){const[s,o,a,l,h,c,u,f]=Oc(r,t,e,n);return jr(Math.min(s,a,h,u),Math.min(o,l,c,f),Math.max(s,a,h,u),Math.max(o,l,c,f),i)}function Oc(r,t,e,n){const i=t*n[0]/2,s=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=i*o,h=i*a,c=s*o,u=s*a,f=r[0],p=r[1];return[f-l+u,p-h-c,f-l-u,p-h+c,f+l-u,p+h+c,f+l+u,p+h-c,f-l+u,p-h-c]}function Vt(r){return r[3]-r[1]}function we(r,t,e){const n=e||je();return Qt(r,t)?(r[0]>t[0]?n[0]=r[0]:n[0]=t[0],r[1]>t[1]?n[1]=r[1]:n[1]=t[1],r[2]<t[2]?n[2]=r[2]:n[2]=t[2],r[3]<t[3]?n[3]=r[3]:n[3]=t[3]):ua(n),n}function Dn(r){return[r[0],r[3]]}function fa(r){return[r[2],r[3]]}function yt(r){return r[2]-r[0]}function Qt(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function kn(r){return r[2]<r[0]||r[3]<r[1]}function yx(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function Tm(r,t){const e=(r[2]-r[0])/2*(t-1),n=(r[3]-r[1])/2*(t-1);r[0]-=e,r[2]+=e,r[1]-=n,r[3]+=n}function xx(r,t,e){let n=!1;const i=Lc(r,t),s=Lc(r,e);if(i===Te.INTERSECTING||s===Te.INTERSECTING)n=!0;else{const o=r[0],a=r[1],l=r[2],h=r[3],c=t[0],u=t[1],f=e[0],p=e[1],m=(p-u)/(f-c);let _,x;s&Te.ABOVE&&!(i&Te.ABOVE)&&(_=f-(p-h)/m,n=_>=o&&_<=l),!n&&s&Te.RIGHT&&!(i&Te.RIGHT)&&(x=p-(f-l)*m,n=x>=a&&x<=h),!n&&s&Te.BELOW&&!(i&Te.BELOW)&&(_=f-(p-a)/m,n=_>=o&&_<=l),!n&&s&Te.LEFT&&!(i&Te.LEFT)&&(x=p-(f-o)*m,n=x>=a&&x<=h)}return n}function Ps(r,t,e,n){if(kn(r))return ua(e);let i=[];if(n>1){const a=r[2]-r[0],l=r[3]-r[1];for(let h=0;h<n;++h)i.push(r[0]+a*h/n,r[1],r[2],r[1]+l*h/n,r[2]-a*h/n,r[3],r[0],r[3]-l*h/n)}else i=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]];t(i,i,2);const s=[],o=[];for(let a=0,l=i.length;a<l;a+=2)s.push(i[a]),o.push(i[a+1]);return fx(s,o,e)}function Pu(r,t){const e=t.getExtent(),n=Re(r);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const i=yt(e),s=Math.floor((n[0]-e[0])/i)*i;r[0]-=s,r[2]-=s}return r}function vx(r,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[e[0],r[1],e[2],r[3]]];Pu(r,t);const n=yt(e);if(yt(r)>n)return[[e[0],r[1],e[2],r[3]]];if(r[0]<e[0])return[[r[0]+n,r[1],e[2],r[3]],[e[0],r[1],r[2],r[3]]];if(r[2]>e[2])return[[r[0],r[1],e[2],r[3]],[e[0],r[1],r[2]-n,r[3]]]}return[r]}const wx={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function Zf(r){return wx[r]}const Xo={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let As=class{constructor(r){this.code_=r.code,this.units_=r.units,this.extent_=r.extent!==void 0?r.extent:null,this.worldExtent_=r.worldExtent!==void 0?r.worldExtent:null,this.axisOrientation_=r.axisOrientation!==void 0?r.axisOrientation:"enu",this.global_=r.global!==void 0?r.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=r.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=r.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Xo[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(r){this.global_=r,this.canWrapX_=!!(r&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(r){this.defaultTileGrid_=r}setExtent(r){this.extent_=r,this.canWrapX_=!!(this.global_&&r)}setWorldExtent(r){this.worldExtent_=r}setGetPointResolution(r){this.getPointResolutionFunc_=r}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const ga=6378137,ds=Math.PI*ga,bx=[-ds,-ds,ds,ds],Sx=[-180,-85,180,85],za=ga*Math.log(Math.tan(Math.PI/2));class Vi extends As{constructor(t){super({code:t,units:"m",extent:bx,global:!0,worldExtent:Sx,getPointResolution:function(e,n){return e/Math.cosh(n[1]/ga)}})}}const $f=[new Vi("EPSG:3857"),new Vi("EPSG:102100"),new Vi("EPSG:102113"),new Vi("EPSG:900913"),new Vi("http://www.opengis.net/def/crs/EPSG/0/3857"),new Vi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Ex(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let i=0;i<n;i+=e){t[i]=ds*r[i]/180;let s=ga*Math.log(Math.tan(Math.PI*(+r[i+1]+90)/360));s>za?s=za:s<-za&&(s=-za),t[i+1]=s}return t}function Tx(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let i=0;i<n;i+=e)t[i]=180*r[i]/ds,t[i+1]=360*Math.atan(Math.exp(r[i+1]/ga))/Math.PI-90;return t}const Mx=6378137,Vf=[-180,-90,180,90],Rx=Math.PI*Mx/180;class yi extends As{constructor(t,e){super({code:t,units:"degrees",extent:Vf,axisOrientation:e,global:!0,metersPerUnit:Rx,worldExtent:Vf})}}const Yf=[new yi("CRS:84"),new yi("EPSG:4326","neu"),new yi("urn:ogc:def:crs:OGC:1.3:CRS84"),new yi("urn:ogc:def:crs:OGC:2:84"),new yi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new yi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new yi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Fc={};function Cx(r){return Fc[r]||Fc[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Ix(r,t){Fc[r]=t}let bs={};function Ls(r,t,e){const n=r.getCode(),i=t.getCode();n in bs||(bs[n]={}),bs[n][i]=e}function Mm(r,t){let e;return r in bs&&t in bs[r]&&(e=bs[r][t]),e}function wt(r,t,e){return Math.min(Math.max(r,t),e)}function Rm(r,t,e,n,i,s){const o=i-e,a=s-n;if(o!==0||a!==0){const l=((r-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=i,n=s):l>0&&(e+=o*l,n+=a*l)}return Mi(r,t,e,n)}function Mi(r,t,e,n){const i=e-r,s=n-t;return i*i+s*s}function Px(r){const t=r.length;for(let n=0;n<t;n++){let i=n,s=Math.abs(r[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(r[a][n]);l>s&&(s=l,i=a)}if(s===0)return null;const o=r[i];r[i]=r[n],r[n]=o;for(let a=n+1;a<t;a++){const l=-r[a][n]/r[n][n];for(let h=n;h<t+1;h++)n==h?r[a][h]=0:r[a][h]+=l*r[n][h]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=r[n][t]/r[n][n];for(let i=n-1;i>=0;i--)r[i][t]-=r[i][n]*e[n]}return e}function Co(r){return r*Math.PI/180}function nn(r,t){const e=r%t;return e*t<0?e+t:e}function fr(r,t,e){return r+e*(t-r)}function pa(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function gl(r,t){return Math.round(pa(r,t))}function fs(r,t){return Math.floor(pa(r,t))}function Qn(r,t){return Math.ceil(pa(r,t))}function wi(r,t,e){const n=e!==void 0?r.toFixed(e):""+r;let i=n.indexOf(".");return i=i===-1?n.length:i,i>t?n:new Array(1+t-i).join("0")+n}function Au(r,t){const e=(""+r).split("."),n=(""+t).split(".");for(let i=0;i<Math.max(e.length,n.length);i++){const s=parseInt(e[i]||"0",10),o=parseInt(n[i]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function Cm(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function Hf(r,t,e){const n=nn(t+180,360)-180,i=Math.abs(3600*n),s=e||0;let o=Math.floor(i/3600),a=Math.floor((i-o*3600)/60),l=pa(i-o*3600-a*60,s);l>=60&&(l=0,a+=1),a>=60&&(a=0,o+=1);let h=o+"°";return(a!==0||l!==0)&&(h+=" "+wi(a,2)+"′"),l!==0&&(h+=" "+wi(l,2,s)+"″"),n!==0&&(h+=" "+r.charAt(n<0?1:0)),h}function pl(r,t){let e=!0;for(let n=r.length-1;n>=0;--n)if(r[n]!=t[n]){e=!1;break}return e}function Ax(r,t){const e=Math.cos(t),n=Math.sin(t),i=r[0]*e-r[1]*n,s=r[1]*e+r[0]*n;return r[0]=i,r[1]=s,r}function Lx(r,t){return r[0]*=t,r[1]*=t,r}function Im(r,t){if(t.canWrapX()){const e=yt(t.getExtent()),n=Pm(r,t,e);n&&(r[0]-=n*e)}return r}function Pm(r,t,e){const n=t.getExtent();let i=0;return t.canWrapX()&&(r[0]<n[0]||r[0]>n[2])&&(e=e||yt(n),i=Math.floor((r[0]-n[0])/e)),i}const Ox=63710088e-1;function Kf(r,t,e){e=e||Ox;const n=Co(r[1]),i=Co(t[1]),s=(i-n)/2,o=Co(t[0]-r[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(i);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Fx(...r){console.warn(...r)}function ml(...r){console.error(...r)}let Nc=!0;function Nx(r){Nc=!(r===void 0||r)}function Lu(r,t){if(t!==void 0){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];t=t}else t=r.slice();return t}function Am(r,t){if(t!==void 0&&r!==t){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];r=t}return r}function Lm(r){Ix(r.getCode(),r),Ls(r,r,Lu)}function Dx(r){r.forEach(Lm)}function tt(r){return typeof r=="string"?Cx(r):r||null}function Qf(r,t,e,n){r=tt(r);let i;const s=r.getPointResolutionFunc();if(s){if(i=s(t,e),n&&n!==r.getUnits()){const o=r.getMetersPerUnit();o&&(i=i*o/Xo[n])}}else{const o=r.getUnits();if(o=="degrees"&&!n||n=="degrees")i=t;else{const a=Bi(r,tt("EPSG:4326"));if(a===Am&&o!=="degrees")i=t*r.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=Kf(h.slice(0,2),h.slice(2,4)),u=Kf(h.slice(4,6),h.slice(6,8));i=(c+u)/2}const l=n?Xo[n]:r.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function Dc(r){Dx(r),r.forEach(function(t){r.forEach(function(e){t!==e&&Ls(t,e,Lu)})})}function kx(r,t,e,n){r.forEach(function(i){t.forEach(function(s){Ls(i,s,e),Ls(s,i,n)})})}function Ou(r,t){return r?typeof r=="string"?tt(r):r:tt(t)}function Jf(r){return function(t,e,n){const i=t.length;n=n!==void 0?n:2,e=e!==void 0?e:new Array(i);for(let s=0;s<i;s+=n){const o=r(t.slice(s,s+n)),a=o.length;for(let l=0,h=n;l<h;++l)e[s+l]=l>=a?t[s+l]:o[l]}return e}}function Gx(r,t,e,n){const i=tt(r),s=tt(t);Ls(i,s,Jf(e)),Ls(s,i,Jf(n))}function tg(r,t){const e=rh(r,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=e[0];return(n<-180||n>180)&&(e[0]=nn(n+180,360)-180),e}function Pe(r,t){if(r===t)return!0;const e=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||Bi(r,t)===Lu)&&e}function Bi(r,t){const e=r.getCode(),n=t.getCode();let i=Mm(e,n);return i||(i=Am),i}function on(r,t){const e=tt(r),n=tt(t);return Bi(e,n)}function rh(r,t,e){return on(t,e)(r,void 0,r.length)}function Fu(r,t,e,n){const i=on(t,e);return Ps(r,i,void 0,n)}let jx=null;function zx(){return jx}function kc(r,t){return r}function Xn(r,t){return Nc&&!pl(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(Nc=!1,Fx("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function nh(r,t){return r}function Nr(r,t){return r}function eg(r,t,e){return function(n){let i,s;if(r.canWrapX()){const o=r.getExtent(),a=yt(o);n=n.slice(0),s=Pm(n,r,a),s&&(n[0]=n[0]-s*a),n[0]=wt(n[0],o[0],o[2]),n[1]=wt(n[1],o[1],o[3]),i=e(n)}else i=e(n);return s&&t.canWrapX()&&(i[0]+=s*yt(t.getExtent())),i}}function Ux(){Dc($f),Dc(Yf),kx(Yf,$f,Ex,Tx)}Ux();function ii(r,t,e,n,i,s){s=s||[];let o=0;for(let a=t;a<e;a+=n){const l=r[a],h=r[a+1];s[o++]=i[0]*l+i[2]*h+i[4],s[o++]=i[1]*l+i[3]*h+i[5]}return s&&s.length!=o&&(s.length=o),s}function Om(r,t,e,n,i,s,o){o=o||[];const a=Math.cos(i),l=Math.sin(i),h=s[0],c=s[1];let u=0;for(let f=t;f<e;f+=n){const p=r[f]-h,m=r[f+1]-c;o[u++]=h+p*a-m*l,o[u++]=c+p*l+m*a;for(let _=f+2;_<f+n;++_)o[u++]=r[_]}return o&&o.length!=u&&(o.length=u),o}function Bx(r,t,e,n,i,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=n){const f=r[u]-l,p=r[u+1]-h;a[c++]=l+i*f,a[c++]=h+s*p;for(let m=u+2;m<u+n;++m)a[c++]=r[m]}return a&&a.length!=c&&(a.length=c),a}function Xx(r,t,e,n,i,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=r[l]+i,o[a++]=r[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=r[h]}return o&&o.length!=a&&(o.length=a),o}const rg=pe();class Nu extends zi{constructor(){super(),this.extent_=je(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=vm((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ct()}closestPointXY(t,e,n,i){return ct()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ct()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&ua(e),this.extentRevision_=this.getRevision()}return yx(this.extent_,t)}rotate(t,e){ct()}scale(t,e,n){ct()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ct()}getType(){return ct()}applyTransform(t){ct()}intersectsExtent(t){return ct()}translate(t,e){ct()}transform(t,e){const n=tt(t),i=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=Vt(h)/Vt(l);return or(rg,h[0],h[3],c,-c,0,0,0),ii(s,0,s.length,a,rg,o),on(n,e)(s,o,a)}:on(n,e);return this.applyTransform(i),this}}class qx extends Nu{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Cu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ct()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Gc(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ct()}setLayout(t,e,n){let i;if(t)i=Gc(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}i=e.length,t=Xi(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();Om(n,0,n.length,i,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Re(this.getExtent()));const i=this.getFlatCoordinates();if(i){const s=this.getStride();Bx(i,0,i.length,s,t,e,n,i),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();Xx(n,0,n.length,i,t,e,n),this.changed()}}}function Xi(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function Gc(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}function Wx(r,t,e){const n=r.getFlatCoordinates();if(!n)return null;const i=r.getStride();return ii(n,0,n.length,i,t,e)}const Ln=qx;function Zx(r,t,e,n){for(let i=0,s=e.length;i<s;++i)r[t++]=e[i];return t}function ma(r,t,e,n){for(let i=0,s=e.length;i<s;++i){const o=e[i];for(let a=0;a<n;++a)r[t++]=o[a]}return t}function _a(r,t,e,n,i){i=i||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=ma(r,t,e[o],n);i[s++]=l,t=l}return i.length=s,i}function Fm(r,t,e,n,i){i=i||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=_a(r,t,e[o],n,i[s]);l.length===0&&(l[0]=t),i[s++]=l,t=l[l.length-1]}return i.length=s,i}class _l extends Nu{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(ve),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(le(t[e],Lt.CHANGE,this.changed,this))}clone(){const t=new _l(Vh(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,i){if(i<Ui(this.getExtent(),t,e))return i;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)i=s[o].closestPointXY(t,e,n,i);return i}containsXY(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)if(n[i].containsXY(t,e))return!0;return!1}computeExtent(t){ua(t);const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)bm(t,e[n].getExtent());return t}getGeometries(){return Vh(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let i=!1;for(let s=0,o=n.length;s<o;++s){const a=n[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(i=!0)}return i?new _l(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)n[i].rotate(t,e);this.changed()}scale(t,e,n){n||(n=Re(this.getExtent()));const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)i[s].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(Vh(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)n[i].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Vh(r){return r.map(t=>t.clone())}const Ge=_l;function ng(r,t,e,n,i,s,o){const a=r[t],l=r[t+1],h=r[e]-a,c=r[e+1]-l;let u;if(h===0&&c===0)u=t;else{const f=((i-a)*h+(s-l)*c)/(h*h+c*c);if(f>1)u=e;else if(f>0){for(let p=0;p<n;++p)o[p]=fr(r[t+p],r[e+p],f);o.length=n;return}else u=t}for(let f=0;f<n;++f)o[f]=r[u+f];o.length=n}function Du(r,t,e,n,i){let s=r[t],o=r[t+1];for(t+=n;t<e;t+=n){const a=r[t],l=r[t+1],h=Mi(s,o,a,l);h>i&&(i=h),s=a,o=l}return i}function ku(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];i=Du(r,t,a,n,i),t=a}return i}function $x(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];i=ku(r,t,a,n,i),t=a[a.length-1]}return i}function Gu(r,t,e,n,i,s,o,a,l,h,c){if(t==e)return h;let u,f;if(i===0){if(f=Mi(o,a,r[t],r[t+1]),f<h){for(u=0;u<n;++u)l[u]=r[t+u];return l.length=n,f}return h}c=c||[NaN,NaN];let p=t+n;for(;p<e;)if(ng(r,p-n,p,n,o,a,c),f=Mi(o,a,c[0],c[1]),f<h){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n,p+=n}else p+=n*Math.max((Math.sqrt(f)-Math.sqrt(h))/i|0,1);if(s&&(ng(r,e-n,t,n,o,a,c),f=Mi(o,a,c[0],c[1]),f<h)){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function ju(r,t,e,n,i,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,f=e.length;u<f;++u){const p=e[u];h=Gu(r,t,p,n,i,s,o,a,l,h,c),t=p}return h}function Vx(r,t,e,n,i,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,f=e.length;u<f;++u){const p=e[u];h=ju(r,t,p,n,i,s,o,a,l,h,c),t=p[p.length-1]}return h}function ih(r,t,e,n,i,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=r[t],s[o++]=r[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),f=h.pop();let p=0;const m=r[f],_=r[f+1],x=r[u],v=r[u+1];for(let w=f+n;w<u;w+=n){const S=r[w],E=r[w+1],T=Rm(S,E,m,_,x,v);T>p&&(c=w,p=T)}p>i&&(l[(c-t)/n]=1,f+n<c&&h.push(f,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=r[t+u*n],s[o++]=r[t+u*n+1]);return o}function Nm(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=ih(r,t,c,n,i,s,o),a.push(o),t=c}return o}function vi(r,t){return t*Math.round(r/t)}function Yx(r,t,e,n,i,s,o){if(t==e)return o;let a=vi(r[t],i),l=vi(r[t+1],i);t+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=vi(r[t],i),c=vi(r[t+1],i),t+=n,t==e)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=vi(r[t],i),f=vi(r[t+1],i);if(t+=n,u==h&&f==c)continue;const p=h-a,m=c-l,_=u-a,x=f-l;if(p*x==m*_&&(p<0&&_<p||p==_||p>0&&_>p)&&(m<0&&x<m||m==x||m>0&&x>m)){h=u,c=f;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=f}return s[o++]=h,s[o++]=c,o}function zu(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Yx(r,t,c,n,i,s,o),a.push(o),t=c}return o}function Hx(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];o=zu(r,t,c,n,i,s,o,u),a.push(u),t=c[c.length-1]}return o}function En(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=t;o<e;o+=n)i[s++]=r.slice(o,o+n);return i.length=s,i}function qo(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];i[s++]=En(r,t,l,n,i[s]),t=l}return i.length=s,i}function jc(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];i[s++]=l.length===1&&l[0]===t?[]:qo(r,t,l,n,i[s]),t=l[l.length-1]}return i.length=s,i}function Dm(r,t,e,n){let i=0,s=r[e-n],o=r[e-n+1];for(;t<e;t+=n){const a=r[t],l=r[t+1];i+=o*a-s*l,s=a,o=l}return i/2}function km(r,t,e,n){let i=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];i+=Dm(r,t,a,n),t=a}return i}function Kx(r,t,e,n){let i=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];i+=km(r,t,a,n),t=a[a.length-1]}return i}class ai extends Ln{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new ai(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,i){return i<Ui(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Du(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Gu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,i))}getArea(){return Dm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return En(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ai(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ma(this.flatCoordinates,0,t,this.stride),this.changed()}}function Gm(r,t,e,n,i){let s;for(t+=n;t<e;t+=n)if(s=i(r.slice(t-n,t),r.slice(t,t+n)),s)return s;return!1}function yl(r,t,e,n,i,s,o){let a,l;const h=(e-t)/n;if(h===1)a=t;else if(h===2)a=t,l=i;else if(h!==0){let c=r[t],u=r[t+1],f=0;const p=[0];for(let x=t+n;x<e;x+=n){const v=r[x],w=r[x+1];f+=Math.sqrt((v-c)*(v-c)+(w-u)*(w-u)),p.push(f),c=v,u=w}const m=i*f,_=rx(p,m);_<0?(l=(m-p[-_-2])/(p[-_-1]-p[-_-2]),a=t+(-_-2)*n):a=t+_*n}o=o>1?o:2,s=s||new Array(o);for(let c=0;c<o;++c)s[c]=a===void 0?NaN:l===void 0?r[a+c]:fr(r[a+c],r[a+n+c],l);return s}function zc(r,t,e,n,i,s){if(e==t)return null;let o;if(i<r[t+n-1])return s?(o=r.slice(t,t+n),o[n-1]=i,o):null;if(r[e-1]<i)return s?(o=r.slice(e-n,e),o[n-1]=i,o):null;if(i==r[t+n-1])return r.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const f=a+l>>1;i<r[(f+1)*n-1]?l=f:a=f+1}const h=r[a*n-1];if(i==h)return r.slice((a-1)*n,(a-1)*n+n);const c=r[(a+1)*n-1],u=(i-h)/(c-h);o=[];for(let f=0;f<n-1;++f)o.push(fr(r[(a-1)*n+f],r[a*n+f],u));return o.push(i),o}function Qx(r,t,e,n,i,s,o){if(o)return zc(r,t,e[e.length-1],n,i,s);let a;if(i<r[n-1])return s?(a=r.slice(0,n),a[n-1]=i,a):null;if(r[r.length-1]<i)return s?(a=r.slice(r.length-n),a[n-1]=i,a):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(i<r[t+n-1])return null;if(i<=r[c-1])return zc(r,t,c,n,i,!1);t=c}}return null}function Jx(r,t,e,n,i){return!Em(i,function(s){return!bi(r,t,e,n,s[0],s[1])})}function bi(r,t,e,n,i,s){let o=0,a=r[e-n],l=r[e-n+1];for(;t<e;t+=n){const h=r[t],c=r[t+1];l<=s?c>s&&(h-a)*(s-l)-(i-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(i-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Uu(r,t,e,n,i,s){if(e.length===0||!bi(r,t,e[0],n,i,s))return!1;for(let o=1,a=e.length;o<a;++o)if(bi(r,e[o-1],e[o],n,i,s))return!1;return!0}function tv(r,t,e,n,i,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(Uu(r,t,l,n,i,s))return!0;t=l[l.length-1]}return!1}function sh(r,t,e,n,i){const s=Sm(je(),r,t,e,n);return Qt(i,s)?We(i,s)||s[0]>=i[0]&&s[2]<=i[2]||s[1]>=i[1]&&s[3]<=i[3]?!0:Gm(r,t,e,n,function(o,a){return xx(i,o,a)}):!1}function ev(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){if(sh(r,t,e[s],n,i))return!0;t=e[s]}return!1}function jm(r,t,e,n,i){return!!(sh(r,t,e,n,i)||bi(r,t,e,n,i[0],i[1])||bi(r,t,e,n,i[0],i[3])||bi(r,t,e,n,i[2],i[1])||bi(r,t,e,n,i[2],i[3]))}function zm(r,t,e,n,i){if(!jm(r,t,e[0],n,i))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(Jx(r,e[s-1],e[s],n,i)&&!sh(r,e[s-1],e[s],n,i))return!1;return!0}function rv(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(zm(r,t,a,n,i))return!0;t=a[a.length-1]}return!1}function Um(r,t,e,n){let i=r[t],s=r[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=r[a],h=r[a+1];o+=Math.sqrt((l-i)*(l-i)+(h-s)*(h-s)),i=l,s=h}return o}class ye extends Ln{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Ot(this.flatCoordinates,t),this.changed()}clone(){const t=new ye(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Ui(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Du(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Gu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,i))}forEachSegment(t){return Gm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,zc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return En(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return yl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Um(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ye(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ma(this.flatCoordinates,0,t,this.stride),this.changed()}}class ar extends Ln{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const i=t,s=[],o=[];for(let l=0,h=i.length;l<h;++l){const c=i[l];Ot(s,c.getFlatCoordinates()),o.push(s.length)}const a=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(t){Ot(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ar(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Ui(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ku(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ju(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,i))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,Qx(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return qo(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new ye(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,i=[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new ye(t.slice(s,l),n);i.push(h),s=l}return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const i=this.ends_,s=this.stride;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=yl(e,n,l,s,.5);Ot(t,h),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Nm(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new ar(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return ev(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=_a(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}let Me=class Bm extends Ln{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Bm(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){const s=this.flatCoordinates,o=Mi(t,e,s[0],s[1]);if(o<i){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Ru(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Mu(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Zx(this.flatCoordinates,0,t,this.stride),this.changed()}};class Xr extends Ln{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Ot(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Xr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){if(i<Ui(this.getExtent(),t,e))return i;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=Mi(t,e,s[a],s[a+1]);if(h<i){i=h;for(let c=0;c<o;++c)n[c]=s[a+c];n.length=o}}return i}getCoordinates(){return En(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Me(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,i=[];for(let s=0,o=t.length;s<o;s+=n){const a=new Me(t.slice(s,s+n),e);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let i=0,s=e.length;i<s;i+=n){const o=e[i],a=e[i+1];if(Mu(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ma(this.flatCoordinates,0,t,this.stride),this.changed()}}function Bu(r,t,e,n,i,s,o){let a,l,h,c,u,f,p;const m=i[s+1],_=[];for(let w=0,S=e.length;w<S;++w){const E=e[w];for(c=r[E-n],f=r[E-n+1],a=t;a<E;a+=n)u=r[a],p=r[a+1],(m<=f&&p<=m||f<=m&&m<=p)&&(h=(m-f)/(p-f)*(u-c)+c,_.push(h)),c=u,f=p}let x=NaN,v=-1/0;for(_.sort(rn),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const w=Math.abs(u-c);w>v&&(h=(c+u)/2,Uu(r,t,e,n,h,m)&&(x=h,v=w)),c=u}return isNaN(x)&&(x=i[s]),o?(o.push(x,m,v),o):[x,m,v]}function Xm(r,t,e,n,i){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Bu(r,t,l,n,i,2*o,s),t=l[l.length-1]}return s}function nv(r,t,e,n){for(;t<e-n;){for(let i=0;i<n;++i){const s=r[t+i];r[t+i]=r[e-n+i],r[e-n+i]=s}t+=n,e-=n}}function oh(r,t,e,n){let i=0,s=r[e-n],o=r[e-n+1];for(;t<e;t+=n){const a=r[t],l=r[t+1];i+=(a-s)*(l+o),s=a,o=l}return i===0?void 0:i>0}function Xu(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=oh(r,t,a,n);if(s===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function qm(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!Xu(r,t,a,n,i))return!1;a.length&&(t=a[a.length-1])}return!0}function xl(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=oh(r,t,a,n);(s===0?i&&l||!i&&!l:i&&!l||!i&&l)&&nv(r,t,a,n),t=a}return t}function Uc(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s)t=xl(r,t,e[s],n,i);return t}function Wm(r,t){const e=[];let n=0,i=0,s;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=oh(r,n,l,2);if(s===void 0&&(s=h),h===s)e.push(t.slice(i,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[i])}i=o+1,n=l}return e}class ze extends Ln{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Ot(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ze(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Ui(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ku(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ju(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return Uu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return km(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),xl(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,qo(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Re(this.getExtent());this.flatInteriorPoint_=Bu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Me(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new ai(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new ai(e.slice(s,l),t);i.push(h),s=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Xu(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=xl(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=zu(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new ze(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return zm(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=_a(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function ig(r){if(kn(r))throw new Error("Cannot create polygon from empty extent");const t=r[0],e=r[1],n=r[2],i=r[3],s=[t,e,t,i,n,i,n,e,t,e];return new ze(s,"XY",[s.length])}function Zm(r,t,e,n){const i=[];let s=je();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Cu(r,t,l[0],n),i.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return i}class Rr extends Ln{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const i=t,s=[],o=[];for(let a=0,l=i.length;a<l;++a){const h=i[a],c=s.length,u=h.getEnds();for(let f=0,p=u.length;f<p;++f)u[f]+=c;Ot(s,h.getFlatCoordinates()),o.push(u)}e=i.length===0?this.getLayout():i[0].getLayout(),t=s,n=o}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;Ot(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let i=0,s=e.length;i<s;++i)e[i]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const n=new Rr(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,i){return i<Ui(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($x(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vx(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return tv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Kx(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Uc(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,jc(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Zm(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Xm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Xr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;qm(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Uc(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Hx(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new Rr(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const n=this.endss_[t].slice(),i=n[n.length-1];if(e!==0)for(let s=0,o=n.length;s<o;++s)n[s]-=e;return new ze(this.flatCoordinates.slice(e,i),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(s!==0)for(let u=0,f=l.length;u<f;++u)l[u]-=s;const c=new ze(e.slice(s,h),t,l);i.push(c),s=h}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return rv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=Fm(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const i=n[n.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}}const sg=pe();class ke{constructor(t,e,n,i,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=s,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Ru(this.flatCoordinates_):Cu(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Re(this.getExtent());this.flatInteriorPoints_=Bu(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Wm(this.flatCoordinates_,this.ends_),e=Zm(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Xm(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=yl(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let i=0,s=n.length;i<s;++i){const o=n[i],a=yl(t,e,o,2,.5);Ot(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=tt(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const i=Vt(n)/Vt(e);or(sg,n[0],n[3],i,-i,0,0,0),ii(this.flatCoordinates_,0,this.flatCoordinates_.length,2,sg,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new ke(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=vm((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let i;switch(this.type_){case"LineString":n.length=ih(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),i=[n.length];break;case"MultiLineString":i=[],n.length=Nm(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,i);break;case"Polygon":i=[],n.length=zu(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,i);break}return i&&(this.simplifiedGeometry_=new ke(this.type_,n,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}ke.prototype.getFlatCoordinates=ke.prototype.getOrientedFlatCoordinates;class iv{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Se,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?tt(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=tt(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return ct()}readFeature(t,e){return ct()}readFeatures(t,e){return ct()}readGeometry(t,e){return ct()}readProjection(t){return ct()}writeFeature(t,e){return ct()}writeFeatures(t,e){return ct()}writeGeometry(t,e){return ct()}}const ya=iv;function se(r,t,e){const n=e?tt(e.featureProjection):null,i=e?tt(e.dataProjection):null;let s=r;if(n&&i&&!Pe(n,i)){t&&(s=r.clone());const o=t?n:i,a=t?i:n;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(on(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};s===r&&(s=r.clone()),s.applyTransform(a)}return s}function qu(r,t){const e=t?tt(t.featureProjection):null,n=t?tt(t.dataProjection):null;return e&&n&&!Pe(e,n)?Fu(r,n,e):r}const sv={Point:Me,LineString:ye,Polygon:ze,MultiPoint:Xr,MultiLineString:ar,MultiPolygon:Rr};function ov(r,t,e){return Array.isArray(t[0])?(qm(r,0,t,e)||(r=r.slice(),Uc(r,0,t,e)),r):(Xu(r,0,t,e)||(r=r.slice(),xl(r,0,t,e)),r)}function $m(r,t){var e;const n=r.geometry;if(!n)return[];if(Array.isArray(n))return n.map(o=>$m({...r,geometry:o})).flat();const i=n.type==="MultiPolygon"?"Polygon":n.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const s=n.layout.length;return se(new ke(i,i==="Polygon"?ov(n.flatCoordinates,n.ends,s):n.flatCoordinates,(e=n.ends)==null?void 0:e.flat(),s,r.properties||{},r.id).enableSimplifyTransformed(),!1,t)}function Wu(r,t){if(!r)return null;if(Array.isArray(r)){const n=r.map(i=>Wu(i,t));return new Ge(n)}const e=sv[r.type];return se(new e(r.flatCoordinates,r.layout,r.ends),!1,t)}class Zu extends ya{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Ua(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Ua(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return ct()}readFeaturesFromObject(t,e){return ct()}readGeometry(t,e){return this.readGeometryFromObject(Ua(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return ct()}readProjection(t){return this.readProjectionFromObject(Ua(t))}readProjectionFromObject(t){return ct()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return ct()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return ct()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return ct()}}function Ua(r){return typeof r=="string"?JSON.parse(r)||null:r!==null?r:null}const av={Point:uv,LineString:dv,Polygon:mv,MultiPoint:gv,MultiLineString:fv,MultiPolygon:pv},lv={Point:_v,LineString:yv,Polygon:xv,MultiPoint:wv,MultiLineString:vv,MultiPolygon:bv};class hv extends Zu{constructor(t){t=t||{},super(),this.geometryName_=t.geometryName}readFeatureFromObject(t,e,n){const i=t,s=og(i.geometry,e),o=new Se;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[n];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(t,e){if(e=e||{},t.features){const n=t,i=[],s=n.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],e,t.objectIdFieldName));return i}return[this.readFeatureFromObject(t,e)]}readGeometryFromObject(t,e){return og(t,e)}readProjectionFromObject(t){if(t.spatialReference&&t.spatialReference.wkid!==void 0){const e=t.spatialReference.wkid;return tt("EPSG:"+e)}return null}writeGeometryObject(t,e){return ag(t,this.adaptOptions(e))}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={};if(!t.hasProperties())return n.attributes={},n;const i=t.getProperties(),s=t.getGeometry();if(s){n.geometry=ag(s,e);const o=e&&(e.dataProjection||e.featureProjection);o&&(n.geometry.spatialReference={wkid:Number(tt(o).getCode().split(":").pop())}),delete i[t.getGeometryName()]}return Pn(i)?n.attributes={}:n.attributes=i,n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let i=0,s=t.length;i<s;++i)n.push(this.writeFeatureObject(t[i],e));return{features:n}}}function og(r,t){if(!r)return null;let e;if(typeof r.x=="number"&&typeof r.y=="number")e="Point";else if(r.points)e="MultiPoint";else if(r.paths)r.paths.length===1?e="LineString":e="MultiLineString";else if(r.rings){const i=r,s=Ws(i),o=cv(i.rings,s);o.length===1?(e="Polygon",r=Object.assign({},r,{rings:o[0]})):(e="MultiPolygon",r=Object.assign({},r,{rings:o}))}const n=av[e];return se(n(r),!1,t)}function cv(r,t){const e=[],n=[],i=[];let s,o;for(s=0,o=r.length;s<o;++s)e.length=0,ma(e,0,r[s],t.length),oh(e,0,e.length,t.length)?n.push([r[s]]):i.push(r[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=n.length-1;s>=0;s--){const h=n[s][0];if(We(new ai(h).getExtent(),new ai(a).getExtent())){n[s].push(a),l=!0;break}}l||n.push([a.reverse()])}return n}function uv(r){let t;return r.m!==void 0&&r.z!==void 0?t=new Me([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?t=new Me([r.x,r.y,r.z],"XYZ"):r.m!==void 0?t=new Me([r.x,r.y,r.m],"XYM"):t=new Me([r.x,r.y]),t}function dv(r){const t=Ws(r);return new ye(r.paths[0],t)}function fv(r){const t=Ws(r);return new ar(r.paths,t)}function Ws(r){let t="XY";return r.hasZ===!0&&r.hasM===!0?t="XYZM":r.hasZ===!0?t="XYZ":r.hasM===!0&&(t="XYM"),t}function gv(r){const t=Ws(r);return new Xr(r.points,t)}function pv(r){const t=Ws(r);return new Rr(r.rings,t)}function mv(r){const t=Ws(r);return new ze(r.rings,t)}function _v(r,t){const e=r.getCoordinates();let n;const i=r.getLayout();if(i==="XYZ")n={x:e[0],y:e[1],z:e[2]};else if(i==="XYM")n={x:e[0],y:e[1],m:e[2]};else if(i==="XYZM")n={x:e[0],y:e[1],z:e[2],m:e[3]};else if(i==="XY")n={x:e[0],y:e[1]};else throw new Error("Invalid geometry layout");return n}function xa(r){const t=r.getLayout();return{hasZ:t==="XYZ"||t==="XYZM",hasM:t==="XYM"||t==="XYZM"}}function yv(r,t){const e=xa(r);return{hasZ:e.hasZ,hasM:e.hasM,paths:[r.getCoordinates()]}}function xv(r,t){const e=xa(r);return{hasZ:e.hasZ,hasM:e.hasM,rings:r.getCoordinates(!1)}}function vv(r,t){const e=xa(r);return{hasZ:e.hasZ,hasM:e.hasM,paths:r.getCoordinates()}}function wv(r,t){const e=xa(r);return{hasZ:e.hasZ,hasM:e.hasM,points:r.getCoordinates()}}function bv(r,t){const e=xa(r),n=r.getCoordinates(!1),i=[];for(let s=0;s<n.length;s++)for(let o=n[s].length-1;o>=0;o--)i.push(n[s][o]);return{hasZ:e.hasZ,hasM:e.hasM,rings:i}}function ag(r,t){const e=lv[r.getType()];return e(se(r,!0,t),t)}const Sv=hv;class Ev extends Zu{constructor(t){t=t||{},super(),this.dataProjection=tt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=tt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const i=$u(n.geometry);if(this.featureClass===ke)return $m({geometry:i,id:n.id,properties:n.properties},e);const s=new Se;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&s.setGeometryName(n.geometry_name),s.setGeometry(Wu(i,e)),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(t,e){const n=t;let i=null;if(n.type==="FeatureCollection"){const s=t;i=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&i.push(h)}}else i=[this.readFeatureFromObject(t,e)];return i.flat()}readGeometryFromObject(t,e){return Tv(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=tt(e.properties.name);else if(e.type==="EPSG")n=tt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},i=t.getId();if(i!==void 0&&(n.id=i),!t.hasProperties())return n;const s=t.getProperties(),o=t.getGeometry();return o&&(n.geometry=Bc(o,e),delete s[t.getGeometryName()]),Pn(s)||(n.properties=s),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let i=0,s=t.length;i<s;++i)n.push(this.writeFeatureObject(t[i],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return Bc(t,this.adaptOptions(e))}}function $u(r,t){if(!r)return null;let e;switch(r.type){case"Point":{e=Rv(r);break}case"LineString":{e=Cv(r);break}case"Polygon":{e=Lv(r);break}case"MultiPoint":{e=Pv(r);break}case"MultiLineString":{e=Iv(r);break}case"MultiPolygon":{e=Av(r);break}case"GeometryCollection":{e=Mv(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return e}function Tv(r,t){const e=$u(r);return Wu(e,t)}function Mv(r,t){return r.geometries.map(function(e){return $u(e)})}function Rv(r){const t=r.coordinates;return{type:"Point",flatCoordinates:t,layout:Xi(t.length)}}function Cv(r){var t;const e=r.coordinates,n=e.flat();return{type:"LineString",flatCoordinates:n,ends:[n.length],layout:Xi(((t=e[0])==null?void 0:t.length)||2)}}function Iv(r){var t,e;const n=r.coordinates,i=((e=(t=n[0])==null?void 0:t[0])==null?void 0:e.length)||2,s=[],o=_a(s,0,n,i);return{type:"MultiLineString",flatCoordinates:s,ends:o,layout:Xi(i)}}function Pv(r){var t;const e=r.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Xi(((t=e[0])==null?void 0:t.length)||2)}}function Av(r){var t,e;const n=r.coordinates,i=[],s=((e=(t=n[0])==null?void 0:t[0])==null?void 0:e[0].length)||2,o=Fm(i,0,n,s);return{type:"MultiPolygon",flatCoordinates:i,ends:o,layout:Xi(s)}}function Lv(r){var t,e;const n=r.coordinates,i=[],s=(e=(t=n[0])==null?void 0:t[0])==null?void 0:e.length,o=_a(i,0,n,s);return{type:"Polygon",flatCoordinates:i,ends:o,layout:Xi(s)}}function Bc(r,t){r=se(r,!0,t);const e=r.getType();let n;switch(e){case"Point":{n=Gv(r);break}case"LineString":{n=Fv(r);break}case"Polygon":{n=jv(r,t);break}case"MultiPoint":{n=Dv(r);break}case"MultiLineString":{n=Nv(r);break}case"MultiPolygon":{n=kv(r,t);break}case"GeometryCollection":{n=Ov(r,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function Ov(r,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(e){return Bc(e,t)})}}function Fv(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}function Nv(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function Dv(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function kv(r,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}function Gv(r,t){return{type:"Point",coordinates:r.getCoordinates()}}function jv(r,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}const Vm=Ev,Ai="http://www.w3.org/2001/XMLSchema-instance";function mt(r,t){return Zs().createElementNS(r,t)}function Ve(r,t){return Ym(r,t,[]).join("")}function Ym(r,t,e){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)t?e.push(String(r.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(r.nodeValue);else{let n;for(n=r.firstChild;n;n=n.nextSibling)Ym(n,t,e)}return e}function Er(r){return"documentElement"in r}function zv(r,t,e){return r.getAttributeNS(t,e)||""}function Tr(r){return new DOMParser().parseFromString(r,"application/xml")}function vl(r,t){return function(e,n){const i=r.call(t!==void 0?t:this,e,n);if(i!==void 0){const s=n[n.length-1];Ot(s,i)}}}function ot(r,t){return function(e,n){const i=r.call(t!==void 0?t:this,e,n);i!==void 0&&n[n.length-1].push(i)}}function ht(r,t){return function(e,n){const i=r.call(t!==void 0?t:this,e,n);i!==void 0&&(n[n.length-1]=i)}}function Kt(r,t,e){return function(n,i){const s=r.call(e!==void 0?e:this,n,i);if(s!==void 0){const o=i[i.length-1],a=t!==void 0?t:n.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function O(r,t,e){return function(n,i){const s=r.call(e!==void 0?e:this,n,i);if(s!==void 0){const o=i[i.length-1],a=t!==void 0?t:n.localName;o[a]=s}}}function N(r,t){return function(e,n,i){r.call(t!==void 0?t:this,e,n,i),i[i.length-1].node.appendChild(e)}}function Hm(r,t){let e,n;return function(i,s,o){if(e===void 0){e={};const a={};a[i.localName]=r,e[i.namespaceURI]=a,n=ce(i.localName)}Km(e,n,s,o)}}function ce(r,t){return function(e,n,i){const s=n[n.length-1].node;let o=r;o===void 0&&(o=i);const a=t!==void 0?t:s.namespaceURI;return mt(a,o)}}const Ce=ce();function lr(r,t){const e=t.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=r[t[i]];return n}function W(r,t,e){e=e!==void 0?e:{};let n,i;for(n=0,i=r.length;n<i;++n)e[r[n]]=t;return e}function sr(r,t,e,n){let i;for(i=t.firstElementChild;i;i=i.nextElementSibling){const s=r[i.namespaceURI];if(s!==void 0){const o=s[i.localName];o!==void 0&&o.call(n,i,e)}}}function Z(r,t,e,n,i){return n.push(r),sr(t,e,n,i),n.pop()}function Km(r,t,e,n,i,s){const o=(i!==void 0?i:e).length;let a,l;for(let h=0;h<o;++h)a=e[h],a!==void 0&&(l=t.call(s!==void 0?s:this,a,n,i!==void 0?i[h]:void 0),l!==void 0&&r[l.namespaceURI][l.localName].call(s,l,a,n))}function pt(r,t,e,n,i,s,o){return i.push(r),Km(t,e,n,i,s,o),i.pop()}let Yh;function Uv(){return Yh===void 0&&typeof XMLSerializer<"u"&&(Yh=new XMLSerializer),Yh}let Hh;function Zs(){return Hh===void 0&&typeof document<"u"&&(Hh=document.implementation.createDocument("","",null)),Hh}class va extends ya{constructor(){super(),this.xmlSerializer_=Uv()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const n=Tr(t);return this.readFeatureFromDocument(n,e)}return Er(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const n=this.readFeaturesFromDocument(t,e);return n.length>0?n[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const n=Tr(t);return this.readFeaturesFromDocument(n,e)}return Er(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const n=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Ot(n,this.readFeaturesFromNode(i,e));return n}readFeaturesFromNode(t,e){return ct()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const n=Tr(t);return this.readGeometryFromDocument(n,e)}return Er(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=Tr(t);return this.readProjectionFromDocument(e)}return Er(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const n=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const n=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const n=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(t,e){return null}}const Mn="http://www.opengis.net/gml",Bv=/^\s*$/;class st extends va{constructor(t){super(),t=t||{},this.featureType=t.featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:ot(this.readFeaturesInternal),featureMembers:ht(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(t,e){const n=t.localName;let i=null;if(n=="FeatureCollection")i=Z([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const s=e[0];let o=s.featureType,a=s.featureNS;const l="p",h="p0";if(!o&&t.childNodes){o=[],a={};for(let f=0,p=t.childNodes.length;f<p;++f){const m=t.childNodes[f];if(m.nodeType===1){const _=m.nodeName.split(":").pop();if(!o.includes(_)){let x="",v=0;const w=m.namespaceURI;for(const S in a){if(a[S]===w){x=S;break}++v}x||(x=l+v,a[x]=w),o.push(x+":"+_)}}}n!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const f=a;a={},a[h]=f}const c={},u=Array.isArray(o)?o:[o];for(const f in a){const p={};for(let m=0,_=u.length;m<_;++m)(u[m].includes(":")?u[m].split(":")[0]:h)===f&&(p[u[m].split(":").pop()]=n=="featureMembers"?ot(this.readFeatureElement,this):ht(this.readFeatureElement,this));c[a[f]]=p}n=="featureMember"||n=="member"?i=Z(void 0,c,t,e):i=Z([],c,t,e)}return i===null&&(i=[]),i}readGeometryOrExtent(t,e){const n=e[0];return n.srsName=t.firstElementChild.getAttribute("srsName"),n.srsDimension=t.firstElementChild.getAttribute("srsDimension"),Z(null,this.GEOMETRY_PARSERS,t,e,this)}readExtentElement(t,e){const n=e[0],i=this.readGeometryOrExtent(t,e);return i?qu(i,n):void 0}readGeometryElement(t,e){const n=e[0],i=this.readGeometryOrExtent(t,e);return i?se(i,!1,n):void 0}readFeatureElementInternal(t,e,n){let i;const s={};for(let l=t.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=Ve(l,!1),Bv.test(h)&&(h=void 0)):(n&&(h=c==="boundedBy"?this.readExtentElement(l,e):this.readGeometryElement(l,e)),h?c!=="boundedBy"&&(i=c):h=this.readFeatureElementInternal(l,e,!1));const u=l.attributes.length;if(u>0&&!(h instanceof Nu)){h={_content_:h};for(let f=0;f<u;f++){const p=l.attributes[f].name;h[p]=l.attributes[f].value}}s[c]?(s[c]instanceof Array||(s[c]=[s[c]]),s[c].push(h)):s[c]=h}if(!n)return s;const o=new Se(s);i&&o.setGeometryName(i);const a=t.getAttribute("fid")||zv(t,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(t,e){return this.readFeatureElementInternal(t,e,!0)}readPoint(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new Me(n,"XYZ")}readMultiPoint(t,e){const n=Z([],this.MULTIPOINT_PARSERS,t,e,this);if(n)return new Xr(n)}readMultiLineString(t,e){const n=Z([],this.MULTILINESTRING_PARSERS,t,e,this);if(n)return new ar(n)}readMultiPolygon(t,e){const n=Z([],this.MULTIPOLYGON_PARSERS,t,e,this);if(n)return new Rr(n)}pointMemberParser(t,e){sr(this.POINTMEMBER_PARSERS,t,e,this)}lineStringMemberParser(t,e){sr(this.LINESTRINGMEMBER_PARSERS,t,e,this)}polygonMemberParser(t,e){sr(this.POLYGONMEMBER_PARSERS,t,e,this)}readLineString(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new ye(n,"XYZ")}readFlatLinearRing(t,e){const n=Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this);if(n)return n}readLinearRing(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new ai(n,"XYZ")}readPolygon(t,e){const n=Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Ot(i,n[o]),s.push(i.length);return new ze(i,"XYZ",s)}}readFlatCoordinatesFromNode(t,e){return Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}readGeometryFromNode(t,e){return this.readGeometryElement(t,[this.getReadOptions(t,e||{})])||null}readFeaturesFromNode(t,e){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[n])||[]}readProjectionFromNode(t){return tt(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))}}st.prototype.namespace=Mn;st.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};st.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};st.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};st.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:ot(st.prototype.pointMemberParser),pointMembers:ot(st.prototype.pointMemberParser)}};st.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:ot(st.prototype.lineStringMemberParser),lineStringMembers:ot(st.prototype.lineStringMemberParser)}};st.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:ot(st.prototype.polygonMemberParser),polygonMembers:ot(st.prototype.polygonMemberParser)}};st.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:ot(st.prototype.readFlatCoordinatesFromNode)}};st.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ot(st.prototype.readLineString)}};st.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ot(st.prototype.readPolygon)}};st.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ht(st.prototype.readFlatLinearRing)}};function li(r){const t=Ve(r,!1);return Ri(t)}function Ri(r){const t=/^\s*(true|1)|(false|0)\s*$/.exec(r);if(t)return t[1]!==void 0||!1}function ah(r){const t=Ve(r,!1),e=Date.parse(t);return isNaN(e)?void 0:e/1e3}function Pt(r){const t=Ve(r,!1);return wn(t)}function wn(r){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(t)return parseFloat(t[1])}function fe(r){const t=Ve(r,!1);return Tn(t)}function Tn(r){const t=/^\s*(\d+)\s*$/.exec(r);if(t)return parseInt(t[1],10)}function $(r){return Ve(r,!1).trim()}function Os(r,t){gt(r,t?"1":"0")}function Xv(r,t){r.appendChild(Zs().createCDATASection(t))}function qv(r,t){const e=new Date(t*1e3),n=e.getUTCFullYear()+"-"+wi(e.getUTCMonth()+1,2)+"-"+wi(e.getUTCDate(),2)+"T"+wi(e.getUTCHours(),2)+":"+wi(e.getUTCMinutes(),2)+":"+wi(e.getUTCSeconds(),2)+"Z";r.appendChild(Zs().createTextNode(n))}function tr(r,t){const e=t.toPrecision();r.appendChild(Zs().createTextNode(e))}function wl(r,t){const e=t.toString();r.appendChild(Zs().createTextNode(e))}function gt(r,t){r.appendChild(Zs().createTextNode(t))}const Wv=Mn+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Zv={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class It extends st{constructor(t){t=t||{},super(t),this.FEATURE_COLLECTION_PARSERS[Mn].featureMember=ot(this.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:Wv}readFlatCoordinates(t,e){const n=Ve(t,!1).replace(/^\s*|\s*$/g,""),i=e[0].srsName;let s="enu";if(i){const l=tt(i);l&&(s=l.getAxisOrientation())}const o=n.trim().split(/\s+/),a=[];for(let l=0,h=o.length;l<h;l++){const c=o[l].split(/,+/),u=parseFloat(c[0]),f=parseFloat(c[1]),p=c.length===3?parseFloat(c[2]):0;s.substr(0,2)==="en"?a.push(u,f,p):a.push(f,u,p)}return a}readBox(t,e){const n=Z([null],this.BOX_PARSERS_,t,e,this);return jr(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)}outerBoundaryIsParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);if(n){const i=e[e.length-1];i[0]=n}}GEOMETRY_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),mt("http://www.opengis.net/gml",n)}writeFeatureElement(t,e,n){const i=e.getId();i&&t.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const u=e.getProperties();for(const f in u){const p=u[f];p!==null&&(l.push(f),h.push(p),f==a||typeof p.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=N(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=N(gt)))}}const c=Object.assign({},s);c.node=t,pt(c,s.serializers,ce(void 0,o),h,n,l)}writeCurveOrLineString(t,e,n){const i=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&i&&t.setAttribute("srsName",i),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s),this.writeCoordinates_(s,e,n)}else if(t.nodeName==="Curve"){const s=mt(t.namespaceURI,"segments");t.appendChild(s),this.writeCurveSegments_(s,e,n)}}writeLineStringOrCurveMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeCurveOrLineString(i,e,n))}writeMultiCurveOrLineString(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();pt({node:t,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(t,e,n){const i=n[n.length-1],s=Object.assign({},i);s.node=t;let o;Array.isArray(e)?o=qu(e,i):o=se(e,!0,i),pt(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(t){const e=mt(t,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e}writeCoordinates_(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=e.getCoordinates(),l=a.length,h=new Array(l);for(let c=0;c<l;++c){const u=a[c];h[c]=this.getCoords_(u,o,s)}gt(t,h.join(" "))}writeCurveSegments_(t,e,n){const i=mt(t.namespaceURI,"LineStringSegment");t.appendChild(i),this.writeCurveOrLineString(i,e,n)}writeSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();pt({node:t,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=mt(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,n)}}RING_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),mt(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(t,e,n){const i=mt(t.namespaceURI,"PolygonPatch");t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n)}writeRing(t,e,n){const i=mt(t.namespaceURI,"LinearRing");t.appendChild(i),this.writeLinearRing(i,e,n)}getCoords_(t,e,n){let i="enu";e&&(i=tt(e).getAxisOrientation());let s=i.substr(0,2)==="en"?t[0]+","+t[1]:t[1]+","+t[0];if(n){const o=t[2]||0;s+=","+o}return s}writePoint(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&t.setAttribute("srsName",o);const a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);const l=e.getCoordinates(),h=this.getCoords_(l,o,s);gt(a,h)}writeMultiPoint(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&t.setAttribute("srsName",o);const a=e.getPoints();pt({node:t,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,ce("pointMember"),a,n,void 0,this)}writePointMember(t,e,n){const i=mt(t.namespaceURI,"Point");t.appendChild(i),this.writePoint(i,e,n)}writeLinearRing(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s),this.writeCoordinates_(s,e,n)}writeMultiSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();pt({node:t,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n))}writeEnvelope(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];pt({node:t},this.ENVELOPE_SERIALIZERS,Ce,o,n,s,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,n){const i=e[e.length-1].node;return mt("http://www.opengis.net/gml",Zv[i.nodeName])}}It.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:ht(It.prototype.readFlatCoordinates)}};It.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:It.prototype.innerBoundaryIsParser,outerBoundaryIs:It.prototype.outerBoundaryIsParser}};It.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:ot(It.prototype.readFlatCoordinates)}};It.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ht(st.prototype.readPoint),MultiPoint:ht(st.prototype.readMultiPoint),LineString:ht(st.prototype.readLineString),MultiLineString:ht(st.prototype.readMultiLineString),LinearRing:ht(st.prototype.readLinearRing),Polygon:ht(st.prototype.readPolygon),MultiPolygon:ht(st.prototype.readMultiPolygon),Box:ht(It.prototype.readBox)}};It.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:N(It.prototype.writeCurveOrLineString),MultiCurve:N(It.prototype.writeMultiCurveOrLineString),Point:N(It.prototype.writePoint),MultiPoint:N(It.prototype.writeMultiPoint),LineString:N(It.prototype.writeCurveOrLineString),MultiLineString:N(It.prototype.writeMultiCurveOrLineString),LinearRing:N(It.prototype.writeLinearRing),Polygon:N(It.prototype.writeSurfaceOrPolygon),MultiPolygon:N(It.prototype.writeMultiSurfaceOrPolygon),Surface:N(It.prototype.writeSurfaceOrPolygon),MultiSurface:N(It.prototype.writeMultiSurfaceOrPolygon),Envelope:N(It.prototype.writeEnvelope)}};It.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:N(It.prototype.writeLineStringOrCurveMember),curveMember:N(It.prototype.writeLineStringOrCurveMember)}};It.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:N(It.prototype.writeRing),innerBoundaryIs:N(It.prototype.writeRing)}};It.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:N(It.prototype.writePointMember)}};It.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:N(It.prototype.writeSurfaceOrPolygonMember),polygonMember:N(It.prototype.writeSurfaceOrPolygonMember)}};It.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:N(gt),upperCorner:N(gt)}};const $v=Mn+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Vv={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class at extends st{constructor(t){t=t||{},super(t),this.surface_=t.surface!==void 0?t.surface:!1,this.curve_=t.curve!==void 0?t.curve:!1,this.multiCurve_=t.multiCurve!==void 0?t.multiCurve:!0,this.multiSurface_=t.multiSurface!==void 0?t.multiSurface:!0,this.schemaLocation=t.schemaLocation?t.schemaLocation:$v,this.hasZ=t.hasZ!==void 0?t.hasZ:!1}readMultiCurve(t,e){const n=Z([],this.MULTICURVE_PARSERS,t,e,this);if(n)return new ar(n)}readFlatCurveRing(t,e){const n=Z([],this.MULTICURVE_PARSERS,t,e,this),i=[];for(let s=0,o=n.length;s<o;++s)Ot(i,n[s].getFlatCoordinates());return i}readMultiSurface(t,e){const n=Z([],this.MULTISURFACE_PARSERS,t,e,this);if(n)return new Rr(n)}curveMemberParser(t,e){sr(this.CURVEMEMBER_PARSERS,t,e,this)}surfaceMemberParser(t,e){sr(this.SURFACEMEMBER_PARSERS,t,e,this)}readPatch(t,e){return Z([null],this.PATCHES_PARSERS,t,e,this)}readSegment(t,e){return Z([],this.SEGMENTS_PARSERS,t,e,this)}readPolygonPatch(t,e){return Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)}readLineStringSegment(t,e){return Z([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}interiorParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)}exteriorParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);if(n){const i=e[e.length-1];i[0]=n}}readSurface(t,e){const n=Z([null],this.SURFACE_PARSERS,t,e,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Ot(i,n[o]),s.push(i.length);return new ze(i,"XYZ",s)}}readCurve(t,e){const n=Z([null],this.CURVE_PARSERS,t,e,this);if(n)return new ye(n,"XYZ")}readEnvelope(t,e){const n=Z([null],this.ENVELOPE_PARSERS,t,e,this);return jr(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(t,e){let n=Ve(t,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(n);)s.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const a=e[0].srsName;let l="enu";if(a&&(l=tt(a).getAxisOrientation()),l==="neu"){let c,u;for(c=0,u=s.length;c<u;c+=3){const f=s[c],p=s[c+1];s[c]=p,s[c+1]=f}}const h=s.length;if(h==2&&s.push(0),h!==0)return s}readFlatPosList(t,e){const n=Ve(t,!1).replace(/^\s*|\s*$/g,""),i=e[0],s=i.srsName,o=i.srsDimension;let a="enu";s&&(a=tt(s).getAxisOrientation());const l=n.split(/\s+/);let h=2;t.getAttribute("srsDimension")?h=Tn(t.getAttribute("srsDimension")):t.getAttribute("dimension")?h=Tn(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?h=Tn(t.parentNode.getAttribute("srsDimension")):o&&(h=Tn(o));let c,u,f;const p=[];for(let m=0,_=l.length;m<_;m+=h)c=parseFloat(l[m]),u=parseFloat(l[m+1]),f=h===3?parseFloat(l[m+2]):0,a.substr(0,2)==="en"?p.push(c,u,f):p.push(u,c,f);return p}writePos_(t,e,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";t.setAttribute("srsDimension",o);const a=i.srsName;let l="enu";a&&(l=tt(a).getAxisOrientation());const h=e.getCoordinates();let c;if(l.substr(0,2)==="en"?c=h[0]+" "+h[1]:c=h[1]+" "+h[0],s){const u=h[2]||0;c+=" "+u}gt(t,c)}getCoords_(t,e,n){let i="enu";e&&(i=tt(e).getAxisOrientation());let s=i.substr(0,2)==="en"?t[0]+" "+t[1]:t[1]+" "+t[0];if(n){const o=t[2]||0;s+=" "+o}return s}writePosList_(t,e,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";t.setAttribute("srsDimension",o);const a=i.srsName,l=e.getCoordinates(),h=l.length,c=new Array(h);let u;for(let f=0;f<h;++f)u=l[f],c[f]=this.getCoords_(u,a,s);gt(t,c.join(" "))}writePoint(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=mt(t.namespaceURI,"pos");t.appendChild(s),this.writePos_(s,e,n)}writeEnvelope(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];pt({node:t},this.ENVELOPE_SERIALIZERS,Ce,o,n,s,this)}writeLinearRing(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=mt(t.namespaceURI,"posList");t.appendChild(s),this.writePosList_(s,e,n)}RING_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),mt(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();pt({node:t,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=mt(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,n)}}writeCurveOrLineString(t,e,n){const i=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&i&&t.setAttribute("srsName",i),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const s=mt(t.namespaceURI,"posList");t.appendChild(s),this.writePosList_(s,e,n)}else if(t.nodeName==="Curve"){const s=mt(t.namespaceURI,"segments");t.appendChild(s),this.writeCurveSegments_(s,e,n)}}writeMultiSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();pt({node:t,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(t,e,n){const i=n[n.length-1],s=i.srsName,o=i.hasZ;s&&t.setAttribute("srsName",s);const a=e.getPoints();pt({node:t,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,ce("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();pt({node:t,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(t,e,n){const i=mt(t.namespaceURI,"LinearRing");t.appendChild(i),this.writeLinearRing(i,e,n)}writeSurfaceOrPolygonMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n))}writePointMember(t,e,n){const i=mt(t.namespaceURI,"Point");t.appendChild(i),this.writePoint(i,e,n)}writeLineStringOrCurveMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeCurveOrLineString(i,e,n))}writeSurfacePatches_(t,e,n){const i=mt(t.namespaceURI,"PolygonPatch");t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n)}writeCurveSegments_(t,e,n){const i=mt(t.namespaceURI,"LineStringSegment");t.appendChild(i),this.writeCurveOrLineString(i,e,n)}writeGeometryElement(t,e,n){const i=n[n.length-1],s=Object.assign({},i);s.node=t;let o;Array.isArray(e)?o=qu(e,i):o=se(e,!0,i),pt(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(t,e,n){const i=e.getId();i&&t.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const u=e.getProperties();for(const f in u){const p=u[f];p!==null&&(l.push(f),h.push(p),f==a||typeof p.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=N(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=N(gt)))}}const c=Object.assign({},s);c.node=t,pt(c,s.serializers,ce(void 0,o),h,n,l)}writeFeatureMembers_(t,e,n){const i=n[n.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=N(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=t,pt(l,a,ce(s,o),e,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,n){const i=e[e.length-1].node;return mt(this.namespace,Vv[i.nodeName])}GEOMETRY_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve")),mt(this.namespace,n)}writeGeometryNode(t,e){e=this.adaptOptions(e);const n=mt(this.namespace,"geom"),i={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&Object.assign(i,e),this.writeGeometryElement(n,t,[i]),n}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt(this.namespace,"featureMembers");n.setAttributeNS(Ai,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&Object.assign(i,e),this.writeFeatureMembers_(n,t,[i]),n}}at.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:ht(at.prototype.readFlatPos),posList:ht(at.prototype.readFlatPosList),coordinates:ht(It.prototype.readFlatCoordinates)}};at.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:at.prototype.interiorParser,exterior:at.prototype.exteriorParser}};at.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ht(st.prototype.readPoint),MultiPoint:ht(st.prototype.readMultiPoint),LineString:ht(st.prototype.readLineString),MultiLineString:ht(st.prototype.readMultiLineString),LinearRing:ht(st.prototype.readLinearRing),Polygon:ht(st.prototype.readPolygon),MultiPolygon:ht(st.prototype.readMultiPolygon),Surface:ht(at.prototype.readSurface),MultiSurface:ht(at.prototype.readMultiSurface),Curve:ht(at.prototype.readCurve),MultiCurve:ht(at.prototype.readMultiCurve),Envelope:ht(at.prototype.readEnvelope)}};at.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:ot(at.prototype.curveMemberParser),curveMembers:ot(at.prototype.curveMemberParser)}};at.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:ot(at.prototype.surfaceMemberParser),surfaceMembers:ot(at.prototype.surfaceMemberParser)}};at.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ot(st.prototype.readLineString),Curve:ot(at.prototype.readCurve)}};at.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ot(st.prototype.readPolygon),Surface:ot(at.prototype.readSurface)}};at.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:ht(at.prototype.readPatch)}};at.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:ht(at.prototype.readSegment)}};at.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:ot(at.prototype.readFlatPosList),upperCorner:ot(at.prototype.readFlatPosList)}};at.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:ht(at.prototype.readPolygonPatch)}};at.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:vl(at.prototype.readLineStringSegment)}};st.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ht(st.prototype.readFlatLinearRing),Ring:ht(at.prototype.readFlatCurveRing)}};at.prototype.writeFeatures;at.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:N(at.prototype.writeRing),interior:N(at.prototype.writeRing)}};at.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:N(gt),upperCorner:N(gt)}};at.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:N(at.prototype.writeSurfaceOrPolygonMember),polygonMember:N(at.prototype.writeSurfaceOrPolygonMember)}};at.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:N(at.prototype.writePointMember)}};at.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:N(at.prototype.writeLineStringOrCurveMember),curveMember:N(at.prototype.writeLineStringOrCurveMember)}};at.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:N(at.prototype.writeCurveOrLineString),MultiCurve:N(at.prototype.writeMultiCurveOrLineString),Point:N(at.prototype.writePoint),MultiPoint:N(at.prototype.writeMultiPoint),LineString:N(at.prototype.writeCurveOrLineString),MultiLineString:N(at.prototype.writeMultiCurveOrLineString),LinearRing:N(at.prototype.writeLinearRing),Polygon:N(at.prototype.writeSurfaceOrPolygon),MultiPolygon:N(at.prototype.writeMultiSurfaceOrPolygon),Surface:N(at.prototype.writeSurfaceOrPolygon),MultiSurface:N(at.prototype.writeMultiSurfaceOrPolygon),Envelope:N(at.prototype.writeEnvelope)}};const Rt=at,Vu=Rt;Vu.prototype.writeFeatures;Vu.prototype.writeFeaturesNode;const Yv=Vu,ne=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Hv="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Kv={rte:Qm,trk:Jm,wpt:t0},Qv=W(ne,{rte:ot(Qm),trk:ot(Jm),wpt:ot(t0)}),Jv=W(ne,{text:O($,"linkText"),type:O($,"linkType")}),tw=W(ne,{name:O($),email:Rw,link:wa}),ew=W(ne,{name:O($),desc:O($),author:O(Ew),copyright:O(Tw),link:wa,time:O(ah),keywords:O($),bounds:Mw,extensions:lh}),rw=W(ne,{year:O(fe),license:O($)}),nw=W(ne,{rte:N(Aw),trk:N(Lw),wpt:N(Fw)});class iw extends va{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.readExtensions_=t.readExtensions}handleReadExtensions_(t){t||(t=[]);for(let e=0,n=t.length;e<n;++e){const i=t[e];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(t){return t?typeof t=="string"?this.readMetadataFromDocument(Tr(t)):Er(t)?this.readMetadataFromDocument(t):this.readMetadataFromNode(t):null}readMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(e);if(n)return n}return null}readMetadataFromNode(t){if(!ne.includes(t.namespaceURI))return null;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(ne.includes(e.namespaceURI)&&e.localName==="metadata")return Z({},ew,e,[]);return null}readFeatureFromNode(t,e){if(!ne.includes(t.namespaceURI))return null;const n=Kv[t.localName];if(!n)return null;const i=n(t,[this.getReadOptions(t,e)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(t,e){if(!ne.includes(t.namespaceURI))return[];if(t.localName=="gpx"){const n=Z([],Qv,t,[this.getReadOptions(t,e)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Ai),n.setAttributeNS(Ai,"xsi:schemaLocation",Hv),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),pt({node:n},nw,Sw,t,[e]),n}}const sw=W(ne,{name:O($),cmt:O($),desc:O($),src:O($),link:wa,number:O(fe),extensions:lh,type:O($),rtept:Cw}),ow=W(ne,{ele:O(Pt),time:O(ah)}),aw=W(ne,{name:O($),cmt:O($),desc:O($),src:O($),link:wa,number:O(fe),type:O($),extensions:lh,trkseg:Pw}),lw=W(ne,{trkpt:Iw}),hw=W(ne,{ele:O(Pt),time:O(ah)}),cw=W(ne,{ele:O(Pt),time:O(ah),magvar:O(Pt),geoidheight:O(Pt),name:O($),cmt:O($),desc:O($),src:O($),link:wa,sym:O($),type:O($),fix:O($),sat:O(fe),hdop:O(Pt),vdop:O(Pt),pdop:O(Pt),ageofdgpsdata:O(Pt),dgpsid:O(fe),extensions:lh}),uw=["text","type"],dw=W(ne,{text:N(gt),type:N(gt)}),fw=W(ne,["name","cmt","desc","src","link","number","type","rtept"]),gw=W(ne,{name:N(gt),cmt:N(gt),desc:N(gt),src:N(gt),link:N(Ku),number:N(wl),type:N(gt),rtept:Hm(N(Qu))}),pw=W(ne,["ele","time"]),mw=W(ne,["name","cmt","desc","src","link","number","type","trkseg"]),_w=W(ne,{name:N(gt),cmt:N(gt),desc:N(gt),src:N(gt),link:N(Ku),number:N(wl),type:N(gt),trkseg:Hm(N(Ow))}),yw=ce("trkpt"),xw=W(ne,{trkpt:N(Qu)}),vw=W(ne,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),ww=W(ne,{ele:N(tr),time:N(qv),magvar:N(tr),geoidheight:N(tr),name:N(gt),cmt:N(gt),desc:N(gt),src:N(gt),link:N(Ku),sym:N(gt),type:N(gt),fix:N(gt),sat:N(wl),hdop:N(tr),vdop:N(tr),pdop:N(tr),ageofdgpsdata:N(tr),dgpsid:N(wl)}),bw={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Sw(r,t,e){const n=r.getGeometry();if(n){const i=bw[n.getType()];if(i){const s=t[t.length-1].node;return mt(s.namespaceURI,i)}}}function Yu(r,t,e,n){return r.push(parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,t.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,t.hasM=!0):r.push(0),r}function Hu(r,t,e){let n="XY",i=2;if(r.hasZ&&r.hasM?(n="XYZM",i=4):r.hasZ?(n="XYZ",i=3):r.hasM&&(n="XYM",i=3),i!==4){for(let s=0,o=t.length/4;s<o;s++)t[s*i]=t[s*4],t[s*i+1]=t[s*4+1],r.hasZ&&(t[s*i+2]=t[s*4+2]),r.hasM&&(t[s*i+2]=t[s*4+3]);if(t.length=t.length/4*i,e)for(let s=0,o=e.length;s<o;s++)e[s]=e[s]/4*i}return n}function Ew(r,t){const e=Z({},tw,r,t);if(e)return e}function Tw(r,t){const e=Z({},rw,r,t);if(e){const n=r.getAttribute("author");return n!==null&&(e.author=n),e}}function Mw(r,t){const e=t[t.length-1],n=r.getAttribute("minlat"),i=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),o=r.getAttribute("maxlon");i!==null&&n!==null&&o!==null&&s!==null&&(e.bounds=[[parseFloat(i),parseFloat(n)],[parseFloat(o),parseFloat(s)]])}function Rw(r,t){const e=t[t.length-1],n=r.getAttribute("id"),i=r.getAttribute("domain");n!==null&&i!==null&&(e.email=`${n}@${i}`)}function wa(r,t){const e=t[t.length-1],n=r.getAttribute("href");n!==null&&(e.link=n),sr(Jv,r,t)}function lh(r,t){const e=t[t.length-1];e.extensionsNode_=r}function Cw(r,t){const e=Z({},ow,r,t);if(e){const n=t[t.length-1],i=n.flatCoordinates,s=n.layoutOptions;Yu(i,s,r,e)}}function Iw(r,t){const e=Z({},hw,r,t);if(e){const n=t[t.length-1],i=n.flatCoordinates,s=n.layoutOptions;Yu(i,s,r,e)}}function Pw(r,t){const e=t[t.length-1];sr(lw,r,t);const n=e.flatCoordinates;e.ends.push(n.length)}function Qm(r,t){const e=t[0],n=Z({flatCoordinates:[],layoutOptions:{}},sw,r,t);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.layoutOptions;delete n.layoutOptions;const o=Hu(s,i),a=new ye(i,o);se(a,!1,e);const l=new Se(a);return l.setProperties(n,!0),l}function Jm(r,t){const e=t[0],n=Z({flatCoordinates:[],ends:[],layoutOptions:{}},aw,r,t);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=Hu(o,i,s),l=new ar(i,a,s);se(l,!1,e);const h=new Se(l);return h.setProperties(n,!0),h}function t0(r,t){const e=t[0],n=Z({},cw,r,t);if(!n)return;const i={},s=Yu([],i,r,n),o=Hu(i,s),a=new Me(s,o);se(a,!1,e);const l=new Se(a);return l.setProperties(n,!0),l}function Ku(r,t,e){r.setAttribute("href",t);const n=e[e.length-1].properties,i=[n.linkText,n.linkType];pt({node:r},dw,Ce,i,e,uw)}function Qu(r,t,e){const n=e[e.length-1],i=n.node.namespaceURI,s=n.properties;switch(r.setAttributeNS(null,"lat",String(t[1])),r.setAttributeNS(null,"lon",String(t[0])),n.geometryLayout){case"XYZM":t[3]!==0&&(s.time=t[3]);case"XYZ":t[2]!==0&&(s.ele=t[2]);break;case"XYM":t[2]!==0&&(s.time=t[2]);break}const o=r.nodeName=="rtept"?pw[i]:vw[i],a=lr(s,o);pt({node:r,properties:s},ww,Ce,a,e,o)}function Aw(r,t,e){const n=e[0],i=t.getProperties(),s={node:r};s.properties=i;const o=t.getGeometry();if(o.getType()=="LineString"){const c=se(o,!0,n);s.geometryLayout=c.getLayout(),i.rtept=c.getCoordinates()}const a=e[e.length-1].node,l=fw[a.namespaceURI],h=lr(i,l);pt(s,gw,Ce,h,e,l)}function Lw(r,t,e){const n=e[0],i=t.getProperties(),s={node:r};s.properties=i;const o=t.getGeometry();if(o.getType()=="MultiLineString"){const c=se(o,!0,n);i.trkseg=c.getLineStrings()}const a=e[e.length-1].node,l=mw[a.namespaceURI],h=lr(i,l);pt(s,_w,Ce,h,e,l)}function Ow(r,t,e){const n={node:r};n.geometryLayout=t.getLayout(),n.properties={},pt(n,xw,yw,t.getCoordinates(),e)}function Fw(r,t,e){const n=e[0],i=e[e.length-1];i.properties=t.getProperties();const s=t.getGeometry();if(s.getType()=="Point"){const o=se(s,!0,n);i.geometryLayout=o.getLayout(),Qu(r,o.getCoordinates(),e)}}const Nw=iw;class Ju extends ya{constructor(){super()}getType(){return"text"}readFeature(t,e){return this.readFeatureFromText(Ba(t),this.adaptOptions(e))}readFeatureFromText(t,e){return ct()}readFeatures(t,e){return this.readFeaturesFromText(Ba(t),this.adaptOptions(e))}readFeaturesFromText(t,e){return ct()}readGeometry(t,e){return this.readGeometryFromText(Ba(t),this.adaptOptions(e))}readGeometryFromText(t,e){return ct()}readProjection(t){return this.readProjectionFromText(Ba(t))}readProjectionFromText(t){return this.dataProjection}writeFeature(t,e){return this.writeFeatureText(t,this.adaptOptions(e))}writeFeatureText(t,e){return ct()}writeFeatures(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))}writeFeaturesText(t,e){return ct()}writeGeometry(t,e){return this.writeGeometryText(t,this.adaptOptions(e))}writeGeometryText(t,e){return ct()}}function Ba(r){return typeof r=="string"?r:""}const Dw=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,kw=/^H.([A-Z]{3}).*?:(.*)/,Gw=/^HFDTE(\d{2})(\d{2})(\d{2})/,jw=/\r\n|\r|\n/;class zw extends Ju{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.altitudeMode_=t.altitudeMode?t.altitudeMode:"none"}readFeatureFromText(t,e){const n=this.altitudeMode_,i=t.split(jw),s={},o=[];let a=2e3,l=0,h=1,c=-1,u,f;for(u=0,f=i.length;u<f;++u){const x=i[u];let v;if(x.charAt(0)=="B"){if(v=Dw.exec(x),v){const w=parseInt(v[1],10),S=parseInt(v[2],10),E=parseInt(v[3],10);let T=parseInt(v[4],10)+parseInt(v[5],10)/6e4;v[6]=="S"&&(T=-T);let R=parseInt(v[7],10)+parseInt(v[8],10)/6e4;if(v[9]=="W"&&(R=-R),o.push(R,T),n!="none"){let I;n=="gps"?I=parseInt(v[11],10):n=="barometric"?I=parseInt(v[12],10):I=0,o.push(I)}let C=Date.UTC(a,l,h,w,S,E);C<c&&(C=Date.UTC(a,l,h+1,w,S,E)),o.push(C/1e3),c=C}}else x.charAt(0)=="H"&&(v=Gw.exec(x),v?(h=parseInt(v[1],10),l=parseInt(v[2],10)-1,a=2e3+parseInt(v[3],10)):(v=kw.exec(x),v&&(s[v[1]]=v[2].trim())))}if(o.length===0)return null;const p=n=="none"?"XYM":"XYZM",m=new ye(o,p),_=new Se(se(m,!1,e));return _.setProperties(s,!0),_}readFeaturesFromText(t,e){const n=this.readFeatureFromText(t,e);return n?[n]:[]}}const Uw=zw,_e={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Li={};Li[_e.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Li[_e.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Li[_e.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Li.none={none:{supports:[],formats:[],qualities:[]}};const Bw=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,lg=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Xw=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function qw(r){let t=r.getComplianceLevelSupportedFeatures();return t===void 0&&(t=Li[_e.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:t.supports,formats:[...t.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...t.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function Ww(r){const t=r.getComplianceLevelSupportedFeatures(),e=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,n=e&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],i=e&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=e&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(o){return o.width})[0],r.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...t.supports,...n],formats:[...t.formats,...i],qualities:[...t.qualities,...s]}}function Zw(r){const t=r.getComplianceLevelSupportedFeatures(),e=r.imageInfo.extraFormats===void 0?t.formats:[...t.formats,...r.imageInfo.extraFormats],n=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&e.includes(s)?s:i},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(i){return i.width})[0],r.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?t.supports:[...t.supports,...r.imageInfo.extraFeatures],formats:e,qualities:r.imageInfo.extraQualities===void 0?t.qualities:[...t.qualities,...r.imageInfo.extraQualities],preferredFormat:n}}const hh={};hh[_e.VERSION1]=qw;hh[_e.VERSION2]=Ww;hh[_e.VERSION3]=Zw;class $w{constructor(t){this.setImageInfo(t)}setImageInfo(t){typeof t=="string"?this.imageInfo=JSON.parse(t):this.imageInfo=t}getImageApiVersion(){if(this.imageInfo===void 0)return;let t=this.imageInfo["@context"]||"ol-no-context";typeof t=="string"&&(t=[t]);for(let e=0;e<t.length;e++)switch(t[e]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return _e.VERSION1;case"http://iiif.io/api/image/2/context.json":return _e.VERSION2;case"http://iiif.io/api/image/3/context.json":return _e.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(_e.VERSION1)&&this.imageInfo.identifier)return _e.VERSION1;break}At(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(t){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(t===void 0&&(t=this.getImageApiVersion()),t){case _e.VERSION1:if(Bw.test(this.imageInfo.profile))return this.imageInfo.profile;break;case _e.VERSION3:if(Xw.test(this.imageInfo.profile))return this.imageInfo.profile;break;case _e.VERSION2:if(typeof this.imageInfo.profile=="string"&&lg.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&lg.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(t){const e=this.getComplianceLevelEntryFromProfile(t);if(e===void 0)return;const n=e.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const t=this.getImageApiVersion(),e=this.getComplianceLevelFromProfile(t);return e===void 0?Li.none.none:Li[t][e]}getTileSourceOptions(t){const e=t||{},n=this.getImageApiVersion();if(n===void 0)return;const i=n===void 0?void 0:hh[n](this);if(i!==void 0)return{url:i.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:e.format!==void 0&&i.formats.includes(e.format)?e.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:e.quality&&i.qualities.includes(e.quality)?e.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}const Vw=$w,et={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Wo={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Ae={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Ae.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Ae.max=Ae.whitepoint[2].D65;Ae.rgb=function(r,t){t=t||Ae.whitepoint[2].E;var e=r[0]/t[0],n=r[1]/t[1],i=r[2]/t[2],s,o,a;return s=e*3.240969941904521+n*-1.537383177570093+i*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+i*.041555057407175,a=e*.055630079696993+n*-.20397695888897+i*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};Wo.xyz=function(r,t){var e=r[0]/255,n=r[1]/255,i=r[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var s=e*.41239079926595+n*.35758433938387+i*.18048078840183,o=e*.21263900587151+n*.71516867876775+i*.072192315360733,a=e*.019330818715591+n*.11919477979462+i*.95053215224966;return t=t||Ae.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};const td={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(r,t,e){var n,i,s,o,a,l,h,c,u,f,p,m,_;if(s=r[0],o=r[1],a=r[2],s===0)return[0,0,0];var x=.0011070564598794539;return t=t||"D65",e=e||2,u=Ae.whitepoint[e][t][0],f=Ae.whitepoint[e][t][1],p=Ae.whitepoint[e][t][2],m=4*u/(u+15*f+3*p),_=9*f/(u+15*f+3*p),n=o/(13*s)+m||0,i=a/(13*s)+_||0,h=s>8?f*Math.pow((s+16)/116,3):f*s*x,l=h*9*n/(4*i)||0,c=h*(12-3*n-20*i)/(4*i)||0,[l,h,c]}};Ae.luv=function(r,t,e){var n,i,s,o,a,l,h,c,u,f,p,m,_,x=.008856451679035631,v=903.2962962962961;t=t||"D65",e=e||2,u=Ae.whitepoint[e][t][0],f=Ae.whitepoint[e][t][1],p=Ae.whitepoint[e][t][2],m=4*u/(u+15*f+3*p),_=9*f/(u+15*f+3*p),l=r[0],h=r[1],c=r[2],n=4*l/(l+15*h+3*c)||0,i=9*h/(l+15*h+3*c)||0;var w=h/f;return s=w<=x?v*w:116*Math.pow(w,1/3)-16,o=13*s*(n-m),a=13*s*(i-_),[s,o,a]};var e0={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(r){var t=r[0],e=r[1],n=r[2],i,s,o;return o=n/360*2*Math.PI,i=e*Math.cos(o),s=e*Math.sin(o),[t,i,s]},xyz:function(r){return td.xyz(e0.luv(r))}};td.lchuv=function(r){var t=r[0],e=r[1],n=r[2],i=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,i,o]};Ae.lchuv=function(r){return td.lchuv(Ae.luv(r))};var Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $s(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Yw={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const hg=$s(Yw);var cg={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Hw(r){var t,e,n,i=[],s=1,o;if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(r=String(r).toLowerCase(),hg[r])i=hg[r].slice(),o="rgb";else if(r==="transparent")s=0,o="rgb",i=[0,0,0];else if(r[0]==="#"){var a=r.slice(1),l=a.length,h=l<=4;s=1,h?(i=[parseInt(a[0]+a[0],16),parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16)],l===4&&(s=parseInt(a[3]+a[3],16)/255)):(i=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)],l===8&&(s=parseInt(a[6]+a[7],16)/255)),i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0),o="rgb"}else if(n=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(r)){var c=n[1];o=c.replace(/a$/,"");var u=o==="cmyk"?4:o==="gray"?1:3;i=n[2].trim().split(/\s*[,\/]\s*|\s+/),o==="color"&&(o=i.shift()),i=i.map(function(f,p){if(f[f.length-1]==="%")return f=parseFloat(f)/100,p===3?f:o==="rgb"?f*255:o[0]==="h"||o[0]==="l"&&!p?f*100:o==="lab"?f*125:o==="lch"?p<2?f*150:f*360:o[0]==="o"&&!p?f:o==="oklab"?f*.4:o==="oklch"?p<2?f*.4:f*360:f;if(o[p]==="h"||p===2&&o[o.length-1]==="h"){if(cg[f]!==void 0)return cg[f];if(f.endsWith("deg"))return parseFloat(f);if(f.endsWith("turn"))return parseFloat(f)*360;if(f.endsWith("grad"))return parseFloat(f)*360/400;if(f.endsWith("rad"))return parseFloat(f)*180/Math.PI}return f==="none"?0:parseFloat(f)}),s=i.length>u?i.pop():1}else/[0-9](?:\s|\/|,)/.test(r)&&(i=r.match(/([0-9]+)/g).map(function(f){return parseFloat(f)}),o=((e=(t=r.match(/([a-z])/ig))==null?void 0:t.join(""))==null?void 0:e.toLowerCase())||"rgb");return{space:o,values:i,alpha:s}}const Kh={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(r){var t=r[0]/360,e=r[1]/100,n=r[2]/100,i,s,o,a,l,h=0;if(e===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+e):n+e-n*e,i=2*n-s,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?i+(s-i)*6*o:2*o<1?s:3*o<2?i+(s-i)*(2/3-o)*6:i,a[h++]=l*255;return a}};Wo.hsl=function(r){var t=r[0]/255,e=r[1]/255,n=r[2]/255,i=Math.min(t,e,n),s=Math.max(t,e,n),o=s-i,a,l,h;return s===i?a=0:t===s?a=(e-n)/o:e===s?a=2+(n-t)/o:n===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(i+s)/2,s===i?l=0:h<=.5?l=o/(s+i):l=o/(2-s-i),[a,l*100,h*100]};function Kw(r){Array.isArray(r)&&r.raw&&(r=String.raw(...arguments)),r instanceof Number&&(r=+r);var t,e=Hw(r);if(!e.space)return[];const n=e.space[0]==="h"?Kh.min:Wo.min,i=e.space[0]==="h"?Kh.max:Wo.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),i[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),i[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),i[2]),e.space[0]==="h"&&(t=Kh.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function Qw(r){return typeof r=="string"?r:rd(r)}const Jw=1024,ao={};let Qh=0;function tb(r){if(r.length===4)return r;const t=r.slice();return t[3]=1,t}function ug(r){const t=Ae.lchuv(Wo.xyz(r));return t[3]=r[3],t}function eb(r){const t=Ae.rgb(e0.xyz(r));return t[3]=r[3],t}function ed(r){if(ao.hasOwnProperty(r))return ao[r];if(Qh>=Jw){let e=0;for(const n in ao)e++&3||(delete ao[n],--Qh)}const t=Kw(r);if(t.length!==4)throw new Error('Failed to parse "'+r+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+r+'" as color');return r0(t),ao[r]=t,++Qh,t}function zr(r){return Array.isArray(r)?r:ed(r)}function r0(r){return r[0]=wt(r[0]+.5|0,0,255),r[1]=wt(r[1]+.5|0,0,255),r[2]=wt(r[2]+.5|0,0,255),r[3]=wt(r[3],0,1),r}function rd(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);const i=r[3]===void 0?1:Math.round(r[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+i+")"}function rb(r){try{return ed(r),!0}catch{return!1}}const hi=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";hi.includes("firefox");const nb=hi.includes("safari")&&!hi.includes("chrom"),ib=nb&&(hi.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(hi));hi.includes("webkit")&&hi.includes("edge");hi.includes("macintosh");const n0=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,nd=typeof Image<"u"&&Image.prototype.decode,sb=typeof createImageBitmap=="function";(function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r})();function Jt(r,t,e,n){let i;return e&&e.length?i=e.shift():n0?i=new OffscreenCanvas(r||300,t||300):i=document.createElement("canvas"),r&&(i.width=r),t&&(i.height=t),i.getContext("2d",n)}let Jh;function Xc(){return Jh||(Jh=Jt(1,1)),Jh}function Oi(r){const t=r.canvas;t.width=1,t.height=1,r.clearRect(0,0,1,1)}class ch extends ha{constructor(t,e,n,i){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof i=="function"?et.IDLE:i,this.image_=null,this.loader=typeof i=="function"?i:null}changed(){this.dispatchEvent(Lt.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==et.IDLE&&this.loader){this.state=et.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;wm(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=et.LOADED}).catch(n=>{this.state=et.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function ob(r,t,e){const n=r;let i=!0,s=!1,o=!1;const a=[Uo(n,Lt.LOAD,function(){o=!0,s||t()})];return n.src&&nd?(s=!0,n.decode().then(function(){i&&t()}).catch(function(l){i&&(o?t():e())})):a.push(Uo(n,Lt.ERROR,e)),function(){i=!1,a.forEach(ve)}}function ab(r,t){return new Promise((e,n)=>{function i(){o(),e(r)}function s(){o(),n(new Error("Image load error"))}function o(){r.removeEventListener("load",i),r.removeEventListener("error",s)}r.addEventListener("load",i),r.addEventListener("error",s),t&&(r.src=t)})}function i0(r,t){return t&&(r.src=t),r.src&&nd?new Promise((e,n)=>r.decode().then(()=>e(r)).catch(i=>r.complete&&r.width?e(r):n(i))):ab(r)}function di(r,t){return t&&(r.src=t),r.src&&nd&&sb?r.decode().then(()=>createImageBitmap(r)).catch(e=>{if(r.complete&&r.width)return r;throw e}):i0(r)}class lb{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const i=tc(t,e,n);return i in this.cache_?this.cache_[i]:null}getPattern(t,e,n){const i=tc(t,e,n);return i in this.patternCache_?this.patternCache_[i]:null}set(t,e,n,i,s){const o=tc(t,e,n),a=o in this.cache_;this.cache_[o]=i,s&&(i.getImageState()===et.IDLE&&i.load(),i.getImageState()===et.LOADING?i.ready().then(()=>{this.patternCache_[o]=Xc().createPattern(i.getImage(1),"repeat")}):this.patternCache_[o]=Xc().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function tc(r,t,e){const n=e?zr(e):"null";return t+":"+r+":"+n}const Jn=new lb;let lo=null;class hb extends ha{constructor(t,e,n,i,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=i===void 0?et.IDLE:i,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===et.LOADED){lo||(lo=Jt(1,1,void 0,{willReadFrequently:!0})),lo.drawImage(this.image_,0,0);try{lo.getImageData(0,0,1,1),this.tainted_=!1}catch{lo=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Lt.CHANGE)}handleImageError_(){this.imageState_=et.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=et.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Jt(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===et.IDLE){this.image_||this.initializeImage_(),this.imageState_=et.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&i0(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==et.LOADED)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const i=n.getContext("2d");i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=Qw(this.color_),i.fillRect(0,0,n.width/t,n.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===et.LOADED||this.imageState_===et.ERROR?t():this.addEventListener(Lt.CHANGE,function e(){(this.imageState_===et.LOADED||this.imageState_===et.ERROR)&&(this.removeEventListener(Lt.CHANGE,e),t())})})),this.ready_}}function id(r,t,e,n,i,s){let o=t===void 0?void 0:Jn.get(t,e,i);return o||(o=new hb(r,r instanceof HTMLImageElement?r.src||void 0:t,e,n,i),Jn.set(t,e,i,o,s)),s&&o&&!Jn.getPattern(t,e,i)&&Jn.set(t,e,i,o,s),o}class Ur{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Ur({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=id(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===et.IDLE&&e.load(),e.getImageState()===et.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function s0(r,t,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function ie(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}class uh{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ie(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new uh({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ct()}getImage(t){return ct()}getHitDetectionImage(){return ct()}getPixelRatio(t){return 1}getImageState(){return ct()}getImageSize(){return ct()}getOrigin(){return ct()}getSize(){return ct()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ie(t)}listenImageChange(t){ct()}load(){ct()}unlistenImageChange(t){ct()}ready(){return Promise.resolve()}}function dg(r,t,e,n){return e!==void 0&&n!==void 0?[e/r,n/t]:e!==void 0?e/r:n!==void 0?n/t:1}class sd extends uh{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;At(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||it(o)),At(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),At(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=et.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?et.LOADED:et.IDLE:l=et.LOADING:l=et.LOADED),this.color_=t.color!==void 0?zr(t.color):null,this.iconImage_=id(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const f=()=>{if(this.unlistenImageChange(f),!this.initialOptions_)return;const p=this.iconImage_.getSize();this.setScale(dg(p[0],p[1],t.width,t.height))};this.listenImageChange(f);return}}h!==void 0&&this.setScale(dg(h,c,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new sd({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==et.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==et.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Lt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Lt.CHANGE,t)}ready(){return this.iconImage_.ready()}}const dh=sd;class od{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new od({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const an=od;function Jr(r){return r?Array.isArray(r)?rd(r):typeof r=="object"&&"src"in r?cb(r):r:null}function cb(r){if(!r.offset||!r.size)return Jn.getPattern(r.src,"anonymous",r.color);const t=r.src+":"+r.offset,e=Jn.getPattern(t,void 0,r.color);if(e)return e;const n=Jn.get(r.src,"anonymous",null);if(n.getImageState()!==et.LOADED)return null;const i=Jt(r.size[0],r.size[1]);return i.drawImage(n.getImage(1),r.offset[0],r.offset[1],r.size[0],r.size[1],0,0,r.size[0],r.size[1]),id(i.canvas,t,void 0,et.LOADED,r.color,!0),Jn.getPattern(t,void 0,r.color)}const ub=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),fg=["style","variant","weight","size","lineHeight","family"],o0=function(r){const t=r.match(ub);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,i=fg.length;n<i;++n){const s=t[n+1];s!==void 0&&(e[fg[n]]=s)}return e.families=e.family.split(/,\s?/),e},a0="10px sans-serif",er="#000",Fs="round",Rn=[],Cn=0,Ns="round",Zo=10,$o="#000",Vo="center",bl="middle",Si=[0,0,0,0],Yo=1,qn=new zi;let ss=null,qc;const Wc={},db=function(){const r="32px ",t=["monospace","serif"],e=t.length,n="wmytzilWMYTZIL@#/&?$%10";let i,s;function o(l,h,c){let u=!0;for(let f=0;f<e;++f){const p=t[f];if(s=Sl(l+" "+h+" "+r+p,n),c!=p){const m=Sl(l+" "+h+" "+r+c+","+p,n);u=u&&m!=s}}return!!u}function a(){let l=!0;const h=qn.getKeys();for(let c=0,u=h.length;c<u;++c){const f=h[c];qn.get(f)<100&&(o.apply(this,f.split(`
`))?(Xs(Wc),ss=null,qc=void 0,qn.set(f,100)):(qn.set(f,qn.get(f)+1,!0),l=!1))}l&&(clearInterval(i),i=void 0)}return function(l){const h=o0(l);if(!h)return;const c=h.families;for(let u=0,f=c.length;u<f;++u){const p=c[u],m=h.style+`
`+h.weight+`
`+p;qn.get(m)===void 0&&(qn.set(m,100,!0),o(h.style,h.weight,p)||(qn.set(m,0,!0),i===void 0&&(i=setInterval(a,32))))}}}(),fb=function(){let r;return function(t){let e=Wc[t];if(e==null){if(n0){const n=o0(t),i=l0(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);Wc[t]=e}return e}}();function l0(r,t){return ss||(ss=Jt(1,1)),r!=qc&&(ss.font=r,qc=ss.font),ss.measureText(t)}function Sl(r,t){return l0(r,t).width}function gg(r,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((i,s)=>Math.max(i,Sl(r,s)),0);return e[t]=n,n}function gb(r,t){const e=[],n=[],i=[];let s=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){s=Math.max(s,o),i.push(o),o=0,a+=l;continue}const f=t[h+1]||r.font,p=Sl(f,u);e.push(p),o+=p;const m=fb(f);n.push(m),l=Math.max(l,m)}return{width:s,height:a,widths:e,heights:n,lineWidths:i}}function pb(r,t,e,n,i,s,o,a,l,h,c){r.save(),e!==1&&(r.globalAlpha===void 0?r.globalAlpha=u=>u.globalAlpha*=e:r.globalAlpha*=e),t&&r.transform.apply(r,t),n.contextInstructions?(r.translate(l,h),r.scale(c[0],c[1]),mb(n,r)):c[0]<0||c[1]<0?(r.translate(l,h),r.scale(c[0],c[1]),r.drawImage(n,i,s,o,a,0,0,o,a)):r.drawImage(n,i,s,o,a,l,h,o*c[0],a*c[1]),r.restore()}function mb(r,t){const e=r.contextInstructions;for(let n=0,i=e.length;n<i;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class fh extends uh{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?et.LOADING:et.LOADED,this.imageState_===et.LOADING&&this.ready().then(()=>this.imageState_=et.LOADED),this.render()}clone(){const t=this.getScale(),e=new fh({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,i=Jt(n.size*t,n.size*t);this.draw_(n,i,t),e=i.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let i=this.radius_,s=this.radius2_===void 0?i:this.radius2_;if(i<s){const E=i;i=s,s=E}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),c=i-h,u=Math.sqrt(l*l+c*c),f=u/l;if(t==="miter"&&f<=n)return f*e;const p=e/2/f,m=e/2*(c/u),_=Math.sqrt((i+p)*(i+p)+m*m)-i;if(this.radius2_===void 0||t==="bevel")return _*2;const x=i*Math.sin(a),v=Math.sqrt(i*i-x*x),w=s-v,S=Math.sqrt(x*x+w*w)/x;if(S<=n){const E=S*e/2-s-i;return 2*Math.max(_,E)}return _*2}createRenderOptions(){let t=Fs,e=Ns,n=0,i=null,s=0,o,a=0;this.stroke_&&(o=Jr(this.stroke_.getColor()??$o),a=this.stroke_.getWidth()??Yo,i=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Ns,t=this.stroke_.getLineCap()??Fs,n=this.stroke_.getMiterLimit()??Zo);const l=this.calculateLineJoinSize_(e,a,n),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:i,lineDashOffset:s,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let i=this.fill_.getColor();i===null&&(i=er),e.fillStyle=Jr(i),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),i=0;typeof n=="string"&&(n=zr(n)),n===null?i=1:Array.isArray(n)&&(i=n.length===4?n[3]:1),i===0&&(e=Jt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,h=a%2===0?n:i;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=er,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class gh extends fh{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new gh({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class ph{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=pg,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new ph({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=pg,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function _b(r){let t;if(typeof r=="function")t=r;else{let e;Array.isArray(r)?e=r:(At(typeof r.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[r]),t=function(){return e}}return t}let ec=null;function yb(r,t){if(!ec){const e=new Ur({color:"rgba(255,255,255,0.4)"}),n=new an({color:"#3399CC",width:1.25});ec=[new ph({image:new gh({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return ec}function pg(r){return r.getGeometry()}const $e=ph,xb="#333";class Fi{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=ie(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Ur({color:xb}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Fi({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ie(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const Gn=["http://www.google.com/kml/ext/2.2"],lt=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],vb="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",mg={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},wb=W(lt,{ExtendedData:S0,Region:E0,MultiGeometry:O(v0,"geometry"),LineString:O(y0,"geometry"),LinearRing:O(x0,"geometry"),Point:O(w0,"geometry"),Polygon:O(b0,"geometry"),Style:O(hd),StyleMap:i2,address:O($),description:O($),name:O($),open:O(li),phoneNumber:O($),styleUrl:O(f0),visibility:O(li)},W(Gn,{MultiTrack:O(Wb,"geometry"),Track:O(_0,"geometry")})),bb=W(lt,{ExtendedData:S0,Region:E0,Link:m2,address:O($),description:O($),name:O($),open:O(li),phoneNumber:O($),visibility:O(li)}),Sb=W(lt,{href:O(d0)}),Eb=W(lt,{Altitude:O(Pt),Longitude:O(Pt),Latitude:O(Pt),Tilt:O(Pt),AltitudeMode:O($),Heading:O(Pt),Roll:O(Pt)}),h0=W(lt,{LatLonAltBox:h2,Lod:u2}),Tb=W(lt,["Document","Placemark"]),Mb=W(lt,{Document:N(E2),Placemark:N(R0)});let Ss,sl=null,Zc,Io,Po,Ao,El,$c=null,ad,Vc=null,Yc,Ei=null,_g=null,Hc=null;function Tl(r){return 32/Math.min(r[0],r[1])}function Rb(){Ss=[255,255,255,1],sl=new Ur({color:Ss}),Zc=[20,2],Io="pixels",Po="pixels",Ao=[64,64],El="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",$c=new dh({anchor:Zc,anchorOrigin:"bottom-left",anchorXUnits:Io,anchorYUnits:Po,crossOrigin:"anonymous",rotation:0,scale:Tl(Ao),size:Ao,src:El}),ad="NO_IMAGE",Vc=new an({color:Ss,width:1}),Yc=new an({color:[51,51,51,1],width:2}),Ei=new Fi({font:"bold 16px Helvetica",fill:sl,stroke:Yc,scale:.8}),_g=new $e({fill:sl,image:$c,text:Ei,stroke:Vc,zIndex:0}),Hc=[_g]}let Xa;function Cb(r){return r}class Ib extends va{constructor(t){super(),t=t||{},Hc||Rb(),this.dataProjection=tt("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:Hc,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:Cb,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const n=W(lt,{Document:vl(this.readDocumentOrFolder_,this),Folder:vl(this.readDocumentOrFolder_,this),Placemark:ot(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),i=Z([],n,t,e,this);if(i)return i}readPlacemark_(t,e){const n=Z({geometry:null},wb,t,e,this);if(!n)return;const i=new Se,s=t.getAttribute("id");s!==null&&i.setId(s);const o=e[0],a=n.geometry;if(a&&se(a,!1,o),i.setGeometry(a),delete n.geometry,this.extractStyles_){const l=n.Style,h=n.styleUrl,c=Ab(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);i.setStyle(c)}return delete n.Style,i.setProperties(n,!0),i}readSharedStyle_(t,e){const n=t.getAttribute("id");if(n!==null){const i=hd.call(this,t,e);if(i){let s,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+n,o).href:s="#"+n,this.sharedStyles_[s]=i}}}readSharedStyleMap_(t,e){const n=t.getAttribute("id");if(n===null)return;const i=p0.call(this,t,e);if(!i)return;let s,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+n,o).href:s="#"+n,this.sharedStyles_[s]=i}readFeatureFromNode(t,e){return lt.includes(t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null}readFeaturesFromNode(t,e){if(!lt.includes(t.namespaceURI))return[];let n;const i=t.localName;if(i=="Document"||i=="Folder")return n=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),n||[];if(i=="Placemark"){const s=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return s?[s]:[]}if(i=="kml"){n=[];for(let s=t.firstElementChild;s;s=s.nextElementSibling){const o=this.readFeaturesFromNode(s,e);o&&Ot(n,o)}return n}return[]}readName(t){if(t){if(typeof t=="string"){const e=Tr(t);return this.readNameFromDocument(e)}return Er(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const n=this.readNameFromNode(e);if(n)return n}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(lt.includes(e.namespaceURI)&&e.localName=="name")return $(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const n=e.localName;if(lt.includes(e.namespaceURI)&&(n=="Document"||n=="Folder"||n=="Placemark"||n=="kml")){const i=this.readNameFromNode(e);if(i)return i}}}readNetworkLinks(t){const e=[];if(typeof t=="string"){const n=Tr(t);Ot(e,this.readNetworkLinksFromDocument(n))}else Er(t)?Ot(e,this.readNetworkLinksFromDocument(t)):Ot(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Ot(e,this.readNetworkLinksFromNode(n));return e}readNetworkLinksFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName=="NetworkLink"){const i=Z({},bb,n,[]);e.push(i)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const i=n.localName;lt.includes(n.namespaceURI)&&(i=="Document"||i=="Folder"||i=="kml")&&Ot(e,this.readNetworkLinksFromNode(n))}return e}readRegion(t){const e=[];if(typeof t=="string"){const n=Tr(t);Ot(e,this.readRegionFromDocument(n))}else Er(t)?Ot(e,this.readRegionFromDocument(t)):Ot(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Ot(e,this.readRegionFromNode(n));return e}readRegionFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName=="Region"){const i=Z({},h0,n,[]);e.push(i)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const i=n.localName;lt.includes(n.namespaceURI)&&(i=="Document"||i=="Folder"||i=="kml")&&Ot(e,this.readRegionFromNode(n))}return e}readCamera(t){const e=[];if(typeof t=="string"){const n=Tr(t);Ot(e,this.readCameraFromDocument(n))}else Er(t)?Ot(e,this.readCameraFromDocument(t)):Ot(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType===Node.ELEMENT_NODE&&Ot(e,this.readCameraFromNode(n));return e}readCameraFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName==="Camera"){const i=Z({},Eb,n,[]);e.push(i)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const i=n.localName;lt.includes(n.namespaceURI)&&(i==="Document"||i==="Folder"||i==="Placemark"||i==="kml")&&Ot(e,this.readCameraFromNode(n))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt(lt[4],"kml"),i="http://www.w3.org/2000/xmlns/";n.setAttributeNS(i,"xmlns:gx",Gn[0]),n.setAttributeNS(i,"xmlns:xsi",Ai),n.setAttributeNS(Ai,"xsi:schemaLocation",vb);const s={node:n},o={};t.length>1?o.Document=t:t.length==1&&(o.Placemark=t[0]);const a=Tb[n.namespaceURI],l=lr(o,a);return pt(s,Mb,Ce,l,[e],a,this),n}}function Pb(r,t){const e=[0,0];let n="start";const i=r.getImage();if(i){const o=i.getSize();if(o&&o.length==2){const a=i.getScaleArray(),l=i.getAnchor();e[0]=a[0]*(o[0]-l[0]),e[1]=a[1]*(o[1]/2-l[1]),n="left"}}let s=r.getText();return s?(s=s.clone(),s.setFont(s.getFont()||Ei.getFont()),s.setScale(s.getScale()||Ei.getScale()),s.setFill(s.getFill()||Ei.getFill()),s.setStroke(s.getStroke()||Yc)):s=Ei.clone(),s.setText(t),s.setOffsetX(e[0]),s.setOffsetY(e[1]),s.setTextAlign(n),new $e({image:i,text:s})}function Ab(r,t,e,n,i){return function(s,o){let a=i,l="",h=[];if(a){const u=s.getGeometry();if(u)if(u instanceof Ge)h=u.getGeometriesArrayRecursive().filter(function(f){const p=f.getType();return p==="Point"||p==="MultiPoint"}),a=h.length>0;else{const f=u.getType();a=f==="Point"||f==="MultiPoint"}}a&&(l=s.get("name"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(Xa||(Xa=document.createElement("textarea")),Xa.innerHTML=l,l=Xa.value));let c=e;if(r?c=r:t&&(c=c0(t,e,n)),a){const u=Pb(c[0],l);if(h.length>0){u.setGeometry(new Ge(h));const f=new $e({geometry:c[0].getGeometry(),image:null,fill:c[0].getFill(),stroke:c[0].getStroke(),text:null});return[u,f].concat(c.slice(1))}return u}return c}}function c0(r,t,e){return Array.isArray(r)?r:typeof r=="string"?c0(e[r],t,e):t}function mh(r){const t=Ve(r,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){const n=e[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function u0(r){let t=Ve(r,!1);const e=[];t=t.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let i;for(;i=n.exec(t);){const s=parseFloat(i[1]),o=parseFloat(i[2]),a=i[3]?parseFloat(i[3]):0;e.push(s,o,a),t=t.substr(i[0].length)}if(t==="")return e}function d0(r){const t=Ve(r,!1).trim();let e=r.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function f0(r){const t=Ve(r,!1).trim().replace(/^(?!.*#)/,"#");let e=r.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function Lb(r){const t=r.getAttribute("xunits"),e=r.getAttribute("yunits");let n;return t!=="insetPixels"?e!=="insetPixels"?n="bottom-left":n="top-left":e!=="insetPixels"?n="bottom-right":n="top-right",{x:parseFloat(r.getAttribute("x")),xunits:mg[t],y:parseFloat(r.getAttribute("y")),yunits:mg[e],origin:n}}function g0(r){return Pt(r)}const Ob=W(lt,{Pair:n2});function p0(r,t){return Z(void 0,Ob,r,t,this)}const Fb=W(lt,{Icon:O(Vb),color:O(mh),heading:O(Pt),hotSpot:O(Lb),scale:O(g0)});function Nb(r,t){const e=Z({},Fb,r,t);if(!e)return;const n=t[t.length-1],i="Icon"in e?e.Icon:{},s=!("Icon"in e)||Object.keys(i).length>0;let o;const a=i.href;a?o=a:s&&(o=El);let l,h,c,u="bottom-left";const f=e.hotSpot;f?(l=[f.x,f.y],h=f.xunits,c=f.yunits,u=f.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=Zc,h=Io,c=Po):o.includes("arrow-reverse")?(l=[54,42],h=Io,c=Po):o.includes("paddle")&&(l=[32,1],h=Io,c=Po));let p;const m=i.x,_=i.y;m!==void 0&&_!==void 0&&(p=[m,_]);let x;const v=i.w,w=i.h;v!==void 0&&w!==void 0&&(x=[v,w]);let S;const E=e.heading;E!==void 0&&(S=Co(E));const T=e.scale,R=e.color;if(s){o==El&&(x=Ao);const C=new dh({anchor:l,anchorOrigin:u,anchorXUnits:h,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:"bottom-left",rotation:S,scale:T,size:x,src:this.iconUrlFunction_(o),color:R}),I=C.getScaleArray()[0],F=C.getSize();if(F===null){const U=C.getImageState();if(U===et.IDLE||U===et.LOADING){const j=function(){const B=C.getImageState();if(!(B===et.IDLE||B===et.LOADING)){const d=C.getSize();if(d&&d.length==2){const g=Tl(d);C.setScale(I*g)}C.unlistenImageChange(j)}};C.listenImageChange(j),U===et.IDLE&&C.load()}}else if(F.length==2){const U=Tl(F);C.setScale(I*U)}n.imageStyle=C}else n.imageStyle=ad}const Db=W(lt,{color:O(mh),scale:O(g0)});function kb(r,t){const e=Z({},Db,r,t);if(!e)return;const n=t[t.length-1],i=new Fi({fill:new Ur({color:"color"in e?e.color:Ss}),scale:e.scale});n.textStyle=i}const Gb=W(lt,{color:O(mh),width:O(Pt)});function jb(r,t){const e=Z({},Gb,r,t);if(!e)return;const n=t[t.length-1],i=new an({color:"color"in e?e.color:Ss,width:"width"in e?e.width:1});n.strokeStyle=i}const zb=W(lt,{color:O(mh),fill:O(li),outline:O(li)});function Ub(r,t){const e=Z({},zb,r,t);if(!e)return;const n=t[t.length-1],i=new Ur({color:"color"in e?e.color:Ss});n.fillStyle=i;const s=e.fill;s!==void 0&&(n.fill=s);const o=e.outline;o!==void 0&&(n.outline=o)}const Bb=W(lt,{coordinates:ht(u0)});function m0(r,t){return Z(null,Bb,r,t)}function Xb(r,t){const e=t[t.length-1].coordinates,n=Ve(r,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){const s=parseFloat(i[1]),o=parseFloat(i[2]),a=parseFloat(i[3]);e.push([s,o,a])}else e.push([])}const qb=W(Gn,{Track:ot(_0)});function Wb(r,t){const e=Z([],qb,r,t);if(e)return new ar(e)}const Zb=W(lt,{when:_2},W(Gn,{coord:Xb}));function _0(r,t){const e=Z({coordinates:[],whens:[]},Zb,r,t);if(!e)return;const n=[],i=e.coordinates,s=e.whens;for(let o=0,a=Math.min(i.length,s.length);o<a;++o)i[o].length==3&&n.push(i[o][0],i[o][1],i[o][2],s[o]);return new ye(n,"XYZM")}const $b=W(lt,{href:O(d0)},W(Gn,{x:O(Pt),y:O(Pt),w:O(Pt),h:O(Pt)}));function Vb(r,t){return Z({},$b,r,t)||null}const Yb=W(lt,{coordinates:ht(u0)});function ld(r,t){return Z(null,Yb,r,t)}const _h=W(lt,{extrude:O(li),tessellate:O(li),altitudeMode:O($)});function y0(r,t){const e=Z({},_h,r,t),n=ld(r,t);if(n){const i=new ye(n,"XYZ");return i.setProperties(e,!0),i}}function x0(r,t){const e=Z({},_h,r,t),n=ld(r,t);if(n){const i=new ze(n,"XYZ",[n.length]);return i.setProperties(e,!0),i}}const Hb=W(lt,{LineString:ot(y0),LinearRing:ot(x0),MultiGeometry:ot(v0),Point:ot(w0),Polygon:ot(b0)});function v0(r,t){const e=Z([],Hb,r,t);if(!e)return null;if(e.length===0)return new Ge(e);let n,i=!0;const s=e[0].getType();let o;for(let a=1,l=e.length;a<l;++a)if(o=e[a],o.getType()!=s){i=!1;break}if(i){let a,l;if(s=="Point"){const h=e[0];a=h.getLayout(),l=h.getFlatCoordinates();for(let c=1,u=e.length;c<u;++c)o=e[c],Ot(l,o.getFlatCoordinates());n=new Xr(l,a),rc(n,e)}else if(s=="LineString")n=new ar(e),rc(n,e);else if(s=="Polygon")n=new Rr(e),rc(n,e);else if(s=="GeometryCollection")n=new Ge(e);else throw new Error("Unknown geometry type found")}else n=new Ge(e);return n}function w0(r,t){const e=Z({},_h,r,t),n=ld(r,t);if(n){const i=new Me(n,"XYZ");return i.setProperties(e,!0),i}}const Kb=W(lt,{innerBoundaryIs:f2,outerBoundaryIs:p2});function b0(r,t){const e=Z({},_h,r,t),n=Z([null],Kb,r,t);if(n&&n[0]){const i=n[0],s=[i.length];for(let a=1,l=n.length;a<l;++a)Ot(i,n[a]),s.push(i.length);const o=new ze(i,"XYZ",s);return o.setProperties(e,!0),o}}const Qb=W(lt,{IconStyle:Nb,LabelStyle:kb,LineStyle:jb,PolyStyle:Ub});function hd(r,t){const e=Z({},Qb,r,t,this);if(!e)return null;let n="fillStyle"in e?e.fillStyle:sl;const i=e.fill;i!==void 0&&!i&&(n=null);let s;"imageStyle"in e?e.imageStyle!=ad&&(s=e.imageStyle):s=$c;const o="textStyle"in e?e.textStyle:Ei,a="strokeStyle"in e?e.strokeStyle:Vc,l=e.outline;return l!==void 0&&!l?[new $e({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const f=c;return new Ge(f.getGeometriesArrayRecursive().filter(function(p){const m=p.getType();return m!=="Polygon"&&m!=="MultiPolygon"}))}if(u!=="Polygon"&&u!=="MultiPolygon")return c},fill:n,image:s,stroke:a,text:o,zIndex:void 0}),new $e({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const f=c;return new Ge(f.getGeometriesArrayRecursive().filter(function(p){const m=p.getType();return m==="Polygon"||m==="MultiPolygon"}))}if(u==="Polygon"||u==="MultiPolygon")return c},fill:n,stroke:null,zIndex:void 0})]:[new $e({fill:n,image:s,stroke:a,text:o,zIndex:void 0})]}function rc(r,t){const e=t.length,n=new Array(t.length),i=new Array(t.length),s=new Array(t.length);let o,a,l;o=!1,a=!1,l=!1;for(let h=0;h<e;++h){const c=t[h];n[h]=c.get("extrude"),i[h]=c.get("tessellate"),s[h]=c.get("altitudeMode"),o=o||n[h]!==void 0,a=a||i[h]!==void 0,l=l||s[h]}o&&r.set("extrude",n),a&&r.set("tessellate",i),l&&r.set("altitudeMode",s)}const Jb=W(lt,{displayName:O($),value:O($)});function t2(r,t){const e=r.getAttribute("name");sr(Jb,r,t);const n=t[t.length-1];e&&n.displayName?n[e]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:e!==null?n[e]=n.value:n.displayName!==null&&(n[n.displayName]=n.value),delete n.value}const e2=W(lt,{Data:t2,SchemaData:o2});function S0(r,t){sr(e2,r,t)}function E0(r,t){sr(h0,r,t)}const r2=W(lt,{Style:O(hd),key:O($),styleUrl:O(f0)});function n2(r,t){const e=Z({},r2,r,t,this);if(!e)return;const n=e.key;if(n&&n=="normal"){const i=e.styleUrl;i&&(t[t.length-1]=i);const s=e.Style;s&&(t[t.length-1]=s)}}function i2(r,t){const e=p0.call(this,r,t);if(!e)return;const n=t[t.length-1];if(Array.isArray(e))n.Style=e;else if(typeof e=="string")n.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}const s2=W(lt,{SimpleData:a2});function o2(r,t){sr(s2,r,t)}function a2(r,t){const e=r.getAttribute("name");if(e!==null){const n=$(r),i=t[t.length-1];i[e]=n}}const l2=W(lt,{altitudeMode:O($),minAltitude:O(Pt),maxAltitude:O(Pt),north:O(Pt),south:O(Pt),east:O(Pt),west:O(Pt)});function h2(r,t){const e=Z({},l2,r,t);if(!e)return;const n=t[t.length-1],i=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];n.extent=i,n.altitudeMode=e.altitudeMode,n.minAltitude=parseFloat(e.minAltitude),n.maxAltitude=parseFloat(e.maxAltitude)}const c2=W(lt,{minLodPixels:O(Pt),maxLodPixels:O(Pt),minFadeExtent:O(Pt),maxFadeExtent:O(Pt)});function u2(r,t){const e=Z({},c2,r,t);if(!e)return;const n=t[t.length-1];n.minLodPixels=parseFloat(e.minLodPixels),n.maxLodPixels=parseFloat(e.maxLodPixels),n.minFadeExtent=parseFloat(e.minFadeExtent),n.maxFadeExtent=parseFloat(e.maxFadeExtent)}const d2=W(lt,{LinearRing:ot(m0)});function f2(r,t){const e=Z([],d2,r,t);e.length>0&&t[t.length-1].push(...e)}const g2=W(lt,{LinearRing:ht(m0)});function p2(r,t){const e=Z(void 0,g2,r,t);if(e){const n=t[t.length-1];n[0]=e}}function m2(r,t){sr(Sb,r,t)}function _2(r,t){const e=t[t.length-1].whens,n=Ve(r,!1),i=Date.parse(n);e.push(isNaN(i)?0:i)}function yh(r,t){const e=zr(t),n=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let i=0;i<4;++i){const s=Math.floor(n[i]).toString(16);n[i]=s.length==1?"0"+s:s}gt(r,n.join(""))}function y2(r,t,e){const n=e[e.length-1],i=n.layout,s=n.stride;let o;if(i=="XY"||i=="XYM")o=2;else if(i=="XYZ"||i=="XYZM")o=3;else throw new Error("Invalid geometry layout");const a=t.length;let l="";if(a>0){l+=t[0];for(let h=1;h<o;++h)l+=","+t[h];for(let h=s;h<a;h+=s){l+=" "+t[h];for(let c=1;c<o;++c)l+=","+t[h+c]}}gt(r,l)}const ol=W(lt,{Data:N(x2),value:N(w2),displayName:N(v2)});function x2(r,t,e){r.setAttribute("name",t.name);const n={node:r},i=t.value;typeof i=="object"?(i!==null&&i.displayName&&pt(n,ol,Ce,[i.displayName],e,["displayName"]),i!==null&&i.value&&pt(n,ol,Ce,[i.value],e,["value"])):pt(n,ol,Ce,[i],e,["value"])}function v2(r,t){Xv(r,t)}function w2(r,t){gt(r,t)}const b2=W(lt,{Placemark:N(R0)}),S2=function(r,t,e){const n=t[t.length-1].node;return mt(n.namespaceURI,"Placemark")};function E2(r,t,e){pt({node:r},b2,S2,t,e,void 0,this)}const T2=ce("Data");function M2(r,t,e){const n={node:r},i=t.names,s=t.values,o=i.length;for(let a=0;a<o;a++)pt(n,ol,T2,[{name:i[a],value:s[a]}],e)}const yg=W(lt,["href"],W(Gn,["x","y","w","h"])),xg=W(lt,{href:N(gt)},W(Gn,{x:N(tr),y:N(tr),w:N(tr),h:N(tr)})),R2=function(r,t,e){return mt(Gn[0],"gx:"+e)};function C2(r,t,e){const n={node:r},i=e[e.length-1].node;let s=yg[i.namespaceURI],o=lr(t,s);pt(n,xg,Ce,o,e,s),s=yg[Gn[0]],o=lr(t,s),pt(n,xg,R2,o,e,s)}const I2=W(lt,["scale","heading","Icon","color","hotSpot"]),P2=W(lt,{Icon:N(C2),color:N(yh),heading:N(tr),hotSpot:N(nS),scale:N(I0)});function A2(r,t,e){const n={node:r},i={},s=t.getSrc(),o=t.getSize(),a=t.getImageSize(),l={href:s};if(o){l.w=o[0],l.h=o[1];const x=t.getAnchor(),v=t.getOrigin();if(v&&a&&v[0]!==0&&v[1]!==o[1]&&(l.x=v[0],l.y=a[1]-(v[1]+o[1])),x&&(x[0]!==o[0]/2||x[1]!==o[1]/2)){const w={x:x[0],xunits:"pixels",y:o[1]-x[1],yunits:"pixels"};i.hotSpot=w}}i.Icon=l;let h=t.getScaleArray()[0],c=o;if(c===null&&(c=Ao),c.length==2){const x=Tl(c);h=h/x}h!==1&&(i.scale=h);const u=t.getRotation();u!==0&&(i.heading=u);const f=t.getColor();f&&(i.color=f);const p=e[e.length-1].node,m=I2[p.namespaceURI],_=lr(i,m);pt(n,P2,Ce,_,e,m)}const L2=W(lt,["color","scale"]),O2=W(lt,{color:N(yh),scale:N(I0)});function F2(r,t,e){const n={node:r},i={},s=t.getFill();s&&(i.color=s.getColor());const o=t.getScale();o&&o!==1&&(i.scale=o);const a=e[e.length-1].node,l=L2[a.namespaceURI],h=lr(i,l);pt(n,O2,Ce,h,e,l)}const N2=W(lt,["color","width"]),D2=W(lt,{color:N(yh),width:N(tr)});function k2(r,t,e){const n={node:r},i={color:t.getColor(),width:Number(t.getWidth())||1},s=e[e.length-1].node,o=N2[s.namespaceURI],a=lr(i,o);pt(n,D2,Ce,a,e,o)}const G2={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},T0=function(r,t,e){if(r){const n=t[t.length-1].node;return mt(n.namespaceURI,G2[r.getType()])}},j2=ce("Point"),z2=ce("LineString"),U2=ce("LinearRing"),B2=ce("Polygon"),X2=W(lt,{LineString:N(Es),Point:N(Es),Polygon:N(C0),GeometryCollection:N(M0)});function M0(r,t,e){const n={node:r},i=t.getType();let s=[],o;if(i==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(a){const l=a.getType();if(l==="MultiPoint")s=s.concat(a.getPoints());else if(l==="MultiLineString")s=s.concat(a.getLineStrings());else if(l==="MultiPolygon")s=s.concat(a.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")s.push(a);else throw new Error("Unknown geometry type")}),o=T0;else if(i==="MultiPoint")s=t.getPoints(),o=j2;else if(i==="MultiLineString")s=t.getLineStrings(),o=z2;else if(i==="MultiPolygon")s=t.getPolygons(),o=B2;else throw new Error("Unknown geometry type");pt(n,X2,o,s,e)}const q2=W(lt,{LinearRing:N(Es)});function vg(r,t,e){pt({node:r},q2,U2,[t],e)}const nc=W(lt,{ExtendedData:N(M2),MultiGeometry:N(M0),LineString:N(Es),LinearRing:N(Es),Point:N(Es),Polygon:N(C0),Style:N(rS),address:N(gt),description:N(gt),name:N(gt),open:N(Os),phoneNumber:N(gt),styleUrl:N(gt),visibility:N(Os)}),W2=W(lt,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Z2=ce("ExtendedData");function R0(r,t,e){const n={node:r};t.getId()&&r.setAttribute("id",t.getId());const i=t.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[t.getGeometryName()]=1;const o=Object.keys(i||{}).sort().filter(function(p){return!s[p]}),a=t.getStyleFunction();if(a){const p=a(t,0);if(p){const m=Array.isArray(p)?p:[p];let _=m;if(t.getGeometry()&&(_=m.filter(function(x){const v=x.getGeometryFunction()(t);if(v){const w=v.getType();return w==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(S){const E=S.getType();return E==="Point"||E==="MultiPoint"}).length:w==="Point"||w==="MultiPoint"}})),this.writeStyles_){let x=m,v=m;t.getGeometry()&&(x=m.filter(function(w){const S=w.getGeometryFunction()(t);if(S){const E=S.getType();return E==="GeometryCollection"?S.getGeometriesArrayRecursive().filter(function(T){const R=T.getType();return R==="LineString"||R==="MultiLineString"}).length:E==="LineString"||E==="MultiLineString"}}),v=m.filter(function(w){const S=w.getGeometryFunction()(t);if(S){const E=S.getType();return E==="GeometryCollection"?S.getGeometriesArrayRecursive().filter(function(T){const R=T.getType();return R==="Polygon"||R==="MultiPolygon"}).length:E==="Polygon"||E==="MultiPolygon"}})),i.Style={pointStyles:_,lineStyles:x,polyStyles:v}}if(_.length&&i.name===void 0){const x=_[0].getText();x&&(i.name=x.getText())}}}const l=e[e.length-1].node,h=W2[l.namespaceURI],c=lr(i,h);if(pt(n,nc,Ce,c,e,h),o.length>0){const p=lr(i,o);pt(n,nc,Z2,[{names:o,values:p}],e)}const u=e[0];let f=t.getGeometry();f&&(f=se(f,!0,u)),pt(n,nc,T0,[f],e)}const $2=W(lt,["extrude","tessellate","altitudeMode","coordinates"]),V2=W(lt,{extrude:N(Os),tessellate:N(Os),altitudeMode:N(gt),coordinates:N(y2)});function Es(r,t,e){const n=t.getFlatCoordinates(),i={node:r};i.layout=t.getLayout(),i.stride=t.getStride();const s=t.getProperties();s.coordinates=n;const o=e[e.length-1].node,a=$2[o.namespaceURI],l=lr(s,a);pt(i,V2,Ce,l,e,a)}const Y2=W(lt,["color","fill","outline"]),wg=W(lt,{outerBoundaryIs:N(vg),innerBoundaryIs:N(vg)}),H2=ce("innerBoundaryIs"),K2=ce("outerBoundaryIs");function C0(r,t,e){const n=t.getLinearRings(),i=n.shift(),s={node:r};pt(s,wg,H2,n,e),pt(s,wg,K2,[i],e)}const Q2=W(lt,{color:N(yh),fill:N(Os),outline:N(Os)});function J2(r,t,e){const n={node:r},i=t.getFill(),s=t.getStroke(),o={color:i?i.getColor():void 0,fill:i?void 0:!1,outline:s?void 0:!1},a=e[e.length-1].node,l=Y2[a.namespaceURI],h=lr(o,l);pt(n,Q2,Ce,h,e,l)}function I0(r,t){tr(r,Math.round(t*1e6)/1e6)}const tS=W(lt,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),eS=W(lt,{IconStyle:N(A2),LabelStyle:N(F2),LineStyle:N(k2),PolyStyle:N(J2)});function rS(r,t,e){const n={node:r},i={};if(t.pointStyles.length){const l=t.pointStyles[0].getText();l&&(i.LabelStyle=l);const h=t.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(i.IconStyle=h)}if(t.lineStyles.length){const l=t.lineStyles[0].getStroke();l&&(i.LineStyle=l)}if(t.polyStyles.length){const l=t.polyStyles[0].getStroke();l&&!i.LineStyle&&(i.LineStyle=l),i.PolyStyle=t.polyStyles[0]}const s=e[e.length-1].node,o=tS[s.namespaceURI],a=lr(i,o);pt(n,eS,Ce,a,e,o)}function nS(r,t){r.setAttribute("x",String(t.x)),r.setAttribute("y",String(t.y)),r.setAttribute("xunits",t.xunits),r.setAttribute("yunits",t.yunits)}const iS=Ib;var cd={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */cd.read=function(r,t,e,n,i){var s,o,a=i*8-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=e?i-1:0,f=e?-1:1,p=r[t+u];for(u+=f,s=p&(1<<-c)-1,p>>=-c,c+=a;c>0;s=s*256+r[t+u],u+=f,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=o*256+r[t+u],u+=f,c-=8);if(s===0)s=1-h;else{if(s===l)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-h}return(p?-1:1)*o*Math.pow(2,s-n)};cd.write=function(r,t,e,n,i,s){var o,a,l,h=s*8-i-1,c=(1<<h)-1,u=c>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,m=n?1:-1,_=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?t+=f/l:t+=f*Math.pow(2,1-u),t*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*l-1)*Math.pow(2,i),o=o+u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;r[e+p]=a&255,p+=m,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;r[e+p]=o&255,p+=m,o/=256,h-=8);r[e+p-m]|=_*128};var sS=jt,qa=cd;function jt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0;jt.Fixed64=1;jt.Bytes=2;jt.Fixed32=5;var Kc=65536*65536,bg=1/Kc,oS=12,P0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");jt.prototype={destroy:function(){this.buf=null},readFields:function(r,t,e){for(e=e||this.length;this.pos<e;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=n&7,r(i,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Wa(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Eg(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Wa(this.buf,this.pos)+Wa(this.buf,this.pos+4)*Kc;return this.pos+=8,r},readSFixed64:function(){var r=Wa(this.buf,this.pos)+Eg(this.buf,this.pos+4)*Kc;return this.pos+=8,r},readFloat:function(){var r=qa.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=qa.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t=this.buf,e,n;return n=t[this.pos++],e=n&127,n<128||(n=t[this.pos++],e|=(n&127)<<7,n<128)||(n=t[this.pos++],e|=(n&127)<<14,n<128)||(n=t[this.pos++],e|=(n&127)<<21,n<128)?e:(n=t[this.pos],e|=(n&15)<<28,aS(e,r,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2===1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=oS&&P0?bS(this.buf,t,r):wS(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==jt.Bytes)return r.push(this.readVarint(t));var e=mn(this);for(r=r||[];this.pos<e;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==jt.Bytes)return r.push(this.readSVarint());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==jt.Bytes)return r.push(this.readBoolean());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==jt.Bytes)return r.push(this.readFloat());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==jt.Bytes)return r.push(this.readDouble());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==jt.Bytes)return r.push(this.readFixed32());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==jt.Bytes)return r.push(this.readSFixed32());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==jt.Bytes)return r.push(this.readFixed64());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==jt.Bytes)return r.push(this.readSFixed64());var t=mn(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=r&7;if(t===jt.Varint)for(;this.buf[this.pos++]>127;);else if(t===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===jt.Fixed32)this.pos+=4;else if(t===jt.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Yi(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Yi(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Yi(this.buf,r&-1,this.pos),Yi(this.buf,Math.floor(r*bg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Yi(this.buf,r&-1,this.pos),Yi(this.buf,Math.floor(r*bg),this.pos+4),this.pos+=8},writeVarint:function(r){if(r=+r||0,r>268435455||r<0){hS(r,this);return}this.realloc(4),this.buf[this.pos++]=r&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=r>>>7&127)))},writeSVarint:function(r){this.writeVarint(r<0?-r*2-1:r*2)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(r.length*4),this.pos++;var t=this.pos;this.pos=SS(this.buf,r,this.pos);var e=this.pos-t;e>=128&&Sg(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(r){this.realloc(4),qa.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),qa.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var e=0;e<t;e++)this.buf[this.pos++]=r[e]},writeRawMessage:function(r,t){this.pos++;var e=this.pos;r(t,this);var n=this.pos-e;n>=128&&Sg(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeMessage:function(r,t,e){this.writeTag(r,jt.Bytes),this.writeRawMessage(t,e)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,dS,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,fS,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,mS,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,gS,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,pS,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,_S,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,yS,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,xS,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,vS,t)},writeBytesField:function(r,t){this.writeTag(r,jt.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,jt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,jt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,jt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,jt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,jt.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,jt.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,jt.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,jt.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,jt.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};function aS(r,t,e){var n=e.buf,i,s;if(s=n[e.pos++],i=(s&112)>>4,s<128||(s=n[e.pos++],i|=(s&127)<<3,s<128)||(s=n[e.pos++],i|=(s&127)<<10,s<128)||(s=n[e.pos++],i|=(s&127)<<17,s<128)||(s=n[e.pos++],i|=(s&127)<<24,s<128)||(s=n[e.pos++],i|=(s&1)<<31,s<128))return lS(r,i,t);throw new Error("Expected varint not more than 10 bytes")}function mn(r){return r.type===jt.Bytes?r.readVarint()+r.pos:r.pos+1}function lS(r,t,e){return e?t*4294967296+(r>>>0):(t>>>0)*4294967296+(r>>>0)}function hS(r,t){var e,n;if(r>=0?(e=r%4294967296|0,n=r/4294967296|0):(e=~(-r%4294967296),n=~(-r/4294967296),e^4294967295?e=e+1|0:(e=0,n=n+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),cS(e,n,t),uS(n,t)}function cS(r,t,e){e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos]=r&127}function uS(r,t){var e=(r&7)<<4;t.buf[t.pos++]|=e|((r>>>=3)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127)))))}function Sg(r,t,e){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(n);for(var i=e.pos-1;i>=r;i--)e.buf[i+n]=e.buf[i]}function dS(r,t){for(var e=0;e<r.length;e++)t.writeVarint(r[e])}function fS(r,t){for(var e=0;e<r.length;e++)t.writeSVarint(r[e])}function gS(r,t){for(var e=0;e<r.length;e++)t.writeFloat(r[e])}function pS(r,t){for(var e=0;e<r.length;e++)t.writeDouble(r[e])}function mS(r,t){for(var e=0;e<r.length;e++)t.writeBoolean(r[e])}function _S(r,t){for(var e=0;e<r.length;e++)t.writeFixed32(r[e])}function yS(r,t){for(var e=0;e<r.length;e++)t.writeSFixed32(r[e])}function xS(r,t){for(var e=0;e<r.length;e++)t.writeFixed64(r[e])}function vS(r,t){for(var e=0;e<r.length;e++)t.writeSFixed64(r[e])}function Wa(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+r[t+3]*16777216}function Yi(r,t,e){r[e]=t,r[e+1]=t>>>8,r[e+2]=t>>>16,r[e+3]=t>>>24}function Eg(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}function wS(r,t,e){for(var n="",i=t;i<e;){var s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a>e)break;var l,h,c;a===1?s<128&&(o=s):a===2?(l=r[i+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=r[i+1],h=r[i+2],(l&192)===128&&(h&192)===128&&(o=(s&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=r[i+1],h=r[i+2],c=r[i+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(o=(s&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),i+=a}return n}function bS(r,t,e){return P0.decode(r.subarray(t,e))}function SS(r,t,e){for(var n=0,i,s;n<t.length;n++){if(i=t.charCodeAt(n),i>55295&&i<57344)if(s)if(i<56320){r[e++]=239,r[e++]=191,r[e++]=189,s=i;continue}else i=s-55296<<10|i-56320|65536,s=null;else{i>56319||n+1===t.length?(r[e++]=239,r[e++]=191,r[e++]=189):s=i;continue}else s&&(r[e++]=239,r[e++]=191,r[e++]=189,s=null);i<128?r[e++]=i:(i<2048?r[e++]=i>>6|192:(i<65536?r[e++]=i>>12|224:(r[e++]=i>>18|240,r[e++]=i>>12&63|128),r[e++]=i>>6&63|128),r[e++]=i&63|128)}return e}const ES=$s(sS);class TS extends ya{constructor(t){super(),t=t||{},this.dataProjection=new As({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:ke,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,n,i){t.pos=e.geometry;const s=t.readVarint()+t.pos;let o=1,a=0,l=0,h=0,c=0,u=0;for(;t.pos<s;){if(!a){const f=t.readVarint();o=f&7,a=f>>3}if(a--,o===1||o===2)l+=t.readSVarint(),h+=t.readSVarint(),o===1&&c>u&&(i.push(c),u=c),n.push(l,h),c+=2;else if(o===7)c>u&&(n.push(n[u],n[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(i.push(c),u=c)}createFeature_(t,e,n){const i=e.type;if(i===0)return null;let s;const o=e.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=e.id,o[this.layerName_]=e.layer.name;const l=[],h=[];this.readRawGeometry_(t,e,l,h);const c=PS(i,h.length);if(this.featureClass_===ke)s=new this.featureClass_(c,l,h,2,o,a),s.transform(n.dataProjection);else{let u;if(c=="Polygon"){const m=Wm(l,h);u=m.length>1?new Rr(l,"XY",m):new ze(l,"XY",h)}else u=c==="Point"?new Me(l,"XY"):c==="LineString"?new ye(l,"XY"):c==="MultiPoint"?new Xr(l,"XY"):c==="MultiLineString"?new ar(l,"XY",h):null;const f=this.featureClass_;s=new f,this.geometryName_&&s.setGeometryName(this.geometryName_);const p=se(u,!1,n);s.setGeometry(p),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(t,e){const n=this.layers_;e=this.adaptOptions(e);const i=tt(e.dataProjection);i.setWorldExtent(e.extent),e.dataProjection=i;const s=new ES(t),o=s.readFields(MS,{}),a=[];for(const l in o){if(n&&!n.includes(l))continue;const h=o[l],c=h?[0,0,h.extent,h.extent]:null;i.setExtent(c);for(let u=0,f=h.length;u<f;++u){const p=IS(s,h,u),m=this.createFeature_(s,p,e);m!==null&&a.push(m)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function MS(r,t,e){if(r===3){const n={keys:[],values:[],features:[]},i=e.readVarint()+e.pos;e.readFields(RS,n,i),n.length=n.features.length,n.length&&(t[n.name]=n)}}function RS(r,t,e){if(r===15)t.version=e.readVarint();else if(r===1)t.name=e.readString();else if(r===5)t.extent=e.readVarint();else if(r===2)t.features.push(e.pos);else if(r===3)t.keys.push(e.readString());else if(r===4){let n=null;const i=e.readVarint()+e.pos;for(;e.pos<i;)r=e.readVarint()>>3,n=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null;t.values.push(n)}}function CS(r,t,e){if(r==1)t.id=e.readVarint();else if(r==2){const n=e.readVarint()+e.pos;for(;e.pos<n;){const i=t.layer.keys[e.readVarint()],s=t.layer.values[e.readVarint()];t.properties[i]=s}}else r==3?t.type=e.readVarint():r==4&&(t.geometry=e.pos)}function IS(r,t,e){r.pos=t.features[e];const n=r.readVarint()+r.pos,i={layer:t,type:0,properties:{}};return r.readFields(CS,i,n),i}function PS(r,t){let e;return r===1?e=t===1?"Point":"MultiPoint":r===2?e=t===1?"LineString":"MultiLineString":r===3&&(e="Polygon"),e}const A0=TS;class ud{read(t){if(!t)return null;if(typeof t=="string"){const e=Tr(t);return this.readFromDocument(e)}return Er(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){ct()}}const AS="http://www.w3.org/1999/xlink";function Vs(r){return r.getAttributeNS(AS,"href")}const hr=[null,"http://www.opengis.net/ows/1.1"],LS=W(hr,{ServiceIdentification:O(nE),ServiceProvider:O(sE),OperationsMetadata:O(eE)});class OS extends ud{constructor(){super()}readFromNode(t){return Z({},LS,t,[])||null}}const FS=W(hr,{DeliveryPoint:O($),City:O($),AdministrativeArea:O($),PostalCode:O($),Country:O($),ElectronicMailAddress:O($)}),NS=W(hr,{Value:Kt(oE)}),DS=W(hr,{AllowedValues:O(VS)}),kS=W(hr,{Phone:O(rE),Address:O($S)}),GS=W(hr,{HTTP:O(JS)}),jS=W(hr,{Get:Kt(QS),Post:void 0}),zS=W(hr,{DCP:O(KS)}),US=W(hr,{Operation:tE}),BS=W(hr,{Voice:O($),Facsimile:O($)}),XS=W(hr,{Constraint:Kt(YS)}),qS=W(hr,{IndividualName:O($),PositionName:O($),ContactInfo:O(HS)}),WS=W(hr,{Abstract:O($),AccessConstraints:O($),Fees:O($),Title:O($),ServiceTypeVersion:O($),ServiceType:O($)}),ZS=W(hr,{ProviderName:O($),ProviderSite:O(Vs),ServiceContact:O(iE)});function $S(r,t){return Z({},FS,r,t)}function VS(r,t){return Z({},NS,r,t)}function YS(r,t){const e=r.getAttribute("name");if(e)return Z({name:e},DS,r,t)}function HS(r,t){return Z({},kS,r,t)}function KS(r,t){return Z({},GS,r,t)}function QS(r,t){const e=Vs(r);if(e)return Z({href:e},XS,r,t)}function JS(r,t){return Z({},jS,r,t)}function tE(r,t){const e=r.getAttribute("name"),n=Z({},zS,r,t);if(!n)return;const i=t[t.length-1];i[e]=n}function eE(r,t){return Z({},US,r,t)}function rE(r,t){return Z({},BS,r,t)}function nE(r,t){return Z({},WS,r,t)}function iE(r,t){return Z({},qS,r,t)}function sE(r,t){return Z({},ZS,r,t)}function oE(r,t){return $(r)}const L0=OS;function Tg(r,t,e,n,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=t;for(;o<e;){const a=r[o++];i[s++]=r[o++],i[s++]=a;for(let l=2;l<n;++l)i[s++]=r[o++]}return i.length=s,i}class aE extends Ju{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.factor_=t.factor?t.factor:1e5,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY"}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e);return new Se(n)}readFeaturesFromText(t,e){return[this.readFeatureFromText(t,e)]}readGeometryFromText(t,e){const n=Gc(this.geometryLayout_),i=hE(t,n,this.factor_);Tg(i,0,i.length,n,i);const s=En(i,0,i.length,n),o=new ye(s,this.geometryLayout_);return se(o,!1,this.adaptOptions(e))}writeFeatureText(t,e){const n=t.getGeometry();if(n)return this.writeGeometryText(n,e);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(t,e){return this.writeFeatureText(t[0],e)}writeGeometryText(t,e){t=se(t,!0,this.adaptOptions(e));const n=t.getFlatCoordinates(),i=t.getStride();return Tg(n,0,n.length,i,n),lE(n,i,this.factor_)}}function lE(r,t,e){e=e||1e5;let n;const i=new Array(t);for(n=0;n<t;++n)i[n]=0;for(let s=0,o=r.length;s<o;)for(n=0;n<t;++n,++s){const a=r[s],l=a-i[n];i[n]=a,r[s]=l}return cE(r,e)}function hE(r,t,e){e=e||1e5;let n;const i=new Array(t);for(n=0;n<t;++n)i[n]=0;const s=uE(r,e);for(let o=0,a=s.length;o<a;)for(n=0;n<t;++n,++o)i[n]+=s[o],s[o]=i[n];return s}function cE(r,t){t=t||1e5;for(let e=0,n=r.length;e<n;++e)r[e]=Math.round(r[e]*t);return dE(r)}function uE(r,t){t=t||1e5;const e=fE(r);for(let n=0,i=e.length;n<i;++n)e[n]/=t;return e}function dE(r){for(let t=0,e=r.length;t<e;++t){const n=r[t];r[t]=n<0?~(n<<1):n<<1}return gE(r)}function fE(r){const t=pE(r);for(let e=0,n=t.length;e<n;++e){const i=t[e];t[e]=i&1?~(i>>1):i>>1}return t}function gE(r){let t="";for(let e=0,n=r.length;e<n;++e)t+=mE(r[e]);return t}function pE(r){const t=[];let e=0,n=0;for(let i=0,s=r.length;i<s;++i){const o=r.charCodeAt(i)-63;e|=(o&31)<<n,o<32?(t.push(e),e=0,n=0):n+=5}return t}function mE(r){let t,e="";for(;r>=32;)t=(32|r&31)+63,e+=String.fromCharCode(t),r>>=5;return t=r+63,e+=String.fromCharCode(t),e}const _E=aE;class yE extends Zu{constructor(t){super(),t=t||{},this.layerName_=t.layerName,this.layers_=t.layers?t.layers:null,this.dataProjection=tt(t.dataProjection?t.dataProjection:"EPSG:4326")}readFeaturesFromObject(t,e){if(t.type=="Topology"){const n=t;let i,s=null,o=null;n.transform&&(i=n.transform,s=i.scale,o=i.translate);const a=n.arcs;i&&RE(a,s,o);const l=[],h=n.objects,c=this.layerName_;let u;for(const f in h)this.layers_&&!this.layers_.includes(f)||(h[f].type==="GeometryCollection"?(u=h[f],l.push.apply(l,ME(u,a,s,o,c,f,e))):(u=h[f],l.push(O0(u,a,s,o,c,f,e))));return l}return[]}readProjectionFromObject(t){return this.dataProjection}}const xE={Point:vE,LineString:bE,Polygon:EE,MultiPoint:wE,MultiLineString:SE,MultiPolygon:TE};function xh(r,t){const e=[];let n;for(let i=0,s=r.length;i<s;++i)if(n=r[i],i>0&&e.pop(),n>=0){const o=t[n];for(let a=0,l=o.length;a<l;++a)e.push(o[a].slice(0))}else{const o=t[~n];for(let a=o.length-1;a>=0;--a)e.push(o[a].slice(0))}return e}function vE(r,t,e){const n=r.coordinates;return t&&e&&dd(n,t,e),new Me(n)}function wE(r,t,e){const n=r.coordinates;if(t&&e)for(let i=0,s=n.length;i<s;++i)dd(n[i],t,e);return new Xr(n)}function bE(r,t){const e=xh(r.arcs,t);return new ye(e)}function SE(r,t){const e=[];for(let n=0,i=r.arcs.length;n<i;++n)e[n]=xh(r.arcs[n],t);return new ar(e)}function EE(r,t){const e=[];for(let n=0,i=r.arcs.length;n<i;++n)e[n]=xh(r.arcs[n],t);return new ze(e)}function TE(r,t){const e=[];for(let n=0,i=r.arcs.length;n<i;++n){const s=r.arcs[n],o=[];for(let a=0,l=s.length;a<l;++a)o[a]=xh(s[a],t);e[n]=o}return new Rr(e)}function ME(r,t,e,n,i,s,o){const a=r.geometries,l=[];for(let h=0,c=a.length;h<c;++h)l[h]=O0(a[h],t,e,n,i,s,o);return l}function O0(r,t,e,n,i,s,o){let a=null;const l=r.type;if(l){const u=xE[l];l==="Point"||l==="MultiPoint"?a=u(r,e,n):a=u(r,t),a=se(a,!1,o)}const h=new Se({geometry:a});r.id!==void 0&&h.setId(r.id);let c=r.properties;return i&&(c||(c={}),c[i]=s),c&&h.setProperties(c,!0),h}function RE(r,t,e){for(let n=0,i=r.length;n<i;++n)CE(r[n],t,e)}function CE(r,t,e){let n=0,i=0;for(let s=0,o=r.length;s<o;++s){const a=r[s];n+=a[0],i+=a[1],a[0]=n,a[1]=i,dd(a,t,e)}}function dd(r,t,e){r[0]=r[0]*t[0]+e[0],r[1]=r[1]*t[1]+e[1]}const IE=yE;class Gt extends Rt{constructor(t){t=t||{},super(t),this.schemaLocation=t.schemaLocation?t.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(t,e,n){const i=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(t,e,n)}}Gt.prototype.namespace="http://www.opengis.net/gml/3.2";Gt.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:ht(Rt.prototype.readFlatPos),posList:ht(Rt.prototype.readFlatPosList),coordinates:ht(It.prototype.readFlatCoordinates)}};Gt.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:Rt.prototype.interiorParser,exterior:Rt.prototype.exteriorParser}};Gt.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ht(st.prototype.readPoint),MultiPoint:ht(st.prototype.readMultiPoint),LineString:ht(st.prototype.readLineString),MultiLineString:ht(st.prototype.readMultiLineString),LinearRing:ht(st.prototype.readLinearRing),Polygon:ht(st.prototype.readPolygon),MultiPolygon:ht(st.prototype.readMultiPolygon),Surface:ht(Gt.prototype.readSurface),MultiSurface:ht(Rt.prototype.readMultiSurface),Curve:ht(Gt.prototype.readCurve),MultiCurve:ht(Rt.prototype.readMultiCurve),Envelope:ht(Gt.prototype.readEnvelope)}};Gt.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:ot(Rt.prototype.curveMemberParser),curveMembers:ot(Rt.prototype.curveMemberParser)}};Gt.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:ot(Rt.prototype.surfaceMemberParser),surfaceMembers:ot(Rt.prototype.surfaceMemberParser)}};Gt.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ot(st.prototype.readLineString),Curve:ot(Rt.prototype.readCurve)}};Gt.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ot(st.prototype.readPolygon),Surface:ot(Rt.prototype.readSurface)}};Gt.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:ht(Rt.prototype.readPatch)}};Gt.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:ht(Rt.prototype.readSegment)}};Gt.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:ot(Rt.prototype.readFlatPosList),upperCorner:ot(Rt.prototype.readFlatPosList)}};Gt.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:ht(Rt.prototype.readPolygonPatch)}};Gt.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:vl(Rt.prototype.readLineStringSegment)}};Gt.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:ot(st.prototype.pointMemberParser),pointMembers:ot(st.prototype.pointMemberParser)}};Gt.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:ot(st.prototype.lineStringMemberParser),lineStringMembers:ot(st.prototype.lineStringMemberParser)}};Gt.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:ot(st.prototype.polygonMemberParser),polygonMembers:ot(st.prototype.polygonMemberParser)}};Gt.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ot(st.prototype.readFlatCoordinatesFromNode)}};Gt.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ot(st.prototype.readLineString)}};Gt.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ot(st.prototype.readPolygon)}};Gt.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:ht(st.prototype.readFlatLinearRing),Ring:ht(Gt.prototype.readFlatCurveRing)}};Gt.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:N(Rt.prototype.writeRing),interior:N(Rt.prototype.writeRing)}};Gt.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:N(gt),upperCorner:N(gt)}};Gt.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:N(Rt.prototype.writeSurfaceOrPolygonMember),polygonMember:N(Rt.prototype.writeSurfaceOrPolygonMember)}};Gt.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:N(Rt.prototype.writePointMember)}};Gt.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:N(Rt.prototype.writeLineStringOrCurveMember),curveMember:N(Rt.prototype.writeLineStringOrCurveMember)}};Gt.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:N(Rt.prototype.writeCurveOrLineString),MultiCurve:N(Rt.prototype.writeMultiCurveOrLineString),Point:N(Gt.prototype.writePoint),MultiPoint:N(Rt.prototype.writeMultiPoint),LineString:N(Rt.prototype.writeCurveOrLineString),MultiLineString:N(Rt.prototype.writeMultiCurveOrLineString),LinearRing:N(Rt.prototype.writeLinearRing),Polygon:N(Rt.prototype.writeSurfaceOrPolygon),MultiPolygon:N(Rt.prototype.writeMultiSurfaceOrPolygon),Surface:N(Rt.prototype.writeSurfaceOrPolygon),MultiSurface:N(Rt.prototype.writeMultiSurfaceOrPolygon),Envelope:N(Rt.prototype.writeEnvelope)}};const fd=Gt;class F0{constructor(t){this.tagName_=t}getTagName(){return this.tagName_}}class PE extends F0{constructor(t,e){super(t),this.conditions=e,At(this.conditions.length>=2,"At least 2 conditions are required")}}class AE extends PE{constructor(t){super("And",Array.prototype.slice.call(arguments))}}const LE=AE;class OE extends F0{constructor(t,e,n){if(super("BBOX"),this.geometryName=t,this.extent=e,e.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}function FE(r){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(LE,t))}function NE(r,t,e){return new OE(r,t,e)}const Mg={"http://www.opengis.net/gml":{boundedBy:O(st.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:ot(st.prototype.readFeaturesInternal)}},DE={"http://www.opengis.net/wfs":{totalInserted:O(fe),totalUpdated:O(fe),totalDeleted:O(fe)},"http://www.opengis.net/wfs/2.0":{totalInserted:O(fe),totalUpdated:O(fe),totalDeleted:O(fe)}},kE={"http://www.opengis.net/wfs":{TransactionSummary:O(Cg,"transactionSummary"),InsertResults:O(Pg,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:O(Cg,"transactionSummary"),InsertResults:O(Pg,"insertIds")}},GE={"http://www.opengis.net/wfs":{PropertyName:N(gt)},"http://www.opengis.net/wfs/2.0":{PropertyName:N(gt)}},N0={"http://www.opengis.net/wfs":{Insert:N(Ag),Update:N(Og),Delete:N(Lg),Property:N(Fg),Native:N(Ng)},"http://www.opengis.net/wfs/2.0":{Insert:N(Ag),Update:N(Og),Delete:N(Lg),Property:N(Fg),Native:N(Ng)}},D0="feature",gd="http://www.w3.org/2000/xmlns/",pd={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Qc={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},md={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Rg={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},_d={"2.0.0":fd,"1.1.0":Rt,"1.0.0":It},jE="1.1.0";class zE extends va{constructor(t){super(),t=t||{},this.version_=t.version?t.version:jE,this.featureType_=t.featureType,this.featureNS_=t.featureNS,this.gmlFormat_=t.gmlFormat?t.gmlFormat:new _d[this.version_],this.schemaLocation_=t.schemaLocation?t.schemaLocation:Rg[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(t){this.featureType_=t}readFeaturesFromNode(t,e){const n={node:t};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(t,e||{}));const i=[n];let s;this.version_==="2.0.0"?s=Mg:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=Z([],s,t,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(t){if(t){if(typeof t=="string"){const e=Tr(t);return this.readTransactionResponseFromDocument(e)}return Er(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t)}}readFeatureCollectionMetadata(t){if(t){if(typeof t=="string"){const e=Tr(t);return this.readFeatureCollectionMetadataFromDocument(e)}return Er(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t)}}readFeatureCollectionMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)}readFeatureCollectionMetadataFromNode(t){const e={},n=Tn(t.getAttribute("numberOfFeatures"));return e.numberOfFeatures=n,Z(e,Mg,t,[],this.gmlFormat_)}readTransactionResponseFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)}readTransactionResponseFromNode(t){return Z({},kE,t,[])}writeGetFeature(t){const e=mt(Qc[this.version_],"GetFeature");e.setAttribute("service","WFS"),e.setAttribute("version",this.version_),t.handle&&e.setAttribute("handle",t.handle),t.outputFormat&&e.setAttribute("outputFormat",t.outputFormat),t.maxFeatures!==void 0&&e.setAttribute("maxFeatures",String(t.maxFeatures)),t.resultType&&e.setAttribute("resultType",t.resultType),t.startIndex!==void 0&&e.setAttribute("startIndex",String(t.startIndex)),t.count!==void 0&&e.setAttribute("count",String(t.count)),t.viewParams!==void 0&&e.setAttribute("viewParams",t.viewParams),e.setAttributeNS(Ai,"xsi:schemaLocation",this.schemaLocation_);const n={node:e};if(Object.assign(n,{version:this.version_,srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,propertyNames:t.propertyNames?t.propertyNames:[]}),At(Array.isArray(t.featureTypes),"`options.featureTypes` must be an Array"),typeof t.featureTypes[0]=="string"){let i=t.filter;t.bbox&&(At(t.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(t.geometryName,t.bbox,t.srsName,i)),Object.assign(n,{geometryName:t.geometryName,filter:i}),Wg(e,t.featureTypes,[n])}else t.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,t.srsName,t.filter);Object.assign(n,{geometryName:i.geometryName,filter:s}),Wg(e,[i.name],[n])});return e}combineBboxAndFilter(t,e,n,i){const s=NE(t,e,n);return i?FE(i,s):s}writeTransaction(t,e,n,i){const s=[],o=i.version?i.version:this.version_,a=mt(Qc[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Ai,"xsi:schemaLocation",Rg[o]);const h=UE(a,l,o,i);return t&&Za("Insert",t,s,h),e&&Za("Update",e,s,h),n&&Za("Delete",n,s,h),i.nativeElements&&Za("Native",i.nativeElements,s,h),a}readProjectionFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null}readProjectionFromNode(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild){t=t.firstElementChild.firstElementChild;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(!(e.childNodes.length===0||e.childNodes.length===1&&e.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(e,n),tt(n.pop().srsName)}}return null}}function UE(r,t,e,n){const i=n.featurePrefix?n.featurePrefix:D0;let s;return e==="1.0.0"?s=2:e==="1.1.0"?s=3:e==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:e,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:i,gmlVersion:s,hasZ:n.hasZ,srsName:n.srsName},t)}function Za(r,t,e,n){pt(n,N0,ce(r),t,e)}function Cg(r,t){return Z({},DE,r,t)}const BE={"http://www.opengis.net/ogc":{FeatureId:ot(function(r,t){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:ot(function(r,t){return r.getAttribute("fid")})}};function Ig(r,t){sr(BE,r,t)}const XE={"http://www.opengis.net/wfs":{Feature:Ig},"http://www.opengis.net/wfs/2.0":{Feature:Ig}};function Pg(r,t){return Z([],XE,r,t)}function Ag(r,t,e){const n=e[e.length-1],i=n.featureType,s=n.featureNS,o=n.gmlVersion,a=mt(s,i);r.appendChild(a),o===2?It.prototype.writeFeatureElement(a,t,e):o===3?Rt.prototype.writeFeatureElement(a,t,e):fd.prototype.writeFeatureElement(a,t,e)}function k0(r,t,e){const n=e[e.length-1].version,i=pd[n],s=mt(i,"Filter"),o=mt(i,"FeatureId");s.appendChild(o),o.setAttribute("fid",t),r.appendChild(s)}function yd(r,t){r=r||D0;const e=r+":";return t.startsWith(e)?t:e+t}function Lg(r,t,e){const n=e[e.length-1];At(t.getId()!==void 0,"Features must have an id set");const i=n.featureType,s=n.featurePrefix,o=n.featureNS,a=yd(s,i);r.setAttribute("typeName",a),r.setAttributeNS(gd,"xmlns:"+s,o);const l=t.getId();l!==void 0&&k0(r,l,e)}function Og(r,t,e){const n=e[e.length-1];At(t.getId()!==void 0,"Features must have an id set");const i=n.version,s=n.featureType,o=n.featurePrefix,a=n.featureNS,l=yd(o,s),h=t.getGeometryName();r.setAttribute("typeName",l),r.setAttributeNS(gd,"xmlns:"+o,a);const c=t.getId();if(c!==void 0){const u=t.getKeys(),f=[];for(let p=0,m=u.length;p<m;p++){const _=t.get(u[p]);if(_!==void 0){let x=u[p];_&&typeof _.getSimplifiedGeometry=="function"&&(x=h),f.push({name:x,value:_})}}pt({version:i,gmlVersion:n.gmlVersion,node:r,hasZ:n.hasZ,srsName:n.srsName},N0,ce("Property"),f,e),k0(r,c,e)}}function Fg(r,t,e){const n=e[e.length-1],i=n.version,s=Qc[i],o=mt(s,i==="2.0.0"?"ValueReference":"Name"),a=n.gmlVersion;if(r.appendChild(o),gt(o,t.name),t.value!==void 0&&t.value!==null){const l=mt(s,"Value");r.appendChild(l),t.value&&typeof t.value.getSimplifiedGeometry=="function"?a===2?It.prototype.writeGeometryElement(l,t.value,e):a===3?Rt.prototype.writeGeometryElement(l,t.value,e):fd.prototype.writeGeometryElement(l,t.value,e):gt(l,t.value)}}function Ng(r,t,e){t.vendorId&&r.setAttribute("vendorId",t.vendorId),t.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(t.safeToIgnore)),t.value!==void 0&&gt(r,t.value)}const vh={"http://www.opengis.net/wfs":{Query:N(Dg)},"http://www.opengis.net/wfs/2.0":{Query:N(Dg)},"http://www.opengis.net/ogc":{During:N(jg),And:N($a),Or:N($a),Not:N(zg),BBOX:N(kg),Contains:N(Hn),Intersects:N(Hn),Within:N(Hn),DWithin:N(Gg),PropertyIsEqualTo:N(wr),PropertyIsNotEqualTo:N(wr),PropertyIsLessThan:N(wr),PropertyIsLessThanOrEqualTo:N(wr),PropertyIsGreaterThan:N(wr),PropertyIsGreaterThanOrEqualTo:N(wr),PropertyIsNull:N(Ug),PropertyIsBetween:N(Bg),PropertyIsLike:N(Xg)},"http://www.opengis.net/fes/2.0":{During:N(jg),And:N($a),Or:N($a),Not:N(zg),BBOX:N(kg),Contains:N(Hn),Disjoint:N(Hn),Intersects:N(Hn),ResourceId:N(WE),Within:N(Hn),DWithin:N(Gg),PropertyIsEqualTo:N(wr),PropertyIsNotEqualTo:N(wr),PropertyIsLessThan:N(wr),PropertyIsLessThanOrEqualTo:N(wr),PropertyIsGreaterThan:N(wr),PropertyIsGreaterThanOrEqualTo:N(wr),PropertyIsNull:N(Ug),PropertyIsBetween:N(Bg),PropertyIsLike:N(Xg)}};function Dg(r,t,e){const n=e[e.length-1],i=n.version,s=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let h;s?h=yd(s,t):h=t;let c;i==="2.0.0"?c="typeNames":c="typeName",r.setAttribute(c,h),l&&r.setAttribute("srsName",l),o&&r.setAttributeNS(gd,"xmlns:"+s,o);const u=Object.assign({},n);u.node=r,pt(u,GE,ce("PropertyName"),a,e);const f=n.filter;if(f){const p=mt(wh(i),"Filter");r.appendChild(p),qE(p,f,e)}}function qE(r,t,e){const n=e[e.length-1],i={node:r};Object.assign(i,{context:n}),pt(i,vh,ce(t.getTagName()),[t],e)}function kg(r,t,e){const n=e[e.length-1],i=n.context.version;n.srsName=t.srsName;const s=_d[i];Ys(i,r,t.geometryName),s.prototype.writeGeometryElement(r,t.extent,e)}function WE(r,t,e){r.setAttribute("rid",t.rid)}function Hn(r,t,e){const n=e[e.length-1],i=n.context.version;n.srsName=t.srsName;const s=_d[i];Ys(i,r,t.geometryName),s.prototype.writeGeometryElement(r,t.geometry,e)}function Gg(r,t,e){const n=e[e.length-1].context.version;Hn(r,t,e);const i=mt(wh(n),"Distance");gt(i,t.distance.toString()),n==="2.0.0"?i.setAttribute("uom",t.unit):i.setAttribute("units",t.unit),r.appendChild(i)}function jg(r,t,e){const n=e[e.length-1].context.version;Ml(md[n],"ValueReference",r,t.propertyName);const i=mt(Mn,"TimePeriod");r.appendChild(i);const s=mt(Mn,"begin");i.appendChild(s),qg(s,t.begin);const o=mt(Mn,"end");i.appendChild(o),qg(o,t.end)}function $a(r,t,e){const n=e[e.length-1].context,i={node:r};Object.assign(i,{context:n});const s=t.conditions;for(let o=0,a=s.length;o<a;++o){const l=s[o];pt(i,vh,ce(l.getTagName()),[l],e)}}function zg(r,t,e){const n=e[e.length-1].context,i={node:r};Object.assign(i,{context:n});const s=t.condition;pt(i,vh,ce(s.getTagName()),[s],e)}function wr(r,t,e){const n=e[e.length-1].context.version;t.matchCase!==void 0&&r.setAttribute("matchCase",t.matchCase.toString()),Ys(n,r,t.propertyName),Rl(n,r,""+t.expression)}function Ug(r,t,e){const n=e[e.length-1].context.version;Ys(n,r,t.propertyName)}function Bg(r,t,e){const n=e[e.length-1].context.version,i=wh(n);Ys(n,r,t.propertyName);const s=mt(i,"LowerBoundary");r.appendChild(s),Rl(n,s,""+t.lowerBoundary);const o=mt(i,"UpperBoundary");r.appendChild(o),Rl(n,o,""+t.upperBoundary)}function Xg(r,t,e){const n=e[e.length-1].context.version;r.setAttribute("wildCard",t.wildCard),r.setAttribute("singleChar",t.singleChar),r.setAttribute("escapeChar",t.escapeChar),t.matchCase!==void 0&&r.setAttribute("matchCase",t.matchCase.toString()),Ys(n,r,t.propertyName),Rl(n,r,""+t.pattern)}function Ml(r,t,e,n){const i=mt(r,t);gt(i,n),e.appendChild(i)}function Rl(r,t,e){Ml(wh(r),"Literal",t,e)}function Ys(r,t,e){r==="2.0.0"?Ml(md[r],"ValueReference",t,e):Ml(pd[r],"PropertyName",t,e)}function qg(r,t){const e=mt(Mn,"TimeInstant");r.appendChild(e);const n=mt(Mn,"timePosition");e.appendChild(n),gt(n,t)}function Wg(r,t,e){const n=e[e.length-1],i=Object.assign({},n);i.node=r,pt(i,vh,ce("Query"),t,e)}function wh(r){let t;return r==="2.0.0"?t=md[r]:t=pd[r],t}const ZE=zE,Wt={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class Zg{constructor(t){this.view_=t,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(t){return this.view_.getUint32((this.pos_+=4)-4,t!==void 0?t:this.isLittleEndian_)}readDouble(t){return this.view_.getFloat64((this.pos_+=8)-8,t!==void 0?t:this.isLittleEndian_)}readPoint(){const t=[];return t.push(this.readDouble()),t.push(this.readDouble()),this.hasZ_&&t.push(this.readDouble()),this.hasM_&&t.push(this.readDouble()),t}readLineString(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readPoint());return e}readPolygon(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readLineString());return e}readWkbHeader(t){const e=this.readUint8()>0,n=this.readUint32(e),i=Math.floor((n&268435455)/1e3),s=!!(n&2147483648)||i===1||i===3,o=!!(n&1073741824)||i===2||i===3,a=!!(n&536870912),l=(n&268435455)%1e3,h=["XY",s?"Z":"",o?"M":""].join(""),c=a?this.readUint32(e):null;if(t!==void 0&&t!==l)throw new Error("Unexpected WKB geometry type "+l);if(this.initialized_){if(this.isLittleEndian_!==e)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=e,this.hasZ_=s,this.hasM_=o,this.layout_=h,this.srid_=c,this.initialized_=!0;return l}readWkbPayload(t){switch(t){case Wt.POINT:return this.readPoint();case Wt.LINE_STRING:return this.readLineString();case Wt.POLYGON:case Wt.TRIANGLE:return this.readPolygon();case Wt.MULTI_POINT:return this.readMultiPoint();case Wt.MULTI_LINE_STRING:return this.readMultiLineString();case Wt.MULTI_POLYGON:case Wt.POLYHEDRAL_SURFACE:case Wt.TIN:return this.readMultiPolygon();case Wt.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+t+" is found")}}readWkbBlock(t){return this.readWkbPayload(this.readWkbHeader(t))}readWkbCollection(t,e){const n=this.readUint32(),i=[];for(let s=0;s<n;s++){const o=t.call(this,e);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Wt.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Wt.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Wt.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const t=this.readWkbHeader(),e=this.readWkbPayload(t);switch(t){case Wt.POINT:return new Me(e,this.layout_);case Wt.LINE_STRING:return new ye(e,this.layout_);case Wt.POLYGON:case Wt.TRIANGLE:return new ze(e,this.layout_);case Wt.MULTI_POINT:return new Xr(e,this.layout_);case Wt.MULTI_LINE_STRING:return new ar(e,this.layout_);case Wt.MULTI_POLYGON:case Wt.POLYHEDRAL_SURFACE:case Wt.TIN:return new Rr(e,this.layout_);case Wt.GEOMETRY_COLLECTION:return new Ge(e);default:return null}}getSrid(){return this.srid_}}class $E{constructor(t){t=t||{},this.layout_=t.layout,this.isLittleEndian_=t.littleEndian!==!1,this.isEWKB_=t.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},t.nodata)}writeUint8(t){this.writeQueue_.push([1,t])}writeUint32(t){this.writeQueue_.push([4,t])}writeDouble(t){this.writeQueue_.push([8,t])}writePoint(t,e){const n=Object.assign.apply(null,e.split("").map((i,s)=>({[i]:t[s]})));for(const i of this.layout_)this.writeDouble(i in n?n[i]:this.nodata_[i])}writeLineString(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writePoint(t[n],e)}writePolygon(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeLineString(t[n],e)}writeWkbHeader(t,e){t%=1e3,this.layout_.includes("Z")&&(t+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(t+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(e)&&(t|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(t),this.isEWKB_&&Number.isInteger(e)&&this.writeUint32(e)}writeMultiPoint(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(1),this.writePoint(t[n],e)}writeMultiLineString(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(2),this.writeLineString(t[n],e)}writeMultiPolygon(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(3),this.writePolygon(t[n],e)}writeGeometryCollection(t){this.writeUint32(t.length);for(let e=0;e<t.length;e++)this.writeGeometry(t[e])}findMinimumLayout(t,e="XYZM"){const n=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(t instanceof Ln)return n(t.getLayout(),e);if(t instanceof Ge){const i=t.getGeometriesArray();for(let s=0;s<i.length&&e!=="XY";s++)e=this.findMinimumLayout(i[s],e)}return e}writeGeometry(t,e){const n={Point:Wt.POINT,LineString:Wt.LINE_STRING,Polygon:Wt.POLYGON,MultiPoint:Wt.MULTI_POINT,MultiLineString:Wt.MULTI_LINE_STRING,MultiPolygon:Wt.MULTI_POLYGON,GeometryCollection:Wt.GEOMETRY_COLLECTION},i=t.getType(),s=n[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(t)),this.writeWkbHeader(s,e),t instanceof Ln?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,t.getCoordinates(),t.getLayout()):t instanceof Ge&&this.writeGeometryCollection(t.getGeometriesArray())}getBuffer(){const t=this.writeQueue_.reduce((s,o)=>s+o[0],0),e=new ArrayBuffer(t),n=new DataView(e);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(i,s[1]);break;case 4:n.setUint32(i,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),e}}class VE extends ya{constructor(t){super(),t=t||{},this.splitCollection=!!t.splitCollection,this.viewCache_=null,this.hex_=t.hex!==!1,this.littleEndian_=t.littleEndian!==!1,this.ewkb_=t.ewkb!==!1,this.layout_=t.geometryLayout,this.nodataZ_=t.nodataZ||0,this.nodataM_=t.nodataM||0,this.srid_=t.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(t,e){return new Se({geometry:this.readGeometry(t,e)})}readFeatures(t,e){let n=[];const i=this.readGeometry(t,e);return this.splitCollection&&i instanceof Ge?n=i.getGeometriesArray():n=[i],n.map(s=>new Se({geometry:s}))}readGeometry(t,e){const n=$g(t);if(!n)return null;const i=new Zg(n).readGeometry();return this.viewCache_=n,e=this.getReadOptions(t,e),this.viewCache_=null,se(i,!1,e)}readProjection(t){const e=this.viewCache_||$g(t);if(!e)return;const n=new Zg(e);return n.readWkbHeader(),n.getSrid()&&tt("EPSG:"+n.getSrid())||void 0}writeFeature(t,e){return this.writeGeometry(t.getGeometry(),e)}writeFeatures(t,e){return this.writeGeometry(new Ge(t.map(n=>n.getGeometry())),e)}writeGeometry(t,e){e=this.adaptOptions(e);const n=new $E({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=e.dataProjection&&tt(e.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}n.writeGeometry(se(t,!0,e),i);const s=n.getBuffer();return this.hex_?YE(s):s}}function YE(r){const t=new Uint8Array(r);return Array.from(t.values()).map(e=>(e<16?"0":"")+Number(e).toString(16).toUpperCase()).join("")}function HE(r){const t=new Uint8Array(r.length/2);for(let e=0;e<r.length/2;e++)t[e]=parseInt(r.substr(e*2,2),16);return new DataView(t.buffer)}function $g(r){return typeof r=="string"?HE(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}const KE=VE,QE={POINT:Me,LINESTRING:ye,POLYGON:ze,MULTIPOINT:Xr,MULTILINESTRING:ar,MULTIPOLYGON:Rr},G0="EMPTY",j0="Z",z0="M",JE="ZM",zt={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},tT={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class eT{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return e=e!==void 0?e:!1,t>="0"&&t<="9"||t=="."&&!e}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let n=t,i;if(t=="(")i=zt.LEFT_PAREN;else if(t==",")i=zt.COMMA;else if(t==")")i=zt.RIGHT_PAREN;else if(this.isNumeric_(t)||t=="-")i=zt.NUMBER,n=this.readNumber_();else if(this.isAlpha_(t))i=zt.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t==="")i=zt.EOF;else throw new Error("Unexpected character: "+t)}return{position:e,value:n,type:i}}readNumber_(){let t;const e=this.index_;let n=!1,i=!1;do t=="."?n=!0:(t=="e"||t=="E")&&(i=!0),t=this.nextChar_();while(this.isNumeric_(t,n)||!i&&(t=="e"||t=="E")||i&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}let rT=class{constructor(r){this.lexer_=r,this.token_={position:0,type:zt.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(r){return this.token_.type==r}match(r){const t=this.isTokenType(r);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let r="XY";const t=this.token_;if(this.isTokenType(zt.TEXT)){const e=t.value;e===j0?r="XYZ":e===z0?r="XYM":e===JE&&(r="XYZM"),r!=="XY"&&this.consume_()}return r}parseGeometryCollectionText_(){if(this.match(zt.LEFT_PAREN)){const r=[];do r.push(this.parseGeometry_());while(this.match(zt.COMMA));if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parsePoint_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parsePointList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parseLineStringTextList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(zt.LEFT_PAREN)){let r;if(this.token_.type==zt.LEFT_PAREN?r=this.parsePointTextList_():r=this.parsePointList_(),this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parseLineStringTextList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parsePolygonTextList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parsePoint_(){const r=[],t=this.layout_.length;for(let e=0;e<t;++e){const n=this.token_;if(this.match(zt.NUMBER))r.push(n.value);else break}if(r.length==t)return r;throw new Error(this.formatErrorMessage_())}parsePointList_(){const r=[this.parsePoint_()];for(;this.match(zt.COMMA);)r.push(this.parsePoint_());return r}parsePointTextList_(){const r=[this.parsePointText_()];for(;this.match(zt.COMMA);)r.push(this.parsePointText_());return r}parseLineStringTextList_(){const r=[this.parseLineStringText_()];for(;this.match(zt.COMMA);)r.push(this.parseLineStringText_());return r}parsePolygonTextList_(){const r=[this.parsePolygonText_()];for(;this.match(zt.COMMA);)r.push(this.parsePolygonText_());return r}isEmptyGeometry_(){const r=this.isTokenType(zt.TEXT)&&this.token_.value==G0;return r&&this.consume_(),r}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const r=this.token_;if(this.match(zt.TEXT)){const t=r.value;this.layout_=this.parseGeometryLayout_();const e=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(e)return new Ge([]);const s=this.parseGeometryCollectionText_();return new Ge(s)}const n=QE[t];if(!n)throw new Error("Invalid geometry type: "+t);let i;if(e)t=="POINT"?i=[NaN,NaN]:i=[];else switch(t){case"POINT":{i=this.parsePointText_();break}case"LINESTRING":{i=this.parseLineStringText_();break}case"POLYGON":{i=this.parsePolygonText_();break}case"MULTIPOINT":{i=this.parseMultiPointText_();break}case"MULTILINESTRING":{i=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{i=this.parseMultiPolygonText_();break}}return new n(i,this.layout_)}throw new Error(this.formatErrorMessage_())}};class nT extends Ju{constructor(t){super(),t=t||{},this.splitCollection_=t.splitCollection!==void 0?t.splitCollection:!1}parse_(t){const e=new eT(t);return new rT(e).parse()}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e),i=new Se;return i.setGeometry(n),i}readFeaturesFromText(t,e){let n=[];const i=this.readGeometryFromText(t,e);this.splitCollection_&&i.getType()=="GeometryCollection"?n=i.getGeometriesArray():n=[i];const s=[];for(let o=0,a=n.length;o<a;++o){const l=new Se;l.setGeometry(n[o]),s.push(l)}return s}readGeometryFromText(t,e){const n=this.parse_(t);return se(n,!1,e)}writeFeatureText(t,e){const n=t.getGeometry();return n?this.writeGeometryText(n,e):""}writeFeaturesText(t,e){if(t.length==1)return this.writeFeatureText(t[0],e);const n=[];for(let s=0,o=t.length;s<o;++s)n.push(t[s].getGeometry());const i=new Ge(n);return this.writeGeometryText(i,e)}writeGeometryText(t,e){return X0(se(t,!0,e))}}function U0(r){const t=r.getCoordinates();return t.length===0?"":t.join(" ")}function iT(r){const t=[],e=r.getPoints();for(let n=0,i=e.length;n<i;++n)t.push("("+U0(e[n])+")");return t.join(",")}function sT(r){const t=[],e=r.getGeometries();for(let n=0,i=e.length;n<i;++n)t.push(X0(e[n]));return t.join(",")}function xd(r){const t=r.getCoordinates(),e=[];for(let n=0,i=t.length;n<i;++n)e.push(t[n].join(" "));return e.join(",")}function oT(r){const t=[],e=r.getLineStrings();for(let n=0,i=e.length;n<i;++n)t.push("("+xd(e[n])+")");return t.join(",")}function B0(r){const t=[],e=r.getLinearRings();for(let n=0,i=e.length;n<i;++n)t.push("("+xd(e[n])+")");return t.join(",")}function aT(r){const t=[],e=r.getPolygons();for(let n=0,i=e.length;n<i;++n)t.push("("+B0(e[n])+")");return t.join(",")}function lT(r){const t=r.getLayout();let e="";return(t==="XYZ"||t==="XYZM")&&(e+=j0),(t==="XYM"||t==="XYZM")&&(e+=z0),e}const hT={Point:U0,LineString:xd,Polygon:B0,MultiPoint:iT,MultiLineString:oT,MultiPolygon:aT,GeometryCollection:sT};function X0(r){const t=r.getType(),e=hT[t],n=e(r);let i=tT[t];if(typeof r.getFlatCoordinates=="function"){const s=lT(r);s.length>0&&(i+=" "+s)}return n.length===0?i+" "+G0:i+"("+n+")"}const cT=nT,Le=[null,"http://www.opengis.net/wms"],uT=W(Le,{Service:O(LT),Capability:O(AT)}),dT=W(Le,{Request:O(jT),Exception:O(DT),Layer:O(kT)});class fT extends ud{constructor(){super(),this.version=void 0}readFromNode(t){return this.version=t.getAttribute("version").trim(),Z({version:this.version},uT,t,[])||null}}const gT=W(Le,{Name:O($),Title:O($),Abstract:O($),KeywordList:O($0),OnlineResource:O(Vs),ContactInformation:O(OT),Fees:O($),AccessConstraints:O($),LayerLimit:O(fe),MaxWidth:O(fe),MaxHeight:O(fe)}),pT=W(Le,{ContactPersonPrimary:O(FT),ContactPosition:O($),ContactAddress:O(NT),ContactVoiceTelephone:O($),ContactFacsimileTelephone:O($),ContactElectronicMailAddress:O($)}),mT=W(Le,{ContactPerson:O($),ContactOrganization:O($)}),_T=W(Le,{AddressType:O($),Address:O($),City:O($),StateOrProvince:O($),PostCode:O($),Country:O($)}),yT=W(Le,{Format:ot($)}),q0=W(Le,{Name:O($),Title:O($),Abstract:O($),KeywordList:O($0),CRS:Kt($),EX_GeographicBoundingBox:O(PT),BoundingBox:Kt(IT),Dimension:Kt(GT),Attribution:O(CT),AuthorityURL:Kt(BT),Identifier:Kt($),MetadataURL:Kt(XT),DataURL:Kt(On),FeatureListURL:Kt(On),Style:Kt(qT),MinScaleDenominator:O(Pt),MaxScaleDenominator:O(Pt),Layer:Kt(W0)}),xT=W(Le,{Title:O($),OnlineResource:O(Vs),LogoURL:O(Z0)}),vT=W(Le,{westBoundLongitude:O(Pt),eastBoundLongitude:O(Pt),southBoundLatitude:O(Pt),northBoundLatitude:O(Pt)}),wT=W(Le,{GetCapabilities:O(ic),GetMap:O(ic),GetFeatureInfo:O(ic)}),bT=W(Le,{Format:Kt($),DCPType:Kt(zT)}),ST=W(Le,{HTTP:O(UT)}),ET=W(Le,{Get:O(On),Post:O(On)}),TT=W(Le,{Name:O($),Title:O($),Abstract:O($),LegendURL:Kt(Z0),StyleSheetURL:O(On),StyleURL:O(On)}),MT=W(Le,{Format:O($),OnlineResource:O(Vs)}),RT=W(Le,{Keyword:ot($)});function CT(r,t){return Z({},xT,r,t)}function IT(r,t){const e=[wn(r.getAttribute("minx")),wn(r.getAttribute("miny")),wn(r.getAttribute("maxx")),wn(r.getAttribute("maxy"))],n=[wn(r.getAttribute("resx")),wn(r.getAttribute("resy"))];return{crs:r.getAttribute("CRS"),extent:e,res:n}}function PT(r,t){const e=Z({},vT,r,t);if(!e)return;const n=e.westBoundLongitude,i=e.southBoundLatitude,s=e.eastBoundLongitude,o=e.northBoundLatitude;if(!(n===void 0||i===void 0||s===void 0||o===void 0))return[n,i,s,o]}function AT(r,t){return Z({},dT,r,t)}function LT(r,t){return Z({},gT,r,t)}function OT(r,t){return Z({},pT,r,t)}function FT(r,t){return Z({},mT,r,t)}function NT(r,t){return Z({},_T,r,t)}function DT(r,t){return Z([],yT,r,t)}function kT(r,t){const e=Z({},q0,r,t);return e.Layer===void 0?Object.assign(e,W0(r,t)):e}function W0(r,t){const e=t[t.length-1],n=Z({},q0,r,t);if(!n)return;let i=Ri(r.getAttribute("queryable"));i===void 0&&(i=e.queryable),n.queryable=i!==void 0?i:!1;let s=Tn(r.getAttribute("cascaded"));s===void 0&&(s=e.cascaded),n.cascaded=s;let o=Ri(r.getAttribute("opaque"));o===void 0&&(o=e.opaque),n.opaque=o!==void 0?o:!1;let a=Ri(r.getAttribute("noSubsets"));a===void 0&&(a=e.noSubsets),n.noSubsets=a!==void 0?a:!1;let l=wn(r.getAttribute("fixedWidth"));l||(l=e.fixedWidth),n.fixedWidth=l;let h=wn(r.getAttribute("fixedHeight"));return h||(h=e.fixedHeight),n.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(c){if(c in e){const u=n[c]||[];n[c]=u.concat(e[c])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(c){if(!(c in n)){const u=e[c];n[c]=u}}),n}function GT(r,t){return{name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol"),default:r.getAttribute("default"),multipleValues:Ri(r.getAttribute("multipleValues")),nearestValue:Ri(r.getAttribute("nearestValue")),current:Ri(r.getAttribute("current")),values:$(r)}}function On(r,t){return Z({},MT,r,t)}function jT(r,t){return Z({},wT,r,t)}function zT(r,t){return Z({},ST,r,t)}function UT(r,t){return Z({},ET,r,t)}function ic(r,t){return Z({},bT,r,t)}function Z0(r,t){const e=On(r,t);if(e){const n=[Tn(r.getAttribute("width")),Tn(r.getAttribute("height"))];return e.size=n,e}}function BT(r,t){const e=On(r,t);if(e)return e.name=r.getAttribute("name"),e}function XT(r,t){const e=On(r,t);if(e)return e.type=r.getAttribute("type"),e}function qT(r,t){return Z({},TT,r,t)}function $0(r,t){return Z([],RT,r,t)}const WT=fT,ZT="_feature",$T="_layer";class VT extends va{constructor(t){super(),t=t||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new It,this.layers_=t.layers?t.layers:null}getLayers(){return this.layers_}setLayers(t){this.layers_=t}readFeatures_(t,e){t.setAttribute("namespaceURI",this.featureNS_);const n=t.localName;let i=[];if(t.childNodes.length===0)return i;if(n=="msGMLOutput")for(let s=0,o=t.childNodes.length;s<o;s++){const a=t.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,h=e[0],c=$T,u=l.localName.replace(c,"");if(this.layers_&&!this.layers_.includes(u))continue;const f=u+ZT;h.featureType=f,h.featureNS=this.featureNS_;const p={};p[f]=ot(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const m=W([h.featureNS,null],p);l.setAttribute("namespaceURI",this.featureNS_);const _=Z([],m,l,e,this.gmlFormat_);_&&Ot(i,_)}if(n=="FeatureCollection"){const s=Z([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(t,e){const n={};return e&&Object.assign(n,this.getReadOptions(t,e)),this.readFeatures_(t,[n])}}const YT=VT,un=[null,"http://www.opengis.net/wmts/1.0"],Hs=[null,"http://www.opengis.net/ows/1.1"],HT=W(un,{Contents:O(aM)});let KT=class extends ud{constructor(){super(),this.owsParser_=new L0}readFromNode(r){let t=r.getAttribute("version");t&&(t=t.trim());let e=this.owsParser_.readFromNode(r);return e?(e.version=t,e=Z(e,HT,r,[]),e||null):null}};const QT=W(un,{Layer:Kt(lM),TileMatrixSet:Kt(hM)}),JT=W(un,{Style:Kt(cM),Format:Kt($),TileMatrixSetLink:Kt(uM),Dimension:Kt(dM),ResourceURL:Kt(fM)},W(Hs,{Title:O($),Abstract:O($),WGS84BoundingBox:O(Y0),BoundingBox:Kt(gM),Identifier:O($)})),tM=W(un,{LegendURL:Kt(pM)},W(Hs,{Title:O($),Identifier:O($)})),eM=W(un,{TileMatrixSet:O($),TileMatrixSetLimits:O(_M)}),rM=W(un,{TileMatrixLimits:ot(yM)}),nM=W(un,{TileMatrix:O($),MinTileRow:O(fe),MaxTileRow:O(fe),MinTileCol:O(fe),MaxTileCol:O(fe)}),iM=W(un,{Default:O($),Value:Kt($)},W(Hs,{Identifier:O($)})),V0=W(Hs,{LowerCorner:ot(Jc),UpperCorner:ot(Jc)}),sM=W(un,{WellKnownScaleSet:O($),TileMatrix:Kt(mM)},W(Hs,{SupportedCRS:O($),Identifier:O($),BoundingBox:O(Y0)})),oM=W(un,{TopLeftCorner:O(Jc),ScaleDenominator:O(Pt),TileWidth:O(fe),TileHeight:O(fe),MatrixWidth:O(fe),MatrixHeight:O(fe)},W(Hs,{Identifier:O($)}));function aM(r,t){return Z({},QT,r,t)}function lM(r,t){return Z({},JT,r,t)}function hM(r,t){return Z({},sM,r,t)}function cM(r,t){const e=Z({},tM,r,t);if(!e)return;const n=r.getAttribute("isDefault")==="true";return e.isDefault=n,e}function uM(r,t){return Z({},eM,r,t)}function dM(r,t){return Z({},iM,r,t)}function fM(r,t){const e=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),s={};return e&&(s.format=e),n&&(s.template=n),i&&(s.resourceType=i),s}function Y0(r,t){const e=Z([],V0,r,t);if(e.length==2)return Is(e)}function gM(r,t){const e=r.getAttribute("crs"),n=Z([],V0,r,t);if(n.length==2)return{extent:Is(n),crs:e}}function pM(r,t){const e={};return e.format=r.getAttribute("format"),e.href=Vs(r),e}function Jc(r,t){const e=$(r).split(/\s+/);if(!e||e.length!=2)return;const n=+e[0],i=+e[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function mM(r,t){return Z({},oM,r,t)}function _M(r,t){return Z([],rM,r,t)}function yM(r,t){return Z({},nM,r,t)}const vd=KT,xM=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:Sv,GML:Yv,GPX:Nw,GeoJSON:Vm,IGC:Uw,IIIFInfo:Vw,KML:iS,MVT:A0,OWS:L0,Polyline:_E,TopoJSON:IE,WFS:ZE,WKB:KE,WKT:cT,WMSCapabilities:WT,WMSGetFeatureInfo:YT,WMTSCapabilities:vd},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=xM;const ti={ADD:"add",REMOVE:"remove"},Vg={LENGTH:"length"};class Va extends cn{constructor(t,e,n){super(t),this.element=e,this.index=n}}let Cl=class extends zi{constructor(r,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=r||[],this.unique_)for(let e=0,n=this.array_.length;e<n;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(r){for(let t=0,e=r.length;t<e;++t)this.push(r[t]);return this}forEach(r){const t=this.array_;for(let e=0,n=t.length;e<n;++e)r(t[e],e,t)}getArray(){return this.array_}item(r){return this.array_[r]}getLength(){return this.get(Vg.LENGTH)}insertAt(r,t){if(r<0||r>this.getLength())throw new Error("Index out of bounds: "+r);this.unique_&&this.assertUnique_(t),this.array_.splice(r,0,t),this.updateLength_(),this.dispatchEvent(new Va(ti.ADD,t,r))}pop(){return this.removeAt(this.getLength()-1)}push(r){this.unique_&&this.assertUnique_(r);const t=this.getLength();return this.insertAt(t,r),this.getLength()}remove(r){const t=this.array_;for(let e=0,n=t.length;e<n;++e)if(t[e]===r)return this.removeAt(e)}removeAt(r){if(r<0||r>=this.getLength())return;const t=this.array_[r];return this.array_.splice(r,1),this.updateLength_(),this.dispatchEvent(new Va(ti.REMOVE,t,r)),t}setAt(r,t){const e=this.getLength();if(r>=e){this.insertAt(r,t);return}if(r<0)throw new Error("Index out of bounds: "+r);this.unique_&&this.assertUnique_(t,r);const n=this.array_[r];this.array_[r]=t,this.dispatchEvent(new Va(ti.REMOVE,n,r)),this.dispatchEvent(new Va(ti.ADD,t,r))}updateLength_(){this.set(Vg.LENGTH,this.array_.length)}assertUnique_(r,t){for(let e=0,n=this.array_.length;e<n;++e)if(this.array_[e]===r&&e!==t)throw new Error("Duplicate item added to a unique collection")}};const rr={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Ut={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class H0 extends zi{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Ut.OPACITY]=t.opacity!==void 0?t.opacity:1,At(typeof e[Ut.OPACITY]=="number","Layer opacity must be a number"),e[Ut.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Ut.Z_INDEX]=t.zIndex,e[Ut.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Ut.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Ut.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Ut.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=wt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ct()}getLayerStatesArray(t){return ct()}getExtent(){return this.get(Ut.EXTENT)}getMaxResolution(){return this.get(Ut.MAX_RESOLUTION)}getMinResolution(){return this.get(Ut.MIN_RESOLUTION)}getMinZoom(){return this.get(Ut.MIN_ZOOM)}getMaxZoom(){return this.get(Ut.MAX_ZOOM)}getOpacity(){return this.get(Ut.OPACITY)}getSourceState(){return ct()}getVisible(){return this.get(Ut.VISIBLE)}getZIndex(){return this.get(Ut.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ut.EXTENT,t)}setMaxResolution(t){this.set(Ut.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Ut.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Ut.MAX_ZOOM,t)}setMinZoom(t){this.set(Ut.MIN_ZOOM,t)}setOpacity(t){At(typeof t=="number","Layer opacity must be a number"),this.set(Ut.OPACITY,t)}setVisible(t){this.set(Ut.VISIBLE,t)}setZIndex(t){this.set(Ut.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const ee={ANIMATING:0,INTERACTING:1},Ar={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},K0=42,Ds=256;function Yg(r,t,e){return function(n,i,s,o,a){if(!n)return;if(!i&&!t)return n;const l=t?0:s[0]*i,h=t?0:s[1]*i,c=a?a[0]:0,u=a?a[1]:0;let f=r[0]+l/2+c,p=r[2]-l/2+c,m=r[1]+h/2+u,_=r[3]-h/2+u;f>p&&(f=(p+f)/2,p=f),m>_&&(m=(_+m)/2,_=m);let x=wt(n[0],f,p),v=wt(n[1],m,_);if(o&&e&&i){const w=30*i;x+=-w*Math.log(1+Math.max(0,f-n[0])/w)+w*Math.log(1+Math.max(0,n[0]-p)/w),v+=-w*Math.log(1+Math.max(0,m-n[1])/w)+w*Math.log(1+Math.max(0,n[1]-_)/w)}return[x,v]}}function vM(r){return r}function wd(r,t,e,n){const i=yt(t)/e[0],s=Vt(t)/e[1];return n?Math.min(r,Math.max(i,s)):Math.min(r,Math.min(i,s))}function bd(r,t,e){let n=Math.min(r,t);const i=50;return n*=Math.log(1+i*Math.max(0,r/t-1))/i+1,e&&(n=Math.max(n,e),n/=Math.log(1+i*Math.max(0,e/r-1))/i+1),wt(n,e/2,t*2)}function wM(r,t,e,n){return t=t!==void 0?t:!0,function(i,s,o,a){if(i!==void 0){const l=r[0],h=r[r.length-1],c=e?wd(l,e,o,n):l;if(a)return t?bd(i,c,h):wt(i,h,c);const u=Math.min(c,i),f=Math.floor(Ql(r,u,s));return r[f]>c&&f<r.length-1?r[f+1]:r[f]}}}function bM(r,t,e,n,i,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=i?wd(t,i,l,s):t;if(h)return n?bd(o,c,e):wt(o,e,c);const u=1e-9,f=Math.ceil(Math.log(t/c)/Math.log(r)-u),p=-a*(.5-u)+.5,m=Math.min(c,o),_=Math.floor(Math.log(t/m)/Math.log(r)+p),x=Math.max(f,_),v=t/Math.pow(r,x);return wt(v,e,c)}}}function Hg(r,t,e,n,i){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=n?wd(r,n,a,i):r;return!e||!l?wt(s,t,h):bd(s,h,t)}}}function SM(r){if(r!==void 0)return 0}function Kg(r){if(r!==void 0)return r}function EM(r){const t=2*Math.PI/r;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function TM(r){const t=r===void 0?Co(5):r;return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function Q0(r){return Math.pow(r,3)}function MM(r){return 1-Q0(1-r)}function RM(r){return 3*r*r-2*r*r*r}const sc=0;class Qg extends zi{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Ou(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Nx(),t.center&&(t.center=Xn(t.center,this.projection_)),t.extent&&(t.extent=Nr(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Ar)delete e[a];this.setProperties(e,!0);const n=IM(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const i=CM(t),s=n.constraint,o=PM(t);this.constraints_={center:i,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const i=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(i[3]-e[3]+e[1]-i[1]),a=s/2*(i[0]-e[0]+e[2]-i[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=Xn(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=Xn(i.anchor,this.getProjection())),e[n]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let i=0;for(;i<e&&!this.isDef();++i){const c=arguments[i];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(i===e){n&&Ya(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;i<e;++i){const c=arguments[i],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||RM,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const f=nn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+f,l=u.targetRotation}AM(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(ee.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ee.ANIMATING]>0}getInteracting(){return this.hints_[ee.INTERACTING]>0}cancelAnimations(){this.setHint(ee.ANIMATING,-this.hints_[ee.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const i=this.animations_[e];if(i[0].callback&&Ya(i[0].callback,!1),!t)for(let s=0,o=i.length;s<o;++s){const a=i[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let s=!0;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const f=l.sourceCenter[0],p=l.sourceCenter[1],m=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const x=f+u*(m-f),v=p+u*(_-p);this.targetCenter_=[x,v]}if(l.sourceResolution&&l.targetResolution){const f=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const p=this.getViewportSize_(this.getRotation()),m=this.constraints_.resolution(f,0,p,!0);this.targetCenter_=this.calculateCenterZoom(m,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const f=u===1?nn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const p=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(p,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(ee.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=i[0].callback;o&&Ya(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-e[0],i[1]-e[1]],Ax(n,t-this.getRotation()),Cm(n,e)),n}calculateCenterZoom(t,e){let n;const i=this.getCenterInternal(),s=this.getResolution();if(i!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-i[0])/s,a=e[1]-t*(e[1]-i[1])/s;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],i=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&kc(t,this.getProjection())}getCenterInternal(){return this.get(Ar.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return nh(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();At(e,"The view center is not defined");const n=this.getResolution();At(n!==void 0,"The view resolution is not defined");const i=this.getRotation();return At(i!==void 0,"The view rotation is not defined"),Iu(e,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ar.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Nr(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=yt(t)/e[0],i=Vt(t)/e[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/Math.log(t);return function(s){return e/Math.pow(t,s*i)}}getRotation(){return this.get(Ar.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(n/i)/e;return function(o){return Math.log(n/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();i=oc(i,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,i;if(this.resolutions_){const s=Ql(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?i=2:i=n/this.resolutions_[s+1]}else n=this.maxResolution_,i=this.zoomFactor_;return e+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=wt(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,wt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(At(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){At(!kn(t),"Cannot fit empty extent provided as `geometry`");const i=Nr(t,this.getProjection());n=ig(i)}else if(t.getType()==="Circle"){const i=Nr(t.getExtent(),this.getProjection());n=ig(i),n.rotate(this.getRotation(),Re(i))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),i=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,f=s.length;u<f;u+=o){const p=s[u]*n-s[u+1]*i,m=s[u]*i+s[u+1]*n;a=Math.min(a,p),l=Math.min(l,m),h=Math.max(h,p),c=Math.max(c,m)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const i=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),f=Re(a);f[0]+=(i[1]-i[3])/2*l,f[1]+=(i[0]-i[2])/2*l;const p=f[0]*u-f[1]*c,m=f[1]*u+f[0]*c,_=this.getConstrainedCenter([p,m],l),x=e.callback?e.callback:zo;e.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:e.duration,easing:e.easing},x):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),Ya(x,!0))}centerOn(t,e,n){this.centerOnInternal(Xn(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(oc(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,i){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=oc(t,i,[a[0]/2+o[3],a[1]/2+o[0]],e,n);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=kc(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Xn(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,i,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Xn(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(i,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Xn(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,i=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(i),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,i,s));this.get(Ar.ROTATION)!==i&&this.set(Ar.ROTATION,i),this.get(Ar.RESOLUTION)!==o&&(this.set(Ar.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ar.CENTER)||!pl(this.get(Ar.CENTER),a))&&this.set(Ar.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const i=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,i,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!pl(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:MM,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ee.INTERACTING,1)}endInteraction(t,e,n){n=n&&Xn(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(ee.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function Ya(r,t){setTimeout(function(){r(t)},0)}function CM(r){if(r.extent!==void 0){const e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return Yg(r.extent,r.constrainOnlyCenter,e)}const t=Ou(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Yg(e,!1,!1)}return vM}function IM(r){let t,e,n,i=r.minZoom!==void 0?r.minZoom:sc,s=r.maxZoom!==void 0?r.maxZoom:28;const o=r.zoomFactor!==void 0?r.zoomFactor:2,a=r.multiWorld!==void 0?r.multiWorld:!1,l=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,h=r.showFullExtent!==void 0?r.showFullExtent:!1,c=Ou(r.projection,"EPSG:3857"),u=c.getExtent();let f=r.constrainOnlyCenter,p=r.extent;if(!a&&!p&&c.isGlobal()&&(f=!1,p=u),r.resolutions!==void 0){const m=r.resolutions;e=m[i],n=m[s]!==void 0?m[s]:m[m.length-1],r.constrainResolution?t=wM(m,l,!f&&p,h):t=Hg(e,n,l,!f&&p,h)}else{const m=(u?Math.max(yt(u),Vt(u)):360*Xo.degrees/c.getMetersPerUnit())/Ds/Math.pow(2,sc),_=m/Math.pow(2,28-sc);e=r.maxResolution,e!==void 0?i=0:e=m/Math.pow(o,i),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=e/Math.pow(o,s):n=m/Math.pow(o,s):n=_),s=i+Math.floor(Math.log(e/n)/Math.log(o)),n=e/Math.pow(o,s-i),r.constrainResolution?t=bM(o,e,n,l,!f&&p,h):t=Hg(e,n,l,!f&&p,h)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:i,zoomFactor:o}}function PM(r){if(r.enableRotation===void 0||r.enableRotation){const t=r.constrainRotation;return t===void 0||t===!0?TM():t===!1?Kg:typeof t=="number"?EM(t):Kg}return SM}function AM(r){return!(r.sourceCenter&&r.targetCenter&&!pl(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function oc(r,t,e,n,i){const s=Math.cos(-i);let o=Math.sin(-i),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}class LM extends H0{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Ut.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Ut.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ve(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=le(t,Lt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Qg?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;e.layerStatesArray?i=e.layerStatesArray.find(o=>o.layer===this):i=this.getLayerState();const s=this.getExtent();return OM(i,e.viewState)&&(!s||Qt(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const i=t instanceof Qg?t.getViewStateAndExtent():t;let s=e(i);return Array.isArray(s)||(s=[s]),s}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Ut.MAP,t)}getMapInternal(){return this.get(Ut.MAP)}setMap(t){this.mapPrecomposeKey_&&(ve(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ve(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=le(t,rr.PRECOMPOSE,function(e){const n=e.frameState.layerStatesArray,i=this.getLayerState(!1);At(!n.some(function(s){return s.layer===i.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(i)},this),this.mapRenderKey_=le(this,Lt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Ut.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function OM(r,t){if(!r.visible)return!1;const e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;const n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}const ba=LM;function FM(r,t,e,n,i){J0(r,t,e||0,n||r.length-1,i||NM)}function J0(r,t,e,n,i){for(;n>e;){if(n-e>600){var s=n-e+1,o=t-e+1,a=Math.log(s),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),c=Math.max(e,Math.floor(t-o*l/s+h)),u=Math.min(n,Math.floor(t+(s-o)*l/s+h));J0(r,t,c,u,i)}var f=r[t],p=e,m=n;for(ho(r,e,t),i(r[n],f)>0&&ho(r,e,n);p<m;){for(ho(r,p,m),p++,m--;i(r[p],f)<0;)p++;for(;i(r[m],f)>0;)m--}i(r[e],f)===0?ho(r,e,m):(m++,ho(r,m,n)),m<=t&&(e=m+1),t<=m&&(n=m-1)}}function ho(r,t,e){var n=r[t];r[t]=r[e],r[e]=n}function NM(r,t){return r<t?-1:r>t?1:0}let Sd=class{constructor(r=9){this._maxEntries=Math.max(4,r),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(r){let t=this.data;const e=[];if(!Ka(r,t))return e;const n=this.toBBox,i=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],a=t.leaf?n(o):o;Ka(r,a)&&(t.leaf?e.push(o):lc(r,a)?this._all(o,e):i.push(o))}t=i.pop()}return e}collides(r){let t=this.data;if(!Ka(r,t))return!1;const e=[];for(;t;){for(let n=0;n<t.children.length;n++){const i=t.children[n],s=t.leaf?this.toBBox(i):i;if(Ka(r,s)){if(t.leaf||lc(r,s))return!0;e.push(i)}}t=e.pop()}return!1}load(r){if(!(r&&r.length))return this;if(r.length<this._minEntries){for(let e=0;e<r.length;e++)this.insert(r[e]);return this}let t=this._build(r.slice(),0,r.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(r){return r&&this._insert(r,this.data.height-1),this}clear(){return this.data=os([]),this}remove(r,t){if(!r)return this;let e=this.data;const n=this.toBBox(r),i=[],s=[];let o,a,l;for(;e||i.length;){if(e||(e=i.pop(),a=i[i.length-1],o=s.pop(),l=!0),e.leaf){const h=DM(r,e.children,t);if(h!==-1)return e.children.splice(h,1),i.push(e),this._condense(i),this}!l&&!e.leaf&&lc(e,n)?(i.push(e),s.push(o),o=0,a=e,e=e.children[0]):a?(o++,e=a.children[o],l=!1):e=null}return this}toBBox(r){return r}compareMinX(r,t){return r.minX-t.minX}compareMinY(r,t){return r.minY-t.minY}toJSON(){return this.data}fromJSON(r){return this.data=r,this}_all(r,t){const e=[];for(;r;)r.leaf?t.push(...r.children):e.push(...r.children),r=e.pop();return t}_build(r,t,e,n){const i=e-t+1;let s=this._maxEntries,o;if(i<=s)return o=os(r.slice(t,e+1)),Hi(o,this.toBBox),o;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),o=os([]),o.leaf=!1,o.height=n;const a=Math.ceil(i/s),l=a*Math.ceil(Math.sqrt(s));Jg(r,t,e,l,this.compareMinX);for(let h=t;h<=e;h+=l){const c=Math.min(h+l-1,e);Jg(r,h,c,a,this.compareMinY);for(let u=h;u<=c;u+=a){const f=Math.min(u+a-1,c);o.children.push(this._build(r,u,f,n-1))}}return Hi(o,this.toBBox),o}_chooseSubtree(r,t,e,n){for(;n.push(t),!(t.leaf||n.length-1===e);){let i=1/0,s=1/0,o;for(let a=0;a<t.children.length;a++){const l=t.children[a],h=ac(l),c=jM(r,l)-h;c<s?(s=c,i=h<i?h:i,o=l):c===s&&h<i&&(i=h,o=l)}t=o||t.children[0]}return t}_insert(r,t,e){const n=e?r:this.toBBox(r),i=[],s=this._chooseSubtree(n,this.data,t,i);for(s.children.push(r),yo(s,n);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(n,i,t)}_split(r,t){const e=r[t],n=e.children.length,i=this._minEntries;this._chooseSplitAxis(e,i,n);const s=this._chooseSplitIndex(e,i,n),o=os(e.children.splice(s,e.children.length-s));o.height=e.height,o.leaf=e.leaf,Hi(e,this.toBBox),Hi(o,this.toBBox),t?r[t-1].children.push(o):this._splitRoot(e,o)}_splitRoot(r,t){this.data=os([r,t]),this.data.height=r.height+1,this.data.leaf=!1,Hi(this.data,this.toBBox)}_chooseSplitIndex(r,t,e){let n,i=1/0,s=1/0;for(let o=t;o<=e-t;o++){const a=_o(r,0,o,this.toBBox),l=_o(r,o,e,this.toBBox),h=zM(a,l),c=ac(a)+ac(l);h<i?(i=h,n=o,s=c<s?c:s):h===i&&c<s&&(s=c,n=o)}return n||e-t}_chooseSplitAxis(r,t,e){const n=r.leaf?this.compareMinX:kM,i=r.leaf?this.compareMinY:GM,s=this._allDistMargin(r,t,e,n),o=this._allDistMargin(r,t,e,i);s<o&&r.children.sort(n)}_allDistMargin(r,t,e,n){r.children.sort(n);const i=this.toBBox,s=_o(r,0,t,i),o=_o(r,e-t,e,i);let a=Ha(s)+Ha(o);for(let l=t;l<e-t;l++){const h=r.children[l];yo(s,r.leaf?i(h):h),a+=Ha(s)}for(let l=e-t-1;l>=t;l--){const h=r.children[l];yo(o,r.leaf?i(h):h),a+=Ha(o)}return a}_adjustParentBBoxes(r,t,e){for(let n=e;n>=0;n--)yo(t[n],r)}_condense(r){for(let t=r.length-1,e;t>=0;t--)r[t].children.length===0?t>0?(e=r[t-1].children,e.splice(e.indexOf(r[t]),1)):this.clear():Hi(r[t],this.toBBox)}};function DM(r,t,e){if(!e)return t.indexOf(r);for(let n=0;n<t.length;n++)if(e(r,t[n]))return n;return-1}function Hi(r,t){_o(r,0,r.children.length,t,r)}function _o(r,t,e,n,i){i||(i=os(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;s<e;s++){const o=r.children[s];yo(i,r.leaf?n(o):o)}return i}function yo(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function kM(r,t){return r.minX-t.minX}function GM(r,t){return r.minY-t.minY}function ac(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function Ha(r){return r.maxX-r.minX+(r.maxY-r.minY)}function jM(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function zM(r,t){const e=Math.max(r.minX,t.minX),n=Math.max(r.minY,t.minY),i=Math.min(r.maxX,t.maxX),s=Math.min(r.maxY,t.maxY);return Math.max(0,i-e)*Math.max(0,s-n)}function lc(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function Ka(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function os(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Jg(r,t,e,n,i){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=n)continue;const o=t+Math.ceil((e-t)/n/2)*n;FM(r,o,t,e,i),s.push(t,o,o,e)}}let Ks=0;const qi=0,te=1<<Ks++,Y=1<<Ks++,xe=1<<Ks++,Xt=1<<Ks++,me=1<<Ks++,Fe=Math.pow(2,Ks)-1,t_={[te]:"boolean",[Y]:"number",[xe]:"string",[Xt]:"color",[me]:"number[]"},UM=Object.keys(t_).map(Number).sort(rn);function be(r){const t=[];for(const e of UM)BM(r,e)&&t.push(t_[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function BM(r,t){return(r&t)===t}function Dr(r,t){return!!(r&t)}function Sa(r,t){return r===t}class ei{constructor(t,e){this.type=t,this.value=e}}class e_{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function Ed(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function XM(r){switch(r){case"string":return xe;case"color":return Xt;case"number":return Y;case"boolean":return te;case"number[]":return me;default:throw new Error(`Unrecognized type hint: ${r}`)}}function Bt(r,t,e){switch(typeof r){case"boolean":return new ei(te,r);case"number":return new ei(Y,r);case"string":{let i=xe;return rb(r)&&(i|=Xt),Sa(i&e,qi)||(i&=e),new ei(i,r)}}if(!Array.isArray(r))throw new Error("Expression must be an array or a primitive value");if(r.length===0)throw new Error("Empty expression");if(typeof r[0]=="string")return eR(r,t,e);for(const i of r)if(typeof i!="number")throw new Error("Expected an array of numbers");let n=me;return(r.length===3||r.length===4)&&(n|=Xt),e&&(n&=e),new ei(n,r)}const z={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},qM={[z.Get]:vt(([r,t])=>t!==void 0?XM(t.value):Fe,Ct(1,2),WM),[z.Var]:vt(([r])=>r.type,Ct(1,1),ZM),[z.Id]:vt(Y|xe,co,$M),[z.Concat]:vt(xe,Ct(2,1/0),Nt(Fe)),[z.GeometryType]:vt(xe,co,VM),[z.Resolution]:vt(Y,co),[z.Zoom]:vt(Y,co),[z.Time]:vt(Y,co),[z.Any]:vt(te,Ct(2,1/0),Nt(te)),[z.All]:vt(te,Ct(2,1/0),Nt(te)),[z.Not]:vt(te,Ct(1,1),Nt(te)),[z.Equal]:vt(te,Ct(2,2),Nt(Fe),Wn),[z.NotEqual]:vt(te,Ct(2,2),Nt(Fe),Wn),[z.GreaterThan]:vt(te,Ct(2,2),Nt(Fe),Wn),[z.GreaterThanOrEqualTo]:vt(te,Ct(2,2),Nt(Fe),Wn),[z.LessThan]:vt(te,Ct(2,2),Nt(Fe),Wn),[z.LessThanOrEqualTo]:vt(te,Ct(2,2),Nt(Fe),Wn),[z.Multiply]:vt(r=>{let t=Y|Xt;for(let e=0;e<r.length;e++)t&=r[e].type;return t},Ct(2,1/0),Nt(Y|Xt),Wn),[z.Coalesce]:vt(r=>{let t=Fe;for(let e=1;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Ct(2,1/0),Nt(Fe),Wn),[z.Divide]:vt(Y,Ct(2,2),Nt(Y)),[z.Add]:vt(Y,Ct(2,1/0),Nt(Y)),[z.Subtract]:vt(Y,Ct(2,2),Nt(Y)),[z.Clamp]:vt(Y,Ct(3,3),Nt(Y)),[z.Mod]:vt(Y,Ct(2,2),Nt(Y)),[z.Pow]:vt(Y,Ct(2,2),Nt(Y)),[z.Abs]:vt(Y,Ct(1,1),Nt(Y)),[z.Floor]:vt(Y,Ct(1,1),Nt(Y)),[z.Ceil]:vt(Y,Ct(1,1),Nt(Y)),[z.Round]:vt(Y,Ct(1,1),Nt(Y)),[z.Sin]:vt(Y,Ct(1,1),Nt(Y)),[z.Cos]:vt(Y,Ct(1,1),Nt(Y)),[z.Atan]:vt(Y,Ct(1,2),Nt(Y)),[z.Sqrt]:vt(Y,Ct(1,1),Nt(Y)),[z.Match]:vt(r=>{let t=Fe;for(let e=2;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Ct(4,1/0),tp,HM),[z.Between]:vt(te,Ct(3,3),Nt(Y)),[z.Interpolate]:vt(r=>{let t=Xt|Y;for(let e=3;e<r.length;e+=2)t&=r[e].type;return t},Ct(6,1/0),tp,KM),[z.Case]:vt(r=>{let t=Fe;for(let e=1;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Ct(3,1/0),YM,QM),[z.In]:vt(te,Ct(2,2),JM),[z.Number]:vt(Y,Ct(1,1/0),Nt(Fe)),[z.String]:vt(xe,Ct(1,1/0),Nt(Fe)),[z.Array]:vt(r=>r.length===3||r.length===4?me|Xt:me,Ct(1,1/0),Nt(Y)),[z.Color]:vt(Xt,Ct(1,4),Nt(Y)),[z.Band]:vt(Y,Ct(1,3),Nt(Y)),[z.Palette]:vt(Xt,Ct(2,2),tR),[z.ToString]:vt(xe,Ct(1,1),Nt(te|Y|xe|Xt))};function WM(r,t){const e=Bt(r[1],t);if(!(e instanceof ei))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),r.length===3){const n=Bt(r[2],t);return[e,n]}return[e]}function ZM(r,t,e,n){const i=r[1];if(typeof i!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(i),!("variables"in t.style)||t.style.variables[i]===void 0)return[new ei(Fe,i)];const s=t.style.variables[i],o=Bt(s,t);if(o.value=i,n&&!Dr(n,o.type))throw new Error(`The variable ${i} has type ${be(o.type)} but the following type was expected: ${be(n)}`);return[o]}function $M(r,t){t.featureId=!0}function VM(r,t){t.geometryType=!0}function co(r,t){const e=r[0];if(r.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function Ct(r,t){return function(e,n){const i=e[0],s=e.length-1;if(r===t){if(s!==r){const o=r===1?"":"s";throw new Error(`Expected ${r} argument${o} for ${i}, got ${s}`)}}else if(s<r||s>t){const o=t===1/0?`${r} or more`:`${r} to ${t}`;throw new Error(`Expected ${o} arguments for ${i}, got ${s}`)}}}function Nt(r){return function(t,e){const n=t[0],i=t.length-1,s=new Array(i);for(let o=0;o<i;++o){const a=Bt(t[o+1],e);if(!Dr(r,a.type)){const l=be(r),h=be(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=r,s[o]=a}return s}}function Wn(r,t,e){const n=r[0],i=r.length-1;let s=Fe;for(let a=0;a<e.length;++a)s&=e[a].type;if(s===qi)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(i);for(let a=0;a<i;++a)o[a]=Bt(r[a+1],t,s);return o}function YM(r,t){const e=r[0],n=r.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function tp(r,t){const e=r[0],n=r.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function HM(r,t,e,n){const i=r.length-1;let s=Bt(r[1],t).type;const o=Bt(r[r.length-1],t);let a=n!==void 0?n&o.type:o.type;const l=new Array(i-2);for(let c=0;c<i-2;c+=2){const u=Bt(r[c+2],t),f=Bt(r[c+3],t);s&=u.type,a&=f.type,l[c]=u,l[c+1]=f}const h=xe|Y|te;if(!Dr(h,s))throw new Error(`Expected an input of type ${be(h)} for the interpolate operation, got ${be(s)} instead`);if(Sa(a,qi))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(r));for(let c=0;c<i-2;c+=2){const u=Bt(r[c+2],t,s),f=Bt(r[c+3],t,a);l[c]=u,l[c+1]=f}return[Bt(r[1],t,s),...l,Bt(r[r.length-1],t,a)]}function KM(r,t,e,n){const i=r[1];let s;switch(i[0]){case"linear":s=1;break;case"exponential":if(s=i[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(i)}`);s=Bt(s,t);let o=Bt(r[2],t);if(!Dr(Y,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${be(o.type)} instead`);o=Bt(r[2],t,Y);const a=new Array(r.length-3);for(let l=0;l<a.length;l+=2){let h=Bt(r[l+3],t);if(!Dr(Y,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${be(h.type)} at position ${l+2} instead`);let c=Bt(r[l+4],t);if(!Dr(Y|Xt,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${be(c.type)} at position ${l+3} instead`);h=Bt(r[l+3],t,Y),c=Bt(r[l+4],t,Y|Xt),a[l]=h,a[l+1]=c}return[s,o,...a]}function QM(r,t,e,n){const i=Bt(r[r.length-1],t);let s=n!==void 0?n&i.type:i.type;const o=new Array(r.length-1);for(let a=0;a<o.length-1;a+=2){const l=Bt(r[a+1],t),h=Bt(r[a+2],t);if(!Dr(te,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${be(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(Sa(s,qi))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(r));for(let a=0;a<o.length-1;a+=2)o[a+1]=Bt(r[a+2],t,s);return o[o.length-1]=Bt(r[r.length-1],t,s),o}function JM(r,t){let e=r[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=xe|Y;const i=new Array(e.length);for(let s=0;s<i.length;s++){const o=Bt(e[s],t);n&=o.type,i[s]=o}if(Sa(n,qi))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(r));return[Bt(r[1],t,n),...i]}function tR(r,t){const e=Bt(r[1],t,Y);if(e.type!==Y)throw new Error(`The first argument of palette must be an number, got ${be(e.type)} instead`);const n=r[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const i=new Array(n.length);for(let s=0;s<i.length;s++){const o=Bt(n[s],t,Xt);if(!(o instanceof ei))throw new Error(`The palette color at index ${s} must be a literal value`);if(!Dr(o.type,Xt))throw new Error(`The palette color at index ${s} should be of type color, got ${be(o.type)} instead`);i[s]=o}return[e,...i]}function vt(r,...t){return function(e,n,i){const s=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,n,o,i)||o;let a=typeof r=="function"?r(o):r;if(i!==void 0){if(!Dr(a,i))throw new Error(`The following expression was expected to return ${be(i)}, but returns ${be(a)} instead: ${JSON.stringify(e)}`);a&=i}if(a===qi)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new e_(a,s,...o)}}function eR(r,t,e){const n=r[0],i=qM[n];if(!i)throw new Error(`Unknown operator: ${n}`);return i(r,t,e)}function Td(r){if(!r)return"";const t=r.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Td(r.getGeometries()[0]);default:return""}}function r_(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function jn(r,t,e){const n=Bt(r,e);if(!Dr(t,n.type)){const i=be(t),s=be(n.type);throw new Error(`Expected expression to be of type ${i}, got ${s}`)}return Br(n)}function Br(r,t){if(r instanceof ei){if(r.type===Xt&&typeof r.value=="string"){const n=ed(r.value);return function(){return n}}return function(){return r.value}}const e=r.operator;switch(e){case z.Number:case z.String:case z.Coalesce:return rR(r);case z.Get:case z.Var:return nR(r);case z.Id:return n=>n.featureId;case z.GeometryType:return n=>n.geometryType;case z.Concat:{const n=r.args.map(i=>Br(i));return i=>"".concat(...n.map(s=>s(i).toString()))}case z.Resolution:return n=>n.resolution;case z.Any:case z.All:case z.Between:case z.In:case z.Not:return sR(r);case z.Equal:case z.NotEqual:case z.LessThan:case z.LessThanOrEqualTo:case z.GreaterThan:case z.GreaterThanOrEqualTo:return iR(r);case z.Multiply:case z.Divide:case z.Add:case z.Subtract:case z.Clamp:case z.Mod:case z.Pow:case z.Abs:case z.Floor:case z.Ceil:case z.Round:case z.Sin:case z.Cos:case z.Atan:case z.Sqrt:return oR(r);case z.Case:return aR(r);case z.Match:return lR(r);case z.Interpolate:return hR(r);case z.ToString:return cR(r);default:throw new Error(`Unsupported operator ${e}`)}}function rR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Br(r.args[s]);switch(e){case z.Coalesce:return s=>{for(let o=0;o<n;++o){const a=i[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case z.Number:case z.String:return s=>{for(let o=0;o<n;++o){const a=i[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function nR(r,t){const e=r.args[0].value;switch(r.operator){case z.Get:return n=>n.properties[e];case z.Var:return n=>n.variables[e];default:throw new Error(`Unsupported accessor operator ${r.operator}`)}}function iR(r,t){const e=r.operator,n=Br(r.args[0]),i=Br(r.args[1]);switch(e){case z.Equal:return s=>n(s)===i(s);case z.NotEqual:return s=>n(s)!==i(s);case z.LessThan:return s=>n(s)<i(s);case z.LessThanOrEqualTo:return s=>n(s)<=i(s);case z.GreaterThan:return s=>n(s)>i(s);case z.GreaterThanOrEqualTo:return s=>n(s)>=i(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function sR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Br(r.args[s]);switch(e){case z.Any:return s=>{for(let o=0;o<n;++o)if(i[o](s))return!0;return!1};case z.All:return s=>{for(let o=0;o<n;++o)if(!i[o](s))return!1;return!0};case z.Between:return s=>{const o=i[0](s),a=i[1](s),l=i[2](s);return o>=a&&o<=l};case z.In:return s=>{const o=i[0](s);for(let a=1;a<n;++a)if(o===i[a](s))return!0;return!1};case z.Not:return s=>!i[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function oR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Br(r.args[s]);switch(e){case z.Multiply:return s=>{let o=1;for(let a=0;a<n;++a)o*=i[a](s);return o};case z.Divide:return s=>i[0](s)/i[1](s);case z.Add:return s=>{let o=0;for(let a=0;a<n;++a)o+=i[a](s);return o};case z.Subtract:return s=>i[0](s)-i[1](s);case z.Clamp:return s=>{const o=i[0](s),a=i[1](s);if(o<a)return a;const l=i[2](s);return o>l?l:o};case z.Mod:return s=>i[0](s)%i[1](s);case z.Pow:return s=>Math.pow(i[0](s),i[1](s));case z.Abs:return s=>Math.abs(i[0](s));case z.Floor:return s=>Math.floor(i[0](s));case z.Ceil:return s=>Math.ceil(i[0](s));case z.Round:return s=>Math.round(i[0](s));case z.Sin:return s=>Math.sin(i[0](s));case z.Cos:return s=>Math.cos(i[0](s));case z.Atan:return n===2?s=>Math.atan2(i[0](s),i[1](s)):s=>Math.atan(i[0](s));case z.Sqrt:return s=>Math.sqrt(i[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function aR(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=Br(r.args[i]);return i=>{for(let s=0;s<e-1;s+=2)if(n[s](i))return n[s+1](i);return n[e-1](i)}}function lR(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=Br(r.args[i]);return i=>{const s=n[0](i);for(let o=1;o<e;o+=2)if(s===n[o](i))return n[o+1](i);return n[e-1](i)}}function hR(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=Br(r.args[i]);return i=>{const s=n[0](i),o=n[1](i);let a,l;for(let h=2;h<e;h+=2){const c=n[h](i);let u=n[h+1](i);const f=Array.isArray(u);if(f&&(u=tb(u)),c>=o)return h===2?u:f?uR(s,o,a,l,c,u):xo(s,o,a,l,c,u);a=c,l=u}return l}}function cR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Br(r.args[s]);switch(e){case z.ToString:return s=>{const o=i[0](s);return r.args[0].type===Xt?rd(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function xo(r,t,e,n,i,s){const o=i-e;if(o===0)return n;const a=t-e,l=r===1?a/o:(Math.pow(r,a)-1)/(Math.pow(r,o)-1);return n+l*(s-n)}function uR(r,t,e,n,i,s){if(i-e===0)return n;const o=ug(n),a=ug(s);let l=a[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const h=[xo(r,t,e,o[0],i,a[0]),xo(r,t,e,o[1],i,a[1]),o[2]+xo(r,t,e,0,i,l),xo(r,t,e,n[3],i,s[3])];return r0(eb(h))}function dR(r){return!0}function fR(r){const t=Ed(),e=gR(r,t),n=r_();return function(i,s){if(n.properties=i.getPropertiesInternal(),n.resolution=s,t.featureId){const o=i.getId();o!==void 0?n.featureId=o:n.featureId=null}return t.geometryType&&(n.geometryType=Td(i.getGeometry())),e(n)}}function ep(r){const t=Ed(),e=r.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=tu(r[o],t);const i=r_(),s=new Array(e);return function(o,a){if(i.properties=o.getPropertiesInternal(),i.resolution=a,t.featureId){const h=o.getId();h!==void 0?i.featureId=h:i.featureId=null}let l=0;for(let h=0;h<e;++h){const c=n[h](i);c&&(s[l]=c,l+=1)}return s.length=l,s}}function gR(r,t){const e=r.length,n=new Array(e);for(let i=0;i<e;++i){const s=r[i],o="filter"in s?jn(s.filter,te,t):dR;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=tu(s.style[h],t)}else a=[tu(s.style,t)];n[i]={filter:o,styles:a}}return function(i){const s=[];let o=!1;for(let a=0;a<e;++a){const l=n[a].filter;if(l(i)&&!(r[a].else&&o)){o=!0;for(const h of n[a].styles){const c=h(i);c&&s.push(c)}}}return s}}function tu(r,t){const e=Ho(r,"",t),n=Ko(r,"",t),i=pR(r,t),s=mR(r,t),o=nr(r,"z-index",t);if(!e&&!n&&!i&&!s&&!Pn(r))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(r));const a=new $e;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(n){const c=n(l);c&&(h=!1),a.setStroke(c)}if(i){const c=i(l);c&&(h=!1),a.setText(c)}if(s){const c=s(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Ho(r,t,e){let n;if(t+"fill-pattern-src"in r?n=vR(r,t+"fill-",e):n=Md(r,t+"fill-color",e),!n)return null;const i=new Ur;return function(s){const o=n(s);return o==="none"?null:(i.setColor(o),i)}}function Ko(r,t,e){const n=nr(r,t+"stroke-width",e),i=Md(r,t+"stroke-color",e);if(!n&&!i)return null;const s=bn(r,t+"stroke-line-cap",e),o=bn(r,t+"stroke-line-join",e),a=n_(r,t+"stroke-line-dash",e),l=nr(r,t+"stroke-line-dash-offset",e),h=nr(r,t+"stroke-miter-limit",e),c=new an;return function(u){if(i){const f=i(u);if(f==="none")return null;c.setColor(f)}if(n&&c.setWidth(n(u)),s){const f=s(u);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(f)}if(o){const f=o(u);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(f)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function pR(r,t){const e="text-",n=bn(r,e+"value",t);if(!n)return null;const i=Ho(r,e,t),s=Ho(r,e+"background-",t),o=Ko(r,e,t),a=Ko(r,e+"background-",t),l=bn(r,e+"font",t),h=nr(r,e+"max-angle",t),c=nr(r,e+"offset-x",t),u=nr(r,e+"offset-y",t),f=Qo(r,e+"overflow",t),p=bn(r,e+"placement",t),m=nr(r,e+"repeat",t),_=bh(r,e+"scale",t),x=Qo(r,e+"rotate-with-view",t),v=nr(r,e+"rotation",t),w=bn(r,e+"align",t),S=bn(r,e+"justify",t),E=bn(r,e+"baseline",t),T=n_(r,e+"padding",t),R=Sh(r,e+"declutter-mode"),C=new Fi({declutterMode:R});return function(I){if(C.setText(n(I)),i&&C.setFill(i(I)),s&&C.setBackgroundFill(s(I)),o&&C.setStroke(o(I)),a&&C.setBackgroundStroke(a(I)),l&&C.setFont(l(I)),h&&C.setMaxAngle(h(I)),c&&C.setOffsetX(c(I)),u&&C.setOffsetY(u(I)),f&&C.setOverflow(f(I)),p){const F=p(I);if(F!=="point"&&F!=="line")throw new Error("Expected point or line for text-placement");C.setPlacement(F)}if(m&&C.setRepeat(m(I)),_&&C.setScale(_(I)),x&&C.setRotateWithView(x(I)),v&&C.setRotation(v(I)),w){const F=w(I);if(F!=="left"&&F!=="center"&&F!=="right"&&F!=="end"&&F!=="start")throw new Error("Expected left, right, center, start, or end for text-align");C.setTextAlign(F)}if(S){const F=S(I);if(F!=="left"&&F!=="right"&&F!=="center")throw new Error("Expected left, right, or center for text-justify");C.setJustify(F)}if(E){const F=E(I);if(F!=="bottom"&&F!=="top"&&F!=="middle"&&F!=="alphabetic"&&F!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");C.setTextBaseline(F)}return T&&C.setPadding(T(I)),C}}function mR(r,t){return"icon-src"in r?_R(r,t):"shape-points"in r?yR(r,t):"circle-radius"in r?xR(r,t):null}function _R(r,t){const e="icon-",n=e+"src",i=i_(r[n],n),s=Il(r,e+"anchor",t),o=bh(r,e+"scale",t),a=nr(r,e+"opacity",t),l=Il(r,e+"displacement",t),h=nr(r,e+"rotation",t),c=Qo(r,e+"rotate-with-view",t),u=np(r,e+"anchor-origin"),f=ip(r,e+"anchor-x-units"),p=ip(r,e+"anchor-y-units"),m=ER(r,e+"color"),_=bR(r,e+"cross-origin"),x=SR(r,e+"offset"),v=np(r,e+"offset-origin"),w=Pl(r,e+"width"),S=Pl(r,e+"height"),E=wR(r,e+"size"),T=Sh(r,e+"declutter-mode"),R=new dh({src:i,anchorOrigin:u,anchorXUnits:f,anchorYUnits:p,color:m,crossOrigin:_,offset:x,offsetOrigin:v,height:S,width:w,size:E,declutterMode:T});return function(C){return a&&R.setOpacity(a(C)),l&&R.setDisplacement(l(C)),h&&R.setRotation(h(C)),c&&R.setRotateWithView(c(C)),o&&R.setScale(o(C)),s&&R.setAnchor(s(C)),R}}function yR(r,t){const e="shape-",n=e+"points",i=e+"radius",s=eu(r[n],n),o=eu(r[i],i),a=Ho(r,e,t),l=Ko(r,e,t),h=bh(r,e+"scale",t),c=Il(r,e+"displacement",t),u=nr(r,e+"rotation",t),f=Qo(r,e+"rotate-with-view",t),p=Pl(r,e+"radius2"),m=Pl(r,e+"angle"),_=Sh(r,e+"declutter-mode"),x=new fh({points:s,radius:o,radius2:p,angle:m,declutterMode:_});return function(v){return a&&x.setFill(a(v)),l&&x.setStroke(l(v)),c&&x.setDisplacement(c(v)),u&&x.setRotation(u(v)),f&&x.setRotateWithView(f(v)),h&&x.setScale(h(v)),x}}function xR(r,t){const e="circle-",n=Ho(r,e,t),i=Ko(r,e,t),s=nr(r,e+"radius",t),o=bh(r,e+"scale",t),a=Il(r,e+"displacement",t),l=nr(r,e+"rotation",t),h=Qo(r,e+"rotate-with-view",t),c=Sh(r,e+"declutter-mode"),u=new gh({radius:5,declutterMode:c});return function(f){return s&&u.setRadius(s(f)),n&&u.setFill(n(f)),i&&u.setStroke(i(f)),a&&u.setDisplacement(a(f)),l&&u.setRotation(l(f)),h&&u.setRotateWithView(h(f)),o&&u.setScale(o(f)),u}}function nr(r,t,e){if(!(t in r))return;const n=jn(r[t],Y,e);return function(i){return eu(n(i),t)}}function bn(r,t,e){if(!(t in r))return null;const n=jn(r[t],xe,e);return function(i){return i_(n(i),t)}}function vR(r,t,e){const n=bn(r,t+"pattern-src",e),i=rp(r,t+"pattern-offset",e),s=rp(r,t+"pattern-size",e),o=Md(r,t+"color",e);return function(a){return{src:n(a),offset:i&&i(a),size:s&&s(a),color:o&&o(a)}}}function Qo(r,t,e){if(!(t in r))return null;const n=jn(r[t],te,e);return function(i){const s=n(i);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${t}`);return s}}function Md(r,t,e){if(!(t in r))return null;const n=jn(r[t],Xt|xe,e);return function(i){return s_(n(i),t)}}function n_(r,t,e){if(!(t in r))return null;const n=jn(r[t],me,e);return function(i){return Ea(n(i),t)}}function Il(r,t,e){if(!(t in r))return null;const n=jn(r[t],me,e);return function(i){const s=Ea(n(i),t);if(s.length!==2)throw new Error(`Expected two numbers for ${t}`);return s}}function rp(r,t,e){if(!(t in r))return null;const n=jn(r[t],me,e);return function(i){return o_(n(i),t)}}function bh(r,t,e){if(!(t in r))return null;const n=jn(r[t],me|Y,e);return function(i){return TR(n(i),t)}}function Pl(r,t){const e=r[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function wR(r,t){const e=r[t];if(e!==void 0){if(typeof e=="number")return ie(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function bR(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function np(r,t){const e=r[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function ip(r,t){const e=r[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function SR(r,t){const e=r[t];if(e!==void 0)return Ea(e,t)}function Sh(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function ER(r,t){const e=r[t];if(e!==void 0)return s_(e,t)}function Ea(r,t){if(!Array.isArray(r))throw new Error(`Expected an array for ${t}`);const e=r.length;for(let n=0;n<e;++n)if(typeof r[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return r}function i_(r,t){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);return r}function eu(r,t){if(typeof r!="number")throw new Error(`Expected a number for ${t}`);return r}function s_(r,t){if(typeof r=="string")return r;const e=Ea(r,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function o_(r,t){const e=Ea(r,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function TR(r,t){return typeof r=="number"?r:o_(r,t)}const sp={RENDER_ORDER:"renderOrder"};class Ta extends ba{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(sp.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new Sd(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(sp.RENDER_ORDER,t)}setStyle(t){this.style_=MR(t),this.styleFunction_=t===null?void 0:_b(this.style_),this.changed()}}function MR(r){if(r===void 0)return yb;if(!r)return null;if(typeof r=="function"||r instanceof $e)return r;if(!Array.isArray(r))return ep([r]);if(r.length===0)return[];const t=r.length,e=r[0];if(e instanceof $e){const n=new Array(t);for(let i=0;i<t;++i){const s=r[i];if(!(s instanceof $e))throw new Error("Expected a list of style instances");n[i]=s}return n}if("style"in e){const n=new Array(t);for(let i=0;i<t;++i){const s=r[i];if(!("style"in s))throw new Error("Expected a list of rules with a style property");n[i]=s}return fR(n)}return ep(r)}const ut={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Qa=[ut.FILL],ri=[ut.STROKE],Ti=[ut.BEGIN_PATH],op=[ut.CLOSE_PATH];class a_{drawCustom(t,e,n,i,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Ma extends a_{constructor(t,e,n,i){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=t.length;a<l;a+=e)i[0]=t[a],i[1]=t[a+1],mr(n,i)&&(s[o++]=i[0],s[o++]=i[1]);return o}appendFlatLineCoordinates(t,e,n,i,s,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=i);let c=t[e],u=t[e+1];const f=this.tmpCoordinate_;let p=!0,m,_,x;for(m=e+i;m<n;m+=i)f[0]=t[m],f[1]=t[m+1],x=Lc(h,f),x!==_?(p&&(a[l++]=c,a[l++]=u,p=!1),a[l++]=f[0],a[l++]=f[1]):x===Te.INTERSECTING?(a[l++]=f[0],a[l++]=f[1],p=!1):p=!0,c=f[0],u=f[1],_=x;return(s&&p||m===e+i)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,n,i,s){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(t,e,l,i,!1,!1);s.push(h),e=l}return e}drawCustom(t,e,n,i,s){this.beginGeometry(t,e,s);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,f,p;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),f=[];const m=t.getEndss();p=0;for(let _=0,x=m.length;_<x;++_){const v=[];p=this.drawCustomCoordinates_(h,p,m[_],a,v),f.push(v)}this.instructions.push([ut.CUSTOM,l,f,t,n,jc,s]),this.hitDetectionInstructions.push([ut.CUSTOM,l,f,t,i||n,jc,s]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),p=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([ut.CUSTOM,l,u,t,n,qo,s]),this.hitDetectionInstructions.push([ut.CUSTOM,l,u,t,i||n,qo,s]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([ut.CUSTOM,l,c,t,n,En,s]),this.hitDetectionInstructions.push([ut.CUSTOM,l,c,t,i||n,En,s]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([ut.CUSTOM,l,c,t,n,En,s]),this.hitDetectionInstructions.push([ut.CUSTOM,l,c,t,i||n,En,s]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([ut.CUSTOM,l,c,t,n,void 0,s]),this.hitDetectionInstructions.push([ut.CUSTOM,l,c,t,i||n,void 0,s]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[ut.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ut.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let i,s,o=-1;for(e=0;e<n;++e)i=t[e],s=i[0],s==ut.END_GEOMETRY?o=e:s==ut.BEGIN_GEOMETRY&&(i[2]=e,ix(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const i=t.getColor();n.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,n.fillStyle=Jr(i||er)}else n.fillStyle=void 0;if(e){const i=e.getColor();n.strokeStyle=Jr(i||$o);const s=e.getLineCap();n.lineCap=s!==void 0?s:Fs;const o=e.getLineDash();n.lineDash=o?o.slice():Rn;const a=e.getLineDashOffset();n.lineDashOffset=a||Cn;const l=e.getLineJoin();n.lineJoin=l!==void 0?l:Ns;const h=e.getWidth();n.lineWidth=h!==void 0?h:Yo;const c=e.getMiterLimit();n.miterLimit=c!==void 0?c:Zo,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[ut.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ut.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,i=t.lineCap,s=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=i||s!=t.currentLineDash&&!ji(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=i,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[ut.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=gx(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Mr(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class RR extends Ma{constructor(t,e,n,i){super(t,e,n,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!mr(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const i=t.getFlatCoordinates(),s=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(i,s);this.instructions.push([ut.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const i=t.getFlatCoordinates(),s=[];for(let l=0,h=i.length;l<h;l+=t.getStride())(!this.maxExtent||mr(this.maxExtent,i.slice(l,l+2)))&&s.push(i[l],i[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([ut.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),i=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const CR=RR;class IR extends Ma{constructor(t,e,n,i){super(t,e,n,i)}drawFlatCoordinates_(t,e,n,i){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,n,i,!1,!1),a=[ut.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,e,n){const i=this.state,s=i.strokeStyle,o=i.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Rn,Cn],Ti);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(ri),this.endGeometry(e)}drawMultiLineString(t,e,n){const i=this.state,s=i.strokeStyle,o=i.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Rn,Cn],Ti);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,f=a.length;u<f;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(ri),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ri),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ri),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Ti)}}const PR=IR;class AR extends Ma{constructor(t,e,n,i){super(t,e,n,i)}drawFlatCoordinatess_(t,e,n,i){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=n.length;this.instructions.push(Ti),this.hitDetectionInstructions.push(Ti);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,c,i,!0,!a),p=[ut.MOVE_TO_LINE_TO,u,f];this.instructions.push(p),this.hitDetectionInstructions.push(p),a&&(this.instructions.push(op),this.hitDetectionInstructions.push(op)),e=c}return o&&(this.instructions.push(Qa),this.hitDetectionInstructions.push(Qa)),a&&(this.instructions.push(ri),this.hitDetectionInstructions.push(ri)),e}drawCircle(t,e,n){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,er]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Rn,Cn]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[ut.CIRCLE,h];this.instructions.push(Ti,c),this.hitDetectionInstructions.push(Ti,c),i.fillStyle!==void 0&&(this.instructions.push(Qa),this.hitDetectionInstructions.push(Qa)),i.strokeStyle!==void 0&&(this.instructions.push(ri),this.hitDetectionInstructions.push(ri)),this.endGeometry(e)}drawPolygon(t,e,n){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,er]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Rn,Cn]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,n){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,er]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Rn,Cn]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,f=a.length;u<f;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,i=e.length;n<i;++n)e[n]=vi(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const ap=AR;function LR(r,t,e,n,i){const s=[];let o=e,a=0,l=t.slice(e,2);for(;a<r&&o+i<n;){const[h,c]=l.slice(-2),u=t[o+i],f=t[o+i+1],p=Math.sqrt((u-h)*(u-h)+(f-c)*(f-c));if(a+=p,a>=r){const m=(r-a+p)/p,_=fr(h,u,m),x=fr(c,f,m);l.push(_,x),s.push(l),l=[_,x],a==r&&(o+=i),a=0}else if(a<r)l.push(t[o+i],t[o+i+1]),o+=i;else{const m=p-a,_=fr(h,u,m/p),x=fr(c,f,m/p);l.push(_,x),s.push(l),l=[_,x],a=0,o+=i}}return a>0&&s.push(l),s}function OR(r,t,e,n,i){let s=e,o=e,a=0,l=0,h=e,c,u,f,p,m,_,x,v,w,S;for(u=e;u<n;u+=i){const E=t[u],T=t[u+1];m!==void 0&&(w=E-m,S=T-_,p=Math.sqrt(w*w+S*S),x!==void 0&&(l+=f,c=Math.acos((x*w+v*S)/(f*p)),c>r&&(l>a&&(a=l,s=h,o=u),l=0,h=u-i)),f=p,x=w,v=S),m=E,_=T}return l+=p,l>a?[h,u]:[s,o]}const Al={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class FR extends Ma{constructor(t,e,n,i){super(t,e,n,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[er]={fillStyle:er},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const i=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!i&&!s)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Qt(this.maxExtent,t.getExtent()))return;let f;if(c=t.getFlatCoordinates(),h=="LineString")f=[c.length];else if(h=="MultiLineString")f=t.getEnds();else if(h=="Polygon")f=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const x=t.getEndss();f=[];for(let v=0,w=x.length;v<w;++v)f.push(x[v][0])}this.beginGeometry(t,e,n);const p=o.repeat,m=p?void 0:o.textAlign;let _=0;for(let x=0,v=f.length;x<v;++x){let w;p?w=LR(p*this.resolution,c,_,f[x],u):w=[c.slice(_,f[x])];for(let S=0,E=w.length;S<E;++S){const T=w[S];let R=0,C=T.length;if(m==null){const F=OR(o.maxAngle,T,0,T.length,2);R=F[0],C=F[1]}for(let F=R;F<C;F+=u)a.push(T[F],T[F+1]);const I=a.length;_=f[x],this.drawChars_(l,I),l=I}}this.endGeometry(e)}else{let f=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||f.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const w=t.getFlatInteriorPoints();c=[];for(let S=0,E=w.length;S<E;S+=3)o.overflow||f.push(w[S+2]/this.resolution),c.push(w[S],w[S+1]);if(c.length===0)return;u=2;break}const p=this.appendFlatPointCoordinates(c,u);if(p===l)return;if(f&&(p-l)/2!==c.length/u){let w=l/2;f=f.filter((S,E)=>{const T=a[(w+E)*2]===c[E*u]&&a[(w+E)*2+1]===c[E*u+1];return T||--w,T})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,n);let m=o.padding;if(m!=Si&&(o.scale[0]<0||o.scale[1]<0)){let w=o.padding[0],S=o.padding[1],E=o.padding[2],T=o.padding[3];o.scale[0]<0&&(S=-S,T=-T),o.scale[1]<0&&(w=-w,E=-E),m=[w,S,E,T]}const _=this.pixelRatio;this.instructions.push([ut.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,m==Si?Si:m.map(function(w){return w*_}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);const x=1/_,v=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=er,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[x,x],NaN,this.declutterMode_,this.declutterImageWithText_,m,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?er:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),o.backgroundFill&&(this.state.fillStyle=v,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||Vo,justify:e.justify,textBaseline:e.textBaseline||bl,scale:e.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,i=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=Al[i.textBaseline],c=this.textOffsetY_*l,u=this.text_,f=n?n.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([ut.DRAW_CHARS,t,e,h,i.overflow,a,i.maxAngle,l,c,s,f*l,u,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([ut.DRAW_CHARS,t,e,h,i.overflow,a&&er,i.maxAngle,l,c,s,f*l,u,o,1/l,this.declutterMode_])}setTextStyle(t,e){let n,i,s;if(!t)this.text_="";else{const o=t.getFill();o?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=Jr(o.getColor()||er)):(i=null,this.textFillState_=i);const a=t.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const m=a.getLineDash(),_=a.getLineDashOffset(),x=a.getWidth(),v=a.getMiterLimit();s.lineCap=a.getLineCap()||Fs,s.lineDash=m?m.slice():Rn,s.lineDashOffset=_===void 0?Cn:_,s.lineJoin=a.getLineJoin()||Ns,s.lineWidth=x===void 0?Yo:x,s.miterLimit=v===void 0?Zo:v,s.strokeStyle=Jr(a.getColor()||$o)}n=this.textState_;const l=t.getFont()||a0;db(l);const h=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||bl,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Si,n.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),f=t.getRotateWithView(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=f===void 0?!1:f,this.textRotation_=p===void 0?0:p,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:it(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+it(i.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const NR={Circle:ap,Default:Ma,Image:CR,LineString:PR,Polygon:ap,Text:FR};class l_{constructor(t,e,n,i){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const i in n){const s=n[i].finish();t[e][i]=s}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let i=this.buildersByZIndex_[n];i===void 0&&(i={},this.buildersByZIndex_[n]=i);let s=i[e];if(s===void 0){const o=NR[e];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[e]=s}return s}}class h_ extends ca{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ct()}getData(t){return null}prepareFrame(t){return ct()}renderFrame(t,e){return ct()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(i,s)=>{const o=this.loadedTileCallback.bind(this,n,i);return t.forEachLoadedTile(e,i,s,o)}}forEachFeatureAtCoordinate(t,e,n,i,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===et.LOADED||e.getState()===et.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=et.LOADED&&e!=et.ERROR&&t.addEventListener(Lt.CHANGE,this.boundHandleImageChange_),e==et.IDLE&&(t.load(),e=t.getState()),e==et.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class al extends cn{constructor(t,e,n,i){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=i}}class Rd{constructor(){vu(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this)),this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof Xc()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,i=e.length;n<i;n+=2){const s=e[n],o=e[n+1];if(typeof t[s]=="function")t[s](...o);else{if(typeof o=="function"){t[s]=o(t);continue}t[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const lp=[];let as=null;function DR(){as=Jt(1,1,void 0,{willReadFrequently:!0})}class Cd extends h_{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=pe(),this.pixelTransform=pe(),this.inversePixelTransform=pe(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){as||DR(),as.clearRect(0,0,1,1);let i;try{as.drawImage(t,e,n,1,1,0,0,1,1),i=as.getImageData(0,0,1,1).data}catch{return as=null,null}return i}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,n){const i=this.getLayer().getClassName();let s,o;if(t&&t.className===i&&(!n||t&&t.style.backgroundColor&&ji(zr(t.style.backgroundColor),zr(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=i;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=Jt();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const i=Dn(n),s=fa(n),o=eh(n),a=da(n);ae(e.coordinateToPixelTransform,i),ae(e.coordinateToPixelTransform,s),ae(e.coordinateToPixelTransform,o),ae(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;ae(l,i),ae(l,s),ae(l,o),ae(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const i=this.getLayer();if(i.hasListener(t)){const s=new al(t,this.inversePixelTransform,n,e);i.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(rr.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(rr.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Rd),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(rr.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(rr.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,i,s,o,a){const l=s/2,h=o/2,c=i/e,u=-c,f=-t[0]+a,p=-t[1];return or(this.tempTransform,l,h,c,u,-n,f,p)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function kR(r,t,e,n,i,s,o,a,l,h,c,u){let f=r[t],p=r[t+1],m=0,_=0,x=0,v=0;function w(){m=f,_=p,t+=n,f=r[t],p=r[t+1],v+=x,x=Math.sqrt((f-m)*(f-m)+(p-_)*(p-_))}do w();while(t<e-n&&v+x<s);let S=x===0?0:(s-v)/x;const E=fr(m,f,S),T=fr(_,p,S),R=t-n,C=v,I=s+a*l(h,i,c);for(;t<e-n&&v+x<I;)w();S=x===0?0:(I-v)/x;const F=fr(m,f,S),U=fr(_,p,S);let j;if(u){const b=[E,T,F,U];Om(b,0,4,2,u,b,b),j=b[0]>b[2]}else j=E>F;const B=Math.PI,d=[],g=R+n===t;t=R,x=0,v=C,f=r[t],p=r[t+1];let y;if(g){w(),y=Math.atan2(p-_,f-m),j&&(y+=y>0?-B:B);const b=(F+E)/2,M=(U+T)/2;return d[0]=[b,M,(I-s)/2,y,i],d}i=i.replace(/\n/g," ");for(let b=0,M=i.length;b<M;){w();let P=Math.atan2(p-_,f-m);if(j&&(P+=P>0?-B:B),y!==void 0){let G=P-y;if(G+=G>B?-2*B:G<-B?2*B:0,Math.abs(G)>o)return null}y=P;const A=b;let L=0;for(;b<M;++b){const G=j?M-b-1:b,H=a*l(h,i[G],c);if(t+n<e&&v+x<s+L+H/2)break;L+=H}if(b===A)continue;const D=j?i.substring(M-A,M-b):i.substring(A,b);S=x===0?0:(s+L/2-v)/x;const X=fr(m,f,S),K=fr(_,p,S);d.push([X,K,L/2,P,D]),s+=L}return d}const Ki=je(),Zn=[],_n=[],yn=[],$n=[];function hp(r){return r[3].declutterBox}const cp=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function hc(r,t){return t==="start"?t=cp.test(r)?"right":"left":t==="end"&&(t=cp.test(r)?"left":"right"),Al[t]}function GR(r,t,e){return e>0&&r.push(`
`,""),r.push(t,""),r}class jR{constructor(t,e,n,i,s){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=pe(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new Rd:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,i){const s=t+e+n+i;if(this.labels_[s])return this.labels_[s];const o=i?this.strokeStates[i]:null,a=n?this.fillStates[n]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(t),f=l.justify?Al[l.justify]:hc(Array.isArray(t)?t[0]:t,l.textAlign||Vo),p=i&&o.lineWidth?o.lineWidth:0,m=u?t:t.split(`
`).reduce(GR,[]),{width:_,height:x,widths:v,heights:w,lineWidths:S}=gb(l,m),E=_+p,T=[],R=(E+2)*c[0],C=(x+p)*c[1],I={width:R<0?Math.floor(R):Math.ceil(R),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:T};(c[0]!=1||c[1]!=1)&&T.push("scale",c),i&&(T.push("strokeStyle",o.strokeStyle),T.push("lineWidth",p),T.push("lineCap",o.lineCap),T.push("lineJoin",o.lineJoin),T.push("miterLimit",o.miterLimit),T.push("setLineDash",[o.lineDash]),T.push("lineDashOffset",o.lineDashOffset)),n&&T.push("fillStyle",a.fillStyle),T.push("textBaseline","middle"),T.push("textAlign","center");const F=.5-f;let U=f*E+F*p;const j=[],B=[];let d=0,g=0,y=0,b=0,M;for(let P=0,A=m.length;P<A;P+=2){const L=m[P];if(L===`
`){g+=d,d=0,U=f*E+F*p,++b;continue}const D=m[P+1]||l.font;D!==M&&(i&&j.push("font",D),n&&B.push("font",D),M=D),d=Math.max(d,w[y]);const X=[L,U+F*v[y]+f*(v[y]-S[b]),.5*(p+d)+g];U+=v[y],i&&j.push("strokeText",X),n&&B.push("fillText",X),++y}return Array.prototype.push.apply(T,j),Array.prototype.push.apply(T,B),this.labels_[s]=I,I}replayTextBackground_(t,e,n,i,s,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,i,s,o,a,l,h,c,u,f,p,m,_,x){a*=f[0],l*=f[1];let v=n-a,w=i-l;const S=s+h>t?t-h:s,E=o+c>e?e-c:o,T=m[3]+S*f[0]+m[1],R=m[0]+E*f[1]+m[2],C=v-m[3],I=w-m[0];(_||u!==0)&&(Zn[0]=C,$n[0]=C,Zn[1]=I,_n[1]=I,_n[0]=C+T,yn[0]=_n[0],yn[1]=I+R,$n[1]=yn[1]);let F;return u!==0?(F=or(pe(),n,i,1,1,u,-n,-i),ae(F,Zn),ae(F,_n),ae(F,yn),ae(F,$n),jr(Math.min(Zn[0],_n[0],yn[0],$n[0]),Math.min(Zn[1],_n[1],yn[1],$n[1]),Math.max(Zn[0],_n[0],yn[0],$n[0]),Math.max(Zn[1],_n[1],yn[1],$n[1]),Ki)):jr(Math.min(C,C+T),Math.min(I,I+R),Math.max(C,C+T),Math.max(I,I+R),Ki),p&&(v=Math.round(v),w=Math.round(w)),{drawImageX:v,drawImageY:w,drawImageW:S,drawImageH:E,originX:h,originY:c,declutterBox:{minX:Ki[0],minY:Ki[1],maxX:Ki[2],maxY:Ki[3],value:x},canvasTransform:F,scale:f}}replayImageOrLabel_(t,e,n,i,s,o,a){const l=!!(o||a),h=i.declutterBox,c=a?a[2]*i.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,Zn,_n,yn,$n,o,a),pb(t,i.canvasTransform,s,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=ae(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(n[0]%i,n[1]%i),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,i){const s=this.textStates[e],o=this.createLabel(t,e,i,n),a=this.strokeStates[n],l=this.pixelRatio,h=hc(Array.isArray(t)?t[0]:t,s.textAlign||Vo),c=Al[s.textBaseline||bl],u=a&&a.lineWidth?a.lineWidth:0,f=o.width/l-2*s.scale[0],p=h*f+2*(.5-h)*u,m=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:p,anchorY:m}}execute_(t,e,n,i,s,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&ji(n,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=ii(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),cx(this.renderedTransform_,n));let u=0;const f=i.length;let p=0,m,_,x,v,w,S,E,T,R,C,I,F,U,j=0,B=0,d=null,g=null;const y=this.coordinateCache_,b=this.viewRotation_,M=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,P={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:b},A=this.instructions!=i||this.overlaps?0:200;let L,D,X,K;for(;u<f;){const G=i[u];switch(G[0]){case ut.BEGIN_GEOMETRY:L=G[1],K=G[3],L.getGeometry()?a!==void 0&&!Qt(a,K.getExtent())?u=G[2]+1:++u:u=G[2],h&&(h.zIndex=G[4]);break;case ut.BEGIN_PATH:j>A&&(this.fill_(t),j=0),B>A&&(t.stroke(),B=0),!j&&!B&&(t.beginPath(),w=NaN,S=NaN),++u;break;case ut.CIRCLE:p=G[1];const H=c[p],Q=c[p+1],nt=c[p+2],xt=c[p+3],dt=nt-H,Tt=xt-Q,St=Math.sqrt(dt*dt+Tt*Tt);t.moveTo(H+St,Q),t.arc(H,Q,St,0,2*Math.PI,!0),++u;break;case ut.CLOSE_PATH:t.closePath(),++u;break;case ut.CUSTOM:p=G[1],m=G[2];const Dt=G[3],Yt=G[4],ue=G[5];P.geometry=Dt,P.feature=L,u in y||(y[u]=[]);const Ht=y[u];ue?ue(c,p,m,2,Ht):(Ht[0]=c[p],Ht[1]=c[p+1],Ht.length=2),h&&(h.zIndex=G[6]),Yt(Ht,P),++u;break;case ut.DRAW_IMAGE:p=G[1],m=G[2],R=G[3],_=G[4],x=G[5];let He=G[6];const ka=G[7],Uh=G[8],Ga=G[9],ja=G[10];let ur=G[11];const Ir=G[12];let qr=G[13];v=G[14]||"declutter";const Pr=G[15];if(!R&&G.length>=20){C=G[19],I=G[20],F=G[21],U=G[22];const yr=this.drawLabelWithPointPlacement_(C,I,F,U);R=yr.label,G[3]=R;const mi=G[23];_=(yr.anchorX-mi)*this.pixelRatio,G[4]=_;const xr=G[24];x=(yr.anchorY-xr)*this.pixelRatio,G[5]=x,He=R.height,G[6]=He,qr=R.width,G[13]=qr}let Zi;G.length>25&&(Zi=G[25]);let $i,Bn,dn;G.length>17?($i=G[16],Bn=G[17],dn=G[18]):($i=Si,Bn=!1,dn=!1),ja&&M?ur+=b:!ja&&!M&&(ur-=b);let Bh=0;for(;p<m;p+=2){if(Zi&&Zi[Bh++]<qr/this.pixelRatio)continue;const yr=this.calculateImageOrLabelDimensions_(R.width,R.height,c[p],c[p+1],qr,He,_,x,Uh,Ga,ur,Ir,s,$i,Bn||dn,L),mi=[t,e,R,yr,ka,Bn?d:null,dn?g:null];if(l){let xr,Wr,vr;if(Pr){const de=m-p;if(!Pr[de]){Pr[de]={args:mi,declutterMode:v};continue}const Be=Pr[de];xr=Be.args,Wr=Be.declutterMode,delete Pr[de],vr=hp(xr)}let fn,gn;if(xr&&(Wr!=="declutter"||!l.collides(vr))&&(fn=!0),(v!=="declutter"||!l.collides(yr.declutterBox))&&(gn=!0),Wr==="declutter"&&v==="declutter"){const de=fn&&gn;fn=de,gn=de}fn&&(Wr!=="none"&&l.insert(vr),this.replayImageOrLabel_.apply(this,xr)),gn&&(v!=="none"&&l.insert(yr.declutterBox),this.replayImageOrLabel_.apply(this,mi))}else this.replayImageOrLabel_.apply(this,mi)}++u;break;case ut.DRAW_CHARS:const Ue=G[1],Lf=G[2],Xh=G[3],A1=G[4];U=G[5];const L1=G[6],Of=G[7],Ff=G[8];F=G[9];const qh=G[10];C=G[11],I=G[12];const Nf=[G[13],G[13]];v=G[14]||"declutter";const Wh=this.textStates[I],io=Wh.font,so=[Wh.scale[0]*Of,Wh.scale[1]*Of];let oo;io in this.widths_?oo=this.widths_[io]:(oo={},this.widths_[io]=oo);const Df=Um(c,Ue,Lf,2),kf=Math.abs(so[0])*gg(io,C,oo);if(A1||kf<=Df){const yr=this.textStates[I].textAlign,mi=(Df-kf)*hc(C,yr),xr=kR(c,Ue,Lf,2,C,mi,L1,Math.abs(so[0]),gg,io,oo,M?0:this.viewRotation_);t:if(xr){const Wr=[];let vr,fn,gn,de,Be;if(F)for(vr=0,fn=xr.length;vr<fn;++vr){Be=xr[vr],gn=Be[4],de=this.createLabel(gn,I,"",F),_=Be[2]+(so[0]<0?-qh:qh),x=Xh*de.height+(.5-Xh)*2*qh*so[1]/so[0]-Ff;const pn=this.calculateImageOrLabelDimensions_(de.width,de.height,Be[0],Be[1],de.width,de.height,_,x,0,0,Be[3],Nf,!1,Si,!1,L);if(l&&v==="declutter"&&l.collides(pn.declutterBox))break t;Wr.push([t,e,de,pn,1,null,null])}if(U)for(vr=0,fn=xr.length;vr<fn;++vr){Be=xr[vr],gn=Be[4],de=this.createLabel(gn,I,U,""),_=Be[2],x=Xh*de.height-Ff;const pn=this.calculateImageOrLabelDimensions_(de.width,de.height,Be[0],Be[1],de.width,de.height,_,x,0,0,Be[3],Nf,!1,Si,!1,L);if(l&&v==="declutter"&&l.collides(pn.declutterBox))break t;Wr.push([t,e,de,pn,1,null,null])}l&&v!=="none"&&l.load(Wr.map(hp));for(let pn=0,O1=Wr.length;pn<O1;++pn)this.replayImageOrLabel_.apply(this,Wr[pn])}}++u;break;case ut.END_GEOMETRY:if(o!==void 0){L=G[1];const yr=o(L,K);if(yr)return yr}++u;break;case ut.FILL:A?j++:this.fill_(t),++u;break;case ut.MOVE_TO_LINE_TO:for(p=G[1],m=G[2],D=c[p],X=c[p+1],E=D+.5|0,T=X+.5|0,(E!==w||T!==S)&&(t.moveTo(D,X),w=E,S=T),p+=2;p<m;p+=2)D=c[p],X=c[p+1],E=D+.5|0,T=X+.5|0,(p==m-2||E!==w||T!==S)&&(t.lineTo(D,X),w=E,S=T);++u;break;case ut.SET_FILL_STYLE:d=G,this.alignAndScaleFill_=G[2],j&&(this.fill_(t),j=0,B&&(t.stroke(),B=0)),t.fillStyle=G[1],++u;break;case ut.SET_STROKE_STYLE:g=G,B&&(t.stroke(),B=0),this.setStrokeStyle_(t,G),++u;break;case ut.STROKE:A?B++:t.stroke(),++u;break;default:++u;break}}j&&this.fill_(t),B&&t.stroke()}execute(t,e,n,i,s,o){this.viewRotation_=i,this.execute_(t,e,n,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,n,i,s){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,i,s)}}const Lo=["Polygon","Circle","LineString","Image","Text","Default"],Ll=["Image","Text"],zR=Lo.filter(r=>!Ll.includes(r));class c_{constructor(t,e,n,i,s,o,a){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=pe(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,a)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let i=this.executorsByZIndex_[n];i===void 0&&(i={},this.executorsByZIndex_[n]=i);const s=t[n];for(const o in s){const a=s[o];i[o]=new jR(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let i=0,s=t.length;i<s;++i)if(t[i]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,i,s,o){i=Math.round(i);const a=i*2+1,l=or(this.hitDetectionTransform_,i+.5,i+.5,1/e,-1/e,-n,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Jt(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=je(),Ro(u,t),Mr(u,e*(this.renderBuffer_+i),u));const f=UR(i);let p;function m(T,R){const C=c.getImageData(0,0,a,a).data;for(let I=0,F=f.length;I<F;I++)if(C[f[I]]>0){if(!o||p!=="Image"&&p!=="Text"||o.includes(T)){const U=(f[I]-3)/4,j=i-U%a,B=i-(U/a|0),d=s(T,R,j*j+B*B);if(d)return d}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(rn);let x,v,w,S,E;for(x=_.length-1;x>=0;--x){const T=_[x].toString();for(w=this.executorsByZIndex_[T],v=Lo.length-1;v>=0;--v)if(p=Lo[v],S=w[p],S!==void 0&&(E=S.executeHitDetection(c,l,n,m,u),E))return E}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],i=e[1],s=e[2],o=e[3],a=[n,i,n,o,s,o,s,i];return ii(a,0,8,2,t,a),a}isEmpty(){return Pn(this.executorsByZIndex_)}execute(t,e,n,i,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(rn),o=o||Lo;let h,c,u,f,p,m;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const _=l[h].toString();for(p=this.executorsByZIndex_[_],u=0,f=o.length;u<f;++u){const x=o[u];if(m=p[x],m!==void 0){const v=a===null?void 0:m.getZIndexContext(),w=v?v.getContext():t,S=this.maxExtent_&&x!=="Image"&&x!=="Text";if(S&&(w.save(),this.clip(w,n)),m.execute(w,e,n,i,s,a),S&&w.restore(),v){v.offset();const E=l[h];this.deferredZIndexContexts_[E]||(this.deferredZIndexContexts_[E]=[]),this.deferredZIndexContexts_[E].push(v)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(rn);for(let n=0,i=e.length;n<i;++n)t[e[n]].forEach(s=>{s.draw(this.renderedContext_),s.clear()})}}const cc={};function UR(r){if(cc[r]!==void 0)return cc[r];const t=r*2+1,e=r*r,n=new Array(e+1);for(let s=0;s<=r;++s)for(let o=0;o<=r;++o){const a=s*s+o*o;if(a>e)break;let l=n[a];l||(l=[],n[a]=l),l.push(((r+s)*t+(r+o))*4+3),s>0&&l.push(((r-s)*t+(r+o))*4+3),o>0&&(l.push(((r+s)*t+(r-o))*4+3),s>0&&l.push(((r-s)*t+(r-o))*4+3))}const i=[];for(let s=0,o=n.length;s<o;++s)n[s]&&i.push(...n[s]);return cc[r]=i,i}class BR extends a_{constructor(t,e,n,i,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=i,this.transformRotation_=i?pa(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=pe()}drawImages_(t,e,n,i){if(!this.image_)return;const s=ii(t,e,n,i,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=s.length;c<u;c+=2){const f=s[c]-this.imageAnchorX_,p=s[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const m=f+this.imageAnchorX_,_=p+this.imageAnchorY_;or(a,m,_,1,1,h,-m,-_),o.save(),o.transform.apply(o,a),o.translate(m,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,p,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,n,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=ii(t,e,n,i,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=i){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,i,s){const o=this.context_,a=ii(t,e,n,i,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),n}drawRings_(t,e,n,i){for(let s=0,o=n.length;s<o;++s)e=this.moveToLineTo_(t,e,n[s],i,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Wx(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],i=e[3]-e[1],s=Math.sqrt(n*n+i*i),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,i=e.length;n<i;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Qt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,i=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)s=this.moveToLineTo_(i,s,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let i=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){const h=s[a];i=this.drawRings_(n,i,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),ji(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,i=t.textAlign?t.textAlign:Vo;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=i&&(n.textAlign=i,e.textAlign=i),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=i,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:i,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:Jr(n||er)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),i=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=s||Rn;this.strokeState_={lineCap:i!==void 0?i:Fs,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Cn)*this.pixelRatio_,lineJoin:a!==void 0?a:Ns,lineWidth:(l!==void 0?l:Yo)*this.pixelRatio_,miterLimit:h!==void 0?h:Zo,strokeStyle:Jr(n||$o)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),i=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*n,this.imageAnchorY_=i[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const p=e.getColor();this.textFillState_={fillStyle:Jr(p||er)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const p=n.getColor(),m=n.getLineCap(),_=n.getLineDash(),x=n.getLineDashOffset(),v=n.getLineJoin(),w=n.getWidth(),S=n.getMiterLimit();this.textStrokeState_={lineCap:m!==void 0?m:Fs,lineDash:_||Rn,lineDashOffset:x||Cn,lineJoin:v!==void 0?v:Ns,lineWidth:w!==void 0?w:Yo,miterLimit:S!==void 0?S:Zo,strokeStyle:Jr(p||$o)}}const i=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),f=t.getTextBaseline();this.textState_={font:i!==void 0?i:a0,textAlign:u!==void 0?u:Vo,textBaseline:f!==void 0?f:bl},this.text_=c!==void 0?Array.isArray(c)?c.reduce((p,m,_)=>p+=_%2?" ":m,""):c:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const u_=BR,gr=.5;function d_(r,t,e,n,i,s,o,a,l){const h=l?nh(i):i,c=r[0]*gr,u=r[1]*gr,f=Jt(c,u);f.imageSmoothingEnabled=!1;const p=f.canvas,m=new u_(f,gr,i,null,o,a,l?Bi(zx(),l):null),_=e.length,x=Math.floor((256*256*256-1)/_),v={};for(let S=1;S<=_;++S){const E=e[S-1],T=E.getStyleFunction()||n;if(!T)continue;let R=T(E,s);if(!R)continue;Array.isArray(R)||(R=[R]);const C=(S*x).toString(16).padStart(7,"#00000");for(let I=0,F=R.length;I<F;++I){const U=R[I],j=U.getGeometryFunction()(E);if(!j||!Qt(h,j.getExtent()))continue;const B=U.clone(),d=B.getFill();d&&d.setColor(C);const g=B.getStroke();g&&(g.setColor(C),g.setLineDash(null)),B.setText(void 0);const y=U.getImage();if(y){const A=y.getImageSize();if(!A)continue;const L=Jt(A[0],A[1],void 0,{alpha:!1}),D=L.canvas;L.fillStyle=C,L.fillRect(0,0,D.width,D.height),B.setImage(new dh({img:D,anchor:y.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:y.getOrigin(),opacity:1,size:y.getSize(),scale:y.getScale(),rotation:y.getRotation(),rotateWithView:y.getRotateWithView()}))}const b=B.getZIndex()||0;let M=v[b];M||(M={},v[b]=M,M.Polygon=[],M.Circle=[],M.LineString=[],M.Point=[]);const P=j.getType();if(P==="GeometryCollection"){const A=j.getGeometriesArrayRecursive();for(let L=0,D=A.length;L<D;++L){const X=A[L];M[X.getType().replace("Multi","")].push(X,B)}}else M[P.replace("Multi","")].push(j,B)}}const w=Object.keys(v).map(Number).sort(rn);for(let S=0,E=w.length;S<E;++S){const T=v[w[S]];for(const R in T){const C=T[R];for(let I=0,F=C.length;I<F;I+=2){m.setStyle(C[I+1]);for(let U=0,j=t.length;U<j;++U)m.setTransform(t[U]),m.drawGeometry(C[I])}}}return f.getImageData(0,0,p.width,p.height)}function f_(r,t,e){const n=[];if(e){const i=Math.floor(Math.round(r[0])*gr),s=Math.floor(Math.round(r[1])*gr),o=(wt(i,0,e.width-1)+wt(s,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/t.length);h&&h%c===0&&n.push(t[h/c-1])}return n}const XR=.5,g_={Point:KR,LineString:VR,Polygon:JR,MultiPoint:QR,MultiLineString:YR,MultiPolygon:HR,GeometryCollection:$R,Circle:WR};function qR(r,t){return parseInt(it(r),10)-parseInt(it(t),10)}function Ol(r,t){const e=p_(r,t);return e*e}function p_(r,t){return XR*r/t}function WR(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,n,i)}const a=e.getText();if(a&&a.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function Fl(r,t,e,n,i,s,o,a){const l=[],h=e.getImage();if(h){let f=!0;const p=h.getImageState();p==et.LOADED||p==et.ERROR?f=!1:p==et.IDLE&&h.load(),f&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>i(null)),ZR(r,t,e,n,s,o,a),u}function ZR(r,t,e,n,i,s,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(n,i);if(e.getRenderer())m_(r,l,e,t,o);else{const h=g_[l.getType()];h(r,l,e,t,o,s)}}function m_(r,t,e,n,i){if(t.getType()=="GeometryCollection"){const s=t.getGeometries();for(let o=0,a=s.length;o<a;++o)m_(r,s[o],e,n,i);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),i)}function $R(r,t,e,n,i,s){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=g_[o[a].getType()];h(r,o[a],e,n,i,s)}}function VR(r,t,e,n,i){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,n,i)}const o=e.getText();if(o&&o.getText()){const a=r.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,i)}}function YR(r,t,e,n,i){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,n,i)}const o=e.getText();if(o&&o.getText()){const a=r.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,i)}}function HR(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(o||s){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,n,i)}const a=e.getText();if(a&&a.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}function KR(r,t,e,n,i,s){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=et.LOADED)return;const c=r.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(t,n,i)}if(l){const c=r.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,n,i)}}function QR(r,t,e,n,i,s){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=s&&a&&h?{}:void 0;if(a){if(o.getImageState()!=et.LOADED)return;const u=r.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(t,n,i)}if(h){const u=r.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,n,i)}}function JR(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,n,i)}const a=e.getText();if(a&&a.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}class __ extends Cd{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=je(),this.wrappedRenderedExtent_=je(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const i=e.extent,s=e.viewState,o=s.center,a=s.resolution,l=s.projection,h=s.rotation,c=l.getExtent(),u=this.getLayer().getSource(),f=this.getLayer().getDeclutter(),p=e.pixelRatio,m=e.viewHints,_=!(m[ee.ANIMATING]||m[ee.INTERACTING]),x=this.context,v=Math.round(yt(i)/a*p),w=Math.round(Vt(i)/a*p),S=u.getWrapX()&&l.canWrapX(),E=S?yt(c):null,T=S?Math.ceil((i[2]-c[2])/E)+1:1;let R=S?Math.floor((i[0]-c[0])/E):0;do{const C=this.getRenderTransform(o,a,h,p,v,w,R*E);t.execute(x,[x.canvas.width,x.canvas.height],C,h,_,n===void 0?Lo:n?Ll:zR,n?f&&e.declutter[f]:void 0)}while(++R<T)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Jt(this.context.canvas.width,this.context.canvas.height,lp))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Oi(this.context),lp.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(t,e){const n=t.pixelRatio,i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const s=t.extent,o=t.viewState.resolution,a=Math.round(yt(s)/o*n),l=Math.round(Vt(s)/o*n);or(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/n,1/n,0,-a/2,-l/2),th(this.inversePixelTransform,this.pixelTransform);const h=Tu(this.pixelTransform);this.useContainer(e,h,this.getBackground(t));const c=this.context,u=c.canvas,f=this.replayGroup_;let p=f&&!f.isEmpty();if(!p&&!(this.getLayer().hasListener(rr.PRERENDER)||this.getLayer().hasListener(rr.POSTRENDER)))return null;u.width!=a||u.height!=l?(u.width=a,u.height=l,u.style.transform!==h&&(u.style.transform=h)):this.containerReused||c.clearRect(0,0,a,l),this.setDrawContext_(),this.preRender(c,t);const m=t.viewState;m.projection;let _=!1;if(p&&i.extent&&this.clipping){const x=Nr(i.extent);p=Qt(x,t.extent),_=p&&!We(x,t.extent),_&&this.clipUnrotated(c,t,x)}return p&&this.renderWorlds(f,t,this.getLayer().getDeclutter()?!1:void 0),_&&c.restore(),this.postRender(c,t),this.renderedRotation_!==m.rotation&&(this.renderedRotation_=m.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];ae(this.pixelTransform,n);const i=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=n[0]*gr,f=n[1]*gr;c.push(this.getRenderTransform(i,s,o,gr,u,f,0).slice());const p=h.getSource(),m=a.getExtent();if(p.getWrapX()&&a.canWrapX()&&!We(m,l)){let _=l[0];const x=yt(m);let v=0,w;for(;_<m[0];)--v,w=x*v,c.push(this.getRenderTransform(i,s,o,gr,u,f,w).slice()),_+=x;for(v=0,_=l[2];_>m[2];)++v,w=x*v,c.push(this.getRenderTransform(i,s,o,gr,u,f,w).slice()),_-=x}this.hitDetectionImageData_=d_(n,c,this.renderedFeatures_,h.getStyleFunction(),l,s,o,Ol(s,this.renderedPixelRatio_),null)}e(f_(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,i,s){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(m,_,x){const v=it(m),w=h[v];if(w){if(w!==!0&&x<w.distanceSq){if(x===0)return h[v]=!0,s.splice(s.lastIndexOf(w),1),i(m,l,_);w.geometry=_,w.distanceSq=x}}else{if(x===0)return h[v]=!0,i(m,l,_);s.push(h[v]={feature:m,layer:l,geometry:_,distanceSq:x,callback:i})}};let u;const f=[this.replayGroup_],p=this.getLayer().getDeclutter();return f.some(m=>u=m.forEachFeatureAtCoordinate(t,o,a,n,c,p&&e.declutter[p]?e.declutter[p].all().map(_=>_.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const i=t.viewHints[ee.ANIMATING],s=t.viewHints[ee.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&i||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,f=t.pixelRatio,p=e.getRevision(),m=e.getRenderBuffer();let _=e.getRenderOrder();_===void 0&&(_=qR);const x=h.center.slice(),v=Mr(l,m*u),w=v.slice(),S=[v.slice()],E=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!We(E,t.extent)){const g=yt(E),y=Math.max(yt(v)/2,g);v[0]=E[0]-y,v[2]=E[2]+y,Im(x,c);const b=Pu(S[0],c);b[0]<E[0]&&b[2]<E[2]?S.push([b[0]+g,b[1],b[2]+g,b[3]]):b[0]>E[0]&&b[2]>E[2]&&S.push([b[0]-g,b[1],b[2]-g,b[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==p&&this.renderedRenderOrder_==_&&We(this.wrappedRenderedExtent_,v))return ji(this.renderedExtent_,w)||(this.hitDetectionImageData_=null,this.renderedExtent_=w),this.renderedCenter_=x,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const T=new l_(p_(u,f),v,u,f);let R;for(let g=0,y=S.length;g<y;++g)n.loadFeatures(S[g],u,c);const C=Ol(u,f);let I=!0;const F=(g,y)=>{let b;const M=g.getStyleFunction()||e.getStyleFunction();if(M&&(b=M(g,u)),b){const P=this.renderFeature(g,C,b,T,R,this.getLayer().getDeclutter(),y);I=I&&!P}},U=nh(v),j=n.getFeaturesInExtent(U);_&&j.sort(_);for(let g=0,y=j.length;g<y;++g)F(j[g],g);this.renderedFeatures_=j,this.ready=I;const B=T.finish(),d=new c_(v,u,f,n.getOverlaps(),B,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=p,this.renderedRenderOrder_=_,this.renderedExtent_=w,this.wrappedRenderedExtent_=v,this.renderedCenter_=x,this.renderedProjection_=c,this.renderedPixelRatio_=f,this.replayGroup_=d,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,i,s,o,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,c=n.length;h<c;++h)l=Fl(i,t,n[h],e,this.boundHandleStyleImageChange_,s,o,a)||l;else l=Fl(i,t,n,e,this.boundHandleStyleImageChange_,s,o,a);return l}}class Id extends Ta{constructor(t){super(t)}createRenderer(){return new __(this)}}class up{constructor(t){this.rbush_=new Sd(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[it(e)]=n}load(t,e){const n=new Array(e.length);for(let i=0,s=e.length;i<s;i++){const o=t[i],a=e[i],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[i]=l,this.items_[it(a)]=l}this.rbush_.load(n)}remove(t){const e=it(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[it(e)],i=[n.minX,n.minY,n.maxX,n.maxY];An(i,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let i=0,s=t.length;i<s;i++)if(n=e(t[i]),n)return n;return n}isEmpty(){return Pn(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return jr(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class tC extends zi{constructor(t){super(),this.projection=tt(t.projection),this.attributions_=dp(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,i){e.viewResolver=n,e.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=dp(t),this.changed()}setState(t){this.state_=t,this.changed()}}function dp(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}const Qs=tC,Ne={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function eC(r,t){return[[-1/0,-1/0,1/0,1/0]]}let rC=!1;function y_(r,t,e,n,i,s,o){const a=new XMLHttpRequest;a.open("GET",typeof r=="function"?r(e,n,i):r,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=rC,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let c;h=="json"?c=JSON.parse(a.responseText):h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?s(t.readFeatures(c,{extent:e,featureProjection:i}),t.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function fp(r,t){return function(e,n,i,s,o){const a=this;y_(r,t,e,n,i,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||zo)}}class Vn extends cn{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class Eh extends Qs{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=zo,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(At(this.format_,"`format` must be set when `url` is set"),this.loader_=fp(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:eC;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new up:null,this.loadedExtentsRtree_=new up,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,i;Array.isArray(t.features)?i=t.features:t.features&&(n=t.features,i=n.getArray()),!e&&n===void 0&&(n=new Cl(i)),i!==void 0&&this.addFeaturesInternal(i),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=it(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Vn(Ne.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof ke||(this.featureChangeKeys_[t]=[le(e,Lt.CHANGE,this.handleFeatureChange_,this),le(e,wu.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const i=String(e.getId());if(!(i in this.idIndex_))this.idIndex_[i]=e;else if(e instanceof ke){const s=this.idIndex_[i];s instanceof ke?Array.isArray(s)?s.push(e):this.idIndex_[i]=[s,e]:n=!1}else n=!1}return n&&(At(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],i=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],l=it(a);this.addToIndex_(l,a)&&n.push(a)}for(let s=0,o=n.length;s<o;s++){const a=n[s],l=it(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,i),this.hasListener(Ne.ADDFEATURE))for(let s=0,o=n.length;s<o;s++)this.dispatchEvent(new Vn(Ne.ADDFEATURE,n[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Ne.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(Ne.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(ti.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(ti.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(ve);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=i=>{this.removeFeatureInternal(i)};this.featuresRtree_.forEach(n);for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Vn(Ne.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(i){const s=i.getGeometry();if(s instanceof ke||s.intersectsCoordinate(t))return e(i)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const i=n.getGeometry();if(i instanceof ke||i.intersectsExtent(t)){const s=e(n);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Pn(this.nullGeometryFeatures_)||Ot(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=vx(t,e);return[].concat(...n.map(i=>this.featuresRtree_.getInExtent(i)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],i=t[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||ox,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=a;if(a=c instanceof ke?0:c.closestPointXY(n,i,o,a),a<u){s=h;const f=Math.sqrt(a);l[0]=n-f,l[1]=i-f,l[2]=n+f,l[3]=i+f}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=it(e),i=e.getGeometry();if(!i)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const o=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const s=e.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Vn(Ne.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:it(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Pn(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const i=this.loadedExtentsRtree_,s=this.strategy_(t,e,n);for(let o=0,a=s.length;o<a;++o){const l=s[o];i.forEachInExtent(l,function(h){return We(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Vn(Ne.FEATURESLOADSTART)),this.loader_.call(this,l,e,n,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vn(Ne.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vn(Ne.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let n;e.forEachInExtent(t,function(i){if(An(i.extent,t))return n=i,!0}),n&&e.remove(n)}removeFeatures(t){const e=[];for(let n=0,i=t.length;n<i;++n){const s=t[n],o=this.removeFeatureInternal(s);o&&e.push(o)}e.length>0&&this.changed()}removeFeature(t){t&&this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=it(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const n=this.featureChangeKeys_[e];if(!n)return;n.forEach(ve),delete this.featureChangeKeys_[e];const i=t.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[e],this.hasListener(Ne.REMOVEFEATURE)&&this.dispatchEvent(new Vn(Ne.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const n in this.idIndex_){const i=this.idIndex_[n];if(t instanceof ke&&Array.isArray(i)&&i.includes(t))i.splice(i.indexOf(t),1);else if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){At(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(fp(t,this.format_))}}function nC(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=r.inversePixelTransform[0],e=r.inversePixelTransform[1],n=Math.sqrt(t*t+e*e),i=r.frameState,s=qs(r.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=Ol(i.viewState.resolution,n);let a;return new u_(r.context,n,i.extent,s,i.viewState.rotation,o,a)}function x_(r,t,e){const n=[];let i=r(0),s=r(1),o=t(i),a=t(s);const l=[s,i],h=[a,o],c=[1,0],u={};let f=1e5,p,m,_,x,v,w;for(;--f>0&&c.length>0;)_=c.pop(),i=l.pop(),o=h.pop(),w=_.toString(),w in u||(n.push(o[0],o[1]),u[w]=!0),x=c.pop(),s=l.pop(),a=h.pop(),v=(_+x)/2,p=r(v),m=t(p),Rm(m[0],m[1],o[0],o[1],a[0],a[1])<e?(n.push(a[0],a[1]),w=x.toString(),u[w]=!0):(c.push(x,v,v,_),h.push(a,m,m,o),l.push(s,p,p,i));return n}function iC(r,t,e,n,i){const s=tt("EPSG:4326");return x_(function(o){return[r,t+(e-t)*o]},on(s,n),i)}function sC(r,t,e,n,i){const s=tt("EPSG:4326");return x_(function(o){return[t+(e-t)*o,r]},on(s,n),i)}const oC=new an({color:"rgba(0,0,0,0.2)"}),aC=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class lC extends Id{constructor(t){t=t||{};const e=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},t);delete e.maxLines,delete e.strokeStyle,delete e.targetSize,delete e.showLabels,delete e.lonLabelFormatter,delete e.latLabelFormatter,delete e.lonLabelPosition,delete e.latLabelPosition,delete e.lonLabelStyle,delete e.latLabelStyle,delete e.intervals,super(e),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=t.targetSize!==void 0?t.targetSize:100,this.maxLines_=t.maxLines!==void 0?t.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=t.strokeStyle!==void 0?t.strokeStyle:oC,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,t.showLabels&&(this.lonLabelFormatter_=t.lonLabelFormatter==null?Hf.bind(this,"EW"):t.lonLabelFormatter,this.latLabelFormatter_=t.latLabelFormatter==null?Hf.bind(this,"NS"):t.latLabelFormatter,this.lonLabelPosition_=t.lonLabelPosition==null?0:t.lonLabelPosition,this.latLabelPosition_=t.latLabelPosition==null?1:t.latLabelPosition,this.lonLabelStyleBase_=new $e({text:t.lonLabelStyle!==void 0?t.lonLabelStyle.clone():new Fi({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Ur({color:"rgba(0,0,0,1)"}),stroke:new an({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=n=>{const i=n.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new $e({text:t.latLabelStyle!==void 0?t.latLabelStyle.clone():new Fi({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Ur({color:"rgba(0,0,0,1)"}),stroke:new an({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=n=>{const i=n.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(rr.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=t.intervals!==void 0?t.intervals:aC,this.setSource(new Eh({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Cl,overlaps:!1,useSpatialIndex:!1,wrapX:t.wrapX})),this.featurePool_=[],this.lineStyle_=new $e({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(t,e){let n=t.slice();return this.projection_&&this.getSource().getWrapX()&&Pu(n,this.projection_),this.loadedExtent_&&(px(this.loadedExtent_,n,e)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(t,e,n){this.loadedExtent_=t;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=we(s,t);if(this.renderedExtent_&&An(this.renderedExtent_,o)&&this.renderedResolution_===e||(this.renderedExtent_=o,this.renderedResolution_=e,kn(o)))return;const a=Re(o),l=e*e/4;(!this.projection_||!Pe(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(o,a,e,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let c;for(;h>this.featurePool_.length;)c=new Se,this.featurePool_.push(c);const u=i.getFeaturesCollection();u.clear();let f=0,p,m;for(p=0,m=this.meridians_.length;p<m;++p)c=this.featurePool_[f++],c.setGeometry(this.meridians_[p]),c.setStyle(this.lineStyle_),u.push(c);for(p=0,m=this.parallels_.length;p<m;++p)c=this.featurePool_[f++],c.setGeometry(this.parallels_[p]),c.setStyle(this.lineStyle_),u.push(c)}addMeridian_(t,e,n,i,s,o){const a=this.getMeridian_(t,e,n,i,o);if(Qt(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(t);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new Me([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(t,e,n,i,s,o){const a=this.getParallel_(t,e,n,i,o);if(Qt(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(t);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new Me([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(t){const e=t.frameState.viewState.rotation,n=t.frameState.viewState.resolution,i=t.frameState.size,s=t.frameState.extent,o=Re(s);let a=s;if(e){const m=i[0]*n,_=i[1]*n;a=[o[0]-m/2,o[1]-_/2,o[0]+m/2,o[1]+_/2]}let l=0,h=0,c=this.latLabelPosition_<.5;const u=this.projection_.getExtent(),f=yt(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!We(u,s)){l=Math.floor((s[0]-u[0])/f),h=Math.ceil((s[2]-u[2])/f);const m=Math.abs(e)>Math.PI/2;c=c!==m}const p=nC(t);for(let m=l;m<=h;++m){let _=this.meridians_.length+this.parallels_.length,x,v,w,S;if(this.meridiansLabels_)for(v=0,w=this.meridiansLabels_.length;v<w;++v){const E=this.meridians_[v];if(!e&&m===0)S=this.getMeridianPoint_(E,s,v);else{const T=E.clone();T.translate(m*f,0),T.rotate(-e,o),S=this.getMeridianPoint_(T,a,v),S.rotate(e,o)}x=this.featurePool_[_++],x.setGeometry(S),x.set("graticule_label",this.meridiansLabels_[v].text),p.drawFeature(x,this.lonLabelStyle_(x))}if(this.parallelsLabels_&&(m===l&&c||m===h&&!c))for(v=0,w=this.parallels_.length;v<w;++v){const E=this.parallels_[v];if(!e&&m===0)S=this.getParallelPoint_(E,s,v);else{const T=E.clone();T.translate(m*f,0),T.rotate(-e,o),S=this.getParallelPoint_(T,a,v),S.rotate(e,o)}x=this.featurePool_[_++],x.setGeometry(S),x.set("graticule_label",this.parallelsLabels_[v].text),p.drawFeature(x,this.latLabelStyle_(x))}}}createGraticule_(t,e,n,i){const s=this.getInterval_(n);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=yt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!We(a,t)&&(yt(t)>=l?(t[0]=a[0],t[2]=a[2]):o=!0);const h=[wt(e[0],this.minX_,this.maxX_),wt(e[1],this.minY_,this.maxY_)],c=this.toLonLatTransform_(h);isNaN(c[1])&&(c[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let u=wt(c[0],this.minLon_,this.maxLon_),f=wt(c[1],this.minLat_,this.maxLat_);const p=this.maxLines_;let m,_,x,v,w=t;o||(w=[wt(t[0],this.minX_,this.maxX_),wt(t[1],this.minY_,this.maxY_),wt(t[2],this.minX_,this.maxX_),wt(t[3],this.minY_,this.maxY_)]);const S=Ps(w,this.toLonLatTransform_,void 0,8);let E=S[3],T=S[2],R=S[1],C=S[0];if(o||(mr(w,this.bottomLeft_)&&(C=this.minLon_,R=this.minLat_),mr(w,this.bottomRight_)&&(T=this.maxLon_,R=this.minLat_),mr(w,this.topLeft_)&&(C=this.minLon_,E=this.maxLat_),mr(w,this.topRight_)&&(T=this.maxLon_,E=this.maxLat_),E=wt(E,f,this.maxLat_),T=wt(T,u,this.maxLon_),R=wt(R,this.minLat_,f),C=wt(C,this.minLon_,u)),u=Math.floor(u/s)*s,v=wt(u,this.minLon_,this.maxLon_),_=this.addMeridian_(v,R,E,i,t,0),m=0,o)for(;(v-=s)>=C&&m++<p;)_=this.addMeridian_(v,R,E,i,t,_);else for(;v!=this.minLon_&&m++<p;)v=Math.max(v-s,this.minLon_),_=this.addMeridian_(v,R,E,i,t,_);if(v=wt(u,this.minLon_,this.maxLon_),m=0,o)for(;(v+=s)<=T&&m++<p;)_=this.addMeridian_(v,R,E,i,t,_);else for(;v!=this.maxLon_&&m++<p;)v=Math.min(v+s,this.maxLon_),_=this.addMeridian_(v,R,E,i,t,_);for(this.meridians_.length=_,this.meridiansLabels_&&(this.meridiansLabels_.length=_),f=Math.floor(f/s)*s,x=wt(f,this.minLat_,this.maxLat_),_=this.addParallel_(x,C,T,i,t,0),m=0;x!=this.minLat_&&m++<p;)x=Math.max(x-s,this.minLat_),_=this.addParallel_(x,C,T,i,t,_);for(x=wt(f,this.minLat_,this.maxLat_),m=0;x!=this.maxLat_&&m++<p;)x=Math.min(x+s,this.maxLat_),_=this.addParallel_(x,C,T,i,t,_);this.parallels_.length=_,this.parallelsLabels_&&(this.parallelsLabels_.length=_)}getInterval_(t){const e=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*t,2),o=[],a=[];for(let l=0,h=this.intervals_.length;l<h;++l){const c=wt(this.intervals_[l]/2,0,90),u=wt(n,-90+c,90-c);if(o[0]=e-c,o[1]=u-c,a[0]=e+c,a[1]=u+c,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(t,e,n,i,s){const o=iC(t,e,n,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new ye(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(t,e,n){const i=t.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(e[1],i[s]),l=Math.min(e[3],i[o]),h=wt(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,a,l),c=[i[s-1]+(i[o-1]-i[s-1])*(h-i[s])/(i[o]-i[s]),h],u=this.meridiansLabels_[n].geom;return u.setCoordinates(c),u}getMeridians(){return this.meridians_}getParallel_(t,e,n,i,s){const o=sC(t,e,n,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new ye(o,"XY"),a}getParallelPoint_(t,e,n){const i=t.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(e[0],i[s]),l=Math.min(e[2],i[o]),h=wt(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,a,l),c=i[s+1]+(i[o+1]-i[s+1])*(h-i[s])/(i[o]-i[s]),u=[h,c],f=this.parallelsLabels_[n].geom;return f.setCoordinates(u),f}getParallels(){return this.parallels_}updateProjectionInfo_(t){const e=tt("EPSG:4326"),n=t.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];const i=on(t,e);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,h){h=h||2;const c=i(a,l,h);for(let u=0,f=c.length;u<f;u+=h)c[u]<o&&(c[u]+=360);return c}}this.fromLonLatTransform_=on(e,t);const s=Ps([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Re(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t}}const hC=lC;class Qi extends cn{constructor(t,e){super(t),this.layer=e}}const uc={LAYERS:"layers"};class Th extends H0{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(uc.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Cl(n.slice(),{unique:!0}):At(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Cl(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ve),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(le(t,ti.ADD,this.handleLayersAdd_,this),le(t,ti.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(ve);Xs(this.listenerKeys_);const e=t.getArray();for(let n=0,i=e.length;n<i;n++){const s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new Qi("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[le(t,wu.PROPERTYCHANGE,this.handleLayerChange_,this),le(t,Lt.CHANGE,this.handleLayerChange_,this)];t instanceof Th&&e.push(le(t,"addlayer",this.handleLayerGroupAdd_,this),le(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[it(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Qi("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Qi("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Qi("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=it(e);this.listenerKeys_[n].forEach(ve),delete this.listenerKeys_[n],this.dispatchEvent(new Qi("removelayer",e)),this.changed()}getLayers(){return this.get(uc.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let i=0,s=n.length;i<s;++i)this.dispatchEvent(new Qi("removelayer",n[i]))}this.set(uc.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const i=this.getLayerState();let s=i.zIndex;!t&&i.zIndex===void 0&&(s=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=we(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}const Mh=34962,Rh=34963,cC=35040,Pd=35044,ru=35048,uC=5121,dC=5123,fC=5125,v_=5126,gp=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function gC(r,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!ib},t);const e=gp.length;for(let n=0;n<e;++n)try{const i=r.getContext(gp[n],t);if(i)return i}catch{}return null}const pC={STATIC_DRAW:Pd,STREAM_DRAW:cC,DYNAMIC_DRAW:ru};class Nl{constructor(t,e){this.array_=null,this.type_=t,At(t===Mh||t===Rh,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:pC.STATIC_DRAW}ofSize(t){return this.array_=new(dc(this.type_))(t),this}fromArray(t){return this.array_=dc(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(dc(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function dc(r){switch(r){case Mh:return Float32Array;case Rh:return Uint32Array;default:return Float32Array}}const Ja={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},mC=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,_C=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class pp{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||mC),e.compileShader(n);const i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,t.fragmentShader||_C),e.compileShader(i),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,i),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:e.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=e.RGBA,o=0,a=e.RGBA,l=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,i,s,n[0],n[1],o,a,l,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n[0],n[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,n,i){const s=this.getGL(),o=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const l=it(s.canvas);if(!t.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(s,t),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${i}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(s.location,n[0],n[1]);return;case 3:e.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(s.location,n)})}}function w_(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function b_(r,t){return r[0]=t[0],r[1]=t[1],r[4]=t[2],r[5]=t[3],r[12]=t[4],r[13]=t[5],r}const vn={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Kr={UNSIGNED_BYTE:uC,UNSIGNED_SHORT:dC,UNSIGNED_INT:fC,FLOAT:v_},Dl={};function mp(r){return"shared/"+r}let _p=0;function yC(){const r="unique/"+_p;return _p+=1,r}function xC(r){let t=Dl[r];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:gC(e)},Dl[r]=t}return t.users+=1,t.context}function vC(r){const t=Dl[r];if(!t||(t.users-=1,t.users>0))return;const e=t.context,n=e.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=e.canvas;i.width=1,i.height=1,delete Dl[r]}class wC extends bu{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?mp(t.canvasCacheKey):yC(),this.gl_=xC(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(Ja.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(Ja.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=pe(),this.offsetScaleMatrix_=pe(),this.tmpMat4_=w_(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new pp({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new pp({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===mp(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=it(t);let i=this.bufferCache_[n];if(!i){const s=e.createBuffer();i={buffer:t,webGlBuffer:s},this.bufferCache_[n]=i}e.bindBuffer(t.getType(),i.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,n=it(t),i=this.bufferCache_[n];i&&!e.isContextLost()&&e.deleteBuffer(i.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(Ja.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(Ja.RESTORED,this.boundHandleWebGLContextRestored_),vC(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,n){const i=this.gl_,s=this.getCanvas(),o=t.size,a=t.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,e?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindTexture(t,e,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(this.getUniformLocation(n),e)}prepareDrawToRenderTarget(t,e,n,i){const s=this.gl_,o=e.getSize();s.bindFramebuffer(s.FRAMEBUFFER,e.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,e.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,e.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=e-t,a=t*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(t,e,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(t,null,e,n):this.postProcessPasses_[i].apply(t,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,i=t.pixelRatio;this.setUniformFloatValue(vn.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(vn.ZOOM,t.viewState.zoom),this.setUniformFloatValue(vn.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(vn.PIXEL_RATIO,i),this.setUniformFloatVec2(vn.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(vn.ROTATION,n)}applyHitDetectionUniform(t){const e=this.getUniformLocation(vn.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(vn.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=n):s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),this.bindTexture(s.texture,i,s.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&s.prevValue!==n&&(s.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,b_(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const n=this.gl_,i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}getProgram(t,e){const n=this.gl_,i=this.compileShader(t,n.FRAGMENT_SHADER),s=this.compileShader(e,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const e=it(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=it(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,i=t.viewState.rotation,s=t.viewState.resolution,o=t.viewState.center;return or(e,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,n,i,s){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,e,n,!1,i,s))}enableAttributes(t){const e=bC(t);let n=0;for(let i=0;i<t.length;i++){const s=t[i];this.enableAttributeArray_(s.name,s.size,s.type||v_,e,n),n+=s.size*S_(s.type)}}handleWebGLContextLost(t){Xs(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,n){const i=this.gl_;n=n||i.createTexture();const s=0,o=i.RGBA,a=0,l=i.RGBA,h=i.UNSIGNED_BYTE;return i.bindTexture(i.TEXTURE_2D,n),e?i.texImage2D(i.TEXTURE_2D,s,o,l,h,e):i.texImage2D(i.TEXTURE_2D,s,o,t[0],t[1],a,l,h,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n}}function bC(r){let t=0;for(let e=0;e<r.length;e++){const n=r[e];t+=n.size*S_(n.type)}return t}function S_(r){switch(r){case Kr.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Kr.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Kr.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Kr.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Ch extends h_{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=pe(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(Ut.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(rr.PRECOMPOSE)){const i=new al(rr.PRECOMPOSE,void 0,e,t);n.dispatchEvent(i)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(rr.POSTCOMPOSE)){const i=new al(rr.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(i)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,n=-1,i;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Ch)){e=!0;continue}const c=l.getClassName();if((e||c!==i)&&(n+=1,e=!1),i=c,h===this)break}const s="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new wC({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const i=this.getLayer();if(i.hasListener(t)){or(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new al(t,this.inversePixelTransform_,n,e);i.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(rr.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(rr.POSTRENDER,t,e)}}const Zr=new Uint8Array(4);class SC{constructor(t,e){this.helper_=t;const n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){ji(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return Zr[0]=0,Zr[1]=0,Zr[2]=0,Zr[3]=0,Zr;this.readAll();const n=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return Zr[0]=this.data_[n*4],Zr[1]=this.data_[n*4+1],Zr[2]=this.data_[n*4+2],Zr[3]=this.data_[n*4+3],Zr}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}}const yp={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var E_={exports:{}};E_.exports=Ih;E_.exports.default=Ih;function Ih(r,t,e){e=e||2;var n=t&&t.length,i=n?t[0]*e:r.length,s=T_(r,0,i,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,h,c,u,f,p;if(n&&(s=CC(r,t,s,e)),r.length>80*e){a=h=r[0],l=c=r[1];for(var m=e;m<i;m+=e)u=r[m],f=r[m+1],u<a&&(a=u),f<l&&(l=f),u>h&&(h=u),f>c&&(c=f);p=Math.max(h-a,c-l),p=p!==0?32767/p:0}return Jo(s,o,e,a,l,p,0),o}function T_(r,t,e,n,i){var s,o;if(i===su(r,t,e,n)>0)for(s=t;s<e;s+=n)o=xp(s,r[s],r[s+1],o);else for(s=e-n;s>=t;s-=n)o=xp(s,r[s],r[s+1],o);return o&&Ph(o,o.next)&&(ea(o),o=o.next),o}function Ni(r,t){if(!r)return r;t||(t=r);var e=r,n;do if(n=!1,!e.steiner&&(Ph(e,e.next)||he(e.prev,e,e.next)===0)){if(ea(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Jo(r,t,e,n,i,s,o){if(r){!o&&s&&OC(r,n,i,s);for(var a=r,l,h;r.prev!==r.next;){if(l=r.prev,h=r.next,s?TC(r,n,i,s):EC(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),ea(r),r=h.next,a=h.next;continue}if(r=h,r===a){o?o===1?(r=MC(Ni(r),t,e),Jo(r,t,e,n,i,s,2)):o===2&&RC(r,t,e,n,i,s):Jo(Ni(r),t,e,n,i,s,1);break}}}}function EC(r){var t=r.prev,e=r,n=r.next;if(he(t,e,n)>=0)return!1;for(var i=t.x,s=e.x,o=n.x,a=t.y,l=e.y,h=n.y,c=i<s?i<o?i:o:s<o?s:o,u=a<l?a<h?a:h:l<h?l:h,f=i>s?i>o?i:o:s>o?s:o,p=a>l?a>h?a:h:l>h?l:h,m=n.next;m!==t;){if(m.x>=c&&m.x<=f&&m.y>=u&&m.y<=p&&gs(i,a,s,l,o,h,m.x,m.y)&&he(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function TC(r,t,e,n){var i=r.prev,s=r,o=r.next;if(he(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,h=o.x,c=i.y,u=s.y,f=o.y,p=a<l?a<h?a:h:l<h?l:h,m=c<u?c<f?c:f:u<f?u:f,_=a>l?a>h?a:h:l>h?l:h,x=c>u?c>f?c:f:u>f?u:f,v=nu(p,m,t,e,n),w=nu(_,x,t,e,n),S=r.prevZ,E=r.nextZ;S&&S.z>=v&&E&&E.z<=w;){if(S.x>=p&&S.x<=_&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&gs(a,c,l,u,h,f,S.x,S.y)&&he(S.prev,S,S.next)>=0||(S=S.prevZ,E.x>=p&&E.x<=_&&E.y>=m&&E.y<=x&&E!==i&&E!==o&&gs(a,c,l,u,h,f,E.x,E.y)&&he(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;S&&S.z>=v;){if(S.x>=p&&S.x<=_&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&gs(a,c,l,u,h,f,S.x,S.y)&&he(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;E&&E.z<=w;){if(E.x>=p&&E.x<=_&&E.y>=m&&E.y<=x&&E!==i&&E!==o&&gs(a,c,l,u,h,f,E.x,E.y)&&he(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function MC(r,t,e){var n=r;do{var i=n.prev,s=n.next.next;!Ph(i,s)&&M_(i,n,n.next,s)&&ta(i,s)&&ta(s,i)&&(t.push(i.i/e|0),t.push(n.i/e|0),t.push(s.i/e|0),ea(n),ea(n.next),n=r=s),n=n.next}while(n!==r);return Ni(n)}function RC(r,t,e,n,i,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&DC(o,a)){var l=R_(o,a);o=Ni(o,o.next),l=Ni(l,l.next),Jo(o,t,e,n,i,s,0),Jo(l,t,e,n,i,s,0);return}a=a.next}o=o.next}while(o!==r)}function CC(r,t,e,n){var i=[],s,o,a,l,h;for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:r.length,h=T_(r,a,l,n,!1),h===h.next&&(h.steiner=!0),i.push(NC(h));for(i.sort(IC),s=0;s<i.length;s++)e=PC(i[s],e);return e}function IC(r,t){return r.x-t.x}function PC(r,t){var e=AC(r,t);if(!e)return t;var n=R_(e,r);return Ni(n,n.next),Ni(e,e.next)}function AC(r,t){var e=t,n=r.x,i=r.y,s=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var a=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=n&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===n))return o}e=e.next}while(e!==t);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,f;e=o;do n>=e.x&&e.x>=h&&n!==e.x&&gs(i<c?n:s,i,h,c,i<c?s:n,i,e.x,e.y)&&(f=Math.abs(i-e.y)/(n-e.x),ta(e,r)&&(f<u||f===u&&(e.x>o.x||e.x===o.x&&LC(o,e)))&&(o=e,u=f)),e=e.next;while(e!==l);return o}function LC(r,t){return he(r.prev,r,t.prev)<0&&he(t.next,r,r.next)<0}function OC(r,t,e,n){var i=r;do i.z===0&&(i.z=nu(i.x,i.y,t,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,FC(i)}function FC(r){var t,e,n,i,s,o,a,l,h=1;do{for(e=r,r=null,s=null,o=0;e;){for(o++,n=e,a=0,t=0;t<h&&(a++,n=n.nextZ,!!n);t++);for(l=h;a>0||l>0&&n;)a!==0&&(l===0||!n||e.z<=n.z)?(i=e,e=e.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;e=n}s.nextZ=null,h*=2}while(o>1);return r}function nu(r,t,e,n,i){return r=(r-e)*i|0,t=(t-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function NC(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function gs(r,t,e,n,i,s,o,a){return(i-o)*(t-a)>=(r-o)*(s-a)&&(r-o)*(n-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(i-o)*(n-a)}function DC(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!kC(r,t)&&(ta(r,t)&&ta(t,r)&&GC(r,t)&&(he(r.prev,r,t.prev)||he(r,t.prev,t))||Ph(r,t)&&he(r.prev,r,r.next)>0&&he(t.prev,t,t.next)>0)}function he(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Ph(r,t){return r.x===t.x&&r.y===t.y}function M_(r,t,e,n){var i=el(he(r,t,e)),s=el(he(r,t,n)),o=el(he(e,n,r)),a=el(he(e,n,t));return!!(i!==s&&o!==a||i===0&&tl(r,e,t)||s===0&&tl(r,n,t)||o===0&&tl(e,r,n)||a===0&&tl(e,t,n))}function tl(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function el(r){return r>0?1:r<0?-1:0}function kC(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&M_(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function ta(r,t){return he(r.prev,r,r.next)<0?he(r,t,r.next)>=0&&he(r,r.prev,t)>=0:he(r,t,r.prev)<0||he(r,r.next,t)<0}function GC(r,t){var e=r,n=!1,i=(r.x+t.x)/2,s=(r.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&i<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==r);return n}function R_(r,t){var e=new iu(r.i,r.x,r.y),n=new iu(t.i,t.x,t.y),i=r.next,s=t.prev;return r.next=t,t.prev=r,e.next=i,i.prev=e,n.next=e,e.prev=n,s.next=n,n.prev=s,n}function xp(r,t,e,n){var i=new iu(r,t,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function ea(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function iu(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ih.deviation=function(r,t,e,n){var i=t&&t.length,s=i?t[0]*e:r.length,o=Math.abs(su(r,0,s,e));if(i)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,c=a<l-1?t[a+1]*e:r.length;o-=Math.abs(su(r,h,c,e))}var u=0;for(a=0;a<n.length;a+=3){var f=n[a]*e,p=n[a+1]*e,m=n[a+2]*e;u+=Math.abs((r[f]-r[m])*(r[p+1]-r[f+1])-(r[f]-r[p])*(r[m+1]-r[f+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function su(r,t,e,n){for(var i=0,s=t,o=e-n;s<e;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i}Ih.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var o=0;o<t;o++)e.vertices.push(r[i][s][o]);i>0&&(n+=r[i-1].length,e.holes.push(n))}return e};const vp=.985;function jC(r,t){t=t||[];const e=256,n=e-1;return t[0]=Math.floor(r/e/e/e)/n,t[1]=Math.floor(r/e/e)%e/n,t[2]=Math.floor(r/e)%e/n,t[3]=r%e/n,t}function zC(r){let t=0;const e=256,n=e-1;return t+=Math.round(r[0]*e*e*e*n),t+=Math.round(r[1]*e*e*n),t+=Math.round(r[2]*e*n),t+=Math.round(r[3]*n),t}function UC(){const r='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}function BC(r,t){const e=r.viewState.projection,n=t.getSource().getWrapX()&&e.canWrapX(),i=e.getExtent(),s=r.extent,o=n?yt(i):null,a=n?Math.ceil((s[2]-i[2])/o)+1:1;return[n?Math.floor((s[0]-i[0])/o):0,a,o]}class C_ extends Ch{constructor(t,e){const n=e.uniforms||{},i=pe();n[vn.PROJECTION_MATRIX]=i,super(t,{uniforms:n,postProcesses:e.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Nl(Mh,ru),this.indicesBuffer_=new Nl(Rh,ru),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.program_,this.hitDetectionEnabled_=e.hitDetectionEnabled??!0;const s=e.attributes?e.attributes.map(function(a){return{name:"a_prop_"+a.name,size:1,type:Kr.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:Kr.FLOAT},{name:"a_index",size:1,type:Kr.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:Kr.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:Kr.FLOAT})),this.attributes.push(...s),this.customAttributes=e.attributes?e.attributes:[],this.previousExtent_=je(),this.currentTransform_=i,this.renderTransform_=pe(),this.invertRenderTransform_=pe(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=UC(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===yp.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,th(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[le(o,Ne.ADDFEATURE,this.handleSourceFeatureAdded_,this),le(o,Ne.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),le(o,Ne.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),le(o,Ne.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[it(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new SC(this.helper))}handleSourceFeatureAdded_(t){const e=t.feature;this.featureCache_[it(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){const e=t.feature;this.featureCache_[it(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}}handleSourceFeatureDelete_(t){const e=t.feature;delete this.featureCache_[it(e)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const[n,i,s]=BC(t,this.getLayer());return this.renderWorlds(t,!1,n,i,s),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),this.helper.getCanvas()}prepareFrameInternal(t){const e=this.getLayer(),n=e.getSource(),i=t.viewState,s=!t.viewHints[ee.ANIMATING]&&!t.viewHints[ee.INTERACTING],o=!An(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const l=i.projection,h=i.resolution,c=e instanceof Ta?e.getRenderBuffer():0,u=Mr(t.extent,c*h);n.loadFeatures(u,h,l),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){const e=pe();this.helper.makeProjectionTransform(t,e);const n=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,i=n*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==i)&&(this.renderInstructions_=new Float32Array(i));let s,o;const a=[],l=[];let h=-1;for(const u in this.featureCache_)if(s=this.featureCache_[u],o=s.geometry,!(!o||o.getType()!=="Point")){if(a[0]=o.getFlatCoordinates()[0],a[1]=o.getFlatCoordinates()[1],ae(e,a),this.renderInstructions_[++h]=a[0],this.renderInstructions_[++h]=a[1],this.hitDetectionEnabled_){const f=jC(h+5,l);this.renderInstructions_[++h]=f[0],this.renderInstructions_[++h]=f[1],this.renderInstructions_[++h]=f[2],this.renderInstructions_[++h]=f[3],this.renderInstructions_[++h]=Number(u)}for(let f=0;f<this.customAttributes.length;f++){const p=this.customAttributes[f].callback(s.feature,s.properties);this.renderInstructions_[++h]=p}}const c={id:++this.lastSentId,type:yp.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:n-2};c.projectionTransform=e,this.ready=!1,this.worker_.postMessage(c,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(t,e,n,i,s){if(At(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=ae(e.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],h=zC(l),c=this.renderInstructions_[h],u=Math.floor(c).toString(),f=this.getLayer().getSource().getFeatureByUid(u);if(f)return i(f,this.getLayer(),null)}renderWorlds(t,e,n,i,s){let o=n;this.helper.useProgram(this.program_,t),e&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),Eu(this.currentTransform_,o*s,0),qs(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.applyHitDetectionUniform(e);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){ve(t)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class XC{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}const Ad=.5,q={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Js extends ha{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(Lt.CHANGE)}release(){this.state===q.ERROR&&this.setState(q.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==q.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==q.LOADED){t.interimTile=null;break}t.getState()==q.LOADING?e=t:t.getState()==q.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==q.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ct()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const i=e-n+1e3/60;return i>=this.transition_?1:Q0(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}function kl(r){return r instanceof Image||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap?r:null}function ou(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Float32Array||r instanceof DataView?r:null}let Ji=null;function qC(r){Ji||(Ji=Jt(r.width,r.height,void 0,{willReadFrequently:!0}));const t=Ji.canvas,e=r.width;t.width!==e&&(t.width=e);const n=r.height;return t.height!==n&&(t.height=n),Ji.clearRect(0,0,e,n),Ji.drawImage(r,0,0),Ji.getImageData(0,0,e,n).data}const WC=[256,256];class Ld extends Js{constructor(t){const e=q.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null}getSize(){if(this.size_)return this.size_;const t=kl(this.data_);return t?[t.width,t.height]:WC}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=q.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=q.ERROR,t.changed()})}}const ZC=10,wp=.25;class Od{constructor(t,e,n,i,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=on(this.targetProj_,this.sourceProj_);this.transformInv_=function(w){const S=w[0]+"/"+w[1];return a[S]||(a[S]=l(w)),a[S]},this.maxSourceExtent_=i,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&yt(i)>=yt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?yt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?yt(this.targetProj_.getExtent()):null;const h=Dn(n),c=fa(n),u=eh(n),f=da(n),p=this.transformInv_(h),m=this.transformInv_(c),_=this.transformInv_(u),x=this.transformInv_(f),v=ZC+(o?Math.max(0,Math.ceil(Math.log2(Bo(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,f,p,m,_,x,v),this.wrapsXInSource_){let w=1/0;this.triangles_.forEach(function(S,E,T){w=Math.min(w,S.source[0][0],S.source[1][0],S.source[2][0])}),this.triangles_.forEach(S=>{if(Math.max(S.source[0][0],S.source[1][0],S.source[2][0])-w>this.sourceWorldWidth_/2){const E=[[S.source[0][0],S.source[0][1]],[S.source[1][0],S.source[1][1]],[S.source[2][0],S.source[2][1]]];E[0][0]-w>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-w>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-w>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);const T=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-T<this.sourceWorldWidth_/2&&(S.source=E)}})}a={}}addTriangle_(t,e,n,i,s,o){this.triangles_.push({source:[i,s,o],target:[t,e,n]})}addQuad_(t,e,n,i,s,o,a,l,h){const c=Is([s,o,a,l]),u=this.sourceWorldWidth_?yt(c)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&u>.5&&u<1;let m=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const x=Is([t,e,n,i]);m=yt(x)/this.targetWorldWidth_>wp||m}!p&&this.sourceProj_.isGlobal()&&u&&(m=u>wp||m)}if(!m&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Qt(c,this.maxSourceExtent_))return;let _=0;if(!m&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)m=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!m){const x=[(t[0]+n[0])/2,(t[1]+n[1])/2],v=this.transformInv_(x);let w;p?w=(nn(s[0],f)+nn(a[0],f))/2-nn(v[0],f):w=(s[0]+a[0])/2-v[0];const S=(s[1]+a[1])/2-v[1];m=w*w+S*S>this.errorThresholdSquared_}if(m){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const x=[(e[0]+n[0])/2,(e[1]+n[1])/2],v=this.transformInv_(x),w=[(i[0]+t[0])/2,(i[1]+t[1])/2],S=this.transformInv_(w);this.addQuad_(t,e,x,w,s,o,v,S,h-1),this.addQuad_(w,x,n,i,S,v,a,l,h-1)}else{const x=[(t[0]+e[0])/2,(t[1]+e[1])/2],v=this.transformInv_(x),w=[(n[0]+i[0])/2,(n[1]+i[1])/2],S=this.transformInv_(w);this.addQuad_(t,x,w,i,s,v,S,l,h-1),this.addQuad_(x,e,n,w,v,o,a,S,h-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,n,i,s,a,l),_&14||this.addTriangle_(t,n,e,s,a,o),_&&(_&13||this.addTriangle_(e,i,t,o,l,s),_&7||this.addTriangle_(e,i,n,o,l,a))}calculateSourceExtent(){const t=je();return this.triangles_.forEach(function(e,n,i){const s=e.source;Ro(t,s[0]),Ro(t,s[1]),Ro(t,s[2])}),t}getTriangles(){return this.triangles_}}let fc;const In=[];function bp(r,t,e,n,i){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(n,i),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,n)+1,Math.max(e,i)),r.restore()}function gc(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function $C(){if(fc===void 0){const r=Jt(6,6,In);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",bp(r,4,5,4,0),bp(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;fc=gc(t,0)||gc(t,4)||gc(t,8),Oi(r),In.push(r.canvas)}return fc}function ra(r,t,e,n){const i=rh(e,t,r);let s=Qf(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||mr(l,i)){const h=Qf(r,s,i)/s;isFinite(h)&&h>0&&(s/=h)}return s}function I_(r,t,e,n){const i=Re(e);let s=ra(r,t,i,n);return(!isFinite(s)||s<=0)&&Em(e,function(o){return s=ra(r,t,o,n),isFinite(s)&&s>0}),s}function Fd(r,t,e,n,i,s,o,a,l,h,c,u,f,p){const m=Jt(Math.round(e*r),Math.round(e*t),In);if(u||(m.imageSmoothingEnabled=!1),l.length===0)return m.canvas;m.scale(e,e);function _(T){return Math.round(T*e)/e}m.globalCompositeOperation="lighter";const x=je();l.forEach(function(T,R,C){bm(x,T.extent)});let v;const w=e/n,S=(u?1:1+Math.pow(2,-24))/w;if(!f||l.length!==1||h!==0){if(v=Jt(Math.round(yt(x)*w),Math.round(Vt(x)*w),In),u||(v.imageSmoothingEnabled=!1),i&&p){const T=(i[0]-x[0])*w,R=-(i[3]-x[3])*w,C=yt(i)*w,I=Vt(i)*w;v.rect(T,R,C,I),v.clip()}l.forEach(function(T,R,C){const I=(T.extent[0]-x[0])*w,F=-(T.extent[3]-x[3])*w,U=yt(T.extent)*w,j=Vt(T.extent)*w;T.image.width>0&&T.image.height>0&&v.drawImage(T.image,h,h,T.image.width-2*h,T.image.height-2*h,u?I:Math.round(I),u?F:Math.round(F),u?U:Math.round(I+U)-Math.round(I),u?j:Math.round(F+j)-Math.round(F))})}const E=Dn(o);return a.getTriangles().forEach(function(T,R,C){const I=T.source,F=T.target;let U=I[0][0],j=I[0][1],B=I[1][0],d=I[1][1],g=I[2][0],y=I[2][1];const b=_((F[0][0]-E[0])/s),M=_(-(F[0][1]-E[1])/s),P=_((F[1][0]-E[0])/s),A=_(-(F[1][1]-E[1])/s),L=_((F[2][0]-E[0])/s),D=_(-(F[2][1]-E[1])/s),X=U,K=j;U=0,j=0,B-=X,d-=K,g-=X,y-=K;const G=[[B,d,0,0,P-b],[g,y,0,0,L-b],[0,0,B,d,A-M],[0,0,g,y,D-M]],H=Px(G);if(!H)return;if(m.save(),m.beginPath(),$C()||!u){m.moveTo(P,A);const nt=4,xt=b-P,dt=M-A;for(let Tt=0;Tt<nt;Tt++)m.lineTo(P+_((Tt+1)*xt/nt),A+_(Tt*dt/(nt-1))),Tt!=nt-1&&m.lineTo(P+_((Tt+1)*xt/nt),A+_((Tt+1)*dt/(nt-1)));m.lineTo(L,D)}else m.moveTo(P,A),m.lineTo(b,M),m.lineTo(L,D);m.clip(),m.transform(H[0],H[2],H[1],H[3],b,M),m.translate(x[0]-X,x[3]-K);let Q;if(v)Q=v.canvas,m.scale(S,-S);else{const nt=l[0],xt=nt.extent;Q=nt.image,m.scale(yt(xt)/Q.width,-Vt(xt)/Q.height)}m.drawImage(Q,0,0),m.restore()}),v&&(Oi(v),In.push(v.canvas)),c&&(m.save(),m.globalCompositeOperation="source-over",m.strokeStyle="black",m.lineWidth=1,a.getTriangles().forEach(function(T,R,C){const I=T.target,F=(I[0][0]-E[0])/s,U=-(I[0][1]-E[1])/s,j=(I[1][0]-E[0])/s,B=-(I[1][1]-E[1])/s,d=(I[2][0]-E[0])/s,g=-(I[2][1]-E[1])/s;m.beginPath(),m.moveTo(j,B),m.lineTo(F,U),m.lineTo(d,g),m.closePath(),m.stroke()}),m.restore()),m.canvas}class Nd extends Ld{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let i=this.sourceTileGrid_.getExtent();const s=n?we(e,n):e;if(Bo(s)===0){this.state=q.EMPTY;return}const o=t.sourceProj,a=o.getExtent();a&&(i?i=we(i,a):i=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,c=I_(o,h,s,l);if(!isFinite(c)||c<=0){this.state=q.EMPTY;return}const u=t.errorThreshold!==void 0?t.errorThreshold:Ad;if(this.triangulation_=new Od(o,h,s,i,c*u,l),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let f=this.triangulation_.calculateSourceExtent();if(i&&(o.canWrapX()?(f[1]=wt(f[1],i[1],i[3]),f[3]=wt(f[3],i[1],i[3])):f=we(f,i)),!Bo(f))this.state=q.EMPTY;else{const p=this.sourceTileGrid_.getTileRangeForExtentAndZ(f,this.sourceZ_),m=t.getTileFunction;for(let _=p.minX;_<=p.maxX;_++)for(let x=p.minY;x<=p.maxY;x++){const v=m(this.sourceZ_,_,x,this.pixelRatio_);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{if(!e||e.getState()!==q.LOADED)return;const n=e.getSize(),i=this.gutter_;let s;const o=ou(e.getData());o?s=o:s=qC(kl(e.getData()));const a=[n[0]+2*i,n[1]+2*i],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),f=c.BYTES_PER_ELEMENT,p=f*u.length/h,m=u.byteLength/a[1],_=Math.floor(m/f/a[0]),x=h*_;let v=u;if(u.length!==x){v=new c(x);let w=0,S=0;const E=a[0]*_;for(let T=0;T<a[1];++T){for(let R=0;R<E;++R)v[w++]=u[S+R];S+=m/f}}t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),data:new Uint8Array(v.buffer),dataType:c,bytesPerPixel:p,pixelSize:a})}),this.sourceTiles_.length=0,t.length===0)this.state=q.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=t[0].bytesPerPixel,f=Math.ceil(u/3);for(let p=f-1;p>=0;--p){const m=[];for(let E=0,T=t.length;E<T;++E){const R=t[E],C=R.data,I=R.pixelSize,F=I[0],U=I[1],j=Jt(F,U,In),B=j.createImageData(F,U),d=B.data;let g=p*3;for(let y=0,b=d.length;y<b;y+=4)d[y]=C[g],d[y+1]=C[g+1],d[y+2]=C[g+2],d[y+3]=255,g+=u;j.putImageData(B,0,0),m.push({extent:R.extent,image:j.canvas})}const _=Fd(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,m,this.gutter_,!1,!1,!1,!0);for(let E=0,T=m.length;E<T;++E){const R=m[E].image.getContext("2d");Oi(R),In.push(R.canvas)}const x=_.getContext("2d"),v=x.getImageData(0,0,_.width,_.height);Oi(x),In.push(_),h||(c=new Uint8Array(u*v.width*v.height),h=new t[0].dataType(c.buffer));const w=v.data;let S=p*3;for(let E=0,T=w.length;E<T;E+=4)w[E+3]===255?(c[S]=w[E],c[S+1]=w[E+1],c[S+2]=w[E+2]):(c[S]=0,c[S+1]=0,c[S+2]=0),S+=u}this.reprojData_=h,this.reprojSize_=[Math.round(i*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=q.LOADED}this.changed()}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n!==q.IDLE&&n!==q.LOADING)return;t++;const i=le(e,Lt.CHANGE,function(){const s=e.getState();(s==q.LOADED||s==q.ERROR||s==q.EMPTY)&&(ve(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e){e.getState()==q.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(ve),this.sourcesListenerKeys_=null}}class ks extends Js{constructor(t,e,n,i,s,o,a,l,h,c,u,f){super(s,q.IDLE,f),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=i,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const p=i.getTileCoordExtent(this.wrappedTileCoord_),m=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const x=m?we(p,m):p;if(Bo(x)===0){this.state=q.EMPTY;return}const v=t.getExtent();v&&(_?_=we(_,v):_=v);const w=i.getResolution(this.wrappedTileCoord_[0]),S=I_(t,n,x,w);if(!isFinite(S)||S<=0){this.state=q.EMPTY;return}const E=c!==void 0?c:Ad;if(this.triangulation_=new Od(t,n,x,_,S*E,w),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=e.getZForResolution(S);let T=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(T[1]=wt(T[1],_[1],_[3]),T[3]=wt(T[3],_[1],_[3])):T=we(T,_)),!Bo(T))this.state=q.EMPTY;else{const R=e.getTileRangeForExtentAndZ(T,this.sourceZ_);for(let C=R.minX;C<=R.maxX;C++)for(let I=R.minY;I<=R.maxY;I++){const F=h(this.sourceZ_,C,I,a);F&&this.sourceTiles_.push(F)}this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==q.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=q.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Fd(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=q.LOADED}this.changed()}load(){if(this.state==q.IDLE){this.state=q.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n==q.IDLE||n==q.LOADING){t++;const i=le(e,Lt.CHANGE,function(s){const o=e.getState();(o==q.LOADED||o==q.ERROR||o==q.EMPTY)&&(ve(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,i){e.getState()==q.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ve),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Oi(this.canvas_.getContext("2d")),In.push(this.canvas_),this.canvas_=null),super.release()}}class Ra extends Js{constructor(t,e,n,i,s,o){super(t,e,o),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=q.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=q.ERROR,this.unlistenImage_(),this.image_=VC(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=q.LOADED:this.state=q.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==q.ERROR&&(this.state=q.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==q.IDLE&&(this.state=q.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=ob(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function VC(){const r=Jt(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}class YC extends ha{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===q.LOADED,this.loaded)this.uploadTile();else{if(t instanceof Ra){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(Lt.CHANGE,this.handleTileChange_)}}uploadTile(){ct()}setReady(){this.ready=!0,this.dispatchEvent(Lt.CHANGE)}handleTileChange_(){this.tile.getState()===q.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_)}}function P_(r,t,e){const n=e?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function HC(r,t,e,n){P_(r,t,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)}function Sp(r,t,e,n,i,s){const o=r.getGL();let a,l;e instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),P_(o,t,s&&l);const h=e.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(i){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,e),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let ls=null;function KC(){ls=Jt(1,1,void 0,{willReadFrequently:!0})}class QC extends YC{constructor(t){super(t),this.textures=[],this.renderSize_=ie(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new Nl(Mh,Pd);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),n=this.tile;this.textures.length=0;let i;n instanceof Ra||n instanceof ks?i=n.getImage():i=n.getData();const s=kl(i);if(s){const w=e.createTexture();this.textures.push(w),this.bandCount=4,HC(e,w,s,n.interpolate),this.setReady();return}i=ou(i);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=i instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,f=i.byteLength/a[1];this.bandCount=Math.floor(f/u/a[0]);const p=Math.ceil(this.bandCount/4);if(p===1){const w=e.createTexture();this.textures.push(w),Sp(t,w,i,a,this.bandCount,n.interpolate),this.setReady();return}const m=new Array(p);for(let w=0;w<p;++w){const S=e.createTexture();this.textures.push(S);const E=w<p-1?4:(this.bandCount-1)%4+1;m[w]=new c(h*E)}let _=0,x=0;const v=a[0]*this.bandCount;for(let w=0;w<a[1];++w){for(let S=0;S<v;++S){const E=i[x+S],T=Math.floor(_/this.bandCount),R=S%this.bandCount,C=Math.floor(R/4),I=m[C],F=I.length/h,U=R%4;I[T*F+U]=E,++_}x+=f/u}for(let w=0;w<p;++w){const S=this.textures[w],E=m[w],T=E.length/h;Sp(t,S,E,a,T,n.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,n){const i=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];ls||KC(),ls.clearRect(0,0,1,1);const a=t.width,l=t.height,h=a-2*i,c=l-2*i,u=i+Math.floor(h*(e/s)),f=i+Math.floor(c*(n/o));let p;try{ls.drawImage(t,u,f,1,1,0,0,1,1),p=ls.getImageData(0,0,1,1).data}catch{return ls=null,null}return p}getArrayPixelData_(t,e,n,i){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=e[0],h=e[1],c=l+2*s,u=h+2*s,f=s+Math.floor(l*(n/o)),p=s+Math.floor(h*(i/a));if(t instanceof DataView){const _=t.byteLength/(c*u),x=_*(p*c+f),v=t.buffer.slice(x,x+_);return new DataView(v)}const m=this.bandCount*(p*c+f);return t.slice(m,m+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof Ld){const n=this.tile.getData(),i=ou(n);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,t,e)}return this.getImagePixelData_(kl(n),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}class Dd{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return At(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return At(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){At(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}class Ah{constructor(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ts(r,t,e,n,i){return i!==void 0?(i.minX=r,i.maxX=t,i.minY=e,i.maxY=n,i):new Ah(r,t,e,n)}function na(r,t,e,n){return n!==void 0?(n[0]=r,n[1]=t,n[2]=e,n):[r,t,e]}function ln(r,t,e){return r+"/"+t+"/"+e}function Kn(r){return ln(r[0],r[1],r[2])}function JC(r){const[t,e,n]=r.substring(r.lastIndexOf("/")+1,r.length).split(",").map(Number);return ln(t,e,n)}function A_(r){return r.split("/").map(Number)}function kd(r){return(r[1]<<r[0])+r[2]}function tI(r,t){const e=r[0],n=r[1],i=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(n,i):!0}const eI={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},rI={};function Ep(r){return 1/(r+2)}function nI(){return{tileIds:new Set,representationsByZ:{}}}function Tp(r,t){return r.tileIds.has(it(t))}function Mp(r,t,e){const n=r.representationsByZ;e in n||(n[e]=new Set),n[e].add(t),r.tileIds.add(it(t.tile))}function pc(r,t){const e=r.layerStatesArray[r.layerIndex];e.extent&&(t=we(t,Nr(e.extent,r.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(r.viewState.projection).getExtent();i&&(t=we(t,i))}return t}function au(r,t){return`${r.getKey()},${Kn(t)}`}class iI extends Ch{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=pe(),this.tempMat4=w_(),this.tempTileRange_=new Ah(0,0,0,0),this.tempTileCoord_=na(0,0,0),this.tempSize_=[0,0];const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new Dd(n),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),n=t.getState(),i=e.getUseInterimTilesOnError();return n==q.LOADED||n==q.EMPTY||n==q.ERROR&&!i}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const e=this.getLayer().getRenderSource();return!e||kn(pc(t,t.extent))?!1:e.getState()==="ready"}createTileRepresentation(t){return ct()}enqueueTiles(t,e,n,i,s){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=it(l);u in t.wantedTiles||(t.wantedTiles[u]={});const f=t.wantedTiles[u],p=this.tileRepresentationCache,m=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),m?m.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let x=n;x>=_;--x){const v=h.getTileRangeForExtentAndZ(e,x,this.tempTileRange_),w=h.getResolution(x);for(let S=v.minX;S<=v.maxX;++S)for(let E=v.minY;E<=v.maxY;++E){const T=na(x,S,E,this.tempTileCoord_),R=au(l,T);let C,I;if(p.containsKey(R)&&(C=p.get(R),I=C.tile),(!C||C.tile.key!==l.getKey())&&(I=l.getTile(x,S,E,t.pixelRatio,o.projection)),Tp(i,I))continue;if(!C)C=this.createTileRepresentation({tile:I,grid:h,helper:this.helper,gutter:c}),p.set(R,C);else if(this.isDrawableTile_(I))C.setTile(I);else{const U=I.getInterimTile();C.setTile(U)}Mp(i,C,x);const F=I.getKey();f[F]=!0,I.getState()===q.IDLE&&(t.tileQueue.isKeyQueued(F)||t.tileQueue.enqueue([I,u,h.getTileCoordCenter(T),w]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,n,i,s,o,a,l,h,c,u){}renderTileMask(t,e,n,i){}drawTile_(t,e,n,i,s,o,a){if(!e.ready)return;const l=e.tile.tileCoord,h=Kn(l),c=h in o?o[h]:1,u=a.getResolution(n),f=ie(a.getTileSize(n),this.tempSize_),p=a.getOrigin(n),m=a.getTileCoordExtent(l),_=c<1?-1:Ep(n);c<1&&(t.animate=!0);const x=t.viewState,v=x.center[0],w=x.center[1],S=f[0]+2*i,E=f[1]+2*i,T=S/E,R=(v-p[0])/(f[0]*u),C=(p[1]-w)/(f[1]*u),I=x.resolution/u,F=l[1],U=l[2];Ac(this.tileTransform_),Mo(this.tileTransform_,2/(t.size[0]*I/S),-2/(t.size[1]*I/S)),ux(this.tileTransform_,x.rotation),Mo(this.tileTransform_,1,1/T),Eu(this.tileTransform_,(f[0]*(F-R)-i)/S,(f[1]*(U-C)-i)/E),this.renderTile(e,this.tileTransform_,t,s,u,f,p,m,_,i,c)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=pc(t,t.extent),h=o.getZForResolution(n.resolution,s.zDirection),c=nI(),u=i.getPreload();if(t.nextExtent){const T=o.getZForResolution(n.nextResolution,s.zDirection),R=pc(t,t.nextExtent);this.enqueueTiles(t,R,T,c,u)}this.enqueueTiles(t,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,c,u-1)},0);const f={},p=it(this),m=t.time;let _=!1;for(const T of c.representationsByZ[h]){const R=T.tile;if((R instanceof ks||R instanceof Nd)&&R.getState()===q.EMPTY)continue;const C=R.tileCoord;if(T.ready){const F=R.getAlpha(p,m);if(F===1){R.endTransition(p);continue}_=!0;const U=Kn(C);f[U]=F}if(this.renderComplete=!1,this.findAltTiles_(o,C,h+1,c))continue;const I=o.getMinZoom();for(let F=h-1;F>=I&&!this.findAltTiles_(o,C,F,c);--F);}const x=c.representationsByZ,v=Object.keys(x).map(Number).sort(nx);if(this.beforeTilesMaskRender(t))for(let T=0,R=v.length;T<R;++T){const C=v[T];for(const I of x[C]){const F=I.tile.tileCoord;if(Kn(F)in f)continue;const U=o.getTileCoordExtent(F);this.renderTileMask(I,C,U,Ep(C))}}this.beforeTilesRender(t,_);for(let T=0,R=v.length;T<R;++T){const C=v[T];for(const I of x[C]){const F=I.tile.tileCoord;Kn(F)in f||this.drawTile_(t,I,C,a,l,f,o)}}for(const T of x[h]){const R=T.tile.tileCoord;Kn(R)in f&&this.drawTile_(t,T,h,a,l,f,o)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const w=this.helper.getCanvas(),S=this.tileRepresentationCache;for(;S.canExpireCache();)S.pop().dispose();const E=function(T,R){s.updateCacheSize(.1,R.viewState.projection),s.expireCache(R.viewState.projection,rI)};return t.postRenderFunctions.push(E),this.postRender(e,t),w}findAltTiles_(t,e,n,i){const s=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=au(l,[n,h,c]);let f=!1;if(a.containsKey(u)){const p=a.get(u);p.ready&&!Tp(i,p.tile)&&(Mp(i,p,n),f=!0)}f||(o=!1)}return o}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const Et={...eI,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},ll={TEXTURE_COORD:"a_textureCoord"},sI=[{name:ll.TEXTURE_COORD,size:2,type:Kr.FLOAT}];class oI extends iI{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new Nl(Rh,Pd),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){super.reset(t),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(t){return new QC(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,n,i,s,o,a,l,h,c,u){const f=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(sI);let p=0;for(;p<t.textures.length;){const T=`${Et.TILE_TEXTURE_ARRAY}[${p}]`;this.helper.bindTexture(t.textures[p],p,T),++p}for(let T=0;T<this.paletteTextures_.length;++T){const R=this.paletteTextures_[T],C=R.getTexture(f);this.helper.bindTexture(C,p,R.name),++p}const m=n.viewState,_=o[0]+2*c,x=o[1]+2*c,v=t.tile.tileCoord,w=v[1],S=v[2];this.helper.setUniformMatrixValue(Et.TILE_TRANSFORM,b_(this.tempMat4,e)),this.helper.setUniformFloatValue(Et.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(Et.DEPTH,h);let E=i;c>0&&(E=l,we(E,i,E)),this.helper.setUniformFloatVec4(Et.RENDER_EXTENT,E),this.helper.setUniformFloatValue(Et.RESOLUTION,m.resolution),this.helper.setUniformFloatValue(Et.ZOOM,m.zoom),this.helper.setUniformFloatValue(Et.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(Et.TEXTURE_PIXEL_HEIGHT,x),this.helper.setUniformFloatValue(Et.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(Et.TEXTURE_ORIGIN_X,a[0]+w*o[0]*s-c*s),this.helper.setUniformFloatValue(Et.TEXTURE_ORIGIN_Y,a[1]-S*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=ae(e.pixelToCoordinateTransform,t.slice()),s=e.viewState,o=n.getExtent();if(o&&!mr(Nr(o,s.projection),i))return null;const a=n.getSources(Is([i]),s.resolution);let l,h,c;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(s.projection),h.getWrapX())break;const f=c.getExtent();if(!f||mr(f,i))break}if(l<0)return null;const u=this.tileRepresentationCache;for(let f=c.getZForResolution(s.resolution);f>=c.getMinZoom();--f){const p=c.getTileCoordForCoordAndZ(i,f),m=au(h,p);if(!u.containsKey(m))continue;const _=u.get(m),x=_.tile;if((x instanceof ks||x instanceof Nd)&&x.getState()===q.EMPTY)return null;if(!_.loaded)continue;const v=c.getOrigin(f),w=ie(c.getTileSize(f)),S=c.getResolution(f),E=(i[0]-v[0])/S-p[1]*w[0],T=(v[1]-i[1])/S-p[2]*w[1];return _.getPixelData(E,T)}return null}disposeInternal(){const t=this.helper;t&&(t.getGL().deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}function aI(r,t){return`operator_${r}_${Object.keys(t.functions).length}`}function Ii(r){const t=r.toString();return t.includes(".")?t:t+".0"}function Gd(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(Ii).join(", ")})`}function hl(r){const t=zr(r),e=t.length>3?t[3]:1;return Gd([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}const mc={};let lI=0;function Gl(r){return r in mc||(mc[r]=lI++),mc[r]}function Sn(r){return Ii(Gl(r))}function jd(r){return"u_var_"+r}function hI(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const _c="getBandValue",L_="u_paletteTextures";function cI(r,t,e,n){const i=Bt(r,e,t);if(Sa(i.type,qi))throw new Error("No matching type was found");if(!Dr(t,i.type)){const s=be(t),o=be(i.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return zd(i,t,n)}function kt(r){return(t,e,n)=>{const i=e.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=zd(e.args[o],n,t);return r(s,t)}}const uI={[z.Get]:(r,t)=>{const e=t.args[0].value;return e in r.properties||(r.properties[e]={name:e,type:t.type}),(r.inFragmentShader?"v_prop_":"a_prop_")+e},[z.GeometryType]:(r,t,e)=>{const n="geometryType";return n in r.properties||(r.properties[n]={name:n,type:xe,evaluator:i=>Td(i.getGeometry())}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[z.Var]:(r,t)=>{const e=t.args[0].value;return e in r.variables||(r.variables[e]={name:e,type:t.type}),jd(e)},[z.Resolution]:()=>"u_resolution",[z.Zoom]:()=>"u_zoom",[z.Time]:()=>"u_time",[z.Any]:kt(r=>`(${r.join(" || ")})`),[z.All]:kt(r=>`(${r.join(" && ")})`),[z.Not]:kt(([r])=>`(!${r})`),[z.Equal]:kt(([r,t])=>`(${r} == ${t})`),[z.NotEqual]:kt(([r,t])=>`(${r} != ${t})`),[z.GreaterThan]:kt(([r,t])=>`(${r} > ${t})`),[z.GreaterThanOrEqualTo]:kt(([r,t])=>`(${r} >= ${t})`),[z.LessThan]:kt(([r,t])=>`(${r} < ${t})`),[z.LessThanOrEqualTo]:kt(([r,t])=>`(${r} <= ${t})`),[z.Multiply]:kt(r=>`(${r.join(" * ")})`),[z.Divide]:kt(([r,t])=>`(${r} / ${t})`),[z.Add]:kt(r=>`(${r.join(" + ")})`),[z.Subtract]:kt(([r,t])=>`(${r} - ${t})`),[z.Clamp]:kt(([r,t,e])=>`clamp(${r}, ${t}, ${e})`),[z.Mod]:kt(([r,t])=>`mod(${r}, ${t})`),[z.Pow]:kt(([r,t])=>`pow(${r}, ${t})`),[z.Abs]:kt(([r])=>`abs(${r})`),[z.Floor]:kt(([r])=>`floor(${r})`),[z.Ceil]:kt(([r])=>`ceil(${r})`),[z.Round]:kt(([r])=>`floor(${r} + 0.5)`),[z.Sin]:kt(([r])=>`sin(${r})`),[z.Cos]:kt(([r])=>`cos(${r})`),[z.Atan]:kt(([r,t])=>t!==void 0?`atan(${r}, ${t})`:`atan(${r})`),[z.Sqrt]:kt(([r])=>`sqrt(${r})`),[z.Match]:kt(r=>{const t=r[0],e=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${t} == ${s} ? ${o} : ${n||e})`}return n}),[z.Between]:kt(([r,t,e])=>`(${r} >= ${t} && ${r} <= ${e})`),[z.Interpolate]:kt(([r,t,...e])=>{let n="";for(let i=0;i<e.length-2;i+=2){const s=e[i],o=n||e[i+1],a=e[i+2],l=e[i+3];let h;r===Ii(1)?h=`(${t} - ${s}) / (${a} - ${s})`:h=`(pow(${r}, (${t} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[z.Case]:kt(r=>{const t=r[r.length-1];let e=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];e=`(${i} ? ${s} : ${e||t})`}return e}),[z.In]:kt(([r,...t],e)=>{const n=aI("in",e),i=[];for(let s=0;s<t.length;s+=1)i.push(`  if (inputValue == ${t[s]}) { return true; }`);return e.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[z.Array]:kt(r=>`vec${r.length}(${r.join(", ")})`),[z.Color]:kt(r=>{if(r.length===1)return`vec4(vec3(${r[0]} / 255.0), 1.0)`;if(r.length===2)return`(${r[1]} * vec4(vec3(${r[0]} / 255.0), 1.0))`;const t=r.slice(0,3).map(e=>`${e} / 255.0`);return r.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${r[3]} * vec4(${t.join(", ")}, 1.0))`}),[z.Band]:kt(([r,t,e],n)=>{if(!(_c in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${Et.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[_c]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Et.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Et.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${_c}(${r}, ${t??"0.0"}, ${e??"0.0"})`}),[z.Palette]:(r,t)=>{const[e,...n]=t.args,i=n.length,s=new Uint8Array(i*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=zr(c),f=h*4;s[f]=u[0],s[f+1]=u[1],s[f+2]=u[2],s[f+3]=u[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${L_}[${r.paletteTextures.length}]`,a=new XC(o,s);r.paletteTextures.push(a);const l=zd(e,Y,r);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function zd(r,t,e){if(r instanceof e_){const n=uI[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(e,r,t)}if((r.type&Y)>0)return Ii(r.value);if((r.type&te)>0)return r.value.toString();if((r.type&xe)>0)return Sn(r.value.toString());if((r.type&Xt)>0)return hl(r.value);if((r.type&me)>0)return Gd(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${be(t)})`)}function dI(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const es=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,rs=dI();class O_{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Ii(rs["circle-radius"])} + ${Ii(rs["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=hl(rs["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Ii(rs["stroke-width"]),this.strokeColorExpression_=hl(rs["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Sn("round"),this.strokeJoinExpression_=Sn("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=hl(rs["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t){return this.attributes_.push(t),this}addVarying(t,e,n){return this.varyings_.push({name:t,type:e,expression:n}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){this.vertexShaderFunctions_.includes(t)||this.vertexShaderFunctions_.push(t)}addFragmentShaderFunction(t){this.fragmentShaderFunctions_.includes(t)||this.fragmentShaderFunctions_.push(t)}getSymbolVertexShader(){return this.hasSymbol_?`${es}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${es}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${es}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${vp} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${es}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${vp}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Sn("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Sn("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Sn("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Sn("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${es}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${es}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}}const Lr={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},fI=["#00f","#0ff","#0f0","#ff0","#f00"];class gI extends Ta{constructor(t){t=t||{};const e=Object.assign({},t);delete e.gradient,delete e.radius,delete e.blur,delete e.weight,super(e),this.gradient_=null,this.addChangeListener(Lr.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:fI),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);const n=t.weight?t.weight:"weight";typeof n=="string"?this.weightFunction_=function(i){return i.get(n)}:this.weightFunction_=n,this.setRenderOrder(null)}getBlur(){return this.get(Lr.BLUR)}getGradient(){return this.get(Lr.GRADIENT)}getRadius(){return this.get(Lr.RADIUS)}handleGradientChanged_(){this.gradient_=pI(this.getGradient())}setBlur(t){this.set(Lr.BLUR,t)}setGradient(t){this.set(Lr.GRADIENT,t)}setRadius(t){this.set(Lr.RADIUS,t)}createRenderer(){const t=new O_().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new C_(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const n=this.weightFunction_(e);return n!==void 0?wt(n,0,1):1}}],uniforms:{u_size:()=>(this.get(Lr.RADIUS)+this.get(Lr.BLUR))*2,u_blurSlope:()=>this.get(Lr.RADIUS)/Math.max(1,this.get(Lr.BLUR))},hitDetectionEnabled:!0,vertexShader:t.getSymbolVertexShader(),fragmentShader:t.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function pI(r){const t=Jt(1,256),e=t.createLinearGradient(0,0,1,256),n=1/(r.length-1);for(let i=0,s=r.length;i<s;++i)e.addColorStop(i*n,r[i]);return t.fillStyle=e,t.fillRect(0,0,1,256),t.canvas}const mI=gI;class _I extends ba{constructor(t){t=t||{},super(t)}}class F_ extends Cd{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,i=t.viewState,s=i.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=we(l,Nr(e.extent,i.projection))),!a[ee.ANIMATING]&&!a[ee.INTERACTING]&&!kn(l))if(o){const h=i.projection,c=o.getImage(l,s,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===et.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=ae(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!mr(s,i))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=yt(o),h=Math.floor(a.width*((i[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=Vt(o),u=Math.floor(a.height*((o[3]-i[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(t,e){const n=this.image_,i=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,f=u.center,p=u.resolution,m=c*o/(p*l),_=c*a/(p*l),x=t.extent,v=u.resolution,w=u.rotation,S=Math.round(yt(x)/v*c),E=Math.round(Vt(x)/v*c);or(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,w,-S/2,-E/2),th(this.inversePixelTransform,this.pixelTransform);const T=Tu(this.pixelTransform);this.useContainer(e,T,this.getBackground(t));const R=this.getRenderContext(t),C=this.context.canvas;C.width!=S||C.height!=E?(C.width=S,C.height=E):this.containerReused||R.clearRect(0,0,S,E);let I=!1,F=!0;if(h.extent){const g=Nr(h.extent,u.projection);F=Qt(g,t.extent),I=F&&!We(g,t.extent),I&&this.clipUnrotated(R,t,g)}const U=n.getImage(),j=or(this.tempTransform,S/2,E/2,m,_,0,l*(i[0]-f[0])/o,l*(f[1]-i[3])/a);this.renderedResolution=a*c/l;const B=U.width*j[0],d=U.height*j[3];if(this.getLayer().getSource().getInterpolate()||(R.imageSmoothingEnabled=!1),this.preRender(R,t),F&&B>=.5&&d>=.5){const g=j[4],y=j[5],b=h.opacity;b!==1&&(R.save(),R.globalAlpha=b),R.drawImage(U,0,0,+U.width,+U.height,g,y,B,d),b!==1&&R.restore()}return this.postRender(this.context,t),I&&R.restore(),R.imageSmoothingEnabled=!0,T!==C.style.transform&&(C.style.transform=T),this.container}}class Ud extends _I{constructor(t){super(t)}createRenderer(){return new F_(this)}getData(t){return super.getData(t)}}const ni={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class N_ extends ba{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(ni.PRELOAD)}setPreload(t){this.set(ni.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(ni.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(ni.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class D_ extends Cd{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=je(),this.tmpTileRange_=new Ah(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),i=e.getUseInterimTilesOnError();return n==q.LOADED||n==q.EMPTY||n==q.ERROR&&!i}getTile(t,e,n,i){const s=i.pixelRatio,o=i.viewState.projection,a=this.getLayer();let l=a.getSource().getTile(t,e,n,s,o);return l.getState()==q.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=ae(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!mr(s,i))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=n.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(e.pixelRatio);for(let f=c.getZForResolution(l.resolution);f>=c.getMinZoom();--f){const p=c.getTileCoordForCoordAndZ(i,f),m=h.getTile(f,p[1],p[2],o,a);if(!(m instanceof Ra||m instanceof ks)||m instanceof ks&&m.getState()===q.EMPTY)return null;if(m.getState()!==q.LOADED)continue;const _=c.getOrigin(f),x=ie(c.getTileSize(f)),v=c.getResolution(f),w=Math.floor(u*((i[0]-_[0])/v-p[1]*x[0])),S=Math.floor(u*((_[1]-i[1])/v-p[2]*x[1])),E=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(m.getImage(),w+E,S+E)}return null}loadedTileCallback(t,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,e,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],i=t.viewState,s=i.projection,o=i.resolution,a=i.center,l=i.rotation,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),f=u.getRevision(),p=u.getTileGridForProjection(s),m=p.getZForResolution(o,u.zDirection),_=p.getResolution(m);let x=t.extent;const v=t.viewState.resolution,w=u.getTilePixelRatio(h),S=Math.round(yt(x)/v*h),E=Math.round(Vt(x)/v*h),T=n.extent&&Nr(n.extent);T&&(x=we(x,Nr(n.extent)));const R=_*S/2/w,C=_*E/2/w,I=[a[0]-R,a[1]-C,a[0]+R,a[1]+C],F=p.getTileRangeForExtentAndZ(x,m),U={};U[m]={};const j=this.createLoadedTileFinder(u,s,U),B=this.tmpExtent,d=this.tmpTileRange_;this.newTiles_=!1;const g=l?Oc(i.center,v,l,t.size):void 0;for(let K=F.minX;K<=F.maxX;++K)for(let G=F.minY;G<=F.maxY;++G){if(l&&!p.tileCoordIntersectsViewport([m,K,G],g))continue;const H=this.getTile(m,K,G,t);if(this.isDrawableTile(H)){const xt=it(this);if(H.getState()==q.LOADED){U[m][H.tileCoord.toString()]=H;let dt=H.inTransition(xt);dt&&n.opacity!==1&&(H.endTransition(xt),dt=!1),!this.newTiles_&&(dt||!this.renderedTiles.includes(H))&&(this.newTiles_=!0)}if(H.getAlpha(xt,t.time)===1)continue}const Q=p.getTileCoordChildTileRange(H.tileCoord,d,B);let nt=!1;Q&&(nt=j(m+1,Q)),nt||p.forEachTileCoordParentTileRange(H.tileCoord,j,d,B)}const y=_/o*h/w;or(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-S/2,-E/2);const b=Tu(this.pixelTransform);this.useContainer(e,b,this.getBackground(t));const M=this.getRenderContext(t),P=this.context.canvas;th(this.inversePixelTransform,this.pixelTransform),or(this.tempTransform,S/2,E/2,y,y,0,-S/2,-E/2),P.width!=S||P.height!=E?(P.width=S,P.height=E):this.containerReused||M.clearRect(0,0,S,E),T&&this.clipUnrotated(M,t,T),u.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,t),this.renderedTiles.length=0;let A=Object.keys(U).map(Number);A.sort(rn);let L,D,X;n.opacity===1&&(!this.containerReused||u.getOpaque(t.viewState.projection))?A=A.reverse():(L=[],D=[]);for(let K=A.length-1;K>=0;--K){const G=A[K],H=u.getTilePixelSize(G,h,s),Q=p.getResolution(G)/_,nt=H[0]*Q*y,xt=H[1]*Q*y,dt=p.getTileCoordForCoordAndZ(Dn(I),G),Tt=p.getTileCoordExtent(dt),St=ae(this.tempTransform,[w*(Tt[0]-I[0])/_,w*(I[3]-Tt[3])/_]),Dt=w*u.getGutterForProjection(s),Yt=U[G];for(const ue in Yt){const Ht=Yt[ue],He=Ht.tileCoord,ka=dt[1]-He[1],Uh=Math.round(St[0]-(ka-1)*nt),Ga=dt[2]-He[2],ja=Math.round(St[1]-(Ga-1)*xt),ur=Math.round(St[0]-ka*nt),Ir=Math.round(St[1]-Ga*xt),qr=Uh-ur,Pr=ja-Ir,Zi=m===G,$i=Zi&&Ht.getAlpha(it(this),t.time)!==1;let Bn=!1;if(!$i)if(L){X=[ur,Ir,ur+qr,Ir,ur+qr,Ir+Pr,ur,Ir+Pr];for(let dn=0,Bh=L.length;dn<Bh;++dn)if(m!==G&&G<D[dn]){const Ue=L[dn];Qt([ur,Ir,ur+qr,Ir+Pr],[Ue[0],Ue[3],Ue[4],Ue[7]])&&(Bn||(M.save(),Bn=!0),M.beginPath(),M.moveTo(X[0],X[1]),M.lineTo(X[2],X[3]),M.lineTo(X[4],X[5]),M.lineTo(X[6],X[7]),M.moveTo(Ue[6],Ue[7]),M.lineTo(Ue[4],Ue[5]),M.lineTo(Ue[2],Ue[3]),M.lineTo(Ue[0],Ue[1]),M.clip())}L.push(X),D.push(G)}else M.clearRect(ur,Ir,qr,Pr);this.drawTileImage(Ht,t,ur,Ir,qr,Pr,Dt,Zi),L&&!$i?(Bn&&M.restore(),this.renderedTiles.unshift(Ht)):this.renderedTiles.push(Ht),this.updateUsedTiles(t.usedTiles,u,Ht)}}return this.renderedRevision=f,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!An(this.renderedExtent_,I),this.renderedExtent_=I,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(t,u,p,h,s,x,m,c.getPreload()),this.scheduleExpireCache(t,u),this.postRender(this.context,t),n.extent&&M.restore(),M.imageSmoothingEnabled=!0,b!==P.style.transform&&(P.style.transform=b),this.container}drawTileImage(t,e,n,i,s,o,a,l){const h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=it(this),f=e.layerStatesArray[e.layerIndex],p=f.opacity*(l?t.getAlpha(u,e.time):1),m=p!==c.globalAlpha;m&&(c.save(),c.globalAlpha=p),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,i,s,o),m&&c.restore(),p!==f.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=(function(i,s,o){const a=it(i);a in o.usedTiles&&i.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const i=it(e);i in t||(t[i]={}),t[i][n.getKey()]=!0}manageTilePyramid(t,e,n,i,s,o,a,l,h){const c=it(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],f=t.tileQueue,p=n.getMinZoom(),m=t.viewState.rotation,_=m?Oc(t.viewState.center,t.viewState.resolution,m,t.size):void 0;let x=0,v,w,S,E,T,R;for(R=p;R<=a;++R)for(w=n.getTileRangeForExtentAndZ(o,R,w),S=n.getResolution(R),E=w.minX;E<=w.maxX;++E)for(T=w.minY;T<=w.maxY;++T)m&&!n.tileCoordIntersectsViewport([R,E,T],_)||(a-R<=l?(++x,v=e.getTile(R,E,T,i,s),v.getState()==q.IDLE&&(u[v.getKey()]=!0,f.isKeyQueued(v.getKey())||f.enqueue([v,c,n.getTileCoordCenter(v.tileCoord),S])),h!==void 0&&h(v)):e.useTile(R,E,T,s));e.updateCacheSize(x,s)}}class jl extends N_{constructor(t){super(t)}createRenderer(){return new D_(this)}}class Bd extends ch{constructor(t,e,n,i,s){const o=s!==void 0?et.IDLE:et.LOADED;super(t,e,n,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=et.ERROR):this.state=et.LOADED,this.changed()}load(){this.state==et.IDLE&&(this.state=et.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}function zl(r){return Array.isArray(r)?Math.min(...r):r}class yI extends F_{constructor(t){super(t),this.vectorRenderer_=new __(t),this.layerImageRatio_=t.getImageRatio(),this.coordinateToVectorPixelTransform_=pe(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(t){if(!this.vectorRenderer_)return Promise.resolve([]);const e=ae(this.coordinateToVectorPixelTransform_,ae(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(t){const e=t.pixelRatio,n=t.viewState,i=n.resolution,s=t.viewHints,o=this.vectorRenderer_;let a=t.extent;this.layerImageRatio_!==1&&(a=a.slice(0),Tm(a,this.layerImageRatio_));const l=yt(a)/i,h=Vt(a)/i;if(!s[ee.ANIMATING]&&!s[ee.INTERACTING]&&!kn(a)){o.useContainer(null,null);const c=o.context,u=t.layerStatesArray[t.layerIndex],f=Object.assign({},u,{opacity:1}),p=Object.assign({},t,{extent:a,size:[l,h],viewState:Object.assign({},t.viewState,{rotation:0}),layerStatesArray:[f],layerIndex:0,declutter:null}),m=this.getLayer().getDeclutter();m&&(p.declutter={[m]:new Sd(9)});let _=!0;const x=new Bd(a,i,e,c.canvas,function(v){o.prepareFrame(p)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(p,null)&&(o.renderDeclutter(p),o.renderDeferred(p),_=!1),v())});x.addEventListener(Lt.CHANGE,()=>{if(x.getState()!==et.LOADED)return;this.image_=_?null:x;const v=x.getPixelRatio(),w=zl(x.getResolution())*e/v;this.renderedResolution=w,this.coordinateToVectorPixelTransform_=or(this.coordinateToVectorPixelTransform_,l/2,h/2,1/w,-1/w,0,-n.center[0],-n.center[1])}),x.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(t,e,n,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,n,i,s):super.forEachFeatureAtCoordinate(t,e,n,i,s)}}class xI extends Ta{constructor(t){t=t||{};const e=Object.assign({},t);delete e.imageRatio,super(e),this.imageRatio_=t.imageRatio!==void 0?t.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new yI(this)}}const vI=xI,wI={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Rp={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class bI extends D_{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=pe(),this.tileClipContexts_=null}prepareTile(t,e,n){let i;const s=t.getState();return(s===q.LOADED||s===q.ERROR)&&(this.updateExecutorGroup_(t,e,n),this.tileImageNeedsRender_(t)&&(i=!0)),i}getTile(t,e,n,i){const s=i.pixelRatio,o=i.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),c=h.getSource().getTile(t,e,n,s,l),u=i.viewHints,f=!(u[ee.ANIMATING]||u[ee.INTERACTING]);return(f||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,s,l)&&(f||Date.now()-i.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(c,i),super.getTile(t,e,n,i)}isDrawableTile(t){const e=this.getLayer();return super.isDrawableTile(t)&&(e.getRenderMode()==="vector"?it(e)in t.executorGroups:t.hasContext(e))}getTileImage(t){return t.getImage(this.getLayer())}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,n){var i;const s=this.getLayer(),o=s.getRevision(),a=s.getRenderOrder()||null,l=t.wantedResolution,h=t.getReplayState(s);if(!h.dirty&&h.renderedResolution===l&&h.renderedRevision==o&&h.renderedRenderOrder==a)return;const c=s.getSource(),u=!!s.getDeclutter(),f=c.getTileGrid(),p=c.getTileGridForProjection(n).getTileCoordExtent(t.wrappedTileCoord),m=c.getSourceTiles(e,n,t),_=it(s);delete t.hitDetectionImageData[_],t.executorGroups[_]=[],h.dirty=!1;for(let x=0,v=m.length;x<v;++x){const w=m[x];if(w.getState()!=q.LOADED)continue;const S=w.tileCoord,E=f.getTileCoordExtent(S),T=we(p,E),R=Mr(T,s.getRenderBuffer()*l,this.tmpExtent),C=An(E,T)?null:R,I=new l_(0,T,l,e),F=Ol(l,e),U=function(y,b){let M;const P=y.getStyleFunction()||s.getStyleFunction();if(P&&(M=P(y,l)),M){const A=this.renderFeature(y,F,M,I,u,b);h.dirty=h.dirty||A}},j=w.getFeatures();a&&a!==h.renderedRenderOrder&&j.sort(a);for(let y=0,b=j.length;y<b;++y){const M=j[y];(!C||Qt(C,M.getGeometry().getExtent()))&&U.call(this,M,y)}const B=I.finish(),d=s.getRenderMode()!=="vector"&&u&&m.length===1?null:T,g=new c_(d,l,e,c.getOverlaps(),B,s.getRenderBuffer(),!!((i=this.frameState)!=null&&i.declutter));t.executorGroups[_].push(g)}h.renderedRevision=o,h.renderedRenderOrder=a,h.renderedResolution=l}forEachFeatureAtCoordinate(t,e,n,i,s){const o=e.viewState.resolution,a=e.viewState.rotation;n=n??0;const l=this.getLayer(),h=l.getSource().getTileGridForProjection(e.viewState.projection),c=Is([t]);Mr(c,o*n,c);const u={},f=function(_,x,v){let w=_.getId();w===void 0&&(w=it(_));const S=u[w];if(S){if(S!==!0&&v<S.distanceSq){if(v===0)return u[w]=!0,s.splice(s.lastIndexOf(S),1),i(_,l,x);S.geometry=x,S.distanceSq=v}}else{if(v===0)return u[w]=!0,i(_,l,x);s.push(u[w]={feature:_,layer:l,geometry:x,distanceSq:v,callback:i})}},p=this.renderedTiles;let m;for(let _=0,x=p.length;!m&&_<x;++_){const v=p[_],w=h.getTileCoordExtent(v.wrappedTileCoord);if(!Qt(w,c))continue;const S=it(l),E=[v.executorGroups[S]],T=l.getDeclutter();E.some(R=>{const C=T?e.declutter[T].all().map(I=>I.value):null;for(let I=0,F=R.length;I<F;++I)if(m=R[I].forEachFeatureAtCoordinate(t,o,a,n,f,C),m)return!0})}return m}getFeatures(t){return new Promise((e,n)=>{const i=this.getLayer(),s=it(i),o=i.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,c=o.getTileGridForProjection(a),u=ae(this.renderedPixelToCoordinateTransform_,t.slice()),f=c.getTileCoordForCoordAndResolution(u,h);let p;for(let S=0,E=this.renderedTiles.length;S<E;++S)if(f.toString()===this.renderedTiles[S].tileCoord.toString()){if(p=this.renderedTiles[S],p.getState()===q.LOADED){const T=c.getTileCoordExtent(p.tileCoord);o.getWrapX()&&a.canWrapX()&&!We(l,T)&&Im(u,a);break}p=void 0}if(!p||p.loadingSourceTiles>0){e([]);return}const m=c.getTileCoordExtent(p.wrappedTileCoord),_=Dn(m),x=[(u[0]-_[0])/h,(_[1]-u[1])/h],v=p.getSourceTiles().reduce(function(S,E){return S.concat(E.getFeatures())},[]);let w=p.hitDetectionImageData[s];if(!w){const S=ie(c.getTileSize(c.getZForResolution(h,o.zDirection))),E=this.renderedRotation_,T=[this.getRenderTransform(c.getTileCoordCenter(p.wrappedTileCoord),h,0,gr,S[0]*gr,S[1]*gr,0)];w=d_(S,T,v,i.getStyleFunction(),c.getTileCoordExtent(p.wrappedTileCoord),p.getReplayState(i).renderedResolution,E),p.hitDetectionImageData[s]=w}e(f_(x,v,w))})}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){const n=this.context,i=n.globalAlpha;n.globalAlpha=e.opacity;const s=t.viewHints,o=!(s[ee.ANIMATING]||s[ee.INTERACTING]),a=this.renderedTiles;for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.executorGroups[it(this.getLayer())],f=this.getLayer().getDeclutter();if(u)for(let p=u.length-1;p>=0;--p)u[p].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(c,t),t.viewState.rotation,o,Ll,f?t.declutter[f]:void 0)}n.globalAlpha=i}renderDeferredInternal(t){const e=this.renderedTiles.reduce((i,s,o)=>(s.executorGroups[it(this.getLayer())].forEach(a=>i.push({executorGroup:a,index:o})),i),[]),n=e.map(({executorGroup:i})=>i.getDeferredZIndexContexts());n.map(i=>Object.keys(i)).flat().sort(rn).map(Number).forEach(i=>{n.forEach((s,o)=>{s[i]&&s[i].forEach(a=>{const{executorGroup:l,index:h}=e[o],c=l.getRenderedContext(),u=c.globalAlpha;c.globalAlpha=this.renderedOpacity_;const f=this.tileClipContexts_[h];f&&f.draw(c),a.draw(c),f&&c.restore(),c.globalAlpha=u,a.clear()})})})}getTileRenderTransform(t,e){const n=e.pixelRatio,i=e.viewState,s=i.center,o=i.resolution,a=i.rotation,l=e.size,h=Math.round(l[0]*n),c=Math.round(l[1]*n),u=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),f=t.tileCoord,p=u.getTileCoordExtent(t.wrappedTileCoord),m=u.getTileCoordExtent(f,this.tmpExtent)[0]-p[0];return qs(Mo(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(s,o,a,n,h,c,m))}postRender(t,e){const n=e.viewHints,i=!(n[ee.ANIMATING]||n[ee.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),h=l?Rp[o].filter(S=>!Ll.includes(S)):Rp[o],c=e.viewState,u=c.rotation,f=s.getSource(),p=f.getTileGridForProjection(c.projection).getZForResolution(c.resolution,f.zDirection),m=this.renderedTiles,_=[],x=[],v=[];let w=!0;for(let S=m.length-1;S>=0;--S){const E=m[S];w=w&&!E.getReplayState(s).dirty;const T=E.executorGroups[it(s)].filter(B=>B.hasExecutors(h));if(T.length===0)continue;const R=this.getTileRenderTransform(E,e),C=E.tileCoord[0];let I=!1;const F=T[0].getClipCoords(R);let U=t,j;if(F){l&&(j=new Rd,U=j.getContext());for(let B=0,d=_.length;B<d;++B)if(p!==C&&C<x[B]){const g=_[B];Qt([F[0],F[3],F[4],F[7]],[g[0],g[3],g[4],g[7]])&&(I||(U.save(),I=!0),U.beginPath(),U.moveTo(F[0],F[1]),U.lineTo(F[2],F[3]),U.lineTo(F[4],F[5]),U.lineTo(F[6],F[7]),U.moveTo(g[6],g[7]),U.lineTo(g[4],g[5]),U.lineTo(g[2],g[3]),U.lineTo(g[0],g[1]),U.clip())}_.push(F),x.push(C)}for(let B=0,d=T.length;B<d;++B)T[B].execute(t,[t.canvas.width,t.canvas.height],R,u,i,h);I&&(U===t?U.restore():v[S]=j)}t.globalAlpha=a,this.ready=w,this.tileClipContexts_=v,super.postRender(t,e)}renderFeature(t,e,n,i,s,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,h=n.length;l<h;++l)a=Fl(i,t,n[l],e,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=Fl(i,t,n,e,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(t){const e=this.getLayer();if(e.getRenderMode()==="vector")return!1;const n=t.getReplayState(e),i=e.getRevision(),s=t.wantedResolution;return n.renderedTileResolution!==s||n.renderedTileRevision!==i}renderTileImage_(t,e){const n=this.getLayer(),i=t.getReplayState(n),s=n.getRevision(),o=t.executorGroups[it(n)];i.renderedTileRevision=s;const a=t.wrappedTileCoord,l=a[0],h=n.getSource();let c=e.pixelRatio;const u=e.viewState.projection,f=h.getTileGridForProjection(u),p=f.getResolution(t.tileCoord[0]),m=e.pixelRatio/t.wantedResolution*p,_=f.getResolution(l),x=t.getContext(n);c=Math.round(Math.max(c,m/c));const v=h.getTilePixelSize(l,c,u);x.canvas.width=v[0],x.canvas.height=v[1];const w=c/m;if(w!==1){const R=Ac(this.tmpTransform_);Mo(R,w,w),x.setTransform.apply(x,R)}const S=f.getTileCoordExtent(a,this.tmpExtent),E=m/_,T=Ac(this.tmpTransform_);Mo(T,E,-E),Eu(T,-S[0],-S[3]);for(let R=0,C=o.length;R<C;++R)o[R].execute(x,[x.canvas.width*w,x.canvas.height*w],T,0,!0,wI[n.getRenderMode()],null);i.renderedTileResolution=t.wantedResolution}}class k_ extends Ta{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un;const n=t.renderMode||"hybrid";At(n=="hybrid"||n=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new bI(this)}getFeatures(t){return super.getFeatures(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(ni.PRELOAD)}getUseInterimTilesOnError(){return this.get(ni.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(ni.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(ni.USE_INTERIM_TILES_ON_ERROR,t)}}function _t(r,t,e){const n=Ed();return n.style=r.style,cI(t,e,n,r)}function Cp(r){const t=zr(r),e=t[0]*256,n=t[1],i=t[2]*256,s=Math.round(t[3]*255);return[e+n,i+s]}const SI=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function G_(r){return r===Xt?2:r===me?4:1}function yc(r){const t=G_(r);return t>1?`vec${t}`:"float"}function Ul(r){return(JSON.stringify(r).split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0),0)>>>0).toString()}function Xd(r,t,e,n){if(`${n}radius`in r&&n!=="icon-"){let i=_t(e,r[`${n}radius`],Y);if(`${n}radius2`in r){const s=_t(e,r[`${n}radius2`],Y);i=`max(${i}, ${s})`}`${n}stroke-width`in r&&(i=`(${i} + ${_t(e,r[`${n}stroke-width`],Y)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in r){const i=_t(e,r[`${n}scale`],Y|me);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in r&&t.setSymbolOffsetExpression(_t(e,r[`${n}displacement`],me)),`${n}rotation`in r&&t.setSymbolRotationExpression(_t(e,r[`${n}rotation`],Y)),`${n}rotate-with-view`in r&&t.setSymbolRotateWithView(!!r[`${n}rotate-with-view`])}function j_(r,t,e,n,i){let s="vec4(0.)";if(t!==null&&(s=t),e!==null&&n!==null){const l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${r})`;s=`mix(${e}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let a=`${s} * ${o}`;return i!==null&&(a=`${a} * ${i}`),a}function qd(r,t,e,n,i){const s=new Image;let o;return s.crossOrigin=r[`${n}cross-origin`]===void 0?"anonymous":r[`${n}cross-origin`],s.src=r[`${n}src`],s.complete&&s.width&&s.height?o=Gd([s.width,s.height]):(e[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],t.addUniform(`vec2 u_texture${i}_size`),o=`u_texture${i}_size`),e[`u_texture${i}`]=s,t.addUniform(`sampler2D u_texture${i}`),o}function Wd(r,t,e,n,i){let s=_t(e,r[`${t}offset`],me);if(`${t}offset-origin`in r)switch(r[`${t}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${i} - ${s}`;break}return s}function EI(r,t,e,n,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Xd(r,t,n,"circle-");let s=null;"circle-opacity"in r&&(s=_t(i,r["circle-opacity"],Y));let o="coordsPx";"circle-scale"in r&&(o=`coordsPx / ${_t(i,r["circle-scale"],Y|me)}`);let a=null;"circle-fill-color"in r&&(a=_t(i,r["circle-fill-color"],Xt));let l=null;"circle-stroke-color"in r&&(l=_t(i,r["circle-stroke-color"],Xt));let h=_t(i,r["circle-radius"],Y),c=null;"circle-stroke-width"in r&&(c=_t(i,r["circle-stroke-width"],Y),h=`(${h} + ${c} * 0.5)`);const u=`circleDistanceField(${o}, ${h})`,f=j_(u,a,l,c,s);t.setSymbolColorExpression(f)}function TI(r,t,e,n,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Xd(r,t,n,"shape-");let s=null;"shape-opacity"in r&&(s=_t(i,r["shape-opacity"],Y));let o="coordsPx";"shape-scale"in r&&(o=`coordsPx / ${_t(i,r["shape-scale"],Y|me)}`);let a=null;"shape-fill-color"in r&&(a=_t(i,r["shape-fill-color"],Xt));let l=null;"shape-stroke-color"in r&&(l=_t(i,r["shape-stroke-color"],Xt));let h=null;"shape-stroke-width"in r&&(h=_t(i,r["shape-stroke-width"],Y));const c=_t(i,r["shape-points"],Y);let u="0.";"shape-angle"in r&&(u=_t(i,r["shape-angle"],Y));let f,p=_t(i,r["shape-radius"],Y);if(h!==null&&(p=`${p} + ${h} * 0.5`),"shape-radius2"in r){let _=_t(i,r["shape-radius2"],Y);h!==null&&(_=`${_} + ${h} * 0.5`),f=`starDistanceField(${o}, ${c}, ${p}, ${_}, ${u})`}else f=`regularDistanceField(${o}, ${c}, ${p}, ${u})`;const m=j_(f,a,l,h,s);t.setSymbolColorExpression(m)}function MI(r,t,e,n,i){let s="vec4(1.0)";"icon-color"in r&&(s=_t(i,r["icon-color"],Xt)),"icon-opacity"in r&&(s=`${s} * ${_t(i,r["icon-opacity"],Y)}`);const o=Ul(r["icon-src"]),a=qd(r,t,e,"icon-",o);if(t.setSymbolColorExpression(`${s} * samplePremultiplied(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in r&&"icon-height"in r&&t.setSymbolSizeExpression(`vec2(${_t(n,r["icon-width"],Y)}, ${_t(n,r["icon-height"],Y)})`),"icon-offset"in r&&"icon-size"in r){const l=_t(n,r["icon-size"],me),h=t.getSymbolSizeExpression();t.setSymbolSizeExpression(l);const c=Wd(r,"icon-",n,"v_quadSizePx",l);t.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${l})) / (${h}).xyxy`)}if(Xd(r,t,n,"icon-"),"icon-anchor"in r){const l=_t(n,r["icon-anchor"],me);let h="1.0";"icon-scale"in r&&(h=_t(n,r["icon-scale"],Y|me));let c;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?c=`${l} * ${h}`:r["icon-anchor-x-units"]==="pixels"?c=`${l} * vec2(vec2(${h}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?c=`${l} * vec2(v_quadSizePx.x, vec2(${h}).x)`:c=`${l} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${u}`)}}function RI(r,t,e,n,i){if("stroke-color"in r&&t.setStrokeColorExpression(_t(i,r["stroke-color"],Xt)),"stroke-pattern-src"in r){const s=Ul(r["stroke-pattern-src"]),o=qd(r,t,e,"stroke-pattern-",s);let a=o,l="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(a=_t(i,r["stroke-pattern-size"],me),l=Wd(r,"stroke-pattern-",i,o,a));let h="0.";"stroke-pattern-spacing"in r&&(h=_t(i,r["stroke-pattern-spacing"],Y)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const c=`u_texture${s}`;let u="1.";"stroke-color"in r&&(u=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${u} * sampleStrokePattern(${c}, ${o}, ${l}, ${a}, ${h}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in r&&t.setStrokeWidthExpression(_t(n,r["stroke-width"],Y)),"stroke-offset"in r&&t.setStrokeOffsetExpression(_t(n,r["stroke-offset"],Y)),"stroke-line-cap"in r&&t.setStrokeCapExpression(_t(n,r["stroke-line-cap"],xe)),"stroke-line-join"in r&&t.setStrokeJoinExpression(_t(n,r["stroke-line-join"],xe)),"stroke-miter-limit"in r&&t.setStrokeMiterLimitExpression(_t(n,r["stroke-miter-limit"],Y)),"stroke-line-dash"in r){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Sn("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Sn("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=r["stroke-line-dash"].map(f=>_t(i,f,Y));s.length%2===1&&(s=[...s,...s]);let o="0.";"stroke-line-dash-offset"in r&&(o=_t(n,r["stroke-line-dash-offset"],Y));const a=`dashDistanceField_${Ul(r["stroke-line-dash"])}`,l=s.map((f,p)=>`float dashLength${p} = ${f};`),h=s.map((f,p)=>`dashLength${p}`).join(" + ");let c="0.",u=`getSingleDashDistance(distance, radius, ${c}, dashLength0, totalDashLength, capType)`;for(let f=2;f<s.length;f+=2)c=`${c} + dashLength${f-2} + dashLength${f-1}`,u=`min(${u}, getSingleDashDistance(distance, radius, ${c}, dashLength${f}, totalDashLength, capType))`;i.functions[a]=`float ${a}(float distance, float radius, float capType) {
  ${l.join(`
  `)}
  float totalDashLength = ${h};
  return ${u};
}`,t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function CI(r,t,e,n,i){if("fill-color"in r&&t.setFillColorExpression(_t(i,r["fill-color"],Xt)),"fill-pattern-src"in r){const s=Ul(r["fill-pattern-src"]),o=qd(r,t,e,"fill-pattern-",s);let a=o,l="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(a=_t(i,r["fill-pattern-size"],me),l=Wd(r,"fill-pattern-",i,o,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const h=`u_texture${s}`;let c="1.";"fill-color"in r&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${h}, ${o}, ${l}, ${a}, pxOrigin, pxPos)`)}}function II(r){const t={inFragmentShader:!1,properties:{},variables:{},functions:{},style:r},e={inFragmentShader:!0,variables:t.variables,properties:{},functions:{},style:r},n=new O_,i={};if("icon-src"in r?MI(r,n,i,t,e):"shape-points"in r?TI(r,n,i,t,e):"circle-radius"in r&&EI(r,n,i,t,e),RI(r,n,i,t,e),CI(r,n,i,t,e),r.filter){const o=_t(e,r.filter,te);n.setFragmentDiscardExpression(`!${o}`)}Object.keys(e.variables).forEach(function(o){const a=e.variables[o],l=jd(a.name);n.addUniform(`${yc(a.type)} ${l}`);let h;a.type===xe?h=()=>Gl(r.variables[a.name]):a.type===Xt?h=()=>Cp([...zr(r.variables[a.name]||"#eee")]):a.type===te?h=()=>r.variables[a.name]?1:0:h=()=>r.variables[a.name],i[l]=h}),Object.keys(e.properties).forEach(function(o){const a=e.properties[o];t.properties[o]||(t.properties[o]=a);let l=yc(a.type),h=`a_prop_${a.name}`;a.type===Xt&&(l="vec4",h=`unpackColor(${h})`,n.addVertexShaderFunction(SI)),n.addVarying(`v_prop_${a.name}`,l,h)}),Object.keys(t.properties).forEach(function(o){const a=t.properties[o];n.addAttribute(`${yc(a.type)} a_prop_${a.name}`)});const s=Object.keys(t.properties).map(function(o){const a=t.properties[o];let l;return a.evaluator?l=a.evaluator:a.type===xe?l=h=>Gl(h.get(a.name)):a.type===Xt?l=h=>Cp([...zr(h.get(a.name)||"#eee")]):a.type===te?l=h=>h.get(a.name)?1:0:l=h=>h.get(a.name),{name:a.name,size:G_(a.type),callback:l}});for(const o in t.functions)n.addVertexShaderFunction(t.functions[o]);for(const o in e.functions)n.addFragmentShaderFunction(e.functions[o]);return{builder:n,attributes:s.reduce((o,a)=>({...o,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:i}}class PI extends ba{constructor(t){const e=Object.assign({},t);super(e),this.parseResult_=II(t.style),this.styleVariables_=t.style.variables||{},this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){const t=Object.keys(this.parseResult_.attributes).map(e=>({name:e,...this.parseResult_.attributes[e]}));return new C_(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:t})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}const AI=PI;function Ip(r,t){const e=`
    attribute vec2 ${ll.TEXTURE_COORD};
    uniform mat4 ${Et.TILE_TRANSFORM};
    uniform float ${Et.TEXTURE_PIXEL_WIDTH};
    uniform float ${Et.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Et.TEXTURE_RESOLUTION};
    uniform float ${Et.TEXTURE_ORIGIN_X};
    uniform float ${Et.TEXTURE_ORIGIN_Y};
    uniform float ${Et.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${ll.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Et.TEXTURE_ORIGIN_X} + ${Et.TEXTURE_RESOLUTION} * ${Et.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Et.TEXTURE_ORIGIN_Y} - ${Et.TEXTURE_RESOLUTION} * ${Et.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Et.TILE_TRANSFORM} * vec4(${ll.TEXTURE_COORD}, ${Et.DEPTH}, 1.0);
    }
  `,n={...hI(),inFragmentShader:!0,bandCount:t,style:r},i=[];if(r.color!==void 0){const u=_t(n,r.color,Xt);i.push(`color = ${u};`)}if(r.contrast!==void 0){const u=_t(n,r.contrast,Y);i.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const u=_t(n,r.exposure,Y);i.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const u=_t(n,r.saturation,Y);i.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const u=_t(n,r.gamma,Y);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(r.brightness!==void 0){const u=_t(n,r.brightness,Y);i.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const f=n.variables[Object.keys(n.variables)[u]];if(!(f.name in r.variables))throw new Error(`Missing '${f.name}' in style variables`);const p=jd(f.name);s[p]=function(){let m=r.variables[f.name];return typeof m=="string"&&(m=Gl(m)),m!==void 0?m:-9999999}}const a=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${Et.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${L_}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Et.RENDER_EXTENT};
    uniform float ${Et.TRANSITION_ALPHA};
    uniform float ${Et.TEXTURE_PIXEL_WIDTH};
    uniform float ${Et.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Et.RESOLUTION};
    uniform float ${Et.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Et.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Et.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Et.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Et.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Et.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Et.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:c,uniforms:s,paletteTextures:n.paletteTextures}}class Bl extends N_{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const n=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Ut.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=Ip(this.style_,this.getSourceBandCount_());return new oI(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const n=this.getRenderer();let i;for(let s=0,o=e.length;s<o;++s)this.renderedSource_=e[s],n.prepareFrame(t)&&(i=n.renderFrame(t));return i}render(t,e){this.rendered=!0;const n=t.viewState,i=this.getSources(t.extent,n.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const h=i[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(t,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=Ip(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}Bl.prototype.dispose;const LI=Object.freeze(Object.defineProperty({__proto__:null,Graticule:hC,Group:Th,Heatmap:mI,Image:Ud,Layer:ba,Tile:jl,Vector:Id,VectorImage:vI,VectorTile:k_,WebGLPoints:AI,WebGLTile:Bl},Symbol.toStringTag,{value:"Module"}));var qe=(r,t,e)=>new Promise((n,i)=>{var s=l=>{try{a(e.next(l))}catch(h){i(h)}},o=l=>{try{a(e.throw(l))}catch(h){i(h)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((e=e.apply(r,t)).next())}),pr=Uint8Array,ps=Uint16Array,OI=Int32Array,z_=new pr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),U_=new pr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),FI=new pr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),B_=function(r,t){for(var e=new ps(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new OI(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)i[s]=s-e[n]<<5|n;return{b:e,r:i}},X_=B_(z_,2),q_=X_.b,NI=X_.r;q_[28]=258,NI[258]=28;var DI=B_(U_,0),kI=DI.b,lu=new ps(32768);for(qt=0;qt<32768;++qt)xn=(qt&43690)>>1|(qt&21845)<<1,xn=(xn&52428)>>2|(xn&13107)<<2,xn=(xn&61680)>>4|(xn&3855)<<4,lu[qt]=((xn&65280)>>8|(xn&255)<<8)>>1;var xn,qt,Oo=function(r,t,e){for(var n=r.length,i=0,s=new ps(t);i<n;++i)r[i]&&++s[r[i]-1];var o=new ps(t);for(i=1;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(e){a=new ps(1<<t);var l=15-t;for(i=0;i<n;++i)if(r[i])for(var h=i<<4|r[i],c=t-r[i],u=o[r[i]-1]++<<c,f=u|(1<<c)-1;u<=f;++u)a[lu[u]>>l]=h}else for(a=new ps(n),i=0;i<n;++i)r[i]&&(a[i]=lu[o[r[i]-1]++]>>15-r[i]);return a},Ca=new pr(288);for(qt=0;qt<144;++qt)Ca[qt]=8;var qt;for(qt=144;qt<256;++qt)Ca[qt]=9;var qt;for(qt=256;qt<280;++qt)Ca[qt]=7;var qt;for(qt=280;qt<288;++qt)Ca[qt]=8;var qt,W_=new pr(32);for(qt=0;qt<32;++qt)W_[qt]=5;var qt,GI=Oo(Ca,9,1),jI=Oo(W_,5,1),xc=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},Or=function(r,t,e){var n=t/8|0;return(r[n]|r[n+1]<<8)>>(t&7)&e},vc=function(r,t){var e=t/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(t&7)},zI=function(r){return(r+7)/8|0},UI=function(r,t,e){(t==null||t<0)&&(t=0),(e==null||e>r.length)&&(e=r.length);var n=new pr(e-t);return n.set(r.subarray(t,e)),n},BI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],dr=function(r,t,e){var n=new Error(t||BI[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,dr),!e)throw n;return n},Zd=function(r,t,e,n){var i=r.length,s=n?n.length:0;if(!i||t.f&&!t.l)return e||new pr(0);var o=!e||t.i!=2,a=t.i;e||(e=new pr(i*3));var l=function(Tt){var St=e.length;if(Tt>St){var Dt=new pr(Math.max(St*2,Tt));Dt.set(e),e=Dt}},h=t.f||0,c=t.p||0,u=t.b||0,f=t.l,p=t.d,m=t.m,_=t.n,x=i*8;do{if(!f){h=Or(r,c,1);var v=Or(r,c+1,3);if(c+=3,v)if(v==1)f=GI,p=jI,m=9,_=5;else if(v==2){var w=Or(r,c,31)+257,S=Or(r,c+10,15)+4,E=w+Or(r,c+5,31)+1;c+=14;for(var T=new pr(E),R=new pr(19),C=0;C<S;++C)R[FI[C]]=Or(r,c+C*3,7);c+=S*3;for(var I=xc(R),F=(1<<I)-1,U=Oo(R,I,1),C=0;C<E;){var j=U[Or(r,c,F)];c+=j&15;var B=j>>4;if(B<16)T[C++]=B;else{var d=0,g=0;for(B==16?(g=3+Or(r,c,3),c+=2,d=T[C-1]):B==17?(g=3+Or(r,c,7),c+=3):B==18&&(g=11+Or(r,c,127),c+=7);g--;)T[C++]=d}}var y=T.subarray(0,w),b=T.subarray(w);m=xc(y),_=xc(b),f=Oo(y,m,1),p=Oo(b,_,1)}else dr(1);else{var B=zI(c)+4,M=r[B-4]|r[B-3]<<8,P=B+M;if(P>i){a&&dr(0);break}o&&l(u+M),e.set(r.subarray(B,P),u),t.b=u+=M,t.p=c=P*8,t.f=h;continue}if(c>x){a&&dr(0);break}}o&&l(u+131072);for(var A=(1<<m)-1,L=(1<<_)-1,D=c;;D=c){var d=f[vc(r,c)&A],X=d>>4;if(c+=d&15,c>x){a&&dr(0);break}if(d||dr(2),X<256)e[u++]=X;else if(X==256){D=c,f=null;break}else{var K=X-254;if(X>264){var C=X-257,G=z_[C];K=Or(r,c,(1<<G)-1)+q_[C],c+=G}var H=p[vc(r,c)&L],Q=H>>4;H||dr(3),c+=H&15;var b=kI[Q];if(Q>3){var G=U_[Q];b+=vc(r,c)&(1<<G)-1,c+=G}if(c>x){a&&dr(0);break}o&&l(u+131072);var nt=u+K;if(u<b){var xt=s-b,dt=Math.min(b,nt);for(xt+u<0&&dr(3);u<dt;++u)e[u]=n[xt+u]}for(;u<nt;u+=4)e[u]=e[u-b],e[u+1]=e[u+1-b],e[u+2]=e[u+2-b],e[u+3]=e[u+3-b];u=nt}}t.l=f,t.p=D,t.b=u,t.f=h,f&&(h=1,t.m=m,t.d=p,t.n=_)}while(!h);return u==e.length?e:UI(e,0,u)},XI=new pr(0),qI=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&dr(6,"invalid gzip data");var t=r[3],e=10;t&4&&(e+=(r[10]|r[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!r[e++]);return e+(t&2)},WI=function(r){var t=r.length;return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0},ZI=function(r,t){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&dr(6,"invalid zlib data"),(r[1]>>5&1)==+!t&&dr(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function $I(r,t){return Zd(r,{i:2},t&&t.out,t&&t.dictionary)}function VI(r,t){var e=qI(r);return e+8>r.length&&dr(6,"invalid gzip data"),Zd(r.subarray(e,-8),{i:2},t&&t.out||new pr(WI(r)),t&&t.dictionary)}function YI(r,t){return Zd(r.subarray(ZI(r,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function hu(r,t){return r[0]==31&&r[1]==139&&r[2]==8?VI(r,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?$I(r,t):YI(r,t)}var HI=typeof TextDecoder<"u"&&new TextDecoder,KI=0;try{HI.decode(XI,{stream:!0}),KI=1}catch{}var Z_=(r,t)=>r*Math.pow(2,t),uo=(r,t)=>Math.floor(r/Math.pow(2,t)),Xl=(r,t)=>Z_(r.getUint16(t+1,!0),8)+r.getUint8(t),$_=(r,t)=>Z_(r.getUint32(t+2,!0),16)+r.getUint16(t,!0),QI=(r,t,e,n,i)=>{if(r!=n.getUint8(i))return r-n.getUint8(i);const s=Xl(n,i+1);if(t!=s)return t-s;const o=Xl(n,i+4);return e!=o?e-o:0},JI=(r,t,e,n)=>{const i=V_(r,t|128,e,n);return i?{z:t,x:e,y:n,offset:i[0],length:i[1],is_dir:!0}:null},Pp=(r,t,e,n)=>{const i=V_(r,t,e,n);return i?{z:t,x:e,y:n,offset:i[0],length:i[1],is_dir:!1}:null},V_=(r,t,e,n)=>{let i=0,s=r.byteLength/17-1;for(;i<=s;){const o=s+i>>1,a=QI(t,e,n,r,o*17);if(a>0)i=o+1;else if(a<0)s=o-1;else return[$_(r,o*17+7),r.getUint32(o*17+13,!0)]}return null},tP=(r,t)=>r.is_dir&&!t.is_dir?1:!r.is_dir&&t.is_dir?-1:r.z!==t.z?r.z-t.z:r.x!==t.x?r.x-t.x:r.y-t.y,Y_=(r,t)=>{const e=r.getUint8(t*17);return{z:e&127,x:Xl(r,t*17+1),y:Xl(r,t*17+4),offset:$_(r,t*17+7),length:r.getUint32(t*17+13,!0),is_dir:e>>7===1}},Ap=r=>{const t=[],e=new DataView(r);for(let n=0;n<e.byteLength/17;n++)t.push(Y_(e,n));return eP(t)},eP=r=>{r.sort(tP);const t=new ArrayBuffer(17*r.length),e=new Uint8Array(t);for(let n=0;n<r.length;n++){const i=r[n];let s=i.z;i.is_dir&&(s=s|128),e[n*17]=s,e[n*17+1]=i.x&255,e[n*17+2]=i.x>>8&255,e[n*17+3]=i.x>>16&255,e[n*17+4]=i.y&255,e[n*17+5]=i.y>>8&255,e[n*17+6]=i.y>>16&255,e[n*17+7]=i.offset&255,e[n*17+8]=uo(i.offset,8)&255,e[n*17+9]=uo(i.offset,16)&255,e[n*17+10]=uo(i.offset,24)&255,e[n*17+11]=uo(i.offset,32)&255,e[n*17+12]=uo(i.offset,48)&255,e[n*17+13]=i.length&255,e[n*17+14]=i.length>>8&255,e[n*17+15]=i.length>>16&255,e[n*17+16]=i.length>>24&255}return t},rP=(r,t)=>{if(r.byteLength<17)return null;const e=r.byteLength/17,n=Y_(r,e-1);if(n.is_dir){const i=n.z,s=t.z-i,o=Math.trunc(t.x/(1<<s)),a=Math.trunc(t.y/(1<<s));return{z:i,x:o,y:a}}return null};function nP(r){return qe(this,null,function*(){const t=yield r.getBytes(0,512e3),e=new DataView(t.data),n=e.getUint32(4,!0),i=e.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(t.data,10,n)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let h=0;"maxzoom"in o&&(h=+o.maxzoom);let c=0,u=0,f=0,p=-180,m=-85,_=180,x=85;if(o.bounds){const v=o.bounds.split(",");p=+v[0],m=+v[1],_=+v[2],x=+v[3]}if(o.center){const v=o.center.split(",");c=+v[0],u=+v[1],f=+v[2]}return{specVersion:e.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:h,minLon:p,minLat:m,maxLon:_,maxLat:x,centerZoom:f,centerLon:c,centerLat:u,etag:t.etag}})}function iP(r,t,e,n,i,s,o){return qe(this,null,function*(){let a=yield e.getArrayBuffer(t,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=Ap(a));const l=Pp(new DataView(a),n,i,s);if(l){let c=(yield t.getBytes(l.offset,l.length,o)).data;const u=new DataView(c);return u.getUint8(0)==31&&u.getUint8(1)==139&&(c=hu(new Uint8Array(c))),{data:c}}const h=rP(new DataView(a),{z:n,x:i,y:s});if(h){const c=JI(new DataView(a),h.z,h.x,h.y);if(c){let u=yield e.getArrayBuffer(t,c.offset,c.length,r);r.specVersion===1&&(u=Ap(u));const f=Pp(new DataView(u),n,i,s);if(f){let p=(yield t.getBytes(f.offset,f.length,o)).data;const m=new DataView(p);return m.getUint8(0)==31&&m.getUint8(1)==139&&(p=hu(new Uint8Array(p))),{data:p}}}}})}var H_={getHeader:nP,getZxy:iP};function sP(r,t){return(t>>>0)*4294967296+(r>>>0)}function oP(r,t){const e=t.buf;let n,i;if(i=e[t.pos++],n=(i&112)>>4,i<128||(i=e[t.pos++],n|=(i&127)<<3,i<128)||(i=e[t.pos++],n|=(i&127)<<10,i<128)||(i=e[t.pos++],n|=(i&127)<<17,i<128)||(i=e[t.pos++],n|=(i&127)<<24,i<128)||(i=e[t.pos++],n|=(i&1)<<31,i<128))return sP(r,n);throw new Error("Expected varint not more than 10 bytes")}function fo(r){const t=r.buf;let e,n;return n=t[r.pos++],e=n&127,n<128||(n=t[r.pos++],e|=(n&127)<<7,n<128)||(n=t[r.pos++],e|=(n&127)<<14,n<128)||(n=t[r.pos++],e|=(n&127)<<21,n<128)?e:(n=t[r.pos],e|=(n&15)<<28,oP(e,r))}function aP(r,t,e,n){if(n==0){e==1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}var lP=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function hP(r,t,e){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>Math.pow(2,r)-1||e>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=lP[r],i=Math.pow(2,r);let s=0,o=0,a=0;const l=[t,e];let h=i/2;for(;h>0;)s=(l[0]&h)>0?1:0,o=(l[1]&h)>0?1:0,a+=h*h*(3*s^o),aP(h,l,s,o),h=h/2;return n+a}function K_(r,t){return qe(this,null,function*(){if(t===1||t===0)return r;if(t===2){if(typeof globalThis.DecompressionStream>"u")return hu(new Uint8Array(r));{let e=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(e).arrayBuffer()}}else throw Error("Compression method not supported")})}var hs=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(hs||{}),cP=127;function uP(r,t){let e=0,n=r.length-1;for(;e<=n;){const i=n+e>>1,s=t-r[i].tileId;if(s>0)e=i+1;else if(s<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||t-r[n].tileId<r[n].runLength)?r[n]:null}var dP=class{constructor(r,t=new Headers){this.url=r,this.customHeaders=t}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,t,e){return qe(this,null,function*(){let n;e||(n=new AbortController,e=n.signal);const i=new Headers(this.customHeaders);i.set("Range","bytes="+r+"-"+(r+t-1));let s=yield fetch(this.url,{signal:e,headers:i});if(s.status===416&&r===0){const a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const l=+a.substr(8);s=yield fetch(this.url,{signal:e,headers:{Range:"bytes=0-"+(l-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>t))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function Fr(r,t){const e=r.getUint32(t+4,!0),n=r.getUint32(t+0,!0);return e*Math.pow(2,32)+n}function fP(r,t){const e=new DataView(r),n=e.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:Fr(e,8),rootDirectoryLength:Fr(e,16),jsonMetadataOffset:Fr(e,24),jsonMetadataLength:Fr(e,32),leafDirectoryOffset:Fr(e,40),leafDirectoryLength:Fr(e,48),tileDataOffset:Fr(e,56),tileDataLength:Fr(e,64),numAddressedTiles:Fr(e,72),numTileEntries:Fr(e,80),numTileContents:Fr(e,88),clustered:e.getUint8(96)===1,internalCompression:e.getUint8(97),tileCompression:e.getUint8(98),tileType:e.getUint8(99),minZoom:e.getUint8(100),maxZoom:e.getUint8(101),minLon:e.getInt32(102,!0)/1e7,minLat:e.getInt32(106,!0)/1e7,maxLon:e.getInt32(110,!0)/1e7,maxLat:e.getInt32(114,!0)/1e7,centerZoom:e.getUint8(118),centerLon:e.getInt32(119,!0)/1e7,centerLat:e.getInt32(123,!0)/1e7,etag:t}}function Q_(r){const t={buf:new Uint8Array(r),pos:0},e=fo(t),n=[];let i=0;for(let s=0;s<e;s++){const o=fo(t);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<e;s++)n[s].runLength=fo(t);for(let s=0;s<e;s++)n[s].length=fo(t);for(let s=0;s<e;s++){const o=fo(t);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}function gP(r){const t=new DataView(r);return t.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):t.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ms=class extends Error{};function pP(r,t,e,n){return qe(this,null,function*(){const i=yield r.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(gP(i.data)<3)return[yield H_.getHeader(r)];const s=i.data.slice(0,cP);let o=i.etag;n&&i.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),o=void 0);const a=fP(s,o);if(e){const l=i.data.slice(a.rootDirectoryOffset,a.rootDirectoryOffset+a.rootDirectoryLength),h=r.getKey()+"|"+(a.etag||"")+"|"+a.rootDirectoryOffset+"|"+a.rootDirectoryLength,c=Q_(yield t(l,a.internalCompression));return[a,[h,c.length,c]]}return[a,void 0]})}function mP(r,t,e,n,i){return qe(this,null,function*(){const s=yield r.getBytes(e,n);if(i.etag&&i.etag!==s.etag)throw new ms(s.etag);const o=yield t(s.data,i.internalCompression),a=Q_(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var _P=class{constructor(r=100,t=!0,e=K_){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=t,this.decompress=e}getHeader(r,t){return qe(this,null,function*(){const e=r.getKey();if(this.cache.has(e))return this.cache.get(e).lastUsed=this.counter++,yield this.cache.get(e).data;const n=new Promise((i,s)=>{pP(r,this.decompress,this.prefetch,t).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),i(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,t,e,n){return qe(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+t+"|"+e;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{mP(r,this.decompress,t,e,n).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(r,t,e,n){return qe(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+t+"|"+e;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{r.getBytes(t,e).then(l=>{if(n.etag&&n.etag!==l.etag)throw new ms(l.etag);o(l.data),this.cache.has(i),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,t;this.cache.forEach((e,n)=>{e.lastUsed<r&&(r=e.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(r,t){return qe(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,t)})}},$d=class{constructor(r,t,e){typeof r=="string"?this.source=new dP(r):this.source=r,e?this.decompress=e:this.decompress=K_,t?this.cache=t:this.cache=new _P}getHeader(){return qe(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,t,e,n){return qe(this,null,function*(){const i=hP(r,t,e),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return H_.getZxy(s,this.source,this.cache,r,t,e,n);if(r<s.minZoom||r>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){const h=yield this.cache.getDirectory(this.source,o,a,s),c=uP(h,i);if(c)if(c.runLength>0){const u=yield this.source.getBytes(s.tileDataOffset+c.offset,c.length,n);if(s.etag&&s.etag!==u.etag)throw new ms(u.etag);return{data:yield this.decompress(u.data,s.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}else o=s.leafDirectoryOffset+c.offset,a=c.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,t,e,n){return qe(this,null,function*(){try{return yield this.getZxyAttempt(r,t,e,n)}catch(i){if(i instanceof ms)return this.cache.invalidate(this.source,i.message),yield this.getZxyAttempt(r,t,e,n);throw i}})}getMetadataAttempt(){return qe(this,null,function*(){const r=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==t.etag)throw new ms(t.etag);const e=yield this.decompress(t.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(e))})}getMetadata(){return qe(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof ms)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};class yP extends cn{constructor(t){super(Lt.ERROR),this.error=t}}class Lh extends Dd{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),e=A_(t)[0];this.forEach(n=>{n.tileCoord[0]!==e&&(this.remove(Kn(n.tileCoord)),n.release())})}}const Ts={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},ns=[0,0,0],Yn=5;class fi{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,At(sx(this.resolutions_,(i,s)=>s-i,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let i=0,s=this.resolutions_.length-1;i<s;++i)if(!e)e=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,At(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Dn(n)),At(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,At(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Ds,At(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((i,s)=>{const o=new Ah(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const i=this.getTileRangeForExtentAndZ(t,e);for(let s=i.minX,o=i.maxX;s<=o;++s)for(let a=i.minY,l=i.maxY;a<=l;++a)n([e,s,a])}forEachTileCoordParentTileRange(t,e,n,i){let s,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,i);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=ts(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return ts(s,s+1,o,o+1,e)}const i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const i=t[0],s=t[1],o=t[2];if(e===i)return ts(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-i),h=Math.floor(s*l),c=Math.floor(o*l);if(e<i)return ts(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,f=Math.floor(l*(o+1))-1;return ts(h,u,c,f,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,ns);const i=ns[1],s=ns[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,ns);const o=ns[1],a=ns[2];return ts(i,o,s,a,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=ie(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*i[0]*n,e[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=ie(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*i,a=n[1]-(t[2]+1)*s[1]*i,l=o+s[0]*i,h=a+s[1]*i;return jr(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,i,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=ie(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/n/h[0],u=a*(l[1]-e)/n/h[1];return i?(c=Qn(c,Yn)-1,u=Qn(u,Yn)-1):(c=fs(c,Yn),u=fs(u,Yn)),na(o,c,u,s)}getTileCoordForXYAndZ_(t,e,n,i,s){const o=this.getOrigin(n),a=this.getResolution(n),l=ie(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return i?(h=Qn(h,Yn)-1,c=Qn(c,Yn)-1):(h=fs(h,Yn),c=fs(c,Yn)),na(n,h,c,s)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=Ql(this.resolutions_,t,e||0);return wt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return jm(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let i=this.minZoom;i<e;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}}class xP extends fi{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}function vP(r,t,e){const n=[],i=[],s=[],o=[],a=[];e=e!==void 0?e:[];const l="SupportedCRS",h="TileMatrix",c="Identifier",u="ScaleDenominator",f="TopLeftCorner",p="TileWidth",m="TileHeight",_=r[l],x=tt(_),v=x.getMetersPerUnit(),w=x.getAxisOrientation().substr(0,2)=="ne";return r[h].sort(function(S,E){return E[u]-S[u]}),r[h].forEach(function(S){let E;if(e.length>0?E=e.find(function(T){return S[c]==T[h]?!0:S[c].includes(":")?!1:r[c]+":"+S[c]===T[h]}):E=!0,E){i.push(S[c]);const T=S[u]*28e-5/v,R=S[p],C=S[m];w?s.push([S[f][1],S[f][0]]):s.push(S[f]),n.push(T),o.push(R==C?R:[R,C]),a.push([S.MatrixWidth,S.MatrixHeight])}}),new xP({extent:t,origins:s,resolutions:n,matrixIds:i,tileSizes:o,sizes:a})}function Vd(r){let t=r.getDefaultTileGrid();return t||(t=SP(r),r.setDefaultTileGrid(t)),t}function wP(r,t,e){const n=t[0],i=r.getTileCoordCenter(t),s=zn(e);if(!mr(s,i)){const o=yt(s),a=Math.ceil((s[0]-i[0])/o);return i[0]+=o*a,r.getTileCoordForCoordAndZ(i,n)}return t}function bP(r,t,e,n){n=n!==void 0?n:"top-left";const i=J_(r,t,e);return new fi({extent:r,origin:_x(r,n),resolutions:i,tileSize:e})}function Wi(r){const t=r||{},e=t.extent||tt("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:J_(e,t.maxZoom,t.tileSize,t.maxResolution)};return new fi(n)}function J_(r,t,e,n){t=t!==void 0?t:K0,e=ie(e!==void 0?e:Ds);const i=Vt(r),s=yt(r);n=n>0?n:Math.max(s/e[0],i/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function SP(r,t,e,n){const i=zn(r);return bP(i,t,e,n)}function zn(r){r=tt(r);let t=r.getExtent();if(!t){const e=180*Xo.degrees/r.getMetersPerUnit();t=jr(-e,-e,e,e)}return t}class EP extends Qs{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ie(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Lh(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,i){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=ln(e,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===q.LOADED,h&&(h=i(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,i,s){return ct()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Vd(t)}getTileCacheForProjection(t){const e=this.getProjection();return At(e===null||Pe(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const i=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),o=ie(i.getTileSize(t),this.tmpSize);return s==1?o:s0(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=wP(n,t,e)),tI(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,i){}}class ty extends cn{constructor(t,e){super(t),this.tile=e}}const Ia=EP;class Yd extends Ia{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let n=t.tileGrid;n===void 0&&e&&(n=Wi({extent:zn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:n,opaque:t.opaque,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?ie(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?ie(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return!e||Pe(e,t)?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,n,i,s){const o=this.getTileCacheForProjection(i),a=ln(t,e,n);if(o.containsKey(a)){const x=o.get(a);if(x&&x.key==this.getKey())return x}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map((x,v)=>{const w=ie(l.getTileSize(v)),S=this.getTileSize(v);return Math.max(S[0]/w[0],S[1]/w[1])})),c=this.getTileGridForProjection(s),u=this.getTileGridForProjection(i),f=[t,e,n],p=this.getTileCoordForTileUrlFunction(f,i),m=Object.assign({sourceProj:s,sourceTileGrid:c,targetProj:i,targetTileGrid:u,tileCoord:f,wrappedTileCoord:p,pixelRatio:h,gutter:this.getGutterForProjection(s),getTileFunction:(x,v,w,S)=>this.getTile(x,v,w,S,s)},this.tileOptions),_=new Nd(m);return _.key=this.getKey(),_}getTile(t,e,n,i,s){const o=this.getProjection();if(o&&s&&!Pe(o,s))return this.getReprojTile_(t,e,n,s,o);const a=this.getTileSize(t),l=ln(t,e,n);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const h=this.loader_;function c(){return wm(function(){return h(t,e,n)})}const u=Object.assign({tileCoord:[t,e,n],loader:c,size:a},this.tileOptions),f=new Ld(u);return f.key=this.getKey(),f.addEventListener(Lt.CHANGE,this.handleTileChange_),this.tileCache.set(l,f),f}handleTileChange_(t){const e=t.target,n=it(e),i=e.getState();let s;i==q.LOADING?(this.tileLoadingKeys_[n]=!0,s=Ts.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==q.ERROR?Ts.TILELOADERROR:i==q.LOADED?Ts.TILELOADEND:void 0),s&&this.dispatchEvent(new ty(s,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Pe(e,t)))return this.tileGrid;const n=it(t);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=Vd(t)),this.tileGridForProjection_[n]}setTileGridForProjection(t,e){const n=tt(t);if(n){const i=it(n);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=e)}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Pe(e,t))return this.tileCache;const n=it(t);return n in this.tileCacheForProjection_||(this.tileCacheForProjection_[n]=new Lh(.1)),this.tileCacheForProjection_[n]}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const i in this.tileCacheForProjection_){const s=this.tileCacheForProjection_[i];s.expireCache(s==n?e:{})}}clear(){super.clear();for(const t in this.tileCacheForProjection_)this.tileCacheForProjection_[t].clear()}}function Oe(r){return(t,...e)=>TP(r,t,e)}function to(r,t){return Oe(ey(r,t).get)}const{apply:TP,construct:nk,defineProperty:ik,get:sk,getOwnPropertyDescriptor:ey,getPrototypeOf:Hd,has:ok,ownKeys:MP,set:ak,setPrototypeOf:lk}=Reflect,{iterator:Pa,species:hk,toStringTag:RP,for:ck}=Symbol,CP=Object,{create:Kd,defineProperty:IP,freeze:uk,is:dk}=CP,PP=Array,AP=PP.prototype,ry=AP[Pa],LP=Oe(ry),ny=ArrayBuffer,OP=ny.prototype;to(OP,"byteLength");const Lp=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Lp&&to(Lp.prototype,"byteLength");const iy=Hd(Uint8Array);iy.from;const Ye=iy.prototype;Ye[Pa];Oe(Ye.keys);Oe(Ye.values);Oe(Ye.entries);Oe(Ye.set);Oe(Ye.reverse);Oe(Ye.fill);Oe(Ye.copyWithin);Oe(Ye.sort);Oe(Ye.slice);Oe(Ye.subarray);to(Ye,"buffer");to(Ye,"byteOffset");to(Ye,"length");to(Ye,RP);const FP=Uint8Array,sy=Uint16Array,Qd=Uint32Array,NP=Float32Array,ia=Hd([][Pa]()),oy=Oe(ia.next),DP=Oe(function*(){}().next),kP=Hd(ia),GP=DataView.prototype,jP=Oe(GP.getUint16),Jd=WeakMap,ay=Jd.prototype,ly=Oe(ay.get),zP=Oe(ay.set),hy=new Jd,UP=Kd(null,{next:{value:function(){const r=ly(hy,this);return oy(r)}},[Pa]:{value:function(){return this}}});function BP(r){if(r[Pa]===ry&&ia.next===oy)return r;const t=Kd(UP);return zP(hy,t,LP(r)),t}const XP=new Jd,qP=Kd(kP,{next:{value:function(){const r=ly(XP,this);return DP(r)},writable:!0,configurable:!0}});for(const r of MP(ia))r!=="next"&&IP(qP,r,ey(ia,r));const cy=new ny(4),WP=new NP(cy),ZP=new Qd(cy),$r=new sy(512),Vr=new FP(512);for(let r=0;r<256;++r){const t=r-127;t<-27?($r[r]=0,$r[r|256]=32768,Vr[r]=24,Vr[r|256]=24):t<-14?($r[r]=1024>>-t-14,$r[r|256]=1024>>-t-14|32768,Vr[r]=-t-1,Vr[r|256]=-t-1):t<=15?($r[r]=t+15<<10,$r[r|256]=t+15<<10|32768,Vr[r]=13,Vr[r|256]=13):t<128?($r[r]=31744,$r[r|256]=64512,Vr[r]=24,Vr[r|256]=24):($r[r]=31744,$r[r|256]=64512,Vr[r]=13,Vr[r|256]=13)}const tf=new Qd(2048);for(let r=1;r<1024;++r){let t=r<<13,e=0;for(;!(t&8388608);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,tf[r]=t|e}for(let r=1024;r<2048;++r)tf[r]=939524096+(r-1024<<13);const eo=new Qd(64);for(let r=1;r<31;++r)eo[r]=r<<23;eo[31]=1199570944;eo[32]=2147483648;for(let r=33;r<63;++r)eo[r]=2147483648+(r-32<<23);eo[63]=3347054592;const uy=new sy(64);for(let r=1;r<64;++r)r!==32&&(uy[r]=1024);function $P(r){const t=r>>10;return ZP[0]=tf[uy[t]+(r&1023)]+eo[t],WP[0]}function dy(r,t,...e){return $P(jP(r,t,...BP(e)))}var ef={exports:{}};function fy(r,t,e){const n=e&&e.debug||!1;n&&console.log("[xml-utils] getting "+t+" in "+r);const i=typeof r=="object"?r.outer:r,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],h=t+"\\="+l+"([^"+l+"]*)"+l;n&&console.log("[xml-utils] pattern:",h);const c=new RegExp(h).exec(s);if(n&&console.log("[xml-utils] match:",c),c)return c[1]}}ef.exports=fy;ef.exports.default=fy;var VP=ef.exports;const wc=$s(VP);var rf={exports:{}},nf={exports:{}},sf={exports:{}};function gy(r,t,e){const n=new RegExp(t).exec(r.slice(e));return n?e+n.index:-1}sf.exports=gy;sf.exports.default=gy;var YP=sf.exports,of={exports:{}};function py(r,t,e){const n=new RegExp(t).exec(r.slice(e));return n?e+n.index+n[0].length-1:-1}of.exports=py;of.exports.default=py;var HP=of.exports,af={exports:{}};function my(r,t){const e=new RegExp(t,"g"),n=r.match(e);return n?n.length:0}af.exports=my;af.exports.default=my;var KP=af.exports;const QP=YP,bc=HP,Op=KP;function _y(r,t,e){const n=e&&e.debug||!1,i=!(e&&typeof e.nested===!1),s=e&&e.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",t," and ",e);const o=QP(r,`<${t}[ 
>/]`,s);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+t.length);let l=bc(a,"^[^<]*[ /]>",0);const h=l!==-1&&a[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",h),h===!1)if(i){let p=0,m=1,_=0;for(;(l=bc(a,"[ /]"+t+">",p))!==-1;){const x=a.substring(p,l+1);if(m+=Op(x,"<"+t+`[ 
	>]`),_+=Op(x,"</"+t+">"),_>=m)break;p=l}}else l=bc(a,"[ /]"+t+">",0);const c=o+t.length+l+1;if(n&&console.log("[xml-utils] end:",c),c===-1)return;const u=r.slice(o,c);let f;return h?f=null:f=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:f,outer:u,start:o,end:c}}nf.exports=_y;nf.exports.default=_y;var JP=nf.exports;const tA=JP;function yy(r,t,e){const n=[],i=e&&e.debug||!1,s=e&&typeof e.nested=="boolean"?e.nested:!0;let o=e&&e.startIndex||0,a;for(;a=tA(r,t,{debug:i,startIndex:o});)s?o=a.start+1+t.length:o=a.end,n.push(a);return i&&console.log("findTagsByName found",n.length,"tags"),n}rf.exports=yy;rf.exports.default=yy;var eA=rf.exports;const rA=$s(eA),Fo={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Hr={};for(const r in Fo)Fo.hasOwnProperty(r)&&(Hr[Fo[r]]=parseInt(r,10));const nA=[Hr.BitsPerSample,Hr.ExtraSamples,Hr.SampleFormat,Hr.StripByteCounts,Hr.StripOffsets,Hr.StripRowCounts,Hr.TileByteCounts,Hr.TileOffsets,Hr.SubIFDs],Sc={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Mt={};for(const r in Sc)Sc.hasOwnProperty(r)&&(Mt[Sc[r]]=parseInt(r,10));const Ke={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},iA={Unspecified:0,Assocalpha:1,Unassalpha:2},fk={Version:0,AddCompression:1},gk={None:0,Deflate:1,Zstandard:2},sA={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function oA(r,t){const{width:e,height:n}=r,i=new Uint8Array(e*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/t*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function aA(r,t){const{width:e,height:n}=r,i=new Uint8Array(e*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/t*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function lA(r,t){const{width:e,height:n}=r,i=new Uint8Array(e*n*3),s=t.length/3,o=t.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const h=r[a];i[l]=t[h]/65536*256,i[l+1]=t[h+s]/65536*256,i[l+2]=t[h+o]/65536*256}return i}function hA(r){const{width:t,height:e}=r,n=new Uint8Array(t*e*3);for(let i=0,s=0;i<r.length;i+=4,s+=3){const o=r[i],a=r[i+1],l=r[i+2],h=r[i+3];n[s]=255*((255-o)/256)*((255-h)/256),n[s+1]=255*((255-a)/256)*((255-h)/256),n[s+2]=255*((255-l)/256)*((255-h)/256)}return n}function cA(r){const{width:t,height:e}=r,n=new Uint8ClampedArray(t*e*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i],a=r[i+1],l=r[i+2];n[s]=o+1.402*(l-128),n[s+1]=o-.34414*(a-128)-.71414*(l-128),n[s+2]=o+1.772*(a-128)}return n}const uA=.95047,dA=1,fA=1.08883;function gA(r){const{width:t,height:e}=r,n=new Uint8Array(t*e*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i+0],a=r[i+1]<<24>>24,l=r[i+2]<<24>>24;let h=(o+16)/116,c=a/500+h,u=h-l/200,f,p,m;c=uA*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=dA*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=fA*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),f=c*3.2406+h*-1.5372+u*-.4986,p=c*-.9689+h*1.8758+u*.0415,m=c*.0557+h*-.204+u*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,n[s]=Math.max(0,Math.min(1,f))*255,n[s+1]=Math.max(0,Math.min(1,p))*255,n[s+2]=Math.max(0,Math.min(1,m))*255}return n}const xy=new Map;function gi(r,t){Array.isArray(r)||(r=[r]),r.forEach(e=>xy.set(e,t))}async function vy(r){const t=xy.get(r.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const e=await t();return new e(r)}gi([void 0,1],()=>Nn(()=>import("./raw-CcGKjn8q.DfNmvAus.js"),__vite__mapDeps([0,1])).then(r=>r.default));gi(5,()=>Nn(()=>import("./lzw-BOMhmEDy.vdrfOEDr.js"),__vite__mapDeps([2,1])).then(r=>r.default));gi(6,()=>{throw new Error("old style JPEG compression is not supported.")});gi(7,()=>Nn(()=>import("./jpeg-DNfUpLwy.DZg5Y_av.js"),__vite__mapDeps([3,1])).then(r=>r.default));gi([8,32946],()=>Nn(()=>import("./deflate-Be2Arps5.xxsQaVdl.js"),__vite__mapDeps([4,5,1])).then(r=>r.default));gi(32773,()=>Nn(()=>import("./packbits-DaUD6MLm.Crl47xZx.js"),__vite__mapDeps([6,1])).then(r=>r.default));gi(34887,()=>Nn(()=>import("./lerc-C9VL9kri.CKqttqR3.js"),__vite__mapDeps([7,5,1,8])).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));gi(50001,()=>Nn(()=>import("./webimage-D2c098k3.D_Ac3USc.js"),__vite__mapDeps([9,1])).then(r=>r.default));function Oh(r,t,e,n=1){return new(Object.getPrototypeOf(r)).constructor(t*e*n)}function pA(r,t,e,n,i){const s=t/n,o=e/i;return r.map(a=>{const l=Oh(a,n,i);for(let h=0;h<i;++h){const c=Math.min(Math.round(o*h),e-1);for(let u=0;u<n;++u){const f=Math.min(Math.round(s*u),t-1),p=a[c*t+f];l[h*n+u]=p}}return l})}function Ms(r,t,e){return(1-e)*r+e*t}function mA(r,t,e,n,i){const s=t/n,o=e/i;return r.map(a=>{const l=Oh(a,n,i);for(let h=0;h<i;++h){const c=o*h,u=Math.floor(c),f=Math.min(Math.ceil(c),e-1);for(let p=0;p<n;++p){const m=s*p,_=m%1,x=Math.floor(m),v=Math.min(Math.ceil(m),t-1),w=a[u*t+x],S=a[u*t+v],E=a[f*t+x],T=a[f*t+v],R=Ms(Ms(w,S,_),Ms(E,T,_),c%1);l[h*n+p]=R}}return l})}function _A(r,t,e,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return pA(r,t,e,n,i);case"bilinear":case"linear":return mA(r,t,e,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function yA(r,t,e,n,i,s){const o=t/n,a=e/i,l=Oh(r,n,i,s);for(let h=0;h<i;++h){const c=Math.min(Math.round(a*h),e-1);for(let u=0;u<n;++u){const f=Math.min(Math.round(o*u),t-1);for(let p=0;p<s;++p){const m=r[c*t*s+f*s+p];l[h*n*s+u*s+p]=m}}}return l}function xA(r,t,e,n,i,s){const o=t/n,a=e/i,l=Oh(r,n,i,s);for(let h=0;h<i;++h){const c=a*h,u=Math.floor(c),f=Math.min(Math.ceil(c),e-1);for(let p=0;p<n;++p){const m=o*p,_=m%1,x=Math.floor(m),v=Math.min(Math.ceil(m),t-1);for(let w=0;w<s;++w){const S=r[u*t*s+x*s+w],E=r[u*t*s+v*s+w],T=r[f*t*s+x*s+w],R=r[f*t*s+v*s+w],C=Ms(Ms(S,E,_),Ms(T,R,_),c%1);l[h*n*s+p*s+w]=C}}}return l}function vA(r,t,e,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return yA(r,t,e,n,i,s);case"bilinear":case"linear":return xA(r,t,e,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function wA(r,t,e){let n=0;for(let i=t;i<e;++i)n+=r[i];return n}function cu(r,t,e){switch(r){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function bA(r,t){return(r===1||r===2)&&t<=32&&t%8===0?!1:!(r===3&&(t===16||t===32||t===64))}function SA(r,t,e,n,i,s,o){const a=new DataView(r),l=e===2?o*s:o*s*n,h=e===2?1:n,c=cu(t,i,l),u=parseInt("1".repeat(i),2);if(t===1){let f;e===1?f=n*i:f=i;let p=s*f;p&7&&(p=p+7&-8);for(let m=0;m<o;++m){const _=m*p;for(let x=0;x<s;++x){const v=_+x*h*i;for(let w=0;w<h;++w){const S=v+w*i,E=(m*s+x)*h+w,T=Math.floor(S/8),R=S%8;if(R+i<=8)c[E]=a.getUint8(T)>>8-i-R&u;else if(R+i<=16)c[E]=a.getUint16(T)>>16-i-R&u;else if(R+i<=24){const C=a.getUint16(T)<<8|a.getUint8(T+2);c[E]=C>>24-i-R&u}else c[E]=a.getUint32(T)>>32-i-R&u}}}}return c.buffer}class wy{constructor(t,e,n,i,s,o){this.fileDirectory=t,this.geoKeys=e,this.dataView=n,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!t.StripOffsets;const a=t.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,s){return dy(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const n=this.getSampleFormat(t),i=this.getBitsPerSample(t);return cu(n,i,e)}async getTileOrStrip(t,e,n,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=e*o+t:this.planarConfiguration===2&&(l=n*o*a+e*o+t);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const f=(await this.source.fetch([{offset:c,length:u}],s))[0];let p;return h===null||!h[l]?(p=(async()=>{let m=await i.decode(this.fileDirectory,f);const _=this.getSampleFormat(),x=this.getBitsPerSample();return bA(_,x)&&(m=SA(m,_,this.planarConfiguration,this.getSamplesPerPixel(),x,this.getTileWidth(),this.getBlockHeight(e))),m})(),h!==null&&(h[l]=p)):p=h[l],{x:t,y:e,sample:n,data:await p}}async _readRaster(t,e,n,i,s,o,a,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),f=this.getWidth(),p=this.getHeight(),m=Math.max(Math.floor(t[0]/c),0),_=Math.min(Math.ceil(t[2]/c),Math.ceil(f/c)),x=Math.max(Math.floor(t[1]/u),0),v=Math.min(Math.ceil(t[3]/u),Math.ceil(p/u)),w=t[2]-t[0];let S=this.getBytesPerPixel();const E=[],T=[];for(let I=0;I<e.length;++I)this.planarConfiguration===1?E.push(wA(this.fileDirectory.BitsPerSample,0,e[I])/8):E.push(0),T.push(this.getReaderForSample(e[I]));const R=[],{littleEndian:C}=this;for(let I=x;I<v;++I)for(let F=m;F<_;++F){let U;this.planarConfiguration===1&&(U=this.getTileOrStrip(F,I,0,s,h));for(let j=0;j<e.length;++j){const B=j,d=e[j];this.planarConfiguration===2&&(S=this.getSampleByteSize(d),U=this.getTileOrStrip(F,I,d,s,h));const g=U.then(y=>{const b=y.data,M=new DataView(b),P=this.getBlockHeight(y.y),A=y.y*u,L=y.x*c,D=A+P,X=(y.x+1)*c,K=T[B],G=Math.min(P,P-(D-t[3]),p-A),H=Math.min(c,c-(X-t[2]),f-L);for(let Q=Math.max(0,t[1]-A);Q<G;++Q)for(let nt=Math.max(0,t[0]-L);nt<H;++nt){const xt=(Q*c+nt)*S,dt=K.call(M,xt+E[B],C);let Tt;i?(Tt=(Q+A-t[1])*w*e.length+(nt+L-t[0])*e.length+B,n[Tt]=dt):(Tt=(Q+A-t[1])*w+nt+L-t[0],n[B][Tt]=dt)}});R.push(g)}}if(await Promise.all(R),o&&t[2]-t[0]!==o||a&&t[3]-t[1]!==a){let I;return i?I=vA(n,t[2]-t[0],t[3]-t[1],o,a,e.length,l):I=_A(n,t[2]-t[0],t[3]-t[1],o,a,l),I.width=o,I.height=a,I}return n.width=o||t[2]-t[0],n.height=a||t[3]-t[1],n}async readRasters({window:t,samples:e=[],interleave:n,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:h}={}){const c=t||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],f=c[3]-c[1],p=u*f,m=this.getSamplesPerPixel();if(!e||!e.length)for(let v=0;v<m;++v)e.push(v);else for(let v=0;v<e.length;++v)if(e[v]>=m)return Promise.reject(new RangeError(`Invalid sample index '${e[v]}'.`));let _;if(n){const v=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=cu(v,w,p*e.length),l&&_.fill(l)}else{_=[];for(let v=0;v<e.length;++v){const w=this.getArrayForSample(e[v],p);Array.isArray(l)&&v<l.length?w.fill(l[v]):l&&!Array.isArray(l)&&w.fill(l),_.push(w)}}const x=i||await vy(this.fileDirectory);return await this._readRaster(c,e,_,n,x,s,o,a,h)}async readRGB({window:t,interleave:e=!0,pool:n=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const h=t||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===Ke.RGB){let v=[0,1,2];if(this.fileDirectory.ExtraSamples!==iA.Unspecified&&a){v=[];for(let w=0;w<this.fileDirectory.BitsPerSample.length;w+=1)v.push(w)}return this.readRasters({window:t,interleave:e,samples:v,pool:n,width:i,height:s,resampleMethod:o,signal:l})}let u;switch(c){case Ke.WhiteIsZero:case Ke.BlackIsZero:case Ke.Palette:u=[0];break;case Ke.CMYK:u=[0,1,2,3];break;case Ke.YCbCr:case Ke.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:h,interleave:!0,samples:u,pool:n,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:p}=this,m=await this.readRasters(f),_=2**this.fileDirectory.BitsPerSample[0];let x;switch(c){case Ke.WhiteIsZero:x=oA(m,_);break;case Ke.BlackIsZero:x=aA(m,_);break;case Ke.Palette:x=lA(m,p.ColorMap);break;case Ke.CMYK:x=hA(m);break;case Ke.YCbCr:x=cA(m);break;case Ke.CIELab:x=gA(m);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const v=new Uint8Array(x.length/3),w=new Uint8Array(x.length/3),S=new Uint8Array(x.length/3);for(let E=0,T=0;E<x.length;E+=3,++T)v[T]=x[E],w[T]=x[E+1],S[T]=x[E+2];x=[v,w,S]}return x.width=m.width,x.height=m.height,x}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=rA(n,"Item");t===null?i=i.filter(s=>wc(s,"sample")===void 0):i=i.filter(s=>Number(wc(s,"sample"))===t);for(let s=0;s<i.length;++s){const o=i[s];e[wc(o,"name")]=o.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(n)return[n[0],-n[5],n[10]];if(t){const[i,s,o]=t.getResolution();return[i*t.getWidth()/this.getWidth(),s*t.getHeight()/this.getHeight(),o*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const t=this.getHeight(),e=this.getWidth();if(this.fileDirectory.ModelTransformation){const[n,i,s,o,a,l,h,c]=this.fileDirectory.ModelTransformation,u=[[0,0],[0,t],[e,0],[e,t]].map(([m,_])=>[o+n*m+i*_,c+a*m+l*_]),f=u.map(m=>m[0]),p=u.map(m=>m[1]);return[Math.min(...f),Math.min(...p),Math.max(...f),Math.max(...p)]}else{const n=this.getOrigin(),i=this.getResolution(),s=n[0],o=n[1],a=s+i[0]*this.getWidth(),l=o+i[1]*this.getHeight();return[Math.min(s,a),Math.min(o,l),Math.max(s,a),Math.max(o,l)]}}}class EA{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const n=this.getUint32(t,e),i=this.getUint32(t+4,e);let s;if(e){if(s=n+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*n+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(t,e){let n=0;const i=(this._dataView.getUint8(t+(e?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(t+(e?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),n+=a*256**o}return i&&(n=-n),n}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return dy(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class TA{constructor(t,e,n,i){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),n=this.readUint32(t+4);let i;if(this._littleEndian){if(i=e+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*e+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(t){let e=0;const n=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(t+(this._littleEndian?s:7-s));n&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),e+=o*256**s}return n&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const MA=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class RA{constructor(t=MA,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise(n=>{Nn(()=>import("./decoder-kAoyGIq9.ZS5A9fiJ.js"),__vite__mapDeps([10,8])).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<t;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?vy(t).then(n=>n.decode(t,e)):new Promise(n=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,n(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:t,buffer:e,id:s},[e])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const Fp=`\r
\r
`;function by(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const t={};for(const[e,n]of r)t[e.toLowerCase()]=n;return t}function CA(r){const t=r.split(`\r
`).map(e=>{const n=e.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return by(t)}function IA(r){const[t,...e]=r.split(";").map(i=>i.trim()),n=e.map(i=>i.split("="));return{type:t,params:by(n)}}function uu(r){let t,e,n;return r&&([,t,e,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),n=parseInt(n,10)),{start:t,end:e,total:n}}function PA(r,t){let e=null;const n=new TextDecoder("ascii"),i=[],s=`--${t}`,o=`${s}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(r,a,s.length))===s&&(e=a);if(e===null)throw new Error("Could not find initial boundary");for(;e<r.byteLength;){const a=n.decode(new Uint8Array(r,e,Math.min(s.length+1024,r.byteLength-e)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const h=l.indexOf(Fp),c=CA(l.substr(0,h)),{start:u,end:f,total:p}=uu(c["content-range"]),m=e+s.length+h+Fp.length,_=parseInt(f,10)+1-parseInt(u,10);i.push({headers:c,data:r.slice(m,m+_),offset:u,length:_,fileSize:p}),e=m+_+4}return i}class lf{async fetch(t,e=void 0){return Promise.all(t.map(n=>this.fetchSlice(n,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class AA extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[e,n]of t)this.onEviction(e,n.value)}_deleteIfExpired(t,e){return typeof e.expiry=="number"&&e.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,e.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,e){if(this._deleteIfExpired(t,e)===!1)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const n=e.get(t);return this._getItemValue(t,n)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield t)}for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(this._deleteIfExpired(t,e)===!1)return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(t)?this.cache.set(t,{value:e,expiry:i}):this._set(t,{value:e,expiry:i}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],n=e.length-t;n<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(n>0&&this._emitEvictions(e.slice(0,n)),this.oldCache=new Map(e.slice(n)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const n=t[e],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const n=t[e],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[n,i]of this.entriesAscending())t.call(e,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function LA(r){return new Promise(t=>setTimeout(t,r))}function OA(r,t){const e=Array.isArray(r)?r:Array.from(r),n=Array.isArray(t)?t:Array.from(t);return e.map((i,s)=>[i,n[s]])}class Gs extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,Gs),this.name="AbortError"}}class FA extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}const NA=FA;class DA{constructor(t,e,n=null){this.offset=t,this.length=e,this.data=n}get top(){return this.offset+this.length}}class Np{constructor(t,e,n){this.offset=t,this.length=e,this.blockIds=n}}class kA extends lf{constructor(t,{blockSize:e=65536,cacheSize:n=100}={}){super(),this.source=t,this.blockSize=e,this.blockCache=new AA({maxSize:n,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const n=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:f,length:p}of t){let m=f+p;const{fileSize:_}=this;_!==null&&(m=Math.min(m,_));const x=Math.floor(f/this.blockSize)*this.blockSize;for(let v=x;v<m;v+=this.blockSize){const w=Math.floor(v/this.blockSize);!this.blockCache.has(w)&&!this.blockRequests.has(w)&&(this.blockIdsToFetch.add(w),i.push(w)),this.blockRequests.has(w)&&n.push(this.blockRequests.get(w)),s.push(w)}}await LA(),this.fetchBlocks(e);const o=[];for(const f of i)this.blockRequests.has(f)&&o.push(this.blockRequests.get(f));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=s.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(l.forEach(f=>this.blockIdsToFetch.add(f)),l.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const f of l){const p=this.blockRequests.get(f);if(!p)throw new Error(`Block ${f} is not in the block requests`);a.push(p)}await Promise.allSettled(a)}if(e&&e.aborted)throw new Gs("Request was aborted");const h=s.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),c=h.filter(f=>!f);if(c.length)throw new NA(c,"Request failed");const u=new Map(OA(s,h));return this.readSliceData(t,u)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(e,t);for(let i=0;i<e.length;++i){const s=e[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[i],l=o*this.blockSize,h=l-a.offset,c=Math.min(h+this.blockSize,a.data.byteLength),u=a.data.slice(h,c),f=new DA(l,u.byteLength,u,o);this.blockCache.set(o,f),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=t,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((o,a)=>o-a);if(e.length===0)return[];let n=[],i=null;const s=[];for(const o of e)i===null||i+1===o?(n.push(o),i=o):(s.push(new Np(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],i=o);return s.push(new Np(n[0]*this.blockSize,n.length*this.blockSize,n)),s}readSliceData(t,e){return t.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(n.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let h=s;h<=o;++h){const c=e.get(h),u=c.offset-n.offset,f=c.top-i;let p=0,m=0,_;u<0?p=-u:u>0&&(m=u),f<0?_=c.length-p:_=i-c.offset-p;const x=new Uint8Array(c.data,p,_);l.set(x,m)}return a})}}class hf{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class cf{constructor(t){this.url=t}async request({headers:t,credentials:e,signal:n}={}){throw new Error("request is not implemented")}}class GA extends hf{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class jA extends cf{constructor(t,e){super(t),this.credentials=e}async request({headers:t,credentials:e,signal:n}={}){const i=await fetch(this.url,{headers:t,credentials:e,signal:n});return new GA(i)}}class zA extends hf{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class UA extends cf{constructRequest(t,e){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(t))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;n(new zA(s,o))},s.onerror=i,s.onabort=()=>i(new Gs("Request aborted")),s.send(),e&&(e.aborted&&s.abort(),e.addEventListener("abort",()=>s.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}const Dp={};class BA extends hf{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class XA extends cf{constructor(t){super(t),this.parsedUrl=Dp.parse(this.url),this.httpApi=(this.parsedUrl.protocol,Dp)}constructRequest(t,e){return new Promise((n,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:t},o=>{const a=new Promise(l=>{const h=[];o.on("data",c=>{h.push(c)}),o.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),o.on("error",i)});n(new BA(o,a))});s.on("error",i),e&&(e.aborted&&s.destroy(new Gs("Request aborted")),e.addEventListener("abort",()=>s.destroy(new Gs("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class uf extends lf{constructor(t,e,n,i){super(),this.client=t,this.headers=e,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(n=>this.fetchSlice(n,e))))}async fetchSlices(t,e){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:e});if(n.ok)if(n.status===206){const{type:i,params:s}=IA(n.getHeader("content-type"));if(i==="multipart/byteranges"){const u=PA(await n.getData(),s.boundary);return this._fileSize=u[0].fileSize||null,u}const o=await n.getData(),{start:a,end:l,total:h}=uu(n.getHeader("content-range"));this._fileSize=h||null;const c=[{data:o,offset:a,length:l-a}];if(t.length>1){const u=await Promise.all(t.slice(1).map(f=>this.fetchSlice(f,e)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:n,length:i}=t,s=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:e});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=uu(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function df(r,{blockSize:t,cacheSize:e}){return t===null?r:new kA(r,{blockSize:t,cacheSize:e})}function qA(r,{headers:t={},credentials:e,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new jA(r,e),a=new uf(o,t,n,i);return df(a,s)}function WA(r,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...i}={}){const s=new UA(r),o=new uf(s,t,e,n);return df(o,i)}function ZA(r,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...i}={}){const s=new XA(r),o=new uf(s,t,e,n);return df(o,i)}function du(r,{forceXHR:t=!1,...e}={}){return typeof fetch=="function"&&!t?qA(r,e):typeof XMLHttpRequest<"u"?WA(r,e):ZA(r,e)}class $A extends lf{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise((n,i)=>{const s=this.file.slice(t.offset,t.offset+t.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),e&&e.addEventListener("abort",()=>o.abort())})}}function VA(r){return new $A(r)}function fu(r){switch(r){case Mt.BYTE:case Mt.ASCII:case Mt.SBYTE:case Mt.UNDEFINED:return 1;case Mt.SHORT:case Mt.SSHORT:return 2;case Mt.LONG:case Mt.SLONG:case Mt.FLOAT:case Mt.IFD:return 4;case Mt.RATIONAL:case Mt.SRATIONAL:case Mt.DOUBLE:case Mt.LONG8:case Mt.SLONG8:case Mt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function YA(r){const t=r.GeoKeyDirectory;if(!t)return null;const e={};for(let n=4;n<=t[3]*4;n+=4){const i=sA[t[n]],s=t[n+1]?Fo[t[n+1]]:null,o=t[n+2],a=t[n+3];let l=null;if(!s)l=a;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}e[i]=l}return e}function is(r,t,e,n){let i=null,s=null;const o=fu(t);switch(t){case Mt.BYTE:case Mt.ASCII:case Mt.UNDEFINED:i=new Uint8Array(e),s=r.readUint8;break;case Mt.SBYTE:i=new Int8Array(e),s=r.readInt8;break;case Mt.SHORT:i=new Uint16Array(e),s=r.readUint16;break;case Mt.SSHORT:i=new Int16Array(e),s=r.readInt16;break;case Mt.LONG:case Mt.IFD:i=new Uint32Array(e),s=r.readUint32;break;case Mt.SLONG:i=new Int32Array(e),s=r.readInt32;break;case Mt.LONG8:case Mt.IFD8:i=new Array(e),s=r.readUint64;break;case Mt.SLONG8:i=new Array(e),s=r.readInt64;break;case Mt.RATIONAL:i=new Uint32Array(e*2),s=r.readUint32;break;case Mt.SRATIONAL:i=new Int32Array(e*2),s=r.readInt32;break;case Mt.FLOAT:i=new Float32Array(e),s=r.readFloat32;break;case Mt.DOUBLE:i=new Float64Array(e),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===Mt.RATIONAL||t===Mt.SRATIONAL)for(let a=0;a<e;a+=2)i[a]=s.call(r,n+a*o),i[a+1]=s.call(r,n+(a*o+4));else for(let a=0;a<e;++a)i[a]=s.call(r,n+a*o);return t===Mt.ASCII?new TextDecoder("utf-8").decode(i):i}class HA{constructor(t,e,n){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=n}}class rl extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class Sy{async readRasters(t={}){const{window:e,width:n,height:i}=t;let{resX:s,resY:o,bbox:a}=t;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(e&&a)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(e){const[m,_]=l.getOrigin(),[x,v]=l.getResolution();a=[m+e[0]*x,_+e[1]*v,m+e[2]*x,_+e[3]*v]}const p=a||u;if(n){if(s)throw new Error("Both width and resX passed");s=(p[2]-p[0])/n}if(i){if(o)throw new Error("Both width and resY passed");o=(p[3]-p[1])/i}}if(s||o){const p=[];for(let m=0;m<c;++m){const _=await this.getImage(m),{SubfileType:x,NewSubfileType:v}=_.fileDirectory;(m===0||x===2||v&1)&&p.push(_)}p.sort((m,_)=>m.getWidth()-_.getWidth());for(let m=0;m<p.length;++m){const _=p[m],x=(u[2]-u[0])/_.getWidth(),v=(u[3]-u[1])/_.getHeight();if(h=_,s&&s>x||o&&o>v)break}}let f=e;if(a){const[p,m]=l.getOrigin(),[_,x]=h.getResolution(l);f=[Math.round((a[0]-p)/_),Math.round((a[1]-m)/x),Math.round((a[2]-p)/_),Math.round((a[3]-m)/x)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return h.readRasters({...t,window:f})}}class js extends Sy{constructor(t,e,n,i,s={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=n,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const n=this.bigTiff?4048:1024;return new TA((await this.source.fetch([{offset:t,length:typeof e<"u"?e:n}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(t);const s=this.bigTiff?i.readUint64(t):i.readUint16(t),o=s*e+(this.bigTiff?16:6);i.covers(t,o)||(i=await this.getSlice(t,o));const a={};let l=t+(this.bigTiff?8:2);for(let u=0;u<s;l+=e,++u){const f=i.readUint16(l),p=i.readUint16(l+2),m=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let _,x;const v=fu(p),w=l+(this.bigTiff?12:8);if(v*m<=(this.bigTiff?8:4))_=is(i,p,m,w);else{const S=i.readOffset(w),E=fu(p)*m;if(i.covers(S,E))_=is(i,p,m,S);else{const T=await this.getSlice(S,E);_=is(T,p,m,S)}}m===1&&nA.indexOf(f)===-1&&!(p===Mt.RATIONAL||p===Mt.SRATIONAL)?x=_[0]:x=_,a[Fo[f]]=x}const h=YA(a),c=i.readOffset(t+n+e*s);return new HA(a,h,c)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof rl?new rl(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new rl(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new wy(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(n){if(n instanceof rl)e=!1;else throw n}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",n=e.length+100;let i=await this.getSlice(t,n);if(e===is(i,Mt.ASCII,e.length,t)){const s=is(i,Mt.ASCII,n,t).split(`
`)[0],o=Number(s.split("=")[1].split(" ")[0])+s.length;o>n&&(i=await this.getSlice(t,o));const a=is(i,Mt.ASCII,o,t);this.ghostValues={},a.split(`
`).filter(l=>l.length>0).map(l=>l.split("=")).forEach(([l,h])=>{this.ghostValues[l]=h})}return this.ghostValues}static async fromSource(t,e,n){const i=(await t.fetch([{offset:0,length:1024}],n))[0],s=new EA(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let h;if(l===42)h=!1;else if(l===43){if(h=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?s.getUint64(8,a):s.getUint32(4,a);return new js(t,a,h,c,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class KA extends Sy{constructor(t,e){super(),this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,n=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(t===e){const a=await s.requestIFD(n);return new wy(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}e++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((e,n)=>e+n,0),this.imageCount}}async function QA(r,t={},e){return js.fromSource(du(r,t),e)}async function JA(r,t){return js.fromSource(VA(r),t)}async function tL(r,t=[],e={},n){const i=await js.fromSource(du(r,e),n),s=await Promise.all(t.map(o=>js.fromSource(du(o,e))));return new KA(i,s)}function eL(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function rL(r,t){if(!r)return!1;if(r===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const e=t.fileDirectory.PhotometricInterpretation,n=Ke;return e===n.CMYK||e===n.YCbCr||e===n.CIELab||e===n.ICCLab}const kp="STATISTICS_MAXIMUM",Gp="STATISTICS_MINIMUM",Ec=256;let Tc;function nL(){return Tc||(Tc=new RA),Tc}function iL(r){try{return r.getBoundingBox()}catch{return[0,0,r.getWidth(),r.getHeight()]}}function sL(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function oL(r,t){try{return r.getResolution(t)}catch{return[t.getWidth()/r.getWidth(),t.getHeight()/r.getHeight()]}}function aL(r){const t=r.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let n=tt(e);if(!n){const i=Zf(t.ProjLinearUnitsGeoKey);i&&(n=new As({code:e,units:i}))}return n}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const e="EPSG:"+t.GeographicTypeGeoKey;let n=tt(e);if(!n){const i=Zf(t.GeogAngularUnitsGeoKey);i&&(n=new As({code:e,units:i}))}return n}return null}function lL(r){return r.getImageCount().then(function(t){const e=new Array(t);for(let n=0;n<t;++n)e[n]=r.getImage(n);return Promise.all(e)})}function hL(r,t){let e;return r.blob?e=JA(r.blob):r.overviews?e=tL(r.url,r.overviews,t):e=QA(r.url,t),e.then(lL)}function vo(r,t,e,n,i){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(t)||s!=t.length){const o=new Error(n);throw i(o),o}for(let o=0;o<s;++o)vo(r[o],t[o],e,n,i);return}if(t=t,Math.abs(r-t)>e*r)throw new Error(n)}function cL(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function uL(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class ff extends Yd{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,opaque:t.opaque,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const e=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(e),this.sourceMasks_=new Array(e),this.resolutionFactors_=new Array(e),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,i=new Array(e);for(let s=0;s<e;++s)i[s]=hL(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){n.configure_(s)}).catch(function(s){ml(s),n.error_=s,n.setState("error")})}getError(){return this.error_}determineProjection(t){const e=t[0];for(let n=e.length-1;n>=0;--n){const i=e[n],s=aL(i);if(s){this.projection=s;break}}}configure_(t){let e,n,i,s,o;const a=new Array(t.length),l=new Array(t.length),h=new Array(t.length);let c=0;const u=t.length;for(let _=0;_<u;++_){const x=[],v=[];t[_].forEach(I=>{eL(I)?v.push(I):x.push(I)});const w=x.length;if(v.length>0&&v.length!==w)throw new Error(`Expected one mask per image found ${v.length} masks and ${w} images`);let S,E;const T=new Array(w),R=new Array(w),C=new Array(w);l[_]=new Array(w),h[_]=new Array(w);for(let I=0;I<w;++I){const F=x[I],U=F.getGDALNoData();h[_][I]=F.getGDALMetadata(0),l[_][I]=U;const j=this.sourceInfo_[_].bands;a[_]=j?j.length:F.getSamplesPerPixel();const B=w-(I+1);S||(S=iL(F)),E||(E=sL(F));const d=oL(F,x[0]);C[B]=d[0];const g=[F.getTileWidth(),F.getTileHeight()];g[0]!==g[1]&&g[1]<Ec&&(g[0]=Ec,g[1]=Ec),T[B]=g;const y=d[0]/Math.abs(d[1]);R[B]=[g[0],g[1]/y]}if(e?we(e,S,e):e=S,!n)n=E;else{const I=`Origin mismatch for source ${_}, got [${E}] but expected [${n}]`;vo(n,E,0,I,this.viewRejector)}if(!o)o=C,this.resolutionFactors_[_]=1;else{o.length-c>C.length&&(c=o.length-C.length);const I=o[o.length-1]/C[C.length-1];this.resolutionFactors_[_]=I;const F=C.map(j=>j*=I),U=`Resolution mismatch for source ${_}, got [${F}] but expected [${o}]`;vo(o.slice(c,o.length),F,.02,U,this.viewRejector)}i?vo(i.slice(c,i.length),R,.01,`Tile size mismatch for source ${_}`,this.viewRejector):i=R,s?vo(s.slice(c,s.length),T,0,`Tile size mismatch for source ${_}`,this.viewRejector):s=T,this.sourceImagery_[_]=x.reverse(),this.sourceMasks_[_]=v.reverse()}for(let _=0,x=this.sourceImagery_.length;_<x;++_){const v=this.sourceImagery_[_];for(;v.length<o.length;)v.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;t:for(let _=0;_<u;++_){if(this.sourceInfo_[_].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[_].length){this.addAlpha_=!0;break}const x=l[_],v=this.sourceInfo_[_].bands;if(v){for(let w=0;w<v.length;++w)if(x[v[w]-1]!==null){this.addAlpha_=!0;break t}continue}for(let w=0;w<x.length;++w)if(x[w]!==null){this.addAlpha_=!0;break t}}let f=this.addAlpha_?1:0;for(let _=0;_<u;++_)f+=a[_];this.bandCount=f;const p=new fi({extent:e,minZoom:c,origin:n,resolutions:o,tileSizes:i});this.tileGrid=p,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:kc(Re(e),this.projection),extent:nh(e,this.projection),zoom:1})}loadTile_(t,e,n){const i=this.getTileSize(t),s=this.sourceImagery_.length,o=new Array(s*2),a=this.nodataValues_,l=this.sourceInfo_,h=nL();for(let c=0;c<s;++c){const u=l[c],f=this.resolutionFactors_[c],p=[Math.round(e*(i[0]*f)),Math.round(n*(i[1]*f)),Math.round((e+1)*(i[0]*f)),Math.round((n+1)*(i[1]*f))],m=this.sourceImagery_[c][t];let _;u.bands&&(_=u.bands.map(function(E){return E-1}));let x;"nodata"in u&&u.nodata!==null?x=u.nodata:_?x=_.map(function(E){return a[c][E]}):x=a[c];const v={window:p,width:i[0],height:i[1],samples:_,fillValue:x,pool:h,interleave:!1};rL(this.convertToRGB_,m)?o[c]=m.readRGB(v):o[c]=m.readRasters(v);const w=s+c,S=this.sourceMasks_[c][t];if(!S){o[w]=Promise.resolve(null);continue}o[w]=S.readRasters({window:p,width:i[0],height:i[1],samples:[0],pool:h,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,i)).catch(function(c){throw ml(c),c})}composeTile_(t,e){const n=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=t[0]*t[1],f=u*o;let p;h?p=new Uint8Array(f):p=new Float32Array(f);let m=0;for(let _=0;_<u;++_){let x=c;for(let v=0;v<s;++v){const w=i[v];let S=w.min,E=w.max,T,R;if(h){const C=n[v][0];S===void 0&&(C&&Gp in C?S=parseFloat(C[Gp]):S=cL(e[v][0])),E===void 0&&(C&&kp in C?E=parseFloat(C[kp]):E=uL(e[v][0])),T=255/(E-S),R=-S*T}for(let C=0;C<a[v];++C){const I=e[v][C][_];let F;if(h?F=wt(T*I+R,0,255):F=I,!c)p[m]=F;else{let U=w.nodata;if(U===void 0){let B;w.bands?B=w.bands[C]-1:B=C,U=l[v][B]}const j=isNaN(U);(!j&&I!==U||j&&!isNaN(I))&&(x=!1,p[m]=F)}m++}if(!x){const C=s+v,I=e[C];I&&!I[0][_]&&(x=!0)}}c&&(x||(p[m]=255),m++)}return p}}ff.prototype.getView;class re{constructor(t){this.name=t}toString(){return this.name}}re.GeoTIFF=new re("GeoTIFF");re.ImageStatic=new re("ImageStatic");re.PMTilesRaster=new re("PMTilesRaster");re.PMTilesVector=new re("PMTilesVector");re.TileJSON=new re("TileJSON");re.TileWMS=new re("TileWMS");re.WMTS=new re("WMTS");re.XYZ=new re("XYZ");class dL extends ch{constructor(t,e,n,i,s,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?we(n,h):n,u=Re(c),f=ra(t,e,u,i),p=Ad,m=new Od(t,e,c,l,f*p,i),_=m.calculateSourceExtent(),x=kn(_)?null:o(_,f,s),v=x?et.IDLE:et.EMPTY,w=x?x.getPixelRatio():1;super(n,i,w,v),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=m,this.targetResolution_=i,this.targetExtent_=n,this.sourceImage_=x,this.sourcePixelRatio_=w,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==et.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==et.LOADED){const e=yt(this.targetExtent_)/this.targetResolution_,n=Vt(this.targetExtent_)/this.targetResolution_;this.canvas_=Fd(e,n,this.sourcePixelRatio_,zl(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==et.IDLE){this.state=et.LOADING,this.changed();const t=this.sourceImage_.getState();t==et.LOADED||t==et.ERROR?this.reproject_():(this.sourceListenerKey_=le(this.sourceImage_,Lt.CHANGE,function(e){const n=this.sourceImage_.getState();(n==et.LOADED||n==et.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){ve(this.sourceListenerKey_),this.sourceListenerKey_=null}}const tn=4,Mc={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class fL extends cn{constructor(t,e){super(t),this.image=e}}class gL extends Qs{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const n=Ql(e,t,0);t=e[n]}return t}getImage(t,e,n,i){const s=this.getProjection();if(!s||!i||Pe(s,i))return s&&(i=s),this.getImageInternal(t,e,n,i);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Pe(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==e&&An(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new dL(s,i,t,e,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,n,i){if(this.loader){const s=Nh(t,e,n,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&We(this.wantedExtent_,s)||We(this.image.getExtent(),s))&&(this.wantedResolution_&&zl(this.wantedResolution_)===o||zl(this.image.getResolution())===o)))return this.image;this.wantedProjection_=i,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new ch(s,o,n,this.loader),this.image.addEventListener(Lt.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let n;switch(e.getState()){case et.LOADING:this.loading=!0,n=Mc.IMAGELOADSTART;break;case et.LOADED:this.loading=!1,n=Mc.IMAGELOADEND;break;case et.ERROR:this.loading=!1,n=Mc.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new fL(n,e))}}function Fh(r,t){r.getImage().src=t}function Nh(r,t,e,n){const i=t/e,s=Re(r),o=Qn(yt(r)/i,tn),a=Qn(Vt(r)/i,tn),l=Qn((n-1)*o/2,tn),h=o+2*l,c=Qn((n-1)*a/2,tn),u=a+2*c;return Iu(s,i,0,[h,u])}const pi=gL;function Ey(r){const t=r.load||di,e=r.imageExtent,n=new Image;return r.crossOrigin!==null&&(n.crossOrigin=r.crossOrigin),()=>t(n,r.url).then(i=>{const s=yt(e)/i.width,o=Vt(e)/i.height;return{image:i,extent:e,resolution:s!==o?[s,o]:o,pixelRatio:1}})}class Ty extends pi{constructor(t){const e=t.crossOrigin!==void 0?t.crossOrigin:null,n=t.imageLoadFunction!==void 0?t.imageLoadFunction:Fh;super({attributions:t.attributions,interpolate:t.interpolate,projection:tt(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new ch(this.imageExtent_,void 0,1,Ey({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(i,s)=>(this.image.setImage(i),n(this.image,s),di(i))})),this.image.addEventListener(Lt.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,n,i){return Qt(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}function pL(r,t){const e=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(i,o[2].toString()).replace(s,function(){const h=o[0],c=t.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function gf(r,t){const e=r.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=pL(r[i],t);return zs(n)}function zs(r){return r.length===1?r[0]:function(t,e,n){if(!t)return;const i=kd(t),s=nn(i,r.length);return r[s](t,e,n)}}function mL(r,t,e){}function pf(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const n=e[1].charCodeAt(0),i=e[2].charCodeAt(0);let s;for(s=n;s<=i;++s)t.push(r.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const n=parseInt(e[2],10);for(let i=parseInt(e[1],10);i<=n;i++)t.push(r.replace(e[0],i.toString()));return t}return t.push(r),t}class mf extends Ia{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===mf.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=it(e),i=e.getState();let s;i==q.LOADING?(this.tileLoadingKeys_[n]=!0,s=Ts.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==q.ERROR?Ts.TILELOADERROR:i==q.LOADED?Ts.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new ty(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=pf(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(gf(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const i=ln(t,e,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const _f=mf;class Cr extends _f{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:_L,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Ra,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const i in this.tileCacheForProjection){const s=this.tileCacheForProjection[i];s.expireCache(s==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Pe(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Pe(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Pe(e,t)))return this.tileGrid;const n=it(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Vd(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Pe(e,t))return this.tileCache;const n=it(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Lh(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,i,s,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,i,s):void 0,c=new this.tileClass(a,h!==void 0?q.IDLE:q.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(Lt.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,n,i,s){const o=this.getProjection();if(!o||!s||Pe(o,s))return this.getTileInternal(t,e,n,i,o||s);const a=this.getTileCacheForProjection(s),l=[t,e,n];let h;const c=Kn(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const f=this.getTileGridForProjection(o),p=this.getTileGridForProjection(s),m=this.getTileCoordForTileUrlFunction(l,s),_=new ks(o,f,s,p,l,m,this.getTilePixelRatio(i),this.getGutter(),(x,v,w,S)=>this.getTileInternal(x,v,w,S,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(t,e,n,i,s){let o=null;const a=ln(t,e,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,n,i,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,n,i,s,l),h.getState()==q.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=tt(t);if(n){const i=it(n);i in this.tileGridForProjection||(this.tileGridForProjection[i]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function _L(r,t){r.getImage().src=t}function yf(r,t,e,n){const i=document.createElement("script"),s="olc_"+it(t);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=r+(r.includes("?")?"&":"?")+(n||"callback")+"="+s;const a=setTimeout(function(){o(),e&&e()},1e4);window[s]=function(l){clearTimeout(a),o(),t(l)},document.head.appendChild(i)}class yL extends Error{constructor(t){const e="Unexpected response status: "+t.status;super(e),this.name="ResponseError",this.response=t}}class xL extends Error{constructor(t){super("Failed to issue request"),this.name="ClientError",this.client=t}}function My(r){return new Promise(function(t,e){function n(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(h){const c="Error parsing response text as JSON: "+h.message;e(new Error(c));return}t(l);return}e(new yL(a))}function i(o){e(new xL(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",n),s.addEventListener("error",i),s.open("GET",r),s.setRequestHeader("Accept","application/json"),s.send()})}function Ry(r,t){return t.includes("://")?t:new URL(t,r).href}class Cy extends Cr{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:tt("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)yf(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){const e=tt("EPSG:4326"),n=this.getProjection();let i;if(t.bounds!==void 0){const h=Bi(e,n);i=Ps(t.bounds,h)}const s=zn(n),o=t.minzoom||0,a=t.maxzoom||22,l=Wi({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=gf(t.tiles,l),t.attribution&&!this.getAttributions()){const h=i!==void 0?i:s;this.setAttributions(function(c){return Qt(h,c.extent)?[t.attribution]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}}let vL=class extends Js{constructor(r,t,e,n,i,s){super(r,t,s),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=i,this.url_=e,this.key=e}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==q.IDLE&&(this.setState(q.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(r,t){this.setFeatures(r)}onError(){this.setState(q.ERROR)}setFeatures(r){this.features_=r,this.setState(q.LOADED)}setLoader(r){this.loader_=r}};const jp=[];class wL extends Js{constructor(t,e,n,i){super(t,e,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.wrappedTileCoord=n}getContext(t){const e=it(t);return e in this.context_||(this.context_[e]=Jt(1,1,jp)),this.context_[e]}hasContext(t){return it(t)in this.context_}getImage(t){return this.hasContext(t)?this.getContext(t).canvas:null}getReplayState(t){const e=it(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){for(const t in this.context_){const e=this.context_[t];Oi(e),jp.push(e.canvas),delete this.context_[t]}super.release()}}class Dh extends _f{constructor(t){const e=t.projection||"EPSG:3857",n=t.extent||zn(e),i=t.tileGrid||Wi({extent:n,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:e,state:t.state,tileGrid:i,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:bL,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.sourceTileCache=new Lh(this.tileCache.highWaterMark),this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:vL,this.tileGrids_={}}getFeaturesInExtent(t){const e=[],n=this.tileCache;if(n.getCount()===0)return e;const i=A_(n.peekFirstKey())[0],s=this.tileGrid;return n.forEach(function(o){if(o.tileCoord[0]!==i||o.getState()!==q.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.tileCoord;if(Qt(t,s.getTileCoordExtent(u))){const f=c.getFeatures();if(f)for(let p=0,m=f.length;p<m;++p){const _=f[p],x=_.getGeometry();Qt(t,x.getExtent())&&e.push(_)}}}}),e}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(t,e){const n=this.getTileCacheForProjection(t),i=Object.keys(e).reduce((s,o)=>{const a=JC(o),l=n.peek(a);if(l){const h=l.sourceTiles;for(let c=0,u=h.length;c<u;++c)s[h[c].getKey()]=!0}return s},{});super.expireCache(t,e),this.sourceTileCache.expireCache(i)}getSourceTiles(t,e,n){if(n.getState()===q.IDLE){n.setState(q.LOADING);const i=n.wrappedTileCoord,s=this.getTileGridForProjection(e),o=s.getTileCoordExtent(i),a=i[0],l=s.getResolution(a);Mr(o,-l,o);const h=this.tileGrid,c=h.getExtent();c&&we(o,c,o);const u=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,u,f=>{const p=this.tileUrlFunction(f,t,e),m=this.sourceTileCache.containsKey(p)?this.sourceTileCache.get(p):new this.tileClass(f,p?q.IDLE:q.EMPTY,p,this.format_,this.tileLoadFunction);n.sourceTiles.push(m);const _=m.getState();if(_<q.LOADED){const x=v=>{this.handleTileChange(v);const w=m.getState();if(w===q.LOADED||w===q.ERROR){const S=m.getKey();S in n.errorTileKeys?m.getState()===q.LOADED&&delete n.errorTileKeys[S]:n.loadingSourceTiles--,w===q.ERROR?n.errorTileKeys[S]=!0:m.removeEventListener(Lt.CHANGE,x),n.loadingSourceTiles===0&&n.setState(Pn(n.errorTileKeys)?q.LOADED:q.ERROR)}};m.addEventListener(Lt.CHANGE,x),n.loadingSourceTiles++}_===q.IDLE&&(m.extent=h.getTileCoordExtent(f),m.projection=e,m.resolution=h.getResolution(f[0]),this.sourceTileCache.set(p,m),m.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(f=>f.getState()===q.ERROR)?q.ERROR:q.LOADED)}return n.sourceTiles}getTile(t,e,n,i,s){const o=ln(t,e,n),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[t,e,n];let c=this.getTileCoordForTileUrlFunction(h,s);const u=this.getTileGrid().getExtent(),f=this.getTileGridForProjection(s);if(c&&u){const _=f.getTileCoordExtent(c);Mr(_,-f.getResolution(t),_),Qt(u,_)||(c=null)}let p=!0;if(c!==null){const _=this.tileGrid,x=f.getResolution(t),v=_.getZForResolution(x,1),w=f.getTileCoordExtent(c);Mr(w,-x,w),_.forEachTileCoord(w,v,S=>{p=p&&!this.tileUrlFunction(S,i,s)})}const m=new wL(h,p?q.EMPTY:q.IDLE,c,this.getSourceTiles.bind(this,i,s));return m.key=a,l?(m.interimTile=l,m.refreshInterimChain(),this.tileCache.replace(o,m)):this.tileCache.set(o,m),m}getTileGridForProjection(t){const e=t.getCode();let n=this.tileGrids_[e];if(!n){const i=this.tileGrid,s=i.getResolutions().slice(),o=s.map(function(h,c){return i.getOrigin(c)}),a=s.map(function(h,c){return i.getTileSize(c)}),l=K0+1;for(let h=s.length;h<l;++h)s.push(s[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);n=new fi({extent:i.getExtent(),origins:o,resolutions:s,tileSizes:a}),this.tileGrids_[e]=n}return n}getTilePixelRatio(t){return t}getTilePixelSize(t,e,n){const i=this.getTileGridForProjection(n),s=ie(i.getTileSize(t),this.tmpSize);return[Math.round(s[0]*e),Math.round(s[1]*e)]}updateCacheSize(t,e){super.updateCacheSize(t*2,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}}function bL(r,t){r.setLoader(function(e,n,i){y_(t,r.getFormat(),e,n,i,r.onLoad.bind(r),r.onError.bind(r))})}function Fn(r,t){const e=[];Object.keys(t).forEach(function(i){t[i]!==null&&t[i]!==void 0&&e.push(i+"="+encodeURIComponent(t[i]))});const n=e.join("&");return r=r.replace(/[?&]$/,""),r+=r.includes("?")?"&":"?",r+n}const ql="1.3.0",zp=[101,101];function Iy(r,t,e,n,i){i.WIDTH=e[0],i.HEIGHT=e[1];const s=n.getAxisOrientation();let o;const a=Au(i.VERSION,"1.3")>=0;return i[a?"CRS":"SRS"]=n.getCode(),a&&s.substr(0,2)=="ne"?o=[t[1],t[0],t[3],t[2]]:o=t,i.BBOX=o.join(","),Fn(r,i)}function Py(r,t,e,n,i,s,o){s=Object.assign({REQUEST:"GetMap"},s);const a=t/e,l=[gl(yt(r)/a,tn),gl(Vt(r)/a,tn)];if(e!=1)switch(o){case"geoserver":const h=90*e+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+h:s.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":s.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":s.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return Iy(i,r,l,n,s)}function Wl(r,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:ql,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},r)}function Ay(r){const t=r.hidpi===void 0?!0:r.hidpi,e=tt(r.projection||"EPSG:3857"),n=r.ratio||1.5,i=r.load||di;return(s,o,a)=>{s=Nh(s,o,a,n),a!=1&&(!t||r.serverType===void 0)&&(a=1);const l=Py(s,o,a,e,r.url,Wl(r.params,"GetMap"),r.serverType),h=new Image;return r.crossOrigin!==null&&(h.crossOrigin=r.crossOrigin),i(h,l).then(c=>({image:c,extent:s,pixelRatio:a}))}}function SL(r,t,e){if(r.url===void 0)return;const n=tt(r.projection||"EPSG:3857"),i=Iu(t,e,0,zp),s={QUERY_LAYERS:r.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(s,Wl(r.params,"GetFeatureInfo"),r.params);const o=fs((t[0]-i[0])/e,tn),a=fs((i[3]-t[1])/e,tn),l=Au(s.VERSION,"1.3")>=0;return s[l?"I":"X"]=o,s[l?"J":"Y"]=a,Iy(r.url,i,zp,n,s)}function EL(r,t){if(r.url===void 0)return;const e={SERVICE:"WMS",VERSION:ql,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(r.params===void 0||r.params.LAYER===void 0){const n=r.params.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;e.LAYER=n}if(t!==void 0){const n=tt(r.projection||"EPSG:3857").getMetersPerUnit()||1,i=28e-5;e.SCALE=t*n/i}return Object.assign(e,r.params),Fn(r.url,e)}class Ly extends Cr{constructor(t){t=t||{};const e=Object.assign({},t.params),n="TRANSPARENT"in e?e.TRANSPARENT:!0;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!n,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=je(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,n,i){const s=tt(n),o=this.getProjection()||s;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=rh(t,s,o),h=ra(o,s,t,e),c=a.getZForResolution(h,this.zDirection),u=a.getResolution(c),f=a.getTileCoordForCoordAndZ(l,c);if(a.getResolutions().length<=f[0])return;let p=a.getTileCoordExtent(f,this.tmpExtent_);const m=this.gutter_;m!==0&&(p=Mr(p,u*m,p));const _={QUERY_LAYERS:this.params_.LAYERS};Object.assign(_,Wl(this.params_,"GetFeatureInfo"),i);const x=Math.floor((l[0]-p[0])/u),v=Math.floor((p[3]-l[1])/u);return _[this.v13_?"I":"X"]=x,_[this.v13_?"J":"Y"]=v,this.getRequestUrl_(f,p,1,o||s,_)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const n={SERVICE:"WMS",VERSION:ql,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const i=this.params_.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;n.LAYER=i}if(t!==void 0){const i=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;n.SCALE=t*i/s}return Object.assign(n,e),Fn(this.urls[0],n)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,n,i,s){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=nn(kd(t),o.length);a=o[l]}return Py(e,(this.tileGrid||this.getTileGridForProjection(i)).getResolution(t[0]),n,i,a,s,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||ql;this.v13_=Au(t,"1.3")>=0}tileUrlFunction(t,e,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const s=i.getResolution(t[0]);let o=i.getTileCoordExtent(t,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=Mr(o,s*a,o));const l=Object.assign({},Wl(this.params_,"GetMap"));return this.getRequestUrl_(t,o,e,n,l)}}class Oy extends Cr{constructor(t){const e=t.requestEncoding!==void 0?t.requestEncoding:"KVP",n=t.tileGrid;let i=t.urls;i===void 0&&t.url!==void 0&&(i=pf(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:i,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),i&&i.length>0&&(this.tileUrlFunction=zs(i.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join(`
`);this.setTileUrlFunction(zs(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Fn(t,n):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,s);let c=t;return e=="KVP"?c=Fn(c,h):c=c.replace(/\{(\w+?)\}/g,function(u,f){return h[f]}),c}}}function Fy(r,t){const e=r.Contents.Layer,n=e==null?void 0:e.find(function(j){return j.Identifier==t.layer});if(!n)return null;const i=r.Contents.TileMatrixSet;let s;n.TileMatrixSetLink.length>1?"projection"in t?s=n.TileMatrixSetLink.findIndex(function(j){const B=i.find(function(y){return y.Identifier==j.TileMatrixSet}).SupportedCRS,d=tt(B),g=tt(t.projection);return d&&g?Pe(d,g):B==t.projection}):s=n.TileMatrixSetLink.findIndex(function(j){return j.TileMatrixSet==t.matrixSet}):s=0,s<0&&(s=0);const o=n.TileMatrixSetLink[s].TileMatrixSet,a=n.TileMatrixSetLink[s].TileMatrixSetLimits;let l=n.Format[0];"format"in t&&(l=t.format),s=n.Style.findIndex(function(j){return"style"in t?j.Title==t.style:j.isDefault}),s<0&&(s=0);const h=n.Style[s].Identifier,c={};"Dimension"in n&&n.Dimension.forEach(function(j,B,d){const g=j.Identifier;let y=j.Default;y===void 0&&(y=j.Value[0]),c[g]=y});const u=r.Contents.TileMatrixSet.find(function(j){return j.Identifier==o});let f;const p=u.SupportedCRS;if(p&&(f=tt(p)),"projection"in t){const j=tt(t.projection);j&&(!f||Pe(j,f))&&(f=j)}let m=!1;const _=f.getAxisOrientation().substr(0,2)=="ne";let x=u.TileMatrix[0],v={MinTileCol:0,MinTileRow:0,MaxTileCol:x.MatrixWidth-1,MaxTileRow:x.MatrixHeight-1};if(a){v=a[a.length-1];const j=u.TileMatrix.find(B=>B.Identifier===v.TileMatrix||u.Identifier+":"+B.Identifier===v.TileMatrix);j&&(x=j)}const w=x.ScaleDenominator*28e-5/f.getMetersPerUnit(),S=_?[x.TopLeftCorner[1],x.TopLeftCorner[0]]:x.TopLeftCorner,E=x.TileWidth*w,T=x.TileHeight*w;let R=u.BoundingBox;R&&_&&(R=[R[1],R[0],R[3],R[2]]);let C=[S[0]+E*v.MinTileCol,S[1]-T*(1+v.MaxTileRow),S[0]+E*(1+v.MaxTileCol),S[1]-T*v.MinTileRow];if(R!==void 0&&!We(R,C)){const j=n.WGS84BoundingBox,B=tt("EPSG:4326").getExtent();if(C=R,j)m=j[0]===B[0]&&j[2]===B[2];else{const d=Fu(R,u.SupportedCRS,"EPSG:4326");m=d[0]-1e-10<=B[0]&&d[2]+1e-10>=B[2]}}const I=vP(u,C,a),F=[];let U=t.requestEncoding;if(U=U!==void 0?U:"","OperationsMetadata"in r&&"GetTile"in r.OperationsMetadata){const j=r.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let B=0,d=j.length;B<d;++B)if(j[B].Constraint){const g=j[B].Constraint.find(function(y){return y.name=="GetEncoding"}).AllowedValues.Value;if(U===""&&(U=g[0]),U==="KVP")g.includes("KVP")&&F.push(j[B].href);else break}else j[B].href&&(U="KVP",F.push(j[B].href))}return F.length===0&&(U="REST",n.ResourceURL.forEach(function(j){j.resourceType==="tile"&&(l=j.format,F.push(j.template))})),{urls:F,layer:t.layer,matrixSet:o,format:l,projection:f,requestEncoding:U,tileGrid:I,style:h,dimensions:c,wrapX:m,crossOrigin:t.crossOrigin}}class Di extends Cr{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Wi({extent:zn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}var Ny={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(Ci,function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(u,f){return u.indexOf(f)===-1?u.length:u.indexOf(f)}function i(u){var f=u.replace(/^v/,"").replace(/\+.*$/,""),p=n(f,"-"),m=f.substring(0,p).split(".");return m.push(f.substring(p+1)),m}function s(u){return isNaN(Number(u))?u:Number(u)}function o(u){if(typeof u!="string")throw new TypeError("Invalid argument expected string");if(!e.test(u))throw new Error("Invalid argument not valid semver ('"+u+"' received)")}function a(u,f){[u,f].forEach(o);for(var p=i(u),m=i(f),_=0;_<Math.max(p.length-1,m.length-1);_++){var x=parseInt(p[_]||0,10),v=parseInt(m[_]||0,10);if(x>v)return 1;if(v>x)return-1}var w=p[p.length-1],S=m[m.length-1];if(w&&S){var E=w.split(".").map(s),T=S.split(".").map(s);for(_=0;_<Math.max(E.length,T.length);_++){if(E[_]===void 0||typeof T[_]=="string"&&typeof E[_]=="number")return-1;if(T[_]===void 0||typeof E[_]=="string"&&typeof T[_]=="number"||E[_]>T[_])return 1;if(T[_]>E[_])return-1}}else if(w||S)return w?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function c(u){if(typeof u!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof u);if(l.indexOf(u)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(u){return typeof u=="string"&&e.test(u)},a.compare=function(u,f,p){c(p);var m=a(u,f);return h[p].indexOf(m)>-1},a})})(Ny);var TL=Ny.exports,gu=TL;const xf="1.0.0",ft={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Pi={itemAndCollection:{"cube:":ft.datacube,"eo:":ft.eo,"file:":ft.file,"label:":ft.label,"pc:":ft.pointcloud,"processing:":ft.processing,"proj:":ft.projection,"raster:":ft.raster,"sar:":ft.sar,"sat:":ft.sat,"sci:":ft.scientific,"view:":ft.view,version:ft.version,deprecated:ft.version,published:ft.timestamps,expires:ft.timestamps,unpublished:ft.timestamps},catalog:{},collection:{item_assets:ft["item-assets"]},item:{}};Pi.collection=Object.assign(Pi.collection,Pi.itemAndCollection);Pi.item=Object.assign(Pi.item,Pi.itemAndCollection);var wo={parseUrl(r){let t=r.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(t)return{id:t[1],version:t[2]}}},Ft={version:xf,extensions:{},set(r){if(typeof r.stac_version!="string"?Ft.version="0.6.0":Ft.version=r.stac_version,Array.isArray(r.stac_extensions))for(let t of r.stac_extensions){let e=wo.parseUrl(t);e&&(Ft.extensions[e.id]=e.version)}},before(r,t=null){let e=t?Ft.extensions[t]:Ft.version;return typeof e>"u"?!1:gu.compare(e,r,"<")}},k={type(r){let t=typeof r;if(t==="object"){if(r===null)return"null";if(Array.isArray(r))return"array"}return t},is(r,t){return k.type(r)===t},isDefined(r){return typeof r<"u"},isObject(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)},rename(r,t,e){return typeof r[t]<"u"&&typeof r[e]>"u"?(r[e]=r[t],delete r[t],!0):!1},forAll(r,t,e){if(r[t]&&typeof r[t]=="object")for(let n in r[t])e(r[t][n])},toArray(r,t){return typeof r[t]<"u"&&!Array.isArray(r[t])?(r[t]=[r[t]],!0):!1},flattenArray(r,t,e,n=!1){if(Array.isArray(r[t])){for(let i in r[t])if(typeof e[i]=="string"){let s=r[t][i];r[e[i]]=n?[s]:s}return delete r[t],!0}return!1},flattenOneElementArray(r,t,e=!1){return!e&&Array.isArray(r[t])?r[t].length===1?(r[t]=r[t][0],!0):!1:!0},removeFromArray(r,t,e){if(Array.isArray(r[t])){let n=r[t].indexOf(e);return n>-1&&r[t].splice(n,1),!0}return!1},ensure(r,t,e){return k.type(e)!==k.type(r[t])&&(r[t]=e),!0},upgradeExtension(r,t){let{id:e,version:n}=wo.parseUrl(t),i=r.stac_extensions.findIndex(s=>{let o=wo.parseUrl(s);return o&&o.id===e&&gu.compare(o.version,n,"<")});return i!==-1?(r.stac_extensions[i]=t,!0):!1},addExtension(r,t){let{id:e,version:n}=wo.parseUrl(t),i=r.stac_extensions.findIndex(s=>{if(s===t)return!0;let o=wo.parseUrl(s);return!!(o&&o.id===e&&gu.compare(o.version,n,"<"))});return i===-1?r.stac_extensions.push(t):r.stac_extensions[i]=t,r.stac_extensions.sort(),!0},removeExtension(r,t){return k.removeFromArray(r,"stac_extensions",t)},migrateExtensionShortnames(r){let t=Object.keys(ft),e=Object.values(ft);return k.mapValues(r,"stac_extensions",t,e)},populateExtensions(r,t){let e=[];(t=="catalog"||t=="collection")&&e.push(r),(t=="item"||t=="collection")&&k.isObject(r.assets)&&(e=e.concat(Object.values(r.assets))),t=="collection"&&k.isObject(r.item_assets)&&(e=e.concat(Object.values(r.item_assets))),t=="collection"&&k.isObject(r.summaries)&&e.push(r.summaries),t=="item"&&k.isObject(r.properties)&&e.push(r.properties);for(let n of e)Object.keys(n).forEach(i=>{let s=i.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let o=Pi[t][s[0]];k.is(o,"string")&&k.addExtension(r,o)}})},mapValues(r,t,e,n){let i=s=>{let o=e.indexOf(s);return o>=0?n[o]:s};return Array.isArray(r[t])?r[t]=r[t].map(i):typeof r[t]<"u"&&(r[t]=i(r[t])),!0},mapObject(r,t){for(let e in r)r[e]=t(r[e],e)},moveTo(r,t,e,n=!1,i=!1){let s;return n?i?s=o=>Array.isArray(o):s=o=>Array.isArray(o)&&o.length===1:s=k.isDefined,s(r[t])?(e[t]=n&&!i?r[t][0]:r[t],delete r[t],!0):!1},runAll(r,t,e,n){for(let i in r)i.startsWith("migrate")||r[i](t,e,n)},toUTC(r,t){if(typeof r[t]=="string")try{return r[t]=this.toISOString(r[t]),!0}catch{}return delete r[t],!1},toISOString(r){return r instanceof Date||(r=new Date(r)),r.toISOString().replace(".000","")}},Qr={multihash:null,hexToUint8(r){if(r.length===0||r.length%2!==0)throw new Error(`The string "${r}" is not valid hex.`);return new Uint8Array(r.match(/.{1,2}/g).map(t=>parseInt(t,16)))},uint8ToHex(r){return r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),"")},toMultihash(r,t,e){if(!Qr.multihash||!k.is(r[t],"string"))return!1;try{const n=Qr.multihash.encode(Qr.hexToUint8(r[t]),e);return r[t]=Qr.uint8ToHex(n),!0}catch(n){return console.warn(n),!1}}},vf={migrate(r,t=!0){return Ft.set(r),t&&(r.stac_version=xf),r.type="Catalog",k.ensure(r,"stac_extensions",[]),Ft.before("1.0.0-rc.1")&&k.migrateExtensionShortnames(r),k.ensure(r,"id",""),k.ensure(r,"description",""),k.ensure(r,"links",[]),k.runAll(vf,r,r),Ft.before("0.8.0")&&k.populateExtensions(r,"catalog"),r}},wf={migrate(r,t=!0){return vf.migrate(r,t),r.type="Collection",Ft.before("1.0.0-rc.1")&&k.migrateExtensionShortnames(r),k.ensure(r,"license","proprietary"),k.ensure(r,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),k.runAll(wf,r,r),k.isObject(r.properties)&&(k.removeFromArray(r,"stac_extensions","commons"),delete r.properties),Ft.before("0.8.0")&&k.populateExtensions(r,"collection"),Ft.before("1.0.0-beta.1")&&k.mapValues(r,"stac_extensions",["assets"],["item-assets"]),r},extent(r){if(k.ensure(r,"extent",{}),Ft.before("0.8.0")&&(Array.isArray(r.extent.spatial)&&(r.extent.spatial={bbox:[r.extent.spatial]}),Array.isArray(r.extent.temporal)&&(r.extent.temporal={interval:[r.extent.temporal]})),k.ensure(r.extent,"spatial",{}),k.ensure(r.extent.spatial,"bbox",[]),k.ensure(r.extent,"temporal",{}),k.ensure(r.extent.temporal,"interval",[]),Ft.before("1.0.0-rc.3")){if(r.extent.temporal.interval.length>1){let t,e;for(let n of r.extent.temporal.interval){if(n[0]===null)t=null;else if(typeof n[0]=="string"&&t!==null)try{let i=new Date(n[0]);(typeof t>"u"||i<t)&&(t=i)}catch{}if(n[1]===null)e=null;else if(typeof n[1]=="string"&&e!==null)try{let i=new Date(n[1]);(typeof e>"u"||i>e)&&(e=i)}catch{}}r.extent.temporal.interval.unshift([t?k.toISOString(t):null,e?k.toISOString(e):null])}if(r.extent.spatial.bbox.length>1){let t=r.extent.spatial.bbox.reduce((e,n)=>Array.isArray(n)?Math.max(n.length,e):e,4);if(t>=4){let e=new Array(t).fill(null),n=t/2;for(let i of r.extent.spatial.bbox){if(!Array.isArray(i)||i.length<4)break;for(let s in i){let o=i[s];e[s]===null?e[s]=o:s<n?e[s]=Math.min(o,e[s]):e[s]=Math.max(o,e[s])}}e.findIndex(i=>i===null)===-1&&r.extent.spatial.bbox.unshift(e)}}}},collectionAssets(r){Ft.before("1.0.0-rc.1")&&k.removeExtension(r,"collection-assets"),sa.migrateAll(r)},itemAsset(r){Ft.before("1.0.0-beta.2")&&k.rename(r,"item_assets","assets"),sa.migrateAll(r,"item_assets")},summaries(r){if(k.ensure(r,"summaries",{}),Ft.before("0.8.0")&&k.isObject(r.other_properties)){for(let t in r.other_properties){let e=r.other_properties[t];Array.isArray(e.extent)&&e.extent.length===2?r.summaries[t]={minimum:e.extent[0],maximum:e.extent[1]}:Array.isArray(e.values)&&(e.values.filter(n=>Array.isArray(n)).length===e.values.length?r.summaries[t]=e.values.reduce((n,i)=>n.concat(i),[]):r.summaries[t]=e.values)}delete r.other_properties}if(Ft.before("1.0.0-beta.1")&&k.isObject(r.properties)&&!r.links.find(t=>["child","item"].includes(t.rel)))for(let t in r.properties){let e=r.properties[t];Array.isArray(e)||(e=[e]),r.summaries[t]=e}Ft.before("1.0.0-rc.1")&&k.mapObject(r.summaries,t=>(k.rename(t,"min","minimum"),k.rename(t,"max","maximum"),t)),kh.migrate(r.summaries,r,!0),k.moveTo(r.summaries,"sci:doi",r,!0)&&k.addExtension(r,ft.scientific),k.moveTo(r.summaries,"sci:publications",r,!0,!0)&&k.addExtension(r,ft.scientific),k.moveTo(r.summaries,"sci:citation",r,!0)&&k.addExtension(r,ft.scientific),k.moveTo(r.summaries,"cube:dimensions",r,!0)&&k.addExtension(r,ft.datacube),Object.keys(r.summaries).length===0&&delete r.summaries}},bf={migrate(r,t=null,e=!0){Ft.set(r),e&&(r.stac_version=xf),k.ensure(r,"stac_extensions",[]),Ft.before("1.0.0-rc.1")&&k.migrateExtensionShortnames(r),k.ensure(r,"id",""),k.ensure(r,"type","Feature"),k.isObject(r.geometry)||(r.geometry=null),r.geometry!==null&&k.ensure(r,"bbox",[]),k.ensure(r,"properties",{}),k.ensure(r,"links",[]),k.ensure(r,"assets",{});let n=!1;return k.isObject(t)&&k.isObject(t.properties)&&(k.removeFromArray(r,"stac_extensions","commons"),r.properties=Object.assign({},t.properties,r.properties),n=!0),k.runAll(bf,r,r),kh.migrate(r.properties,r),sa.migrateAll(r),(Ft.before("0.8.0")||n)&&k.populateExtensions(r,"item"),r}},Dy={migrate(r,t=!0){return k.ensure(r,"collections",[]),k.ensure(r,"links",[]),k.runAll(Dy,r,r),r.collections=r.collections.map(e=>wf.migrate(e,t)),r}},ky={migrate(r,t=!0){return k.ensure(r,"type","FeatureCollection"),k.ensure(r,"features",[]),k.ensure(r,"links",[]),k.runAll(ky,r,r),r.features=r.features.map(e=>bf.migrate(e,null,t)),r}},sa={migrateAll(r,t="assets"){for(let e in r[t])sa.migrate(r[t][e],r)},migrate(r,t){return k.runAll(sa,r,t),kh.migrate(r,t),r},mediaTypes(r){k.is(r.type,"string")&&k.mapValues(r,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(r,t){let e=k.isObject(t.properties)&&Array.isArray(t.properties["eo:bands"])?t.properties["eo:bands"]:[];if(Array.isArray(r["eo:bands"]))for(let n in r["eo:bands"]){let i=r["eo:bands"][n];k.is(i,"number")&&k.isObject(e[i])?i=e[i]:k.isObject(i)||(i={}),r["eo:bands"][n]=i}}},kh={migrate(r,t,e=!1){return k.runAll(kh,r,t,e),r},_commonMetadata(r){Ft.before("1.0.0-rc.3")&&(k.toUTC(r,"created"),k.toUTC(r,"updated"))},_timestamps(r,t){k.toUTC(r,"published"),k.toUTC(r,"expires"),k.toUTC(r,"unpublished"),k.upgradeExtension(t,ft.timestamps)},_versioningIndicator(r,t){k.upgradeExtension(t,ft.version)},checksum(r,t){Ft.before("0.9.0")&&Qr.multihash&&(k.rename(r,"checksum:md5","checksum:multihash")&&Qr.toMultihash(r,"checksum:multihash","md5"),k.rename(r,"checksum:sha1","checksum:multihash")&&Qr.toMultihash(r,"checksum:multihash","sha1"),k.rename(r,"checksum:sha2","checksum:multihash")&&Qr.toMultihash(r,"checksum:multihash","sha2-256"),k.rename(r,"checksum:sha3","checksum:multihash")&&Qr.toMultihash(r,"checksum:multihash","sha3-256")),Ft.before("1.0.0-rc.1")&&k.rename(r,"checksum:multihash","file:checksum")&&k.addExtension(t,ft.file),k.removeExtension(t,"checksum")},classification(r,t){Ft.before("1.1.0","classification")&&k.forAll(r,"classification:classes",e=>k.rename(e,"color-hint","color_hint")),k.upgradeExtension(t,ft.classification)},cube(r,t){k.upgradeExtension(t,ft.datacube)},dtr(r,t){Ft.before("0.9.0")&&(k.rename(r,"dtr:start_datetime","start_datetime"),k.rename(r,"dtr:end_datetime","end_datetime"),k.removeExtension(t,"datetime-range"))},eo(r,t){Ft.before("0.9.0")&&(k.rename(r,"eo:epsg","proj:epsg")&&k.addExtension(t,ft.projection),k.rename(r,"eo:platform","platform"),k.rename(r,"eo:instrument","instruments")&&k.toArray(r,"instruments"),k.rename(r,"eo:constellation","constellation"),k.rename(r,"eo:off_nadir","view:off_nadir")&&k.addExtension(t,ft.view),k.rename(r,"eo:azimuth","view:azimuth")&&k.addExtension(t,ft.view),k.rename(r,"eo:incidence_angle","view:incidence_angle")&&k.addExtension(t,ft.view),k.rename(r,"eo:sun_azimuth","view:sun_azimuth")&&k.addExtension(t,ft.view),k.rename(r,"eo:sun_elevation","view:sun_elevation")&&k.addExtension(t,ft.view)),Ft.before("1.0.0-beta.1")&&k.rename(r,"eo:gsd","gsd"),k.upgradeExtension(t,ft.eo)},file(r,t){k.upgradeExtension(t,ft.file)},label(r,t){Ft.before("0.8.0")&&(k.rename(r,"label:property","label:properties"),k.rename(r,"label:task","label:tasks"),k.rename(r,"label:overview","label:overviews")&&k.toArray(r,"label:overviews"),k.rename(r,"label:method","label:methods"),k.toArray(r,"label:classes")),k.upgradeExtension(t,ft.label)},pc(r,t){Ft.before("0.8.0")&&k.rename(r,"pc:schema","pc:schemas"),k.upgradeExtension(t,ft.pointcloud)},processing(r,t){k.upgradeExtension(t,ft.processing)},proj(r,t){k.upgradeExtension(t,ft.projection)},raster(r,t){k.upgradeExtension(t,ft.raster)},sar(r,t,e){k.rename(r,"sar:incidence_angle","view:incidence_angle")&&k.addExtension(t,ft.view),k.rename(r,"sar:pass_direction","sat:orbit_state")&&k.mapValues(r,"sat:orbit_state",[null],["geostationary"])&&k.addExtension(t,ft.sat),Ft.before("0.7.0")&&(k.flattenArray(r,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],e),k.flattenArray(r,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],e),k.flattenArray(r,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],e),k.rename(r,"sar:off_nadir","view:off_nadir")&&k.addExtension(t,ft.view)),Ft.before("0.9.0")&&(k.rename(r,"sar:platform","platform"),k.rename(r,"sar:instrument","instruments")&&k.toArray(r,"instruments"),k.rename(r,"sar:constellation","constellation"),k.rename(r,"sar:type","sar:product_type"),k.rename(r,"sar:polarization","sar:polarizations"),k.flattenOneElementArray(r,"sar:absolute_orbit",e)&&k.rename(r,"sar:absolute_orbit","sat:absolute_orbit")&&k.addExtension(t,ft.sat),k.flattenOneElementArray(r,"sar:relative_orbit",e)&&k.rename(r,"sar:relative_orbit","sat:relative_orbit")&&k.addExtension(t,ft.sat)),k.upgradeExtension(t,ft.sar)},sat(r,t){Ft.before("0.9.0")&&(k.rename(r,"sat:off_nadir_angle","sat:off_nadir"),k.rename(r,"sat:azimuth_angle","sat:azimuth"),k.rename(r,"sat:sun_azimuth_angle","sat:sun_azimuth"),k.rename(r,"sat:sun_elevation_angle","sat:sun_elevation")),k.upgradeExtension(t,ft.sat)},sci(r,t){k.upgradeExtension(t,ft.scientific)},item(r){Ft.before("0.8.0")&&(k.rename(r,"item:license","license"),k.rename(r,"item:providers","providers"))},table(r,t){k.upgradeExtension(t,ft.table)},view(r,t){k.upgradeExtension(t,ft.view)}},cs={item(r,t=null,e=!0){return bf.migrate(r,t,e)},catalog(r,t=!0){return vf.migrate(r,t)},collection(r,t=!0){return wf.migrate(r,t)},collectionCollection(r,t=!0){return Dy.migrate(r,t)},itemCollection(r,t=!0){return ky.migrate(r,t)},stac(r,t=!0){return r.type==="Feature"?cs.item(r,null,t):r.type==="FeatureCollection"?cs.itemCollection(r,t):r.type==="Collection"||!r.type&&k.isDefined(r.extent)&&k.isDefined(r.license)?cs.collection(r,t):!r.type&&Array.isArray(r.collections)?cs.collectionCollection(r,t):cs.catalog(r,t)},enableMultihash(r){Qr.multihash=r}},ML=cs;const RL=$s(ML);function ro(r){let t=r.length>=6,e=r[0],n=r[t?3:2],i=r[1],s=r[t?4:3],o={west:e,east:n,south:i,north:s};return t&&(o.base=r[2],o.height=r[5]),o}function Rc(r){let{west:t,east:e,south:n,north:i}=ro(r);return[[[t,i],[t,n],[e,n],[e,i],[t,i]]]}function CL(r){if(!kr(r))return null;let t=ro(r),e=[];if(jy(r)){let n=(t.west+360+t.east)/2;n>180&&(n-=360),e.push(n)}else e.push((t.west+t.east)/2);return e.push((t.south+t.north)/2),typeof t.base<"u"&&e.push((t.base+t.height)/2),e}function Gy(r){if(kr(r)?r=[r]:Array.isArray(r)&&(r=r.filter(n=>kr(n))),!Array.isArray(r)||r.length===0)return null;let t=r.reduce((n,i)=>{if(jy(i)){let{west:s,east:o,south:a,north:l}=ro(i);n.push(Rc([-180,a,o,l])),n.push(Rc([s,a,180,l]))}else n.push(Rc(i));return n},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function kr(r){if(!Array.isArray(r)||![4,6].includes(r.length)||r.some(s=>typeof s!="number"))return!1;let{west:t,east:e,south:n,north:i}=ro(r);return n<=i&&t>=-180&&t<=180&&n>=-90&&e<=180&&e>=-180&&i<=90}function jy(r){if(!kr(r))return!1;let{west:t,east:e}=ro(r);return t>e}function zy(r){if(!Array.isArray(r)||r.length===0)return null;let t={west:180,south:90,east:-180,north:-90};r.forEach(n=>{if(!kr(n))return;let i=ro(n),s=["west","south"];for(let o in i){let a=s.includes(o)?Math.min:Math.max;t[o]=a(t[o],i[o])}});let e=[t.west,t.south,t.east,t.north];return kr(e)?e:null}function ir(r){return typeof r=="string"&&r.length>0}function Je(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function Uy(...r){if(r=r.filter(t=>Array.isArray(t)),r.length>1){let t=Math.max(...r.map(n=>n.length)),e=[];for(let n=0;n<t;n++)e.push(Object.assign({},...r.map(i=>i[n])));return e}else if(r.length===1)return r[0];return[]}function IL(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function PL(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class Gh{constructor(t,e={},n=[]){if(!Je(t))throw new Error("Given data is not an object");if(t instanceof Gh){for(let i of n)this[i]=t[i];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in t)typeof this[i]>"u"&&(i in e?this[i]=e[i](t[i],this):this[i]=t[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return CL(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let n=this[e];if(e in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)i[s]=n[s].toJSON();n=i}t[e]=n}),t}}var By={exports:{}},cl={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */cl.exports;var Up;function AL(){return Up||(Up=1,function(r,t){(function(e){var n=t&&!t.nodeType&&t,i=r&&!r.nodeType&&r,s=typeof Ci=="object"&&Ci;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,l=36,h=1,c=26,u=38,f=700,p=72,m=128,_="-",x=/^xn--/,v=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,T=Math.floor,R=String.fromCharCode,C;function I(L){throw new RangeError(S[L])}function F(L,D){for(var X=L.length,K=[];X--;)K[X]=D(L[X]);return K}function U(L,D){var X=L.split("@"),K="";X.length>1&&(K=X[0]+"@",L=X[1]),L=L.replace(w,".");var G=L.split("."),H=F(G,D).join(".");return K+H}function j(L){for(var D=[],X=0,K=L.length,G,H;X<K;)G=L.charCodeAt(X++),G>=55296&&G<=56319&&X<K?(H=L.charCodeAt(X++),(H&64512)==56320?D.push(((G&1023)<<10)+(H&1023)+65536):(D.push(G),X--)):D.push(G);return D}function B(L){return F(L,function(D){var X="";return D>65535&&(D-=65536,X+=R(D>>>10&1023|55296),D=56320|D&1023),X+=R(D),X}).join("")}function d(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:l}function g(L,D){return L+22+75*(L<26)-((D!=0)<<5)}function y(L,D,X){var K=0;for(L=X?T(L/f):L>>1,L+=T(L/D);L>E*c>>1;K+=l)L=T(L/E);return T(K+(E+1)*L/(L+u))}function b(L){var D=[],X=L.length,K,G=0,H=m,Q=p,nt,xt,dt,Tt,St,Dt,Yt,ue,Ht;for(nt=L.lastIndexOf(_),nt<0&&(nt=0),xt=0;xt<nt;++xt)L.charCodeAt(xt)>=128&&I("not-basic"),D.push(L.charCodeAt(xt));for(dt=nt>0?nt+1:0;dt<X;){for(Tt=G,St=1,Dt=l;dt>=X&&I("invalid-input"),Yt=d(L.charCodeAt(dt++)),(Yt>=l||Yt>T((a-G)/St))&&I("overflow"),G+=Yt*St,ue=Dt<=Q?h:Dt>=Q+c?c:Dt-Q,!(Yt<ue);Dt+=l)Ht=l-ue,St>T(a/Ht)&&I("overflow"),St*=Ht;K=D.length+1,Q=y(G-Tt,K,Tt==0),T(G/K)>a-H&&I("overflow"),H+=T(G/K),G%=K,D.splice(G++,0,H)}return B(D)}function M(L){var D,X,K,G,H,Q,nt,xt,dt,Tt,St,Dt=[],Yt,ue,Ht,He;for(L=j(L),Yt=L.length,D=m,X=0,H=p,Q=0;Q<Yt;++Q)St=L[Q],St<128&&Dt.push(R(St));for(K=G=Dt.length,G&&Dt.push(_);K<Yt;){for(nt=a,Q=0;Q<Yt;++Q)St=L[Q],St>=D&&St<nt&&(nt=St);for(ue=K+1,nt-D>T((a-X)/ue)&&I("overflow"),X+=(nt-D)*ue,D=nt,Q=0;Q<Yt;++Q)if(St=L[Q],St<D&&++X>a&&I("overflow"),St==D){for(xt=X,dt=l;Tt=dt<=H?h:dt>=H+c?c:dt-H,!(xt<Tt);dt+=l)He=xt-Tt,Ht=l-Tt,Dt.push(R(g(Tt+He%Ht,0))),xt=T(He/Ht);Dt.push(R(g(xt,0))),H=y(X,ue,K==G),X=0,++K}++X,++D}return Dt.join("")}function P(L){return U(L,function(D){return x.test(D)?b(D.slice(4).toLowerCase()):D})}function A(L){return U(L,function(D){return v.test(D)?"xn--"+M(D):D})}if(o={version:"1.3.2",ucs2:{decode:j,encode:B},decode:b,encode:M,toASCII:A,toUnicode:P},n&&i)if(r.exports==n)i.exports=o;else for(C in o)o.hasOwnProperty(C)&&(n[C]=o[C]);else e.punycode=o})(Ci)}(cl,cl.exports)),cl.exports}var Bp={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Xp;function LL(){return Xp||(Xp=1,function(r){(function(t,e){r.exports?r.exports=e():t.IPv6=e(t)})(Ci,function(t){var e=t&&t.IPv6;function n(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,h=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&a[c]!=="";c++);if(c<h)for(a.splice(c,1,"0000");a.length<h;)a.splice(c,0,"0000");for(var u,f=0;f<h;f++){u=a[f].split("");for(var p=0;p<3&&u[0]==="0"&&u.length>1;p++)u.splice(0,1);a[f]=u.join("")}var m=-1,_=0,x=0,v=-1,w=!1;for(f=0;f<h;f++)w?a[f]==="0"?x+=1:(w=!1,x>_&&(m=v,_=x)):a[f]==="0"&&(w=!0,v=f,x=1);x>_&&(m=v,_=x),_>1&&a.splice(m,_,""),l=a.length;var S="";for(a[0]===""&&(S=":"),f=0;f<l&&(S+=a[f],f!==l-1);f++)S+=":";return a[l-1]===""&&(S+=":"),S}function i(){return t.IPv6===this&&(t.IPv6=e),this}return{best:n,noConflict:i}})}(Bp)),Bp.exports}var qp={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Wp;function OL(){return Wp||(Wp=1,function(r){(function(t,e){r.exports?r.exports=e():t.SecondLevelDomains=e(t)})(Ci,function(t){var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(o+1,s)+" ")>=0:!1},is:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o>=0)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(0,s)+" ")>=0:!1},get:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return null;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=n.list[i.slice(s+1)];return!a||a.indexOf(" "+i.slice(o+1,s)+" ")<0?null:i.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})}(qp)),qp.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(t,e){r.exports?r.exports=e(AL(),LL(),OL()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(Ci,function(t,e,n,i){var s=i&&i.URI;function o(d,g){var y=arguments.length>=1,b=arguments.length>=2;if(!(this instanceof o))return y?b?new o(d,g):new o(d):new o;if(d===void 0){if(y)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?d=location.href+"":d=""}if(d===null&&y)throw new TypeError("null is not a valid argument for URI");return this.href(d),g!==void 0?this.absoluteTo(g):this}function a(d){return/^[0-9]+$/.test(d)}o.version="1.19.11";var l=o.prototype,h=Object.prototype.hasOwnProperty;function c(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(d){return d===void 0?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function f(d){return u(d)==="Array"}function p(d,g){var y={},b,M;if(u(g)==="RegExp")y=null;else if(f(g))for(b=0,M=g.length;b<M;b++)y[g[b]]=!0;else y[g]=!0;for(b=0,M=d.length;b<M;b++){var P=y&&y[d[b]]!==void 0||!y&&g.test(d[b]);P&&(d.splice(b,1),M--,b--)}return d}function m(d,g){var y,b;if(f(g)){for(y=0,b=g.length;y<b;y++)if(!m(d,g[y]))return!1;return!0}var M=u(g);for(y=0,b=d.length;y<b;y++)if(M==="RegExp"){if(typeof d[y]=="string"&&d[y].match(g))return!0}else if(d[y]===g)return!0;return!1}function _(d,g){if(!f(d)||!f(g)||d.length!==g.length)return!1;d.sort(),g.sort();for(var y=0,b=d.length;y<b;y++)if(d[y]!==g[y])return!1;return!0}function x(d){var g=/^\/+|\/+$/g;return d.replace(g,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(d){if(!(!d||!d.nodeName)){var g=d.nodeName.toLowerCase();if(!(g==="input"&&d.type!=="image"))return o.domAttributes[g]}};function v(d){return escape(d)}function w(d){return encodeURIComponent(d).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}o.encode=w,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=w,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(d,g){var y=o.encode(d+"");return g===void 0&&(g=o.escapeQuerySpace),g?y.replace(/%20/g,"+"):y},o.decodeQuery=function(d,g){d+="",g===void 0&&(g=o.escapeQuerySpace);try{return o.decode(g?d.replace(/\+/g,"%20"):d)}catch{return d}};var S={encode:"encode",decode:"decode"},E,T=function(d,g){return function(y){try{return o[g](y+"").replace(o.characters[d][g].expression,function(b){return o.characters[d][g].map[b]})}catch{return y}}};for(E in S)o[E+"PathSegment"]=T("pathname",S[E]),o[E+"UrnPathSegment"]=T("urnpath",S[E]);var R=function(d,g,y){return function(b){var M;y?M=function(D){return o[g](o[y](D))}:M=o[g];for(var P=(b+"").split(d),A=0,L=P.length;A<L;A++)P[A]=M(P[A]);return P.join(d)}};o.decodePath=R("/","decodePathSegment"),o.decodeUrnPath=R(":","decodeUrnPathSegment"),o.recodePath=R("/","encodePathSegment","decode"),o.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),o.encodeReserved=T("reserved","encode"),o.parse=function(d,g){var y;return g||(g={preventInvalidHostname:o.preventInvalidHostname}),d=d.replace(o.leading_whitespace_expression,""),d=d.replace(o.ascii_tab_whitespace,""),y=d.indexOf("#"),y>-1&&(g.fragment=d.substring(y+1)||null,d=d.substring(0,y)),y=d.indexOf("?"),y>-1&&(g.query=d.substring(y+1)||null,d=d.substring(0,y)),d=d.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),d=d.replace(/^[/\\]{2,}/i,"//"),d.substring(0,2)==="//"?(g.protocol=null,d=d.substring(2),d=o.parseAuthority(d,g)):(y=d.indexOf(":"),y>-1&&(g.protocol=d.substring(0,y)||null,g.protocol&&!g.protocol.match(o.protocol_expression)?g.protocol=void 0:d.substring(y+1,y+3).replace(/\\/g,"/")==="//"?(d=d.substring(y+3),d=o.parseAuthority(d,g)):(d=d.substring(y+1),g.urn=!0))),g.path=d,g},o.parseHost=function(d,g){d||(d=""),d=d.replace(/\\/g,"/");var y=d.indexOf("/"),b,M;if(y===-1&&(y=d.length),d.charAt(0)==="[")b=d.indexOf("]"),g.hostname=d.substring(1,b)||null,g.port=d.substring(b+2,y)||null,g.port==="/"&&(g.port=null);else{var P=d.indexOf(":"),A=d.indexOf("/"),L=d.indexOf(":",P+1);L!==-1&&(A===-1||L<A)?(g.hostname=d.substring(0,y)||null,g.port=null):(M=d.substring(0,y).split(":"),g.hostname=M[0]||null,g.port=M[1]||null)}return g.hostname&&d.substring(y).charAt(0)!=="/"&&(y++,d="/"+d),g.preventInvalidHostname&&o.ensureValidHostname(g.hostname,g.protocol),g.port&&o.ensureValidPort(g.port),d.substring(y)||"/"},o.parseAuthority=function(d,g){return d=o.parseUserinfo(d,g),o.parseHost(d,g)},o.parseUserinfo=function(d,g){var y=d,b=d.indexOf("\\");b!==-1&&(d=d.replace(/\\/g,"/"));var M=d.indexOf("/"),P=d.lastIndexOf("@",M>-1?M:d.length-1),A;return P>-1&&(M===-1||P<M)?(A=d.substring(0,P).split(":"),g.username=A[0]?o.decode(A[0]):null,A.shift(),g.password=A[0]?o.decode(A.join(":")):null,d=y.substring(P+1)):(g.username=null,g.password=null),d},o.parseQuery=function(d,g){if(!d)return{};if(d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!d)return{};for(var y={},b=d.split("&"),M=b.length,P,A,L,D=0;D<M;D++)P=b[D].split("="),A=o.decodeQuery(P.shift(),g),L=P.length?o.decodeQuery(P.join("="),g):null,A!=="__proto__"&&(h.call(y,A)?((typeof y[A]=="string"||y[A]===null)&&(y[A]=[y[A]]),y[A].push(L)):y[A]=L);return y},o.build=function(d){var g="",y=!1;return d.protocol&&(g+=d.protocol+":"),!d.urn&&(g||d.hostname)&&(g+="//",y=!0),g+=o.buildAuthority(d)||"",typeof d.path=="string"&&(d.path.charAt(0)!=="/"&&y&&(g+="/"),g+=d.path),typeof d.query=="string"&&d.query&&(g+="?"+d.query),typeof d.fragment=="string"&&d.fragment&&(g+="#"+d.fragment),g},o.buildHost=function(d){var g="";if(d.hostname)o.ip6_expression.test(d.hostname)?g+="["+d.hostname+"]":g+=d.hostname;else return"";return d.port&&(g+=":"+d.port),g},o.buildAuthority=function(d){return o.buildUserinfo(d)+o.buildHost(d)},o.buildUserinfo=function(d){var g="";return d.username&&(g+=o.encode(d.username)),d.password&&(g+=":"+o.encode(d.password)),g&&(g+="@"),g},o.buildQuery=function(d,g,y){var b="",M,P,A,L;for(P in d)if(P!=="__proto__"&&h.call(d,P))if(f(d[P]))for(M={},A=0,L=d[P].length;A<L;A++)d[P][A]!==void 0&&M[d[P][A]+""]===void 0&&(b+="&"+o.buildQueryParameter(P,d[P][A],y),g!==!0&&(M[d[P][A]+""]=!0));else d[P]!==void 0&&(b+="&"+o.buildQueryParameter(P,d[P],y));return b.substring(1)},o.buildQueryParameter=function(d,g,y){return o.encodeQuery(d,y)+(g!==null?"="+o.encodeQuery(g,y):"")},o.addQuery=function(d,g,y){if(typeof g=="object")for(var b in g)h.call(g,b)&&o.addQuery(d,b,g[b]);else if(typeof g=="string"){if(d[g]===void 0){d[g]=y;return}else typeof d[g]=="string"&&(d[g]=[d[g]]);f(y)||(y=[y]),d[g]=(d[g]||[]).concat(y)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(d,g,y){if(typeof g=="object")for(var b in g)h.call(g,b)&&o.setQuery(d,b,g[b]);else if(typeof g=="string")d[g]=y===void 0?null:y;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(d,g,y){var b,M,P;if(f(g))for(b=0,M=g.length;b<M;b++)d[g[b]]=void 0;else if(u(g)==="RegExp")for(P in d)g.test(P)&&(d[P]=void 0);else if(typeof g=="object")for(P in g)h.call(g,P)&&o.removeQuery(d,P,g[P]);else if(typeof g=="string")y!==void 0?u(y)==="RegExp"?!f(d[g])&&y.test(d[g])?d[g]=void 0:d[g]=p(d[g],y):d[g]===String(y)&&(!f(y)||y.length===1)?d[g]=void 0:f(d[g])&&(d[g]=p(d[g],y)):d[g]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(d,g,y,b){switch(u(g)){case"String":break;case"RegExp":for(var M in d)if(h.call(d,M)&&g.test(M)&&(y===void 0||o.hasQuery(d,M,y)))return!0;return!1;case"Object":for(var P in g)if(h.call(g,P)&&!o.hasQuery(d,P,g[P]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(y)){case"Undefined":return g in d;case"Boolean":var A=!!(f(d[g])?d[g].length:d[g]);return y===A;case"Function":return!!y(d[g],g,d);case"Array":if(!f(d[g]))return!1;var L=b?m:_;return L(d[g],y);case"RegExp":return f(d[g])?b?m(d[g],y):!1:!!(d[g]&&d[g].match(y));case"Number":y=String(y);case"String":return f(d[g])?b?m(d[g],y):!1:d[g]===y;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var d=[],g=[],y=0,b=0;b<arguments.length;b++){var M=new o(arguments[b]);d.push(M);for(var P=M.segment(),A=0;A<P.length;A++)typeof P[A]=="string"&&g.push(P[A]),P[A]&&y++}if(!g.length||!y)return new o("");var L=new o("").segment(g);return(d[0].path()===""||d[0].path().slice(0,1)==="/")&&L.path("/"+L.path()),L.normalize()},o.commonPath=function(d,g){var y=Math.min(d.length,g.length),b;for(b=0;b<y;b++)if(d.charAt(b)!==g.charAt(b)){b--;break}return b<1?d.charAt(0)===g.charAt(0)&&d.charAt(0)==="/"?"/":"":((d.charAt(b)!=="/"||g.charAt(b)!=="/")&&(b=d.substring(0,b).lastIndexOf("/")),d.substring(0,b+1))},o.withinString=function(d,g,y){y||(y={});var b=y.start||o.findUri.start,M=y.end||o.findUri.end,P=y.trim||o.findUri.trim,A=y.parens||o.findUri.parens,L=/[a-z0-9-]=["']?$/i;for(b.lastIndex=0;;){var D=b.exec(d);if(!D)break;var X=D.index;if(y.ignoreHtml){var K=d.slice(Math.max(X-3,0),X);if(K&&L.test(K))continue}for(var G=X+d.slice(X).search(M),H=d.slice(X,G),Q=-1;;){var nt=A.exec(H);if(!nt)break;var xt=nt.index+nt[0].length;Q=Math.max(Q,xt)}if(Q>-1?H=H.slice(0,Q)+H.slice(Q).replace(P,""):H=H.replace(P,""),!(H.length<=D[0].length)&&!(y.ignore&&y.ignore.test(H))){G=X+H.length;var dt=g(H,X,G,d);if(dt===void 0){b.lastIndex=G;continue}dt=String(dt),d=d.slice(0,X)+dt+d.slice(G),b.lastIndex=X+dt.length}}return b.lastIndex=0,d},o.ensureValidHostname=function(d,g){var y=!!d,b=!!g,M=!1;if(b&&(M=m(o.hostProtocols,g)),M&&!y)throw new TypeError("Hostname cannot be empty, if protocol is "+g);if(d&&d.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(d).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(d){if(d){var g=Number(d);if(!(a(g)&&g>0&&g<65536))throw new TypeError('Port "'+d+'" is not a valid port')}},o.noConflict=function(d){if(d){var g={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(g.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(g.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(g.SecondLevelDomains=i.SecondLevelDomains.noConflict()),g}else i.URI===this&&(i.URI=s);return this},l.build=function(d){return d===!0?this._deferred_build=!0:(d===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(d){return function(g,y){return g===void 0?this._parts[d]||"":(this._parts[d]=g||null,this.build(!y),this)}}function I(d,g){return function(y,b){return y===void 0?this._parts[d]||"":(y!==null&&(y=y+"",y.charAt(0)===g&&(y=y.substring(1))),this._parts[d]=y,this.build(!b),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=I("query","?"),l.fragment=I("fragment","#"),l.search=function(d,g){var y=this.query(d,g);return typeof y=="string"&&y.length?"?"+y:y},l.hash=function(d,g){var y=this.fragment(d,g);return typeof y=="string"&&y.length?"#"+y:y},l.pathname=function(d,g){if(d===void 0||d===!0){var y=this._parts.path||(this._parts.hostname?"/":"");return d?(this._parts.urn?o.decodeUrnPath:o.decodePath)(y):y}else return this._parts.urn?this._parts.path=d?o.recodeUrnPath(d):"":this._parts.path=d?o.recodePath(d):"/",this.build(!g),this},l.path=l.pathname,l.href=function(d,g){var y;if(d===void 0)return this.toString();this._string="",this._parts=o._parts();var b=d instanceof o,M=typeof d=="object"&&(d.hostname||d.path||d.pathname);if(d.nodeName){var P=o.getDomAttribute(d);d=d[P]||"",M=!1}if(!b&&M&&d.pathname!==void 0&&(d=d.toString()),typeof d=="string"||d instanceof String)this._parts=o.parse(String(d),this._parts);else if(b||M){var A=b?d._parts:d;for(y in A)y!=="query"&&h.call(this._parts,y)&&(this._parts[y]=A[y]);A.query&&this.query(A.query,!1)}else throw new TypeError("invalid input");return this.build(!g),this},l.is=function(d){var g=!1,y=!1,b=!1,M=!1,P=!1,A=!1,L=!1,D=!this._parts.urn;switch(this._parts.hostname&&(D=!1,y=o.ip4_expression.test(this._parts.hostname),b=o.ip6_expression.test(this._parts.hostname),g=y||b,M=!g,P=M&&n&&n.has(this._parts.hostname),A=M&&o.idn_expression.test(this._parts.hostname),L=M&&o.punycode_expression.test(this._parts.hostname)),d.toLowerCase()){case"relative":return D;case"absolute":return!D;case"domain":case"name":return M;case"sld":return P;case"ip":return g;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return b;case"idn":return A;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return L}return null};var F=l.protocol,U=l.port,j=l.hostname;l.protocol=function(d,g){if(d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(o.protocol_expression)))throw new TypeError('Protocol "'+d+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return F.call(this,d,g)},l.scheme=l.protocol,l.port=function(d,g){return this._parts.urn?d===void 0?"":this:(d!==void 0&&(d===0&&(d=null),d&&(d+="",d.charAt(0)===":"&&(d=d.substring(1)),o.ensureValidPort(d))),U.call(this,d,g))},l.hostname=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d!==void 0){var y={preventInvalidHostname:this._parts.preventInvalidHostname},b=o.parseHost(d,y);if(b!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');d=y.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(d,this._parts.protocol)}return j.call(this,d,g)},l.origin=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=this.protocol(),b=this.authority();return b?(y?y+"://":"")+this.authority():""}else{var M=o(d);return this.protocol(M.protocol()).authority(M.authority()).build(!g),this}},l.host=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var y=o.parseHost(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!g),this},l.authority=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var y=o.parseAuthority(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!g),this},l.userinfo=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=o.buildUserinfo(this._parts);return y&&y.substring(0,y.length-1)}else return d[d.length-1]!=="@"&&(d+="@"),o.parseUserinfo(d,this._parts),this.build(!g),this},l.resource=function(d,g){var y;return d===void 0?this.path()+this.search()+this.hash():(y=o.parse(d),this._parts.path=y.path,this._parts.query=y.query,this._parts.fragment=y.fragment,this.build(!g),this)},l.subdomain=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,y)||""}else{var b=this._parts.hostname.length-this.domain().length,M=this._parts.hostname.substring(0,b),P=new RegExp("^"+c(M));if(d&&d.charAt(d.length-1)!=="."&&(d+="."),d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return d&&o.ensureValidHostname(d,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(P,d),this.build(!g),this}},l.domain=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(g=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.match(/\./g);if(y&&y.length<2)return this._parts.hostname;var b=this._parts.hostname.length-this.tld(g).length-1;return b=this._parts.hostname.lastIndexOf(".",b-1)+1,this._parts.hostname.substring(b)||""}else{if(!d)throw new TypeError("cannot set domain empty");if(d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(d,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=d;else{var M=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(M,d)}return this.build(!g),this}},l.tld=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(g=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(y+1);return g!==!0&&n&&n.list[b.toLowerCase()]&&n.get(this._parts.hostname)||b}else{var M;if(d)if(d.match(/[^a-zA-Z0-9-]/))if(n&&n.is(d))M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d);else throw new TypeError('TLD "'+d+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d)}else throw new TypeError("cannot set TLD empty");return this.build(!g),this}},l.directory=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var y=this._parts.path.length-this.filename().length-1,b=this._parts.path.substring(0,y)||(this._parts.hostname?"/":"");return d?o.decodePath(b):b}else{var M=this._parts.path.length-this.filename().length,P=this._parts.path.substring(0,M),A=new RegExp("^"+c(P));return this.is("relative")||(d||(d="/"),d.charAt(0)!=="/"&&(d="/"+d)),d&&d.charAt(d.length-1)!=="/"&&(d+="/"),d=o.recodePath(d),this._parts.path=this._parts.path.replace(A,d),this.build(!g),this}},l.filename=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d!="string"){if(!this._parts.path||this._parts.path==="/")return"";var y=this._parts.path.lastIndexOf("/"),b=this._parts.path.substring(y+1);return d?o.decodePathSegment(b):b}else{var M=!1;d.charAt(0)==="/"&&(d=d.substring(1)),d.match(/\.?\//)&&(M=!0);var P=new RegExp(c(this.filename())+"$");return d=o.recodePath(d),this._parts.path=this._parts.path.replace(P,d),M?this.normalizePath(g):this.build(!g),this}},l.suffix=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path||this._parts.path==="/")return"";var y=this.filename(),b=y.lastIndexOf("."),M,P;return b===-1?"":(M=y.substring(b+1),P=/^[a-z0-9%]+$/i.test(M)?M:"",d?o.decodePathSegment(P):P)}else{d.charAt(0)==="."&&(d=d.substring(1));var A=this.suffix(),L;if(A)d?L=new RegExp(c(A)+"$"):L=new RegExp(c("."+A)+"$");else{if(!d)return this;this._parts.path+="."+o.recodePath(d)}return L&&(d=o.recodePath(d),this._parts.path=this._parts.path.replace(L,d)),this.build(!g),this}},l.segment=function(d,g,y){var b=this._parts.urn?":":"/",M=this.path(),P=M.substring(0,1)==="/",A=M.split(b);if(d!==void 0&&typeof d!="number"&&(y=g,g=d,d=void 0),d!==void 0&&typeof d!="number")throw new Error('Bad segment "'+d+'", must be 0-based integer');if(P&&A.shift(),d<0&&(d=Math.max(A.length+d,0)),g===void 0)return d===void 0?A:A[d];if(d===null||A[d]===void 0)if(f(g)){A=[];for(var L=0,D=g.length;L<D;L++)!g[L].length&&(!A.length||!A[A.length-1].length)||(A.length&&!A[A.length-1].length&&A.pop(),A.push(x(g[L])))}else(g||typeof g=="string")&&(g=x(g),A[A.length-1]===""?A[A.length-1]=g:A.push(g));else g?A[d]=x(g):A.splice(d,1);return P&&A.unshift(""),this.path(A.join(b),y)},l.segmentCoded=function(d,g,y){var b,M,P;if(typeof d!="number"&&(y=g,g=d,d=void 0),g===void 0){if(b=this.segment(d,g,y),!f(b))b=b!==void 0?o.decode(b):void 0;else for(M=0,P=b.length;M<P;M++)b[M]=o.decode(b[M]);return b}if(!f(g))g=typeof g=="string"||g instanceof String?o.encode(g):g;else for(M=0,P=g.length;M<P;M++)g[M]=o.encode(g[M]);return this.segment(d,g,y)};var B=l.query;return l.query=function(d,g){if(d===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="function"){var y=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),b=d.call(this,y);return this._parts.query=o.buildQuery(b||y,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!g),this}else return d!==void 0&&typeof d!="string"?(this._parts.query=o.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!g),this):B.call(this,d,g)},l.setQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="string"||d instanceof String)b[d]=g!==void 0?g:null;else if(typeof d=="object")for(var M in d)h.call(d,M)&&(b[M]=d[M]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=g),this.build(!y),this},l.addQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(b,d,g===void 0?null:g),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=g),this.build(!y),this},l.removeQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(b,d,g),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=g),this.build(!y),this},l.hasQuery=function(d,g,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(b,d,g,y)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(d){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d)),this},l.normalizeHostname=function(d){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d)),this},l.normalizePort=function(d){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d)),this},l.normalizePath=function(d){var g=this._parts.path;if(!g)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!d),this;if(this._parts.path==="/")return this;g=o.recodePath(g);var y,b="",M,P;for(g.charAt(0)!=="/"&&(y=!0,g="/"+g),(g.slice(-3)==="/.."||g.slice(-2)==="/.")&&(g+="/"),g=g.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),y&&(b=g.substring(1).match(/^(\.\.\/)+/)||"",b&&(b=b[0]));M=g.search(/\/\.\.(\/|$)/),M!==-1;){if(M===0){g=g.substring(3);continue}P=g.substring(0,M).lastIndexOf("/"),P===-1&&(P=M),g=g.substring(0,P)+g.substring(M+3)}return y&&this.is("relative")&&(g=b+g.substring(1)),this._parts.path=g,this.build(!d),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(d){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d)),this},l.normalizeFragment=function(d){return this._parts.fragment||(this._parts.fragment=null,this.build(!d)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var d=o.encode,g=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=d,o.decode=g}return this},l.unicode=function(){var d=o.encode,g=o.decode;o.encode=w,o.decode=unescape;try{this.normalize()}finally{o.encode=d,o.decode=g}return this},l.readable=function(){var d=this.clone();d.username("").password("").normalize();var g="";if(d._parts.protocol&&(g+=d._parts.protocol+"://"),d._parts.hostname&&(d.is("punycode")&&t?(g+=t.toUnicode(d._parts.hostname),d._parts.port&&(g+=":"+d._parts.port)):g+=d.host()),d._parts.hostname&&d._parts.path&&d._parts.path.charAt(0)!=="/"&&(g+="/"),g+=d.path(!0),d._parts.query){for(var y="",b=0,M=d._parts.query.split("&"),P=M.length;b<P;b++){var A=(M[b]||"").split("=");y+="&"+o.decodeQuery(A[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),A[1]!==void 0&&(y+="="+o.decodeQuery(A[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}g+="?"+y.substring(1)}return g+=o.decodeQuery(d.hash(),!0),g},l.absoluteTo=function(d){var g=this.clone(),y=["protocol","username","password","hostname","port"],b,M,P;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d instanceof o||(d=new o(d)),g._parts.protocol||(g._parts.protocol=d._parts.protocol,this._parts.hostname))return g;for(M=0;P=y[M];M++)g._parts[P]=d._parts[P];return g._parts.path?(g._parts.path.substring(-2)===".."&&(g._parts.path+="/"),g.path().charAt(0)!=="/"&&(b=d.directory(),b=b||(d.path().indexOf("/")===0?"/":""),g._parts.path=(b?b+"/":"")+g._parts.path,g.normalizePath())):(g._parts.path=d._parts.path,g._parts.query||(g._parts.query=d._parts.query)),g.build(),g},l.relativeTo=function(d){var g=this.clone().normalize(),y,b,M,P,A;if(g._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d=new o(d).normalize(),y=g._parts,b=d._parts,P=g.path(),A=d.path(),P.charAt(0)!=="/")throw new Error("URI is already relative");if(A.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(y.protocol===b.protocol&&(y.protocol=null),y.username!==b.username||y.password!==b.password||y.protocol!==null||y.username!==null||y.password!==null)return g.build();if(y.hostname===b.hostname&&y.port===b.port)y.hostname=null,y.port=null;else return g.build();if(P===A)return y.path="",g.build();if(M=o.commonPath(P,A),!M)return g.build();var L=b.path.substring(M.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return y.path=L+y.path.substring(M.length)||"./",g.build()},l.equals=function(d){var g=this.clone(),y=new o(d),b={},M={},P={},A,L,D;if(g.normalize(),y.normalize(),g.toString()===y.toString())return!0;if(A=g.query(),L=y.query(),g.query(""),y.query(""),g.toString()!==y.toString()||A.length!==L.length)return!1;b=o.parseQuery(A,this._parts.escapeQuerySpace),M=o.parseQuery(L,this._parts.escapeQuerySpace);for(D in b)if(h.call(b,D)){if(f(b[D])){if(!_(b[D],M[D]))return!1}else if(b[D]!==M[D])return!1;P[D]=!0}for(D in M)if(h.call(M,D)&&!P[D])return!1;return!0},l.preventInvalidHostname=function(d){return this._parts.preventInvalidHostname=!!d,this},l.duplicateQueryParameters=function(d){return this._parts.duplicateQueryParameters=!!d,this},l.escapeQuerySpace=function(d){return this._parts.escapeQuerySpace=!!d,this},o})})(By);var FL=By.exports;const pu=$s(FL),Zp=["http","https"];function NL(r){return typeof r=="string"&&r.startsWith("/vsi")&&!r.startsWith("/vsicurl/")}function DL(r,t,e=!0){return kL(r,t,!1,e)}function kL(r,t=null,e=!1,n=!0){typeof r=="string"&&r.startsWith("/vsicurl/")&&(r=r.replace(/^\/vsicurl\//,""));let i=pu(r);if(t&&i.is("relative")&&!NL(r)){let s=pu(t),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),e&&(i.query(""),i.fragment("")),n?i.toString():i}const GL="application/geo+json",jL=["application/json",GL,"text/json"],$p=["image/gif","image/jpeg","image/apng","image/png","image/webp"],Xy=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],qy=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(Xy);function Sf(r,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof r>"u"?!0:typeof r!="string"?!1:(t=t.map(n=>n.toLowerCase()),t.includes(r.toLowerCase()))}function zL(r,t=!1){return Sf(r,jL,t)}class Wy extends Gh{constructor(t,e=null,n={},i=[]){super(t,n,["_context"].concat(i)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?DL(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string"||!t&&typeof this.type>"u")return!1;let e=new pu(this.href),n=e.protocol().toLowerCase(),i=e.suffix().toLowerCase();return ir(n)&&!Zp.includes(n)?!1:ir(this.type)&&$p.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&ir(i)&&(i==="jpg"||$p.includes("image/"+i)))}isType(t){return ir(this.type)&&Sf(this.type,t)}isGeoTIFF(){return this.isType(qy)}isCOG(){return this.isType(Xy)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return ir(t)&&Zp.includes(t)}}class Ef extends Wy{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(n=>Je(n)?new Ef(n,e):n):[]}}class Zy extends Gh{constructor(t,e=null,n={},i=[]){if(super(t,Object.assign({links:Ef.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=e,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(n=>zL(n.type,e))}getStacLinkWithRel(t,e=!0){const n=this.getStacLinksWithRel(t,e);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>Je(t)&&ir(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class $y extends Zy{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getAll(){return[]}}class si extends Wy{constructor(t,e=null,n=null){super(t,n,{},["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getBands(){return Uy(this["eo:bands"],this["raster:bands"])}findVisualBands(){let t={red:null,green:null,blue:null},e=this.getBands();for(let n in e){let i=parseInt(n,10),s=e[i];Je(s)&&ir(s.common_name)&&s.common_name in t&&(t[s.common_name]={index:i,band:s})}return Object.values(t).every(n=>n!==null)?t:null}findBand(t,e="name",n=null){Array.isArray(t)||(t=[t]),Je(n)||(n=this.getBands());let i=n.findIndex(s=>Je(s)&&t.includes(s[e]));return i>=0?{index:i,band:n[i]}:null}getBand(t){return Je(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(t=null){t=this.getBand(t);const e={minimum:null,maximum:null},n=a=>a.minimum!==null&&a.maximum!==null;if(t&&(Je(t.statistics)&&(typeof t.statistics.minimum=="number"&&(e.minimum=t.statistics.minimum),typeof t.statistics.maximum=="number"&&(e.maximum=t.statistics.maximum),n(e))||Je(t.histogram)&&(typeof t.histogram.min=="number"&&(e.minimum=t.histogram.min),typeof t.histogram.max=="number"&&(e.maximum=t.histogram.max),n(e))))return e;let i=this.getMetadata("classification:classes");if(Array.isArray(i)&&(i.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),e),n(e)))return e;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),e),n(e)))return e;let o=Je(t)&&t.data_type||this.getMetadata("file:data_type");return o&&(e.minimum=IL(o),e.maximum=PL(o)),e}getNoDataValues(t=null){t=this.getBand(t);let e=[];if(t&&typeof t.nodata<"u")e.push(t.nodata);else{let n=this.getMetadata("file:nodata");if(typeof n<"u")e=n;else{let i=this.getMetadata("classification:classes");Array.isArray(i)&&(e=i.filter(s=>!!s.nodata).map(s=>s.value))}}return e.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}isDefinition(){return!ir(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>t.includes(n))}static fromAssets(t,e=null){let n={};if(Je(t))for(let i in t)n[i]=new si(t[i],i,e);return n}}class Aa extends Zy{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let n=this.getAssetsWithRoles(["thumbnail","overview"],!0);if(n.length===0&&(n=this.getLinksWithRels(["preview"])),t&&(n=n.filter(i=>i.canBrowserDisplayImage())),e&&n.length>1){let i=s=>Array.isArray(s.roles)&&s.roles.includes(e)||s.getKey()===e;n=n.filter(i).concat(n.filter(s=>!i(s)))}return n}getDefaultGeoTIFF(t=!0,e=!1){var n;return(n=this.rankGeoTIFFs(t,e)[0])==null?void 0:n.asset}rankGeoTIFFs(t=!0,e=!1,n=null,i=null){Je(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],o=this.getAssetsByTypes(qy);t&&(o=o.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let a=Object.entries(n);for(let l of o){let h=0;if(a.length>0){let c=a.filter(([u])=>l.hasRole(u,!0)).map(([,u])=>u);c.length>0&&(h+=Math.max(...c))}!e&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof i=="function"&&(h+=i(l)),s.push({asset:l,score:h})}return s.sort((l,h)=>h.score-l.score),s}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),n=this.getAssets();for(let i of n){let s=i.getBands();if(s.length!==1)continue;let o=i.findBand(e,"common_name",s);o&&(t[o.band.common_name]=i)}return Object.values(t).every(i=>i!==null)?t:null}getAsset(t){return Je(this.assets)&&this.assets[t]||null}getAssets(){return Je(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(n=>n.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>Sf(e.type,t))}equals(t){return this===t?!0:!(t instanceof Aa)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}}class Vy extends Aa{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(n=>n.method===t||!t&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class UL extends Vy{constructor(t,e=null){super(t,e)}}function bo(r){if(ir(r)&&r.length>=10)try{let t=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(e=>parseInt(e,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function BL(r,t){return new Date(r.valueOf()+(t-r)/2)}function Yy(r){if(!Array.isArray(r)||r.length===0)return null;let t,e;const n=(i,s,o)=>typeof i>"u"?s:i===null||s===null?null:o(i,s);return r.forEach(([i,s])=>{t=n(t,i,Math.min),e=n(e,s,Math.max)}),[t===null?null:new Date(t),e===null?null:new Date(e)]}class Hy extends Vy{constructor(t,e=null){const n={assets:si.fromAssets,item_assets:si.fromAssets};super(t,e,n)}toGeoJSON(){let t=Gy(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0&&kr(t[0])?t[0]:null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1&&kr(t[0])?t:t.length>1?t.filter((e,n)=>n>0&&kr(e)):[]}getRawBoundingBoxes(){var t,e;let n=(e=(t=this.extent)==null?void 0:t.spatial)==null?void 0:e.bbox;return Array.isArray(n)&&n.length>0?n:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,e;let n=(e=(t=this.extent)==null?void 0:t.temporal)==null?void 0:e.interval;return Array.isArray(n)&&n.length>0?n.filter(i=>Array.isArray(i)&&(ir(i[0])||ir(i[1]))).map(i=>i.map(s=>bo(s))):[]}getSummary(t){return this.summaries[t]}getBands(){let t=this.getSummary("eo:bands"),e=this.getSummary("raster:bands"),n=[t,e].filter(i=>Array.isArray(i));return n.length>=2?Uy(...n):n.length===1?n[0]:[]}}class XL extends $y{constructor(t,e=null){const n={collections:i=>i.map(s=>new Hy(s))};super(t,e,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return zy(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(t=>t.getBoundingBox())}getTemporalExtent(){return Yy(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(t=>t.getTemporalExtent())}}class Ky extends Aa{constructor(t,e=null){super(t,e,{assets:si.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return kr(this.bbox)?this.bbox:null}getBoundingBoxes(){return kr(this.bbox)?[this.bbox]:[]}getDateTime(){let t=bo(this.properties.datetime);if(!t){let e=bo(this.properties.start_datetime),n=bo(this.properties.end_datetime);return e&&n?BL(e,n):e||n}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return ir(this.properties.start_datetime)||ir(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:ir(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(n=>bo(n)))}getMetadata(t){return this.properties[t]}getBands(){let t=this.getMetadata("eo:bands");return Array.isArray(t)?t:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class qL extends $y{constructor(t,e=null){const n={features:i=>i.map(s=>new Ky(s))};super(t,e,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return zy(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(t=>t.getBoundingBox())}getTemporalExtent(){return Yy(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(t=>t.getTemporalExtent())}}function WL(r,t=!0,e=!1){return t&&(r=RL.stac(r,e)),r.type==="Feature"?new Ky(r):r.type==="FeatureCollection"?new qL(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new Hy(r):!r.type&&Array.isArray(r.collections)?new XL(r):new UL(r)}class Vp extends Yd{constructor(t){super({...t,state:"loading"}),vu(this,"loadImage",n=>new Promise((i,s)=>{const o=new Image;o.addEventListener("load",()=>i(o)),o.addEventListener("error",()=>s(new Error("load failed"))),o.src=n}));const e=new $d(t.url);e.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setLoader(async(i,s,o)=>{const a=await e.getZxy(i,s,o),l=URL.createObjectURL(new Blob([a.data])),h=await this.loadImage(l);return URL.revokeObjectURL(l),h}),this.setState("ready")})}}class ZL extends Dh{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new A0}),vu(this,"tileLoadFunction",(e,n)=>{const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=n.match(i),o=+s[2],a=+s[3],l=+s[4];e.setLoader((h,c,u)=>{e.setState(q.LOADING),this.pmtiles_.getZxy(o,a,l).then(f=>{if(f){const p=e.getFormat();e.setFeatures(p.readFeatures(f.data,{extent:h,featureProjection:u})),e.setState(q.LOADED)}else e.setFeatures([]),e.setState(q.EMPTY)}).catch(f=>{e.setFeatures([]),e.setState(q.ERROR)})})}),this.pmtiles_=new $d(t.url),this.pmtiles_.getHeader().then(e=>{this.tileGrid.minZoom=e.minZoom,this.tileGrid.maxZoom=e.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}let Tf=null;function $L(){return!!Tf}function Qy(r){Tf=r;const t=Object.keys(r.defs),e=t.length;let n,i;for(n=0;n<e;++n){const s=t[n];if(!tt(s)){const o=r.defs(s);let a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),Lm(new As({code:s,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(n=0;n<e;++n){const s=t[n],o=tt(s);for(i=0;i<e;++i){const a=t[i],l=tt(a);if(!Mm(s,a))if(r.defs[s]===r.defs[a])Dc([o,l]);else{const h=r(s,a);Gx(o,l,eg(o,l,h.forward),eg(l,o,h.inverse))}}}}let VL=async function(r){const t=await fetch(`https://epsg.io/${r}.proj4`);if(!t.ok)throw new Error(`Unexpected response from epsg.io: ${t.status}`);return t.text()};async function YL(r){typeof r=="string"&&(r=parseInt(r.split(":").pop(),10));const t=Tf;if(!t)throw new Error("Proj4 must be registered first with register(proj4)");const e="EPSG:"+r;return t.defs(e)||(t.defs(e,await VL(r)),Qy(t)),tt(e)}const HL=new $e({fill:new Ur({color:"rgba(255,255,255,0.4)"}),stroke:new an({color:"#3399CC",width:3})}),KL=new $e({stroke:new an({color:"#ff9933",width:1})});function QL(r,t){const e={url:r.getAbsoluteUrl()};let n=null;r.getBands().length===1&&(n=0);const{minimum:i,maximum:s}=r.getMinMaxValues(n);typeof i=="number"&&(e.min=i),typeof s=="number"&&(e.max=s);const o=r.getNoDataValues(n);return o.length>0&&(e.nodata=o[0]),t.length>0&&(e.bands=t),e}async function Yp(r,t=void 0){let e=t;if($L()){const n=r.getMetadata("proj:epsg");if(n)try{e=await YL(n)}catch{}}return e}function Hp(r,t){const e=r.clone();return t.hasOnlyBounds()||e.setFill(null),e}function JL(r){let t=r.href;if(t.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const e=Math.random()*r["href:servers"].length|0;t=t.replace("{s}",r["href:servers"][e])}else return null;return t}async function tO(r){try{const t=new URL(r);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const e=await fetch(t);return new vd().read(await e.text())}catch{return null}}class Mf extends Th{constructor(t){const e={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>e[n]=t[n]),super(e),this.getSourceOptions_=t.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=t.crossOrigin||null,this.displayFootprint_=t.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!t.displayGeoTiffByDefault,this.displayPreview_=!!t.displayPreview,this.displayOverview_=t.displayOverview!==!1,this.displayWebMapLink_=t.displayWebMapLink||!1,this.buildTileUrlTemplate_=t.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=t.useTileLayerAsFallback||!1,this.boundsStyle_=t.boundsStyle||HL,this.collectionStyle_=t.collectionStyle||KL,this.boundsLayer_=null,t.data){try{this.configure_(t.data,t.url,t.assets,t.bands)}catch(n){this.handleError_(n)}return}if(!t.url)throw new Error("Either url or data must be provided");fetch(t.url).then(n=>n.json()).then(n=>this.configure_(n,t.url,t.assets,t.bands)).catch(n=>this.handleError_(n))}getBoundsLayer(){return this.boundsLayer_}handleError_(t){this.dispatchEvent(new yP(t))}configure_(t,e=null,n=null,i=[]){t instanceof si||t instanceof Aa?this.data_=t:this.data_=WL(t),e&&e.includes("://")&&this.data_.setAbsoluteUrl(e),this.bands_=i,this.boundsLayer_=this.addFootprint_();const s=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Hp(this.boundsStyle_,this))};this.getLayers().on("add",s),this.getLayers().on("remove",s),this.setAssets(n).then(()=>this.dispatchEvent("assetsready")).catch(o=>this.handleError_(o)),this.dispatchEvent("sourceready")}async addApiCollection_(){const t=this.getData().getAll().map(e=>{const n=new Mf({data:e,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(n),n});return await Promise.all(t)}async addStacAssets_(){let t=this.getAssets();if(t===null){t=[];const n=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(n)t.push(n);else{const i=this.getData().getThumbnails();i.length>0&&t.push(i[0])}}const e=t.map(n=>this.addImagery_(n));return await Promise.all(e)}async addImagery_(t){if(t){if(t.isGeoTIFF())return await this.addGeoTiff_(t);if(t.canBrowserDisplayImage())return await this.addThumbnail_(t)}}async addThumbnail_(t){if(!this.displayPreview_)return;let e={url:t.getAbsoluteUrl(),projection:await Yp(t,"EPSG:4326"),imageExtent:t.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(e=await this.getSourceOptions_(re.ImageStatic,e,t));const n=new Ud({source:new Ty(e)});return this.addLayer_(n,t),n}async addWebMapLinks_(){const t=this.getWebMapLinks();if(t.length>0)return await this.addLayerForLink(t[0])}async addLayerForLink(t){const e=JL(t);if(!e)return;const n={attributions:t.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:e},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,t)),a),s=[];switch(t.rel){case"pmtiles":const o=await new $d(n.url).getHeader();let a;switch(o.tileType){case hs.Mvt:a=new ZL(await i(re.PMTilesVector,n));break;case hs.Avif:case hs.Jpeg:case hs.Png:case hs.Webp:a=new Vp(await i(re.PMTilesRaster,n));break;default:return}s.push(a);break;case"tilejson":s.push(new Cy(await i(re.TileJSON,n)));break;case"wms":if(!Array.isArray(t["wms:layers"]))break;for(const c in t["wms:layers"]){const u=t["wms:layers"][c];let f;Array.isArray(t["wms:styles"])&&typeof t["wms:styles"][c]=="string"&&(f=t["wms:styles"][c]);const p=Object.assign({LAYERS:u,STYLES:f},t["wms:dimensions"]);typeof t["wms:transparent"]=="boolean"&&(p.TRANSPARENT=String(t["wms:transparent"])),typeof t.type=="string"&&t.type.startsWith("image/")&&(p.FORMAT=t.type);const m=await i(re.TileWMS,Object.assign({},n,{params:p}));s.push(new Ly(m))}break;case"wmts":const l=await tO(e);if(!l)return;const h=Array.isArray(t["wmts:layer"])?t["wmts:layer"]:[t["wmts:layer"]];for(const c of h){let u=Object.assign({},n,{layer:c});typeof t.type=="string"&&t.type.startsWith("image/")&&(u.format=t.type),u=await i(re.WMTS,u),s.push(new Oy(Fy(l,u)))}break;case"xyz":s.push(new Di(await i(re.XYZ,n)));break;default:return}return s.map(o=>{let a;return o instanceof Dh?a=new k_({source:o,declutter:!0}):o instanceof Vp?a=new Bl({source:o}):a=new jl({source:o}),this.addLayer_(a,t),a})}async addGeoTiff_(t){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);let e={sources:[QL(t,this.bands_)]};const n=await Yp(t);n&&(e.projection=n),this.getSourceOptions_&&(e=await this.getSourceOptions_(re.GeoTIFF,e,t));const i=async(s,o)=>(o&&this.getLayers().remove(o),await this.addTileLayerForImagery_(s));try{const s=new ff(e),o=new Bl({source:s});if(this.useTileLayerAsFallback_){const a=()=>i(t,o);s.on("error",a),s.on("tileloaderror",a),s.on("change",()=>{s.getState()==="error"&&i(t,o)}),o.on("error",a),await s.getView()}return this.addLayer_(o,t),o}catch(s){if(this.useTileLayerAsFallback_)return await i(t,null);this.handleError_(s)}}async addTileLayerForImagery_(t){let e={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(t)};this.getSourceOptions_&&(e=await this.getSourceOptions_(re.XYZ,e,t));const n=new jl({source:new Di(e)});return this.addLayer_(n,t),n}addLayer_(t,e,n=0){t.set("stac",e),t.setZIndex(n),this.getLayers().push(t)}addFootprint_(){let t=null;const e=this.getData();if(e.isItemCollection()||e.isCollectionCollection()?t=Gy(e.getBoundingBox()):t=e.toGeoJSON(),t){const n=new Vm,i=new Eh({format:n,loader:(o,a,l)=>{const h=n.readFeatures(t,{featureProjection:l});i.addFeatures(h)}}),s=new Id({source:i,style:Hp(this.boundsStyle_,this),visible:this.displayFootprint_});return s.set("bounds",!0),this.addLayer_(s,e,1),s}return null}async updateLayers_(){const t=this.getLayers();for(let n=t.getLength()-1;n>=0;n--){const i=t.item(n).get("stac");i&&(i.isLink()||i.isAsset())&&t.removeAt(n)}const e=this.getData();e.isItemCollection()||e.isCollectionCollection()?await this.addApiCollection_():(e.isItem()||e.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&(Array.isArray(this.displayWebMapLink_)||this.hasOnlyBounds())&&await this.addWebMapLinks_()}hasOnlyBounds(){const t=this.getBoundsLayer();return typeof this.getLayersArray().find(e=>e!==t)>"u"}getWebMapLinks(){let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let e=this.data_.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?e=this.displayWebMapLink_.map(n=>typeof n=="string"?e.find(s=>s.id===n)||null:n).filter(n=>!!n):e.sort((n,i)=>{const s=t.indexOf(n.rel),o=t.indexOf(i.rel);return s-o}),e}async setAssets(t){Array.isArray(t)?this.assets_=t.map(e=>typeof e=="string"?this.getData().getAsset(e):e instanceof si?e:new si(e)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const t=this.boundsLayer_.getMapInternal();if(!t)return;const e=t.getView();if(!e)return;const n=this.getData();if(!n)return;const i=n.getBoundingBox();if(i)return Fu(i,"EPSG:4326",e.getProjection())}}function eO(r){r("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),r("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),r("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),r.WGS84=r["EPSG:4326"],r["EPSG:3785"]=r["EPSG:3857"],r.GOOGLE=r["EPSG:3857"],r["EPSG:900913"]=r["EPSG:3857"],r["EPSG:102113"]=r["EPSG:3857"]}var ki=1,Gi=2,Rs=3,rO=4,mu=5,Kp=6378137,nO=6356752314e-3,Qp=.0066943799901413165,No=484813681109536e-20,V=Math.PI/2,iO=.16666666666666666,sO=.04722222222222222,oO=.022156084656084655,J=1e-10,Ie=.017453292519943295,en=57.29577951308232,Zt=Math.PI/4,oa=Math.PI*2,ge=3.14159265359,cr={};cr.greenwich=0;cr.lisbon=-9.131906111111;cr.paris=2.337229166667;cr.bogota=-74.080916666667;cr.madrid=-3.687938888889;cr.rome=12.452333333333;cr.bern=7.439583333333;cr.jakarta=106.807719444444;cr.ferro=-17.666666666667;cr.brussels=4.367975;cr.stockholm=18.058277777778;cr.athens=23.7163375;cr.oslo=10.722916666667;const aO={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Jp=/[\s_\-\/\(\)]/g;function ci(r,t){if(r[t])return r[t];for(var e=Object.keys(r),n=t.toLowerCase().replace(Jp,""),i=-1,s,o;++i<e.length;)if(s=e[i],o=s.toLowerCase().replace(Jp,""),o===n)return r[s]}function _u(r){var t={},e=r.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var h=l.split("=");return h.push(!0),a[h[0].toLowerCase()]=h[1],a},{}),n,i,s,o={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*Ie},lat_1:function(a){t.lat1=a*Ie},lat_2:function(a){t.lat2=a*Ie},lat_ts:function(a){t.lat_ts=a*Ie},lon_0:function(a){t.long0=a*Ie},lon_1:function(a){t.long1=a*Ie},lon_2:function(a){t.long2=a*Ie},alpha:function(a){t.alpha=parseFloat(a)*Ie},gamma:function(a){t.rectified_grid_angle=parseFloat(a)},lonc:function(a){t.longc=a*Ie},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r:function(a){t.a=t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var l=ci(aO,a);l&&(t.to_meter=l.to_meter)},from_greenwich:function(a){t.from_greenwich=a*Ie},pm:function(a){var l=ci(cr,a);t.from_greenwich=(l||parseFloat(a))*Ie},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(n in e)i=e[n],n in o?(s=o[n],typeof s=="function"?s(i):t[s]=i):t[n]=i;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var aa=1,Jy=2,t1=3,Zl=4,e1=5,Rf=-1,lO=/\s/,hO=/[A-Za-z]/,cO=/[A-Za-z84_]/,jh=/[,\]]/,r1=/[\d\.E\-\+]/;function Un(r){if(typeof r!="string")throw new Error("not a string");this.text=r.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=aa}Un.prototype.readCharicter=function(){var r=this.text[this.place++];if(this.state!==Zl)for(;lO.test(r);){if(this.place>=this.text.length)return;r=this.text[this.place++]}switch(this.state){case aa:return this.neutral(r);case Jy:return this.keyword(r);case Zl:return this.quoted(r);case e1:return this.afterquote(r);case t1:return this.number(r);case Rf:return}};Un.prototype.afterquote=function(r){if(r==='"'){this.word+='"',this.state=Zl;return}if(jh.test(r)){this.word=this.word.trim(),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in afterquote yet, index '+this.place)};Un.prototype.afterItem=function(r){if(r===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=aa;return}if(r==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=aa,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Rf);return}};Un.prototype.number=function(r){if(r1.test(r)){this.word+=r;return}if(jh.test(r)){this.word=parseFloat(this.word),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in number yet, index '+this.place)};Un.prototype.quoted=function(r){if(r==='"'){this.state=e1;return}this.word+=r};Un.prototype.keyword=function(r){if(cO.test(r)){this.word+=r;return}if(r==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=aa;return}if(jh.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in keyword yet, index '+this.place)};Un.prototype.neutral=function(r){if(hO.test(r)){this.word=r,this.state=Jy;return}if(r==='"'){this.word="",this.state=Zl;return}if(r1.test(r)){this.word=r,this.state=t1;return}if(jh.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in neutral yet, index '+this.place)};Un.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Rf)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function uO(r){var t=new Un(r);return t.output()}function tm(r,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var n=t?{}:r,i=e.reduce(function(s,o){return _s(o,s),s},n);t&&(r[t]=i)}function _s(r,t){if(!Array.isArray(r)){t[r]=!0;return}var e=r.shift();if(e==="PARAMETER"&&(e=r.shift()),r.length===1){if(Array.isArray(r[0])){t[e]={},_s(r[0],t[e]);return}t[e]=r[0];return}if(!r.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=r;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(r);return}Array.isArray(e)||(t[e]={});var n;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:r[0].toLowerCase(),convert:r[1]},r.length===3&&_s(r[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:r[0],a:r[1],rf:r[2]},r.length===4&&_s(r[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":r[0]=["name",r[0]],tm(t,e,r);return;default:for(n=-1;++n<r.length;)if(!Array.isArray(r[n]))return _s(r,t[e]);return tm(t,e,r)}}var dO=.017453292519943295;function fO(r,t){var e=t[0],n=t[1];!(e in r)&&n in r&&(r[e]=r[n],t.length===3&&(r[e]=t[2](r[e])))}function Yr(r){return r*dO}function gO(r){if(r.type==="GEOGCS"?r.projName="longlat":r.type==="LOCAL_CS"?(r.projName="identity",r.local=!0):typeof r.PROJECTION=="object"?r.projName=Object.keys(r.PROJECTION)[0]:r.projName=r.PROJECTION,r.AXIS){for(var t="",e=0,n=r.AXIS.length;e<n;++e){var i=[r.AXIS[e][0].toLowerCase(),r.AXIS[e][1].toLowerCase()];i[0].indexOf("north")!==-1||(i[0]==="y"||i[0]==="lat")&&i[1]==="north"?t+="n":i[0].indexOf("south")!==-1||(i[0]==="y"||i[0]==="lat")&&i[1]==="south"?t+="s":i[0].indexOf("east")!==-1||(i[0]==="x"||i[0]==="lon")&&i[1]==="east"?t+="e":(i[0].indexOf("west")!==-1||(i[0]==="x"||i[0]==="lon")&&i[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(r.axis=t)}r.UNIT&&(r.units=r.UNIT.name.toLowerCase(),r.units==="metre"&&(r.units="meter"),r.UNIT.convert&&(r.type==="GEOGCS"?r.DATUM&&r.DATUM.SPHEROID&&(r.to_meter=r.UNIT.convert*r.DATUM.SPHEROID.a):r.to_meter=r.UNIT.convert));var s=r.GEOGCS;r.type==="GEOGCS"&&(s=r),s&&(s.DATUM?r.datumCode=s.DATUM.name.toLowerCase():r.datumCode=s.name.toLowerCase(),r.datumCode.slice(0,2)==="d_"&&(r.datumCode=r.datumCode.slice(2)),(r.datumCode==="new_zealand_geodetic_datum_1949"||r.datumCode==="new_zealand_1949")&&(r.datumCode="nzgd49"),(r.datumCode==="wgs_1984"||r.datumCode==="world_geodetic_system_1984")&&(r.PROJECTION==="Mercator_Auxiliary_Sphere"&&(r.sphere=!0),r.datumCode="wgs84"),r.datumCode.slice(-6)==="_ferro"&&(r.datumCode=r.datumCode.slice(0,-6)),r.datumCode.slice(-8)==="_jakarta"&&(r.datumCode=r.datumCode.slice(0,-8)),~r.datumCode.indexOf("belge")&&(r.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(r.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),r.ellps.toLowerCase().slice(0,13)==="international"&&(r.ellps="intl"),r.a=s.DATUM.SPHEROID.a,r.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(r.datum_params=s.DATUM.TOWGS84),~r.datumCode.indexOf("osgb_1936")&&(r.datumCode="osgb36"),~r.datumCode.indexOf("osni_1952")&&(r.datumCode="osni52"),(~r.datumCode.indexOf("tm65")||~r.datumCode.indexOf("geodetic_datum_of_1965"))&&(r.datumCode="ire65"),r.datumCode==="ch1903+"&&(r.datumCode="ch1903"),~r.datumCode.indexOf("israel")&&(r.datumCode="isr93")),r.b&&!isFinite(r.b)&&(r.b=r.a);function o(h){var c=r.to_meter||1;return h*c}var a=function(h){return fO(r,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Yr],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Yr],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Yr],["lat0","latitude_of_origin",Yr],["lat0","standard_parallel_1",Yr],["lat1","standard_parallel_1",Yr],["lat2","standard_parallel_2",Yr],["azimuth","Azimuth"],["alpha","azimuth",Yr],["srsCode","name"]];l.forEach(a),!r.long0&&r.longc&&(r.projName==="Albers_Conic_Equal_Area"||r.projName==="Lambert_Azimuthal_Equal_Area")&&(r.long0=r.longc),!r.lat_ts&&r.lat1&&(r.projName==="Stereographic_South_Pole"||r.projName==="Polar Stereographic (variant B)")?(r.lat0=Yr(r.lat1>0?90:-90),r.lat_ts=r.lat1):!r.lat_ts&&r.lat0&&r.projName==="Polar_Stereographic"&&(r.lat_ts=r.lat0,r.lat0=Yr(r.lat0>0?90:-90))}function n1(r){var t=uO(r),e=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",e]);var i={};return _s(t,i),gO(i),i}function Xe(r){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?Xe[r]=_u(arguments[1]):Xe[r]=n1(arguments[1]):Xe[r]=e}else if(arguments.length===1){if(Array.isArray(r))return r.map(function(n){Array.isArray(n)?Xe.apply(t,n):Xe(n)});if(typeof r=="string"){if(r in Xe)return Xe[r]}else"EPSG"in r?Xe["EPSG:"+r.EPSG]=r:"ESRI"in r?Xe["ESRI:"+r.ESRI]=r:"IAU2000"in r?Xe["IAU2000:"+r.IAU2000]=r:console.log(r);return}}eO(Xe);function pO(r){return typeof r=="string"}function mO(r){return r in Xe}var _O=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function yO(r){return _O.some(function(t){return r.indexOf(t)>-1})}var xO=["3857","900913","3785","102113"];function vO(r){var t=ci(r,"authority");if(t){var e=ci(t,"epsg");return e&&xO.indexOf(e)>-1}}function wO(r){var t=ci(r,"extension");if(t)return ci(t,"proj4")}function bO(r){return r[0]==="+"}function SO(r){if(pO(r)){if(mO(r))return Xe[r];if(yO(r)){var t=n1(r);if(vO(t))return Xe["EPSG:3857"];var e=wO(t);return e?_u(e):t}if(bO(r))return _u(r)}else return r}function em(r,t){r=r||{};var e,n;if(!t)return r;for(n in t)e=t[n],e!==void 0&&(r[n]=e);return r}function hn(r,t,e){var n=r*t;return e/Math.sqrt(1-n*n)}function La(r){return r<0?-1:1}function rt(r){return Math.abs(r)<=ge?r:r-La(r)*oa}function Gr(r,t,e){var n=r*e,i=.5*r;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(V-t))/n}function la(r,t){for(var e=.5*r,n,i,s=V-2*Math.atan(t),o=0;o<=15;o++)if(n=r*Math.sin(s),i=V-2*Math.atan(t*Math.pow((1-n)/(1+n),e))-s,s+=i,Math.abs(i)<=1e-10)return s;return-9999}function EO(){var r=this.b/this.a;this.es=1-r*r,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function TO(r){var t=r.x,e=r.y;if(e*en>90&&e*en<-90&&t*en>180&&t*en<-180)return null;var n,i;if(Math.abs(Math.abs(e)-V)<=J)return null;if(this.sphere)n=this.x0+this.a*this.k0*rt(t-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(Zt+.5*e));else{var s=Math.sin(e),o=Gr(this.e,e,s);n=this.x0+this.a*this.k0*rt(t-this.long0),i=this.y0-this.a*this.k0*Math.log(o)}return r.x=n,r.y=i,r}function MO(r){var t=r.x-this.x0,e=r.y-this.y0,n,i;if(this.sphere)i=V-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var s=Math.exp(-e/(this.a*this.k0));if(i=la(this.e,s),i===-9999)return null}return n=rt(this.long0+t/(this.a*this.k0)),r.x=n,r.y=i,r}var RO=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const CO={init:EO,forward:TO,inverse:MO,names:RO};function IO(){}function rm(r){return r}var PO=["longlat","identity"];const AO={init:IO,forward:rm,inverse:rm,names:PO};var LO=[CO,AO],ul={},$l=[];function i1(r,t){var e=$l.length;return r.names?($l[e]=r,r.names.forEach(function(n){ul[n.toLowerCase()]=e}),this):(console.log(t),!0)}function OO(r){if(!r)return!1;var t=r.toLowerCase();if(typeof ul[t]<"u"&&$l[ul[t]])return $l[ul[t]]}function FO(){LO.forEach(i1)}const NO={start:FO,add:i1,get:OO};var bt={};bt.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};bt.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};bt.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};bt.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};bt.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};bt.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};bt.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};bt.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};bt.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};bt.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};bt.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};bt.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};bt.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};bt.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};bt.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};bt.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};bt.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};bt.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};bt.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};bt.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};bt.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};bt.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};bt.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};bt.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};bt.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};bt.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};bt.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};bt.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};bt.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};bt.hough={a:6378270,rf:297,ellipseName:"Hough"};bt.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};bt.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};bt.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};bt.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};bt.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};bt.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};bt.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};bt.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};bt.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};bt.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};bt.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};bt.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var DO=bt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};bt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function kO(r,t,e,n){var i=r*r,s=t*t,o=(i-s)/i,a=0;n?(r*=1-o*(iO+o*(sO+o*oO)),i=r*r,o=0):a=Math.sqrt(o);var l=(i-s)/s;return{es:o,e:a,ep2:l}}function GO(r,t,e,n,i){if(!r){var s=ci(bt,n);s||(s=DO),r=s.a,t=s.b,e=s.rf}return e&&!t&&(t=(1-1/e)*r),(e===0||Math.abs(r-t)<J)&&(i=!0,t=r),{a:r,b:t,rf:e,sphere:i}}var Ee={};Ee.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Ee.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Ee.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Ee.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Ee.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Ee.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Ee.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Ee.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Ee.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Ee.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Ee.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Ee.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Ee.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Ee.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Ee.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Ee.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Ee.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Ee.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function jO(r,t,e,n,i,s,o){var a={};return r===void 0||r==="none"?a.datum_type=mu:a.datum_type=rO,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=ki),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=Gi,a.datum_params[3]*=No,a.datum_params[4]*=No,a.datum_params[5]*=No,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=Rs,a.grids=o),a.a=e,a.b=n,a.es=i,a.ep2=s,a}var s1={};function zO(r,t){var e=new DataView(t),n=XO(e),i=qO(e,n),s=WO(e,i,n),o={header:i,subgrids:s};return s1[r]=o,o}function UO(r){if(r===void 0)return null;var t=r.split(",");return t.map(BO)}function BO(r){if(r.length===0)return null;var t=r[0]==="@";return t&&(r=r.slice(1)),r==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:r,mandatory:!t,grid:s1[r]||null,isNull:!1}}function ys(r){return r/3600*Math.PI/180}function XO(r){var t=r.getInt32(8,!1);return t===11?!1:(t=r.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function qO(r,t){return{nFields:r.getInt32(8,t),nSubgridFields:r.getInt32(24,t),nSubgrids:r.getInt32(40,t),shiftType:yu(r,56,64).trim(),fromSemiMajorAxis:r.getFloat64(120,t),fromSemiMinorAxis:r.getFloat64(136,t),toSemiMajorAxis:r.getFloat64(152,t),toSemiMinorAxis:r.getFloat64(168,t)}}function yu(r,t,e){return String.fromCharCode.apply(null,new Uint8Array(r.buffer.slice(t,e)))}function WO(r,t,e){for(var n=176,i=[],s=0;s<t.nSubgrids;s++){var o=$O(r,n,e),a=VO(r,n,o,e),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),h=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);i.push({ll:[ys(o.lowerLongitude),ys(o.lowerLatitude)],del:[ys(o.longitudeInterval),ys(o.latitudeInterval)],lim:[l,h],count:o.gridNodeCount,cvs:ZO(a)}),n+=176+o.gridNodeCount*16}return i}function ZO(r){return r.map(function(t){return[ys(t.longitudeShift),ys(t.latitudeShift)]})}function $O(r,t,e){return{name:yu(r,t+8,t+16).trim(),parent:yu(r,t+24,t+24+8).trim(),lowerLatitude:r.getFloat64(t+72,e),upperLatitude:r.getFloat64(t+88,e),lowerLongitude:r.getFloat64(t+104,e),upperLongitude:r.getFloat64(t+120,e),latitudeInterval:r.getFloat64(t+136,e),longitudeInterval:r.getFloat64(t+152,e),gridNodeCount:r.getInt32(t+168,e)}}function VO(r,t,e,n){for(var i=t+176,s=16,o=[],a=0;a<e.gridNodeCount;a++){var l={latitudeShift:r.getFloat32(i+a*s,n),longitudeShift:r.getFloat32(i+a*s+4,n),latitudeAccuracy:r.getFloat32(i+a*s+8,n),longitudeAccuracy:r.getFloat32(i+a*s+12,n)};o.push(l)}return o}function sn(r,t){if(!(this instanceof sn))return new sn(r);t=t||function(h){if(h)throw h};var e=SO(r);if(typeof e!="object"){t(r);return}var n=sn.projections.get(e.projName);if(!n){t(r);return}if(e.datumCode&&e.datumCode!=="none"){var i=ci(Ee,e.datumCode);i&&(e.datum_params=e.datum_params||(i.towgs84?i.towgs84.split(","):null),e.ellps=i.ellipse,e.datumName=i.datumName?i.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var s=GO(e.a,e.b,e.rf,e.ellps,e.sphere),o=kO(s.a,s.b,s.rf,e.R_A),a=UO(e.nadgrids),l=e.datum||jO(e.datumCode,e.datum_params,s.a,s.b,o.es,o.ep2,a);em(this,e),em(this,n),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),t(null,this)}sn.projections=NO;sn.projections.start();function YO(r,t){return r.datum_type!==t.datum_type||r.a!==t.a||Math.abs(r.es-t.es)>5e-11?!1:r.datum_type===ki?r.datum_params[0]===t.datum_params[0]&&r.datum_params[1]===t.datum_params[1]&&r.datum_params[2]===t.datum_params[2]:r.datum_type===Gi?r.datum_params[0]===t.datum_params[0]&&r.datum_params[1]===t.datum_params[1]&&r.datum_params[2]===t.datum_params[2]&&r.datum_params[3]===t.datum_params[3]&&r.datum_params[4]===t.datum_params[4]&&r.datum_params[5]===t.datum_params[5]&&r.datum_params[6]===t.datum_params[6]:!0}function o1(r,t,e){var n=r.x,i=r.y,s=r.z?r.z:0,o,a,l,h;if(i<-V&&i>-1.001*V)i=-V;else if(i>V&&i<1.001*V)i=V;else{if(i<-V)return{x:-1/0,y:-1/0,z:r.z};if(i>V)return{x:1/0,y:1/0,z:r.z}}return n>Math.PI&&(n-=2*Math.PI),a=Math.sin(i),h=Math.cos(i),l=a*a,o=e/Math.sqrt(1-t*l),{x:(o+s)*h*Math.cos(n),y:(o+s)*h*Math.sin(n),z:(o*(1-t)+s)*a}}function a1(r,t,e,n){var i=1e-12,s=i*i,o=30,a,l,h,c,u,f,p,m,_,x,v,w,S,E=r.x,T=r.y,R=r.z?r.z:0,C,I,F;if(a=Math.sqrt(E*E+T*T),l=Math.sqrt(E*E+T*T+R*R),a/e<i){if(C=0,l/e<i)return I=V,F=-n,{x:r.x,y:r.y,z:r.z}}else C=Math.atan2(T,E);h=R/l,c=a/l,u=1/Math.sqrt(1-t*(2-t)*c*c),m=c*(1-t)*u,_=h*u,S=0;do S++,p=e/Math.sqrt(1-t*_*_),F=a*m+R*_-p*(1-t*_*_),f=t*p/(p+F),u=1/Math.sqrt(1-f*(2-f)*c*c),x=c*(1-f)*u,v=h*u,w=v*m-x*_,m=x,_=v;while(w*w>s&&S<o);return I=Math.atan(v/Math.abs(x)),{x:C,y:I,z:F}}function HO(r,t,e){if(t===ki)return{x:r.x+e[0],y:r.y+e[1],z:r.z+e[2]};if(t===Gi){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6];return{x:h*(r.x-l*r.y+a*r.z)+n,y:h*(l*r.x+r.y-o*r.z)+i,z:h*(-a*r.x+o*r.y+r.z)+s}}}function KO(r,t,e){if(t===ki)return{x:r.x-e[0],y:r.y-e[1],z:r.z-e[2]};if(t===Gi){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],c=(r.x-n)/h,u=(r.y-i)/h,f=(r.z-s)/h;return{x:c+l*u-a*f,y:-l*c+u+o*f,z:a*c-o*u+f}}}function nl(r){return r===ki||r===Gi}function QO(r,t,e){if(YO(r,t)||r.datum_type===mu||t.datum_type===mu)return e;var n=r.a,i=r.es;if(r.datum_type===Rs){var s=nm(r,!1,e);if(s!==0)return;n=Kp,i=Qp}var o=t.a,a=t.b,l=t.es;if(t.datum_type===Rs&&(o=Kp,a=nO,l=Qp),i===l&&n===o&&!nl(r.datum_type)&&!nl(t.datum_type))return e;if(e=o1(e,i,n),nl(r.datum_type)&&(e=HO(e,r.datum_type,r.datum_params)),nl(t.datum_type)&&(e=KO(e,t.datum_type,t.datum_params)),e=a1(e,l,o,a),t.datum_type===Rs){var h=nm(t,!0,e);if(h!==0)return}return e}function nm(r,t,e){if(r.grids===null||r.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-e.x,y:e.y},i={x:Number.NaN,y:Number.NaN},s=[];t:for(var o=0;o<r.grids.length;o++){var a=r.grids[o];if(s.push(a.name),a.isNull){i=n;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var l=a.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],f=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,p=u.ll[0]-f,m=u.ll[1]-f,_=u.ll[0]+(u.lim[0]-1)*u.del[0]+f,x=u.ll[1]+(u.lim[1]-1)*u.del[1]+f;if(!(m>n.y||p>n.x||x<n.y||_<n.x)&&(i=JO(n,t,u),!isNaN(i.x)))break t}}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*en+" "+n.y*en+" tried: '"+s+"'"),-1):(e.x=-i.x,e.y=i.y,0)}function JO(r,t,e){var n={x:Number.NaN,y:Number.NaN};if(isNaN(r.x))return n;var i={x:r.x,y:r.y};i.x-=e.ll[0],i.y-=e.ll[1],i.x=rt(i.x-Math.PI)+Math.PI;var s=im(i,e);if(t){if(isNaN(s.x))return n;s.x=i.x-s.x,s.y=i.y-s.y;var o=9,a=1e-12,l,h;do{if(h=im(s,e),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:i.x-(h.x+s.x),y:i.y-(h.y+s.y)},s.x+=l.x,s.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=rt(s.x+e.ll[0]),n.y=s.y+e.ll[1]}else isNaN(s.x)||(n.x=r.x+s.x,n.y=r.y+s.y);return n}function im(r,t){var e={x:r.x/t.del[0],y:r.y/t.del[1]},n={x:Math.floor(e.x),y:Math.floor(e.y)},i={x:e.x-1*n.x,y:e.y-1*n.y},s={x:Number.NaN,y:Number.NaN},o;if(n.x<0||n.x>=t.lim[0]||n.y<0||n.y>=t.lim[1])return s;o=n.y*t.lim[0]+n.x;var a={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var l={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var h={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var c={x:t.cvs[o][0],y:t.cvs[o][1]},u=i.x*i.y,f=i.x*(1-i.y),p=(1-i.x)*(1-i.y),m=(1-i.x)*i.y;return s.x=p*a.x+f*l.x+m*c.x+u*h.x,s.y=p*a.y+f*l.y+m*c.y+u*h.y,s}function sm(r,t,e){var n=e.x,i=e.y,s=e.z||0,o,a,l,h={};for(l=0;l<3;l++)if(!(t&&l===2&&e.z===void 0))switch(l===0?(o=n,"ew".indexOf(r.axis[l])!==-1?a="x":a="y"):l===1?(o=i,"ns".indexOf(r.axis[l])!==-1?a="y":a="x"):(o=s,a="z"),r.axis[l]){case"e":h[a]=o;break;case"w":h[a]=-o;break;case"n":h[a]=o;break;case"s":h[a]=-o;break;case"u":e[a]!==void 0&&(h.z=o);break;case"d":e[a]!==void 0&&(h.z=-o);break;default:return null}return h}function l1(r){var t={x:r[0],y:r[1]};return r.length>2&&(t.z=r[2]),r.length>3&&(t.m=r[3]),t}function tF(r){om(r.x),om(r.y)}function om(r){if(typeof Number.isFinite=="function"){if(Number.isFinite(r))return;throw new TypeError("coordinates must be finite numbers")}if(typeof r!="number"||r!==r||!isFinite(r))throw new TypeError("coordinates must be finite numbers")}function eF(r,t){return(r.datum.datum_type===ki||r.datum.datum_type===Gi||r.datum.datum_type===Rs)&&t.datumCode!=="WGS84"||(t.datum.datum_type===ki||t.datum.datum_type===Gi||t.datum.datum_type===Rs)&&r.datumCode!=="WGS84"}function Vl(r,t,e,n){var i;Array.isArray(e)?e=l1(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var s=e.z!==void 0;if(tF(e),r.datum&&t.datum&&eF(r,t)&&(i=new sn("WGS84"),e=Vl(r,i,e,n),r=i),n&&r.axis!=="enu"&&(e=sm(r,!1,e)),r.projName==="longlat")e={x:e.x*Ie,y:e.y*Ie,z:e.z||0};else if(r.to_meter&&(e={x:e.x*r.to_meter,y:e.y*r.to_meter,z:e.z||0}),e=r.inverse(e),!e)return;if(r.from_greenwich&&(e.x+=r.from_greenwich),e=QO(r.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*en,y:e.y*en,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),n&&t.axis!=="enu"?sm(t,!0,e):(e&&!s&&delete e.z,e)}var am=sn("WGS84");function Cc(r,t,e,n){var i,s,o;return Array.isArray(e)?(i=Vl(r,t,e,n)||{x:NaN,y:NaN},e.length>2?typeof r.name<"u"&&r.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof i.z=="number"?[i.x,i.y,i.z].concat(e.splice(3)):[i.x,i.y,e[2]].concat(e.splice(3)):[i.x,i.y].concat(e.splice(2)):[i.x,i.y]):(s=Vl(r,t,e,n),o=Object.keys(e),o.length===2||o.forEach(function(a){if(typeof r.name<"u"&&r.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;s[a]=e[a]}),s)}function lm(r){return r instanceof sn?r:r.oProj?r.oProj:sn(r)}function _r(r,t,e){r=lm(r);var n=!1,i;return typeof t>"u"?(t=r,r=am,n=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=r,r=am,n=!0),t=lm(t),e?Cc(r,t,e):(i={forward:function(s,o){return Cc(r,t,s,o)},inverse:function(s,o){return Cc(t,r,s,o)}},n&&(i.oProj=t),i)}var hm=6,h1="AJSAJS",c1="AFAFAF",xs=65,Qe=73,br=79,So=86,Eo=90;const rF={forward:u1,inverse:nF,toPoint:d1};function u1(r,t){return t=t||5,oF(iF({lat:r[1],lon:r[0]}),t)}function nF(r){var t=Cf(g1(r.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function d1(r){var t=Cf(g1(r.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Ic(r){return r*(Math.PI/180)}function cm(r){return 180*(r/Math.PI)}function iF(r){var t=r.lat,e=r.lon,n=6378137,i=.00669438,s=.9996,o,a,l,h,c,u,f,p=Ic(t),m=Ic(e),_,x;x=Math.floor((e+180)/6)+1,e===180&&(x=60),t>=56&&t<64&&e>=3&&e<12&&(x=32),t>=72&&t<84&&(e>=0&&e<9?x=31:e>=9&&e<21?x=33:e>=21&&e<33?x=35:e>=33&&e<42&&(x=37)),o=(x-1)*6-180+3,_=Ic(o),a=i/(1-i),l=n/Math.sqrt(1-i*Math.sin(p)*Math.sin(p)),h=Math.tan(p)*Math.tan(p),c=a*Math.cos(p)*Math.cos(p),u=Math.cos(p)*(m-_),f=n*((1-i/4-3*i*i/64-5*i*i*i/256)*p-(3*i/8+3*i*i/32+45*i*i*i/1024)*Math.sin(2*p)+(15*i*i/256+45*i*i*i/1024)*Math.sin(4*p)-35*i*i*i/3072*Math.sin(6*p));var v=s*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*a)*u*u*u*u*u/120)+5e5,w=s*(f+l*Math.tan(p)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*a)*u*u*u*u*u*u/720));return t<0&&(w+=1e7),{northing:Math.round(w),easting:Math.round(v),zoneNumber:x,zoneLetter:sF(t)}}function Cf(r){var t=r.northing,e=r.easting,n=r.zoneLetter,i=r.zoneNumber;if(i<0||i>60)return null;var s=.9996,o=6378137,a=.00669438,l,h=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),c,u,f,p,m,_,x,v,w,S=e-5e5,E=t;n<"N"&&(E-=1e7),x=(i-1)*6-180+3,l=a/(1-a),_=E/s,v=_/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),w=v+(3*h/2-27*h*h*h/32)*Math.sin(2*v)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*v)+151*h*h*h/96*Math.sin(6*v),c=o/Math.sqrt(1-a*Math.sin(w)*Math.sin(w)),u=Math.tan(w)*Math.tan(w),f=l*Math.cos(w)*Math.cos(w),p=o*(1-a)/Math.pow(1-a*Math.sin(w)*Math.sin(w),1.5),m=S/(c*s);var T=w-c*Math.tan(w)/p*(m*m/2-(5+3*u+10*f-4*f*f-9*l)*m*m*m*m/24+(61+90*u+298*f+45*u*u-252*l-3*f*f)*m*m*m*m*m*m/720);T=cm(T);var R=(m-(1+2*u+f)*m*m*m/6+(5-2*f+28*u-3*f*f+8*l+24*u*u)*m*m*m*m*m/120)/Math.cos(w);R=x+cm(R);var C;if(r.accuracy){var I=Cf({northing:r.northing+r.accuracy,easting:r.easting+r.accuracy,zoneLetter:r.zoneLetter,zoneNumber:r.zoneNumber});C={top:I.lat,right:I.lon,bottom:T,left:R}}else C={lat:T,lon:R};return C}function sF(r){var t="Z";return 84>=r&&r>=72?t="X":72>r&&r>=64?t="W":64>r&&r>=56?t="V":56>r&&r>=48?t="U":48>r&&r>=40?t="T":40>r&&r>=32?t="S":32>r&&r>=24?t="R":24>r&&r>=16?t="Q":16>r&&r>=8?t="P":8>r&&r>=0?t="N":0>r&&r>=-8?t="M":-8>r&&r>=-16?t="L":-16>r&&r>=-24?t="K":-24>r&&r>=-32?t="J":-32>r&&r>=-40?t="H":-40>r&&r>=-48?t="G":-48>r&&r>=-56?t="F":-56>r&&r>=-64?t="E":-64>r&&r>=-72?t="D":-72>r&&r>=-80&&(t="C"),t}function oF(r,t){var e="00000"+r.easting,n="00000"+r.northing;return r.zoneNumber+r.zoneLetter+aF(r.easting,r.northing,r.zoneNumber)+e.substr(e.length-5,t)+n.substr(n.length-5,t)}function aF(r,t,e){var n=f1(e),i=Math.floor(r/1e5),s=Math.floor(t/1e5)%20;return lF(i,s,n)}function f1(r){var t=r%hm;return t===0&&(t=hm),t}function lF(r,t,e){var n=e-1,i=h1.charCodeAt(n),s=c1.charCodeAt(n),o=i+r-1,a=s+t,l=!1;o>Eo&&(o=o-Eo+xs-1,l=!0),(o===Qe||i<Qe&&o>Qe||(o>Qe||i<Qe)&&l)&&o++,(o===br||i<br&&o>br||(o>br||i<br)&&l)&&(o++,o===Qe&&o++),o>Eo&&(o=o-Eo+xs-1),a>So?(a=a-So+xs-1,l=!0):l=!1,(a===Qe||s<Qe&&a>Qe||(a>Qe||s<Qe)&&l)&&a++,(a===br||s<br&&a>br||(a>br||s<br)&&l)&&(a++,a===Qe&&a++),a>So&&(a=a-So+xs-1);var h=String.fromCharCode(o)+String.fromCharCode(a);return h}function g1(r){if(r&&r.length===0)throw"MGRSPoint coverting from nothing";for(var t=r.length,e=null,n="",i,s=0;!/[A-Z]/.test(i=r.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+r;n+=i,s++}var o=parseInt(n,10);if(s===0||s+3>t)throw"MGRSPoint bad conversion from: "+r;var a=r.charAt(s++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+r;e=r.substring(s,s+=2);for(var l=f1(o),h=hF(e.charAt(0),l),c=cF(e.charAt(1),l);c<uF(a);)c+=2e6;var u=t-s;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+r;var f=u/2,p=0,m=0,_,x,v,w,S;return f>0&&(_=1e5/Math.pow(10,f),x=r.substring(s,s+f),p=parseFloat(x)*_,v=r.substring(s+f),m=parseFloat(v)*_),w=p+h,S=m+c,{easting:w,northing:S,zoneLetter:a,zoneNumber:o,accuracy:_}}function hF(r,t){for(var e=h1.charCodeAt(t-1),n=1e5,i=!1;e!==r.charCodeAt(0);){if(e++,e===Qe&&e++,e===br&&e++,e>Eo){if(i)throw"Bad character: "+r;e=xs,i=!0}n+=1e5}return n}function cF(r,t){if(r>"V")throw"MGRSPoint given invalid Northing "+r;for(var e=c1.charCodeAt(t-1),n=0,i=!1;e!==r.charCodeAt(0);){if(e++,e===Qe&&e++,e===br&&e++,e>So){if(i)throw"Bad character: "+r;e=xs,i=!0}n+=1e5}return n}function uF(r){var t;switch(r){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+r}function Us(r,t,e){if(!(this instanceof Us))return new Us(r,t,e);if(Array.isArray(r))this.x=r[0],this.y=r[1],this.z=r[2]||0;else if(typeof r=="object")this.x=r.x,this.y=r.y,this.z=r.z||0;else if(typeof r=="string"&&typeof t>"u"){var n=r.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=r,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Us.fromMGRS=function(r){return new Us(d1(r))};Us.prototype.toMGRS=function(r){return u1([this.x,this.y],r)};var dF=1,fF=.25,um=.046875,dm=.01953125,fm=.01068115234375,gF=.75,pF=.46875,mF=.013020833333333334,_F=.007120768229166667,yF=.3645833333333333,xF=.005696614583333333,vF=.3076171875;function p1(r){var t=[];t[0]=dF-r*(fF+r*(um+r*(dm+r*fm))),t[1]=r*(gF-r*(um+r*(dm+r*fm)));var e=r*r;return t[2]=e*(pF-r*(mF+r*_F)),e*=r,t[3]=e*(yF-r*xF),t[4]=e*r*vF,t}function zh(r,t,e,n){return e*=t,t*=t,n[0]*r-e*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}var wF=20;function m1(r,t,e){for(var n=1/(1-t),i=r,s=wF;s;--s){var o=Math.sin(i),a=1-t*o*o;if(a=(zh(i,o,Math.cos(i),e)-r)*(a*Math.sqrt(a))*n,i-=a,Math.abs(a)<J)return i}return i}function bF(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=p1(this.es),this.ml0=zh(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function SF(r){var t=r.x,e=r.y,n=rt(t-this.long0),i,s,o,a=Math.sin(e),l=Math.cos(e);if(this.es){var h=l*n,c=Math.pow(h,2),u=this.ep2*Math.pow(l,2),f=Math.pow(u,2),p=Math.abs(l)>J?Math.tan(e):0,m=Math.pow(p,2),_=Math.pow(m,2);i=1-this.es*Math.pow(a,2),h=h/Math.sqrt(i);var x=zh(e,a,l,this.en);s=this.a*(this.k0*h*(1+c/6*(1-m+u+c/20*(5-18*m+_+14*u-58*m*u+c/42*(61+179*_-_*m-479*m)))))+this.x0,o=this.a*(this.k0*(x-this.ml0+a*n*h/2*(1+c/12*(5-m+9*u+4*f+c/30*(61+_-58*m+270*u-330*m*u+c/56*(1385+543*_-_*m-3111*m))))))+this.y0}else{var v=l*Math.sin(n);if(Math.abs(Math.abs(v)-1)<J)return 93;if(s=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,o=l*Math.cos(n)/Math.sqrt(1-Math.pow(v,2)),v=Math.abs(o),v>=1){if(v-1>J)return 93;o=0}else o=Math.acos(o);e<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return r.x=s,r.y=o,r}function EF(r){var t,e,n,i,s=(r.x-this.x0)*(1/this.a),o=(r.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,e=m1(t,this.es,this.en),Math.abs(e)<V){var a=Math.sin(e),l=Math.cos(e),h=Math.abs(l)>J?Math.tan(e):0,c=this.ep2*Math.pow(l,2),u=Math.pow(c,2),f=Math.pow(h,2),p=Math.pow(f,2);t=1-this.es*Math.pow(a,2);var m=s*Math.sqrt(t)/this.k0,_=Math.pow(m,2);t=t*h,n=e-t*_/(1-this.es)*.5*(1-_/12*(5+3*f-9*c*f+c-4*u-_/30*(61+90*f-252*c*f+45*p+46*c-_/56*(1385+3633*f+4095*p+1574*p*f)))),i=rt(this.long0+m*(1-_/6*(1+2*f+c-_/20*(5+28*f+24*p+8*c*f+6*c-_/42*(61+662*f+1320*p+720*p*f))))/l)}else n=V*La(o),i=0;else{var x=Math.exp(s/this.k0),v=.5*(x-1/x),w=this.lat0+o/this.k0,S=Math.cos(w);t=Math.sqrt((1-Math.pow(S,2))/(1+Math.pow(v,2))),n=Math.asin(t),o<0&&(n=-n),v===0&&S===0?i=0:i=rt(Math.atan2(v,S)+this.long0)}return r.x=i,r.y=n,r}var TF=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const dl={init:bF,forward:SF,inverse:EF,names:TF};function _1(r){var t=Math.exp(r);return t=(t-1/t)/2,t}function Sr(r,t){r=Math.abs(r),t=Math.abs(t);var e=Math.max(r,t),n=Math.min(r,t)/(e||1);return e*Math.sqrt(1+Math.pow(n,2))}function MF(r){var t=1+r,e=t-1;return e===0?r:r*Math.log(t)/e}function RF(r){var t=Math.abs(r);return t=MF(t*(1+t/(Sr(1,t)+1))),r<0?-t:t}function If(r,t){for(var e=2*Math.cos(2*t),n=r.length-1,i=r[n],s=0,o;--n>=0;)o=-s+e*i+r[n],s=i,i=o;return t+o*Math.sin(2*t)}function CF(r,t){for(var e=2*Math.cos(t),n=r.length-1,i=r[n],s=0,o;--n>=0;)o=-s+e*i+r[n],s=i,i=o;return Math.sin(t)*o}function IF(r){var t=Math.exp(r);return t=(t+1/t)/2,t}function y1(r,t,e){for(var n=Math.sin(t),i=Math.cos(t),s=_1(e),o=IF(e),a=2*i*o,l=-2*n*s,h=r.length-1,c=r[h],u=0,f=0,p=0,m,_;--h>=0;)m=f,_=u,f=c,u=p,c=-m+a*f-l*u+r[h],p=-_+l*f+a*u;return a=n*o,l=i*s,[a*c-l*p,a*p+l*c]}function PF(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(dl.init.apply(this),this.forward=dl.forward,this.inverse=dl.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var r=this.es/(1+Math.sqrt(1-this.es)),t=r/(2-r),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var n=If(this.cbg,this.lat0);this.Zb=-this.Qn*(n+CF(this.gtu,2*n))}function AF(r){var t=rt(r.x-this.long0),e=r.y;e=If(this.cbg,e);var n=Math.sin(e),i=Math.cos(e),s=Math.sin(t),o=Math.cos(t);e=Math.atan2(n,o*i),t=Math.atan2(s*i,Sr(n,i*o)),t=RF(Math.tan(t));var a=y1(this.gtu,2*e,2*t);e=e+a[0],t=t+a[1];var l,h;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*e+this.Zb)+this.y0):(l=1/0,h=1/0),r.x=l,r.y=h,r}function LF(r){var t=(r.x-this.x0)*(1/this.a),e=(r.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var n,i;if(Math.abs(t)<=2.623395162778){var s=y1(this.utg,2*e,2*t);e=e+s[0],t=t+s[1],t=Math.atan(_1(t));var o=Math.sin(e),a=Math.cos(e),l=Math.sin(t),h=Math.cos(t);e=Math.atan2(o*h,Sr(l,h*a)),t=Math.atan2(l,h*a),n=rt(t+this.long0),i=If(this.cgb,e)}else n=1/0,i=1/0;return r.x=n,r.y=i,r}var OF=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const fl={init:PF,forward:AF,inverse:LF,names:OF};function FF(r,t){if(r===void 0){if(r=Math.floor((rt(t)+Math.PI)*30/Math.PI)+1,r<0)return 0;if(r>60)return 60}return r}var NF="etmerc";function DF(){var r=FF(this.zone,this.long0);if(r===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(r)-183)*Ie,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,fl.init.apply(this),this.forward=fl.forward,this.inverse=fl.inverse}var kF=["Universal Transverse Mercator System","utm"];const GF={init:DF,names:kF,dependsOn:NF};function Pf(r,t){return Math.pow((1-r)/(1+r),t)}var jF=20;function zF(){var r=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*r*r),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(r/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Zt)/(Math.pow(Math.tan(.5*this.lat0+Zt),this.C)*Pf(this.e*r,this.ratexp))}function UF(r){var t=r.x,e=r.y;return r.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Zt),this.C)*Pf(this.e*Math.sin(e),this.ratexp))-V,r.x=this.C*t,r}function BF(r){for(var t=1e-14,e=r.x/this.C,n=r.y,i=Math.pow(Math.tan(.5*n+Zt)/this.K,1/this.C),s=jF;s>0&&(n=2*Math.atan(i*Pf(this.e*Math.sin(r.y),-.5*this.e))-V,!(Math.abs(n-r.y)<t));--s)r.y=n;return s?(r.x=e,r.y=n,r):null}var XF=["gauss"];const Af={init:zF,forward:UF,inverse:BF,names:XF};function qF(){Af.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function WF(r){var t,e,n,i;return r.x=rt(r.x-this.long0),Af.forward.apply(this,[r]),t=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*n),r.x=i*e*Math.sin(r.x),r.y=i*(this.cosc0*t-this.sinc0*e*n),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function ZF(r){var t,e,n,i,s;if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,s=Sr(r.x,r.y)){var o=2*Math.atan2(s,this.R2);t=Math.sin(o),e=Math.cos(o),i=Math.asin(e*this.sinc0+r.y*t*this.cosc0/s),n=Math.atan2(r.x*t,s*this.cosc0*e-r.y*this.sinc0*t)}else i=this.phic0,n=0;return r.x=n,r.y=i,Af.inverse.apply(this,[r]),r.x=rt(r.x+this.long0),r}var $F=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const VF={init:qF,forward:WF,inverse:ZF,names:$F};function YF(r,t,e){return t*=e,Math.tan(.5*(V+r))*Math.pow((1-t)/(1+t),.5*e)}function HF(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=J&&(this.k0=.5*(1+La(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=J&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=J&&Math.abs(Math.cos(this.lat_ts))>J&&(this.k0=.5*this.cons*hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Gr(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=hn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-V,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function KF(r){var t=r.x,e=r.y,n=Math.sin(e),i=Math.cos(e),s,o,a,l,h,c,u=rt(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=J&&Math.abs(e+this.lat0)<=J?(r.x=NaN,r.y=NaN,r):this.sphere?(s=2*this.k0/(1+this.sinlat0*n+this.coslat0*i*Math.cos(u)),r.x=this.a*s*i*Math.sin(u)+this.x0,r.y=this.a*s*(this.coslat0*n-this.sinlat0*i*Math.cos(u))+this.y0,r):(o=2*Math.atan(this.ssfn_(e,n,this.e))-V,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=J?(h=Gr(this.e,e*this.con,this.con*n),c=2*this.a*this.k0*h/this.cons,r.x=this.x0+c*Math.sin(t-this.long0),r.y=this.y0-this.con*c*Math.cos(t-this.long0),r):(Math.abs(this.sinlat0)<J?(s=2*this.a*this.k0/(1+l*Math.cos(u)),r.y=s*a):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(u))),r.y=s*(this.cosX0*a-this.sinX0*l*Math.cos(u))+this.y0),r.x=s*l*Math.sin(u)+this.x0,r))}function QF(r){r.x-=this.x0,r.y-=this.y0;var t,e,n,i,s,o=Math.sqrt(r.x*r.x+r.y*r.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,e=this.lat0,o<=J?(r.x=t,r.y=e,r):(e=Math.asin(Math.cos(a)*this.sinlat0+r.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<J?this.lat0>0?t=rt(this.long0+Math.atan2(r.x,-1*r.y)):t=rt(this.long0+Math.atan2(r.x,r.y)):t=rt(this.long0+Math.atan2(r.x*Math.sin(a),o*this.coslat0*Math.cos(a)-r.y*this.sinlat0*Math.sin(a))),r.x=t,r.y=e,r)}else if(Math.abs(this.coslat0)<=J){if(o<=J)return e=this.lat0,t=this.long0,r.x=t,r.y=e,r;r.x*=this.con,r.y*=this.con,n=o*this.cons/(2*this.a*this.k0),e=this.con*la(this.e,n),t=this.con*rt(this.con*this.long0+Math.atan2(r.x,-1*r.y))}else i=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=J?s=this.X0:(s=Math.asin(Math.cos(i)*this.sinX0+r.y*Math.sin(i)*this.cosX0/o),t=rt(this.long0+Math.atan2(r.x*Math.sin(i),o*this.cosX0*Math.cos(i)-r.y*this.sinX0*Math.sin(i)))),e=-1*la(this.e,Math.tan(.5*(V+s)));return r.x=t,r.y=e,r}var JF=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const t3={init:HF,forward:KF,inverse:QF,names:JF,ssfn_:YF};function e3(){var r=this.lat0;this.lambda0=this.long0;var t=Math.sin(r),e=this.a,n=this.rf,i=1/n,s=2*i-Math.pow(i,2),o=this.e=Math.sqrt(s);this.R=this.k0*e*Math.sqrt(1-s)/(1-s*Math.pow(t,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(r),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+r/2)),h=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*l+this.alpha*o/2*h}function r3(r){var t=Math.log(Math.tan(Math.PI/4-r.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(r.y))/(1-this.e*Math.sin(r.y))),n=-this.alpha*(t+e)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),s=this.alpha*(r.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(s))),a=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(s));return r.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,r.x=this.R*o+this.x0,r}function n3(r){for(var t=r.x-this.x0,e=r.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),a=this.lambda0+o/this.alpha,l=0,h=s,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return r.x=a,r.y=h,r}var i3=["somerc"];const s3={init:e3,forward:r3,inverse:n3,names:i3};var us=1e-7;function o3(r){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof r.PROJECTION=="object"?Object.keys(r.PROJECTION)[0]:r.PROJECTION;return"no_uoff"in r||"no_off"in r||t.indexOf(e)!==-1}function a3(){var r,t,e,n,i,s,o,a,l,h,c=0,u,f=0,p=0,m=0,_=0,x=0,v=0;this.no_off=o3(this),this.no_rot="no_rot"in this;var w=!1;"alpha"in this&&(w=!0);var S=!1;if("rectified_grid_angle"in this&&(S=!0),w&&(v=this.alpha),S&&(c=this.rectified_grid_angle*Ie),w||S)f=this.longc;else if(p=this.long1,_=this.lat1,m=this.long2,x=this.lat2,Math.abs(_-x)<=us||(r=Math.abs(_))<=us||Math.abs(r-V)<=us||Math.abs(Math.abs(this.lat0)-V)<=us||Math.abs(Math.abs(x)-V)<=us)throw new Error;var E=1-this.es;t=Math.sqrt(E),Math.abs(this.lat0)>J?(a=Math.sin(this.lat0),e=Math.cos(this.lat0),r=1-this.es*a*a,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/E),this.A=this.B*this.k0*t/r,n=this.B*t/(e*Math.sqrt(r)),i=n*n-1,i<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(Gr(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=i=1),w||S?(w?(u=Math.asin(Math.sin(v)/n),S||(c=v)):(u=c,v=Math.asin(n*Math.sin(u))),this.lam0=f-Math.asin(.5*(i-1/i)*Math.tan(u))/this.B):(s=Math.pow(Gr(this.e,_,Math.sin(_)),this.B),o=Math.pow(Gr(this.e,x,Math.sin(x)),this.B),i=this.E/s,l=(o-s)/(o+s),h=this.E*this.E,h=(h-o*s)/(h+o*s),r=p-m,r<-Math.pi?m-=oa:r>Math.pi&&(m+=oa),this.lam0=rt(.5*(p+m)-Math.atan(h*Math.tan(.5*this.B*(p-m))/l)/this.B),u=Math.atan(2*Math.sin(this.B*rt(p-this.lam0))/(i-1/i)),c=v=Math.asin(n*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Zt-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(Zt+i))}function l3(r){var t={},e,n,i,s,o,a,l,h;if(r.x=r.x-this.lam0,Math.abs(Math.abs(r.y)-V)>J){if(o=this.E/Math.pow(Gr(this.e,r.y,Math.sin(r.y)),this.B),a=1/o,e=.5*(o-a),n=.5*(o+a),s=Math.sin(this.B*r.x),i=(e*this.singam-s*this.cosgam)/n,Math.abs(Math.abs(i)-1)<J)throw new Error;h=.5*this.ArB*Math.log((1-i)/(1+i)),a=Math.cos(this.B*r.x),Math.abs(a)<us?l=this.A*r.x:l=this.ArB*Math.atan2(e*this.cosgam+s*this.singam,a)}else h=r.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*r.y;return this.no_rot?(t.x=l,t.y=h):(l-=this.u_0,t.x=h*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function h3(r){var t,e,n,i,s,o,a,l={};if(r.x=(r.x-this.x0)*(1/this.a),r.y=(r.y-this.y0)*(1/this.a),this.no_rot?(e=r.y,t=r.x):(e=r.x*this.cosrot-r.y*this.sinrot,t=r.y*this.cosrot+r.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*e),i=.5*(n-1/n),s=.5*(n+1/n),o=Math.sin(this.BrA*t),a=(o*this.cosgam+i*this.singam)/s,Math.abs(Math.abs(a)-1)<J)l.x=0,l.y=a<0?-V:V;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=la(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(i*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var c3=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const u3={init:a3,forward:l3,inverse:h3,names:c3};function d3(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<J)){var r=this.b/this.a;this.e=Math.sqrt(1-r*r);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),n=hn(this.e,t,e),i=Gr(this.e,this.lat1,t),s=Math.sin(this.lat2),o=Math.cos(this.lat2),a=hn(this.e,s,o),l=Gr(this.e,this.lat2,s),h=Gr(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>J?this.ns=Math.log(n/a)/Math.log(i/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function f3(r){var t=r.x,e=r.y;Math.abs(2*Math.abs(e)-Math.PI)<=J&&(e=La(e)*(V-2*J));var n=Math.abs(Math.abs(e)-V),i,s;if(n>J)i=Gr(this.e,e,Math.sin(e)),s=this.a*this.f0*Math.pow(i,this.ns);else{if(n=e*this.ns,n<=0)return null;s=0}var o=this.ns*rt(t-this.long0);return r.x=this.k0*(s*Math.sin(o))+this.x0,r.y=this.k0*(this.rh-s*Math.cos(o))+this.y0,r}function g3(r){var t,e,n,i,s,o=(r.x-this.x0)/this.k0,a=this.rh-(r.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+a*a),e=1):(t=-Math.sqrt(o*o+a*a),e=-1);var l=0;if(t!==0&&(l=Math.atan2(e*o,e*a)),t!==0||this.ns>0){if(e=1/this.ns,n=Math.pow(t/(this.a*this.f0),e),i=la(this.e,n),i===-9999)return null}else i=-V;return s=rt(l/this.ns+this.long0),r.x=s,r.y=i,r}var p3=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const m3={init:d3,forward:f3,inverse:g3,names:p3};function _3(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function y3(r){var t,e,n,i,s,o,a,l=r.x,h=r.y,c=rt(l-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),n=-c*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(n)),s=Math.asin(Math.cos(e)*Math.sin(n)/Math.cos(i)),o=this.n*s,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),r.y=a*Math.cos(o)/1,r.x=a*Math.sin(o)/1,this.czech||(r.y*=-1,r.x*=-1),r}function x3(r){var t,e,n,i,s,o,a,l,h=r.x;r.x=r.y,r.y=h,this.czech||(r.y*=-1,r.x*=-1),o=Math.sqrt(r.x*r.x+r.y*r.y),s=Math.atan2(r.y,r.x),i=s/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),e=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t)),r.x=this.long0-e/this.alfa,a=t,l=0;var c=0;do r.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-r.y)<1e-10&&(l=1),a=r.y,c+=1;while(l===0&&c<15);return c>=15?null:r}var v3=["Krovak","krovak"];const w3={init:_3,forward:y3,inverse:x3,names:v3};function Ze(r,t,e,n,i){return r*i-t*Math.sin(2*i)+e*Math.sin(4*i)-n*Math.sin(6*i)}function Oa(r){return 1-.25*r*(1+r/16*(3+1.25*r))}function Fa(r){return .375*r*(1+.25*r*(1+.46875*r))}function Na(r){return .05859375*r*r*(1+.75*r)}function Da(r){return r*r*r*(35/3072)}function Bs(r,t,e){var n=t*e;return r/Math.sqrt(1-n*n)}function no(r){return Math.abs(r)<V?r:r-La(r)*Math.PI}function Yl(r,t,e,n,i){var s,o;s=r/t;for(var a=0;a<15;a++)if(o=(r-(t*s-e*Math.sin(2*s)+n*Math.sin(4*s)-i*Math.sin(6*s)))/(t-2*e*Math.cos(2*s)+4*n*Math.cos(4*s)-6*i*Math.cos(6*s)),s+=o,Math.abs(o)<=1e-10)return s;return NaN}function b3(){this.sphere||(this.e0=Oa(this.es),this.e1=Fa(this.es),this.e2=Na(this.es),this.e3=Da(this.es),this.ml0=this.a*Ze(this.e0,this.e1,this.e2,this.e3,this.lat0))}function S3(r){var t,e,n=r.x,i=r.y;if(n=rt(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(n)),e=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var s=Math.sin(i),o=Math.cos(i),a=Bs(this.a,this.e,s),l=Math.tan(i)*Math.tan(i),h=n*Math.cos(i),c=h*h,u=this.es*o*o/(1-this.es),f=this.a*Ze(this.e0,this.e1,this.e2,this.e3,i);t=a*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),e=f-this.ml0+a*s/o*c*(.5+(5-l+6*u)*c/24)}return r.x=t+this.x0,r.y=e+this.y0,r}function E3(r){r.x-=this.x0,r.y-=this.y0;var t=r.x/this.a,e=r.y/this.a,n,i;if(this.sphere){var s=e+this.lat0;n=Math.asin(Math.sin(s)*Math.cos(t)),i=Math.atan2(Math.tan(t),Math.cos(s))}else{var o=this.ml0/this.a+e,a=Yl(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-V)<=J)return r.x=this.long0,r.y=V,e<0&&(r.y*=-1),r;var l=Bs(this.a,this.e,Math.sin(a)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(a),2),u=t*this.a/l,f=u*u;n=a-l*Math.tan(a)/h*u*u*(.5-(1+3*c)*u*u/24),i=u*(1-f*(c/3+(1+3*c)*c*f/15))/Math.cos(a)}return r.x=rt(i+this.long0),r.y=no(n),r}var T3=["Cassini","Cassini_Soldner","cass"];const M3={init:b3,forward:S3,inverse:E3,names:T3};function oi(r,t){var e;return r>1e-7?(e=r*t,(1-r*r)*(t/(1-e*e)-.5/r*Math.log((1-e)/(1+e)))):2*t}var R3=1,C3=2,I3=3,P3=4;function A3(){var r=Math.abs(this.lat0);if(Math.abs(r-V)<J?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(r)<J?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=oi(this.e,1),this.mmf=.5/(1-this.es),this.apa=z3(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=oi(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function L3(r){var t,e,n,i,s,o,a,l,h,c,u=r.x,f=r.y;if(u=rt(u-this.long0),this.sphere){if(s=Math.sin(f),c=Math.cos(f),n=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+c*n:1+this.sinph0*s+this.cosph0*c*n,e<=J)return null;e=Math.sqrt(2/e),t=e*c*Math.sin(u),e*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(f+this.lat0)<J)return null;e=Zt-f*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(u),e*=n}}else{switch(a=0,l=0,h=0,n=Math.cos(u),i=Math.sin(u),s=Math.sin(f),o=oi(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:h=1+this.sinb1*a+this.cosb1*l*n;break;case this.EQUIT:h=1+l*n;break;case this.N_POLE:h=V+f,o=this.qp-o;break;case this.S_POLE:h=f-V,o=this.qp+o;break}if(Math.abs(h)<J)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?e=this.ymf*h*(this.cosb1*a-this.sinb1*l*n):e=(h=Math.sqrt(2/(1+l*n)))*a*this.ymf,t=this.xmf*h*l*i;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(h=Math.sqrt(o))*i,e=n*(this.mode===this.S_POLE?h:-h)):t=e=0;break}}return r.x=this.a*t+this.x0,r.y=this.a*e+this.y0,r}function O3(r){r.x-=this.x0,r.y-=this.y0;var t=r.x/this.a,e=r.y/this.a,n,i,s,o,a,l,h;if(this.sphere){var c=0,u,f=0;if(u=Math.sqrt(t*t+e*e),i=u*.5,i>1)return null;switch(i=2*Math.asin(i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(i),c=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(u)<=J?0:Math.asin(e*f/u),t*=f,e=c*u;break;case this.OBLIQ:i=Math.abs(u)<=J?this.lat0:Math.asin(c*this.sinph0+e*f*this.cosph0/u),t*=f*this.cosph0,e=(c-Math.sin(i)*this.sinph0)*u;break;case this.N_POLE:e=-e,i=V-i;break;case this.S_POLE:i-=V;break}n=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,l=Math.sqrt(t*t+e*e),l<J)return r.x=this.long0,r.y=this.lat0,r;o=2*Math.asin(.5*l/this.rq),s=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(h=s*this.sinb1+e*o*this.cosb1/l,a=this.qp*h,e=l*this.cosb1*s-e*this.sinb1*o):(h=e*o/l,a=this.qp*h,e=l*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),a=t*t+e*e,!a)return r.x=this.long0,r.y=this.lat0,r;h=1-a/this.qp,this.mode===this.S_POLE&&(h=-h)}n=Math.atan2(t,e),i=U3(Math.asin(h),this.apa)}return r.x=rt(this.long0+n),r.y=i,r}var F3=.3333333333333333,N3=.17222222222222222,D3=.10257936507936508,k3=.06388888888888888,G3=.0664021164021164,j3=.016415012942191543;function z3(r){var t,e=[];return e[0]=r*F3,t=r*r,e[0]+=t*N3,e[1]=t*k3,t*=r,e[0]+=t*D3,e[1]+=t*G3,e[2]=t*j3,e}function U3(r,t){var e=r+r;return r+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var B3=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const X3={init:A3,forward:L3,inverse:O3,names:B3,S_POLE:R3,N_POLE:C3,EQUIT:I3,OBLIQ:P3};function ui(r){return Math.abs(r)>1&&(r=r>1?1:-1),Math.asin(r)}function q3(){Math.abs(this.lat1+this.lat2)<J||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=hn(this.e3,this.sin_po,this.cos_po),this.qs1=oi(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=hn(this.e3,this.sin_po,this.cos_po),this.qs2=oi(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=oi(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>J?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function W3(r){var t=r.x,e=r.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var n=oi(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,s=this.ns0*rt(t-this.long0),o=i*Math.sin(s)+this.x0,a=this.rh-i*Math.cos(s)+this.y0;return r.x=o,r.y=a,r}function Z3(r){var t,e,n,i,s,o;return r.x-=this.x0,r.y=this.rh-r.y+this.y0,this.ns0>=0?(t=Math.sqrt(r.x*r.x+r.y*r.y),n=1):(t=-Math.sqrt(r.x*r.x+r.y*r.y),n=-1),i=0,t!==0&&(i=Math.atan2(n*r.x,n*r.y)),n=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(e=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,e)),s=rt(i/this.ns0+this.long0),r.x=s,r.y=o,r}function $3(r,t){var e,n,i,s,o,a=ui(.5*t);if(r<J)return a;for(var l=r*r,h=1;h<=25;h++)if(e=Math.sin(a),n=Math.cos(a),i=r*e,s=1-i*i,o=.5*s*s/n*(t/(1-l)-e/s+.5/r*Math.log((1-i)/(1+i))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var V3=["Albers_Conic_Equal_Area","Albers","aea"];const Y3={init:q3,forward:W3,inverse:Z3,names:V3,phi1z:$3};function H3(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function K3(r){var t,e,n,i,s,o,a,l,h=r.x,c=r.y;return n=rt(h-this.long0),t=Math.sin(c),e=Math.cos(c),i=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*i,s=1,o>0||Math.abs(o)<=J?(a=this.x0+this.a*s*e*Math.sin(n)/o,l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*i)/o):(a=this.x0+this.infinity_dist*e*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*i)),r.x=a,r.y=l,r}function Q3(r){var t,e,n,i,s,o;return r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,(t=Math.sqrt(r.x*r.x+r.y*r.y))?(i=Math.atan2(t,this.rc),e=Math.sin(i),n=Math.cos(i),o=ui(n*this.sin_p14+r.y*e*this.cos_p14/t),s=Math.atan2(r.x*e,t*this.cos_p14*n-r.y*this.sin_p14*e),s=rt(this.long0+s)):(o=this.phic0,s=0),r.x=s,r.y=o,r}var J3=["gnom"];const tN={init:H3,forward:K3,inverse:Q3,names:J3};function eN(r,t){var e=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*V:V;for(var n=Math.asin(.5*t),i,s,o,a,l=0;l<30;l++)if(s=Math.sin(n),o=Math.cos(n),a=r*s,i=Math.pow(1-a*a,2)/(2*o)*(t/(1-r*r)-s/(1-a*a)+.5/r*Math.log((1-a)/(1+a))),n+=i,Math.abs(i)<=1e-10)return n;return NaN}function rN(){this.sphere||(this.k0=hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function nN(r){var t=r.x,e=r.y,n,i,s=rt(t-this.long0);if(this.sphere)n=this.x0+this.a*s*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var o=oi(this.e,Math.sin(e));n=this.x0+this.a*this.k0*s,i=this.y0+this.a*o*.5/this.k0}return r.x=n,r.y=i,r}function iN(r){r.x-=this.x0,r.y-=this.y0;var t,e;return this.sphere?(t=rt(this.long0+r.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(r.y/this.a*Math.cos(this.lat_ts))):(e=eN(this.e,2*r.y*this.k0/this.a),t=rt(this.long0+r.x/(this.a*this.k0))),r.x=t,r.y=e,r}var sN=["cea"];const oN={init:rN,forward:nN,inverse:iN,names:sN};function aN(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function lN(r){var t=r.x,e=r.y,n=rt(t-this.long0),i=no(e-this.lat0);return r.x=this.x0+this.a*n*this.rc,r.y=this.y0+this.a*i,r}function hN(r){var t=r.x,e=r.y;return r.x=rt(this.long0+(t-this.x0)/(this.a*this.rc)),r.y=no(this.lat0+(e-this.y0)/this.a),r}var cN=["Equirectangular","Equidistant_Cylindrical","eqc"];const uN={init:aN,forward:lN,inverse:hN,names:cN};var gm=20;function dN(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Oa(this.es),this.e1=Fa(this.es),this.e2=Na(this.es),this.e3=Da(this.es),this.ml0=this.a*Ze(this.e0,this.e1,this.e2,this.e3,this.lat0)}function fN(r){var t=r.x,e=r.y,n,i,s,o=rt(t-this.long0);if(s=o*Math.sin(e),this.sphere)Math.abs(e)<=J?(n=this.a*o,i=-1*this.a*this.lat0):(n=this.a*Math.sin(s)/Math.tan(e),i=this.a*(no(e-this.lat0)+(1-Math.cos(s))/Math.tan(e)));else if(Math.abs(e)<=J)n=this.a*o,i=-1*this.ml0;else{var a=Bs(this.a,this.e,Math.sin(e))/Math.tan(e);n=a*Math.sin(s),i=this.a*Ze(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+a*(1-Math.cos(s))}return r.x=n+this.x0,r.y=i+this.y0,r}function gN(r){var t,e,n,i,s,o,a,l,h;if(n=r.x-this.x0,i=r.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=J)t=rt(n/this.a+this.long0),e=0;else{o=this.lat0+i/this.a,a=n*n/this.a/this.a+o*o,l=o;var c;for(s=gm;s;--s)if(c=Math.tan(l),h=-1*(o*(l*c+1)-l-.5*(l*l+a)*c)/((l-o)/c-1),l+=h,Math.abs(h)<=J){e=l;break}t=rt(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(e))}else if(Math.abs(i+this.ml0)<=J)e=0,t=rt(this.long0+n/this.a);else{o=(this.ml0+i)/this.a,a=n*n/this.a/this.a+o*o,l=o;var u,f,p,m,_;for(s=gm;s;--s)if(_=this.e*Math.sin(l),u=Math.sqrt(1-_*_)*Math.tan(l),f=this.a*Ze(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),m=f/this.a,h=(o*(u*m+1)-m-.5*u*(m*m+a))/(this.es*Math.sin(2*l)*(m*m+a-2*o*m)/(4*u)+(o-m)*(u*p-2/Math.sin(2*l))-p),l-=h,Math.abs(h)<=J){e=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=rt(this.long0+Math.asin(n*u/this.a)/Math.sin(e))}return r.x=t,r.y=e,r}var pN=["Polyconic","poly"];const mN={init:dN,forward:fN,inverse:gN,names:pN};function _N(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function yN(r){var t,e=r.x,n=r.y,i=n-this.lat0,s=e-this.long0,o=i/No*1e-5,a=s,l=1,h=0;for(t=1;t<=10;t++)l=l*o,h=h+this.A[t]*l;var c=h,u=a,f=1,p=0,m,_,x=0,v=0;for(t=1;t<=6;t++)m=f*c-p*u,_=p*c+f*u,f=m,p=_,x=x+this.B_re[t]*f-this.B_im[t]*p,v=v+this.B_im[t]*f+this.B_re[t]*p;return r.x=v*this.a+this.x0,r.y=x*this.a+this.y0,r}function xN(r){var t,e=r.x,n=r.y,i=e-this.x0,s=n-this.y0,o=s/this.a,a=i/this.a,l=1,h=0,c,u,f=0,p=0;for(t=1;t<=6;t++)c=l*o-h*a,u=h*o+l*a,l=c,h=u,f=f+this.C_re[t]*l-this.C_im[t]*h,p=p+this.C_im[t]*l+this.C_re[t]*h;for(var m=0;m<this.iterations;m++){var _=f,x=p,v,w,S=o,E=a;for(t=2;t<=6;t++)v=_*f-x*p,w=x*f+_*p,_=v,x=w,S=S+(t-1)*(this.B_re[t]*_-this.B_im[t]*x),E=E+(t-1)*(this.B_im[t]*_+this.B_re[t]*x);_=1,x=0;var T=this.B_re[1],R=this.B_im[1];for(t=2;t<=6;t++)v=_*f-x*p,w=x*f+_*p,_=v,x=w,T=T+t*(this.B_re[t]*_-this.B_im[t]*x),R=R+t*(this.B_im[t]*_+this.B_re[t]*x);var C=T*T+R*R;f=(S*T+E*R)/C,p=(E*T-S*R)/C}var I=f,F=p,U=1,j=0;for(t=1;t<=9;t++)U=U*I,j=j+this.D[t]*U;var B=this.lat0+j*No*1e5,d=this.long0+F;return r.x=d,r.y=B,r}var vN=["New_Zealand_Map_Grid","nzmg"];const wN={init:_N,forward:yN,inverse:xN,names:vN};function bN(){}function SN(r){var t=r.x,e=r.y,n=rt(t-this.long0),i=this.x0+this.a*n,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return r.x=i,r.y=s,r}function EN(r){r.x-=this.x0,r.y-=this.y0;var t=rt(this.long0+r.x/this.a),e=2.5*(Math.atan(Math.exp(.8*r.y/this.a))-Math.PI/4);return r.x=t,r.y=e,r}var TN=["Miller_Cylindrical","mill"];const MN={init:bN,forward:SN,inverse:EN,names:TN};var RN=20;function CN(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=p1(this.es)}function IN(r){var t,e,n=r.x,i=r.y;if(n=rt(n-this.long0),this.sphere){if(!this.m)i=this.n!==1?Math.asin(this.n*Math.sin(i)):i;else for(var s=this.n*Math.sin(i),o=RN;o;--o){var a=(this.m*i+Math.sin(i)-s)/(this.m+Math.cos(i));if(i-=a,Math.abs(a)<J)break}t=this.a*this.C_x*n*(this.m+Math.cos(i)),e=this.a*this.C_y*i}else{var l=Math.sin(i),h=Math.cos(i);e=this.a*zh(i,l,h,this.en),t=this.a*n*h/Math.sqrt(1-this.es*l*l)}return r.x=t,r.y=e,r}function PN(r){var t,e,n,i;return r.x-=this.x0,n=r.x/this.a,r.y-=this.y0,t=r.y/this.a,this.sphere?(t/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(t))),this.m?t=ui((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=ui(Math.sin(t)/this.n)),n=rt(n+this.long0),t=no(t)):(t=m1(r.y/this.a,this.es,this.en),i=Math.abs(t),i<V?(i=Math.sin(t),e=this.long0+r.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)),n=rt(e)):i-J<V&&(n=this.long0)),r.x=n,r.y=t,r}var AN=["Sinusoidal","sinu"];const LN={init:CN,forward:IN,inverse:PN,names:AN};function ON(){}function FN(r){for(var t=r.x,e=r.y,n=rt(t-this.long0),i=e,s=Math.PI*Math.sin(e);;){var o=-(i+Math.sin(i)-s)/(1+Math.cos(i));if(i+=o,Math.abs(o)<J)break}i/=2,Math.PI/2-Math.abs(e)<J&&(n=0);var a=.900316316158*this.a*n*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return r.x=a,r.y=l,r}function NN(r){var t,e;r.x-=this.x0,r.y-=this.y0,e=r.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var n=rt(this.long0+r.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var i=Math.asin(e);return r.x=n,r.y=i,r}var DN=["Mollweide","moll"];const kN={init:ON,forward:FN,inverse:NN,names:DN};function GN(){Math.abs(this.lat1+this.lat2)<J||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Oa(this.es),this.e1=Fa(this.es),this.e2=Na(this.es),this.e3=Da(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=hn(this.e,this.sinphi,this.cosphi),this.ml1=Ze(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<J?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=hn(this.e,this.sinphi,this.cosphi),this.ml2=Ze(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ze(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function jN(r){var t=r.x,e=r.y,n;if(this.sphere)n=this.a*(this.g-e);else{var i=Ze(this.e0,this.e1,this.e2,this.e3,e);n=this.a*(this.g-i)}var s=this.ns*rt(t-this.long0),o=this.x0+n*Math.sin(s),a=this.y0+this.rh-n*Math.cos(s);return r.x=o,r.y=a,r}function zN(r){r.x-=this.x0,r.y=this.rh-r.y+this.y0;var t,e,n,i;this.ns>=0?(e=Math.sqrt(r.x*r.x+r.y*r.y),t=1):(e=-Math.sqrt(r.x*r.x+r.y*r.y),t=-1);var s=0;if(e!==0&&(s=Math.atan2(t*r.x,t*r.y)),this.sphere)return i=rt(this.long0+s/this.ns),n=no(this.g-e/this.a),r.x=i,r.y=n,r;var o=this.g-e/this.a;return n=Yl(o,this.e0,this.e1,this.e2,this.e3),i=rt(this.long0+s/this.ns),r.x=i,r.y=n,r}var UN=["Equidistant_Conic","eqdc"];const BN={init:GN,forward:jN,inverse:zN,names:UN};function XN(){this.R=this.a}function qN(r){var t=r.x,e=r.y,n=rt(t-this.long0),i,s;Math.abs(e)<=J&&(i=this.x0+this.R*n,s=this.y0);var o=ui(2*Math.abs(e/Math.PI));(Math.abs(n)<=J||Math.abs(Math.abs(e)-V)<=J)&&(i=this.x0,e>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*o):s=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/n-n/Math.PI),l=a*a,h=Math.sin(o),c=Math.cos(o),u=c/(h+c-1),f=u*u,p=u*(2/h-1),m=p*p,_=Math.PI*this.R*(a*(u-m)+Math.sqrt(l*(u-m)*(u-m)-(m+l)*(f-m)))/(m+l);n<0&&(_=-_),i=this.x0+_;var x=l+u;return _=Math.PI*this.R*(p*x-a*Math.sqrt((m+l)*(l+1)-x*x))/(m+l),e>=0?s=this.y0+_:s=this.y0-_,r.x=i,r.y=s,r}function WN(r){var t,e,n,i,s,o,a,l,h,c,u,f,p;return r.x-=this.x0,r.y-=this.y0,u=Math.PI*this.R,n=r.x/u,i=r.y/u,s=n*n+i*i,o=-Math.abs(i)*(1+s),a=o-2*i*i+n*n,l=-2*o+1+2*i*i+s*s,p=i*i/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,h=(o-a*a/3/l)/l,c=2*Math.sqrt(-h/3),u=3*p/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),f=Math.acos(u)/3,r.y>=0?e=(-c*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI:e=-(-c*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI,Math.abs(n)<J?t=this.long0:t=rt(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(n*n-i*i)+s*s))/2/n),r.x=t,r.y=e,r}var ZN=["Van_der_Grinten_I","VanDerGrinten","vandg"];const $N={init:XN,forward:qN,inverse:WN,names:ZN};function VN(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function YN(r){var t=r.x,e=r.y,n=Math.sin(r.y),i=Math.cos(r.y),s=rt(t-this.long0),o,a,l,h,c,u,f,p,m,_,x,v,w,S,E,T,R,C,I,F,U,j,B;return this.sphere?Math.abs(this.sin_p12-1)<=J?(r.x=this.x0+this.a*(V-e)*Math.sin(s),r.y=this.y0-this.a*(V-e)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=J?(r.x=this.x0+this.a*(V+e)*Math.sin(s),r.y=this.y0+this.a*(V+e)*Math.cos(s),r):(C=this.sin_p12*n+this.cos_p12*i*Math.cos(s),T=Math.acos(C),R=T?T/Math.sin(T):1,r.x=this.x0+this.a*R*i*Math.sin(s),r.y=this.y0+this.a*R*(this.cos_p12*n-this.sin_p12*i*Math.cos(s)),r):(o=Oa(this.es),a=Fa(this.es),l=Na(this.es),h=Da(this.es),Math.abs(this.sin_p12-1)<=J?(c=this.a*Ze(o,a,l,h,V),u=this.a*Ze(o,a,l,h,e),r.x=this.x0+(c-u)*Math.sin(s),r.y=this.y0-(c-u)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=J?(c=this.a*Ze(o,a,l,h,V),u=this.a*Ze(o,a,l,h,e),r.x=this.x0+(c+u)*Math.sin(s),r.y=this.y0+(c+u)*Math.cos(s),r):(f=n/i,p=Bs(this.a,this.e,this.sin_p12),m=Bs(this.a,this.e,n),_=Math.atan((1-this.es)*f+this.es*p*this.sin_p12/(m*i)),x=Math.atan2(Math.sin(s),this.cos_p12*Math.tan(_)-this.sin_p12*Math.cos(s)),x===0?I=Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.abs(Math.abs(x)-Math.PI)<=J?I=-Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):I=Math.asin(Math.sin(s)*Math.cos(_)/Math.sin(x)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),w=this.e*this.cos_p12*Math.cos(x)/Math.sqrt(1-this.es),S=v*w,E=w*w,F=I*I,U=F*I,j=U*I,B=j*I,T=p*I*(1-F*E*(1-E)/6+U/8*S*(1-2*E)+j/120*(E*(4-7*E)-3*v*v*(1-7*E))-B/48*S),r.x=this.x0+T*Math.sin(x),r.y=this.y0+T*Math.cos(x),r))}function HN(r){r.x-=this.x0,r.y-=this.y0;var t,e,n,i,s,o,a,l,h,c,u,f,p,m,_,x,v,w,S,E,T,R,C,I;return this.sphere?(t=Math.sqrt(r.x*r.x+r.y*r.y),t>2*V*this.a?void 0:(e=t/this.a,n=Math.sin(e),i=Math.cos(e),s=this.long0,Math.abs(t)<=J?o=this.lat0:(o=ui(i*this.sin_p12+r.y*n*this.cos_p12/t),a=Math.abs(this.lat0)-V,Math.abs(a)<=J?this.lat0>=0?s=rt(this.long0+Math.atan2(r.x,-r.y)):s=rt(this.long0-Math.atan2(-r.x,r.y)):s=rt(this.long0+Math.atan2(r.x*n,t*this.cos_p12*i-r.y*this.sin_p12*n))),r.x=s,r.y=o,r)):(l=Oa(this.es),h=Fa(this.es),c=Na(this.es),u=Da(this.es),Math.abs(this.sin_p12-1)<=J?(f=this.a*Ze(l,h,c,u,V),t=Math.sqrt(r.x*r.x+r.y*r.y),p=f-t,o=Yl(p/this.a,l,h,c,u),s=rt(this.long0+Math.atan2(r.x,-1*r.y)),r.x=s,r.y=o,r):Math.abs(this.sin_p12+1)<=J?(f=this.a*Ze(l,h,c,u,V),t=Math.sqrt(r.x*r.x+r.y*r.y),p=t-f,o=Yl(p/this.a,l,h,c,u),s=rt(this.long0+Math.atan2(r.x,r.y)),r.x=s,r.y=o,r):(t=Math.sqrt(r.x*r.x+r.y*r.y),x=Math.atan2(r.x,r.y),m=Bs(this.a,this.e,this.sin_p12),v=Math.cos(x),w=this.e*this.cos_p12*v,S=-w*w/(1-this.es),E=3*this.es*(1-S)*this.sin_p12*this.cos_p12*v/(1-this.es),T=t/m,R=T-S*(1+S)*Math.pow(T,3)/6-E*(1+3*S)*Math.pow(T,4)/24,C=1-S*R*R/2-T*R*R*R/6,_=Math.asin(this.sin_p12*Math.cos(R)+this.cos_p12*Math.sin(R)*v),s=rt(this.long0+Math.asin(Math.sin(x)*Math.sin(R)/Math.cos(_))),I=Math.sin(_),o=Math.atan2((I-this.es*C*this.sin_p12)*Math.tan(_),I*(1-this.es)),r.x=s,r.y=o,r))}var KN=["Azimuthal_Equidistant","aeqd"];const QN={init:VN,forward:YN,inverse:HN,names:KN};function JN(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function tD(r){var t,e,n,i,s,o,a,l,h=r.x,c=r.y;return n=rt(h-this.long0),t=Math.sin(c),e=Math.cos(c),i=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*i,s=1,(o>0||Math.abs(o)<=J)&&(a=this.a*s*e*Math.sin(n),l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*i)),r.x=a,r.y=l,r}function eD(r){var t,e,n,i,s,o,a;return r.x-=this.x0,r.y-=this.y0,t=Math.sqrt(r.x*r.x+r.y*r.y),e=ui(t/this.a),n=Math.sin(e),i=Math.cos(e),o=this.long0,Math.abs(t)<=J?(a=this.lat0,r.x=o,r.y=a,r):(a=ui(i*this.sin_p14+r.y*n*this.cos_p14/t),s=Math.abs(this.lat0)-V,Math.abs(s)<=J?(this.lat0>=0?o=rt(this.long0+Math.atan2(r.x,-r.y)):o=rt(this.long0-Math.atan2(-r.x,r.y)),r.x=o,r.y=a,r):(o=rt(this.long0+Math.atan2(r.x*n,t*this.cos_p14*i-r.y*this.sin_p14*n)),r.x=o,r.y=a,r))}var rD=["ortho"];const nD={init:JN,forward:tD,inverse:eD,names:rD};var oe={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},$t={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function iD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=V-Zt/2?this.face=oe.TOP:this.lat0<=-(V-Zt/2)?this.face=oe.BOTTOM:Math.abs(this.long0)<=Zt?this.face=oe.FRONT:Math.abs(this.long0)<=V+Zt?this.face=this.long0>0?oe.RIGHT:oe.LEFT:this.face=oe.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function sD(r){var t={x:0,y:0},e,n,i,s,o,a,l={value:0};if(r.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(r.y)):e=r.y,n=r.x,this.face===oe.TOP)s=V-e,n>=Zt&&n<=V+Zt?(l.value=$t.AREA_0,i=n-V):n>V+Zt||n<=-(V+Zt)?(l.value=$t.AREA_1,i=n>0?n-ge:n+ge):n>-(V+Zt)&&n<=-Zt?(l.value=$t.AREA_2,i=n+V):(l.value=$t.AREA_3,i=n);else if(this.face===oe.BOTTOM)s=V+e,n>=Zt&&n<=V+Zt?(l.value=$t.AREA_0,i=-n+V):n<Zt&&n>=-Zt?(l.value=$t.AREA_1,i=-n):n<-Zt&&n>=-(V+Zt)?(l.value=$t.AREA_2,i=-n-V):(l.value=$t.AREA_3,i=n>0?-n+ge:-n-ge);else{var h,c,u,f,p,m,_;this.face===oe.RIGHT?n=Cs(n,+V):this.face===oe.BACK?n=Cs(n,+ge):this.face===oe.LEFT&&(n=Cs(n,-V)),f=Math.sin(e),p=Math.cos(e),m=Math.sin(n),_=Math.cos(n),h=p*_,c=p*m,u=f,this.face===oe.FRONT?(s=Math.acos(h),i=il(s,u,c,l)):this.face===oe.RIGHT?(s=Math.acos(c),i=il(s,u,-h,l)):this.face===oe.BACK?(s=Math.acos(-h),i=il(s,u,-c,l)):this.face===oe.LEFT?(s=Math.acos(-c),i=il(s,u,h,l)):(s=i=0,l.value=$t.AREA_0)}return a=Math.atan(12/ge*(i+Math.acos(Math.sin(i)*Math.cos(Zt))-V)),o=Math.sqrt((1-Math.cos(s))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(i))))),l.value===$t.AREA_1?a+=V:l.value===$t.AREA_2?a+=ge:l.value===$t.AREA_3&&(a+=1.5*ge),t.x=o*Math.cos(a),t.y=o*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,r.x=t.x,r.y=t.y,r}function oD(r){var t={lam:0,phi:0},e,n,i,s,o,a,l,h,c,u={value:0};if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,n=Math.atan(Math.sqrt(r.x*r.x+r.y*r.y)),e=Math.atan2(r.y,r.x),r.x>=0&&r.x>=Math.abs(r.y)?u.value=$t.AREA_0:r.y>=0&&r.y>=Math.abs(r.x)?(u.value=$t.AREA_1,e-=V):r.x<0&&-r.x>=Math.abs(r.y)?(u.value=$t.AREA_2,e=e<0?e+ge:e-ge):(u.value=$t.AREA_3,e+=V),c=ge/12*Math.tan(e),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),a=Math.atan(o),i=Math.cos(e),s=Math.tan(n),l=1-i*i*s*s*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===oe.TOP)h=Math.acos(l),t.phi=V-h,u.value===$t.AREA_0?t.lam=a+V:u.value===$t.AREA_1?t.lam=a<0?a+ge:a-ge:u.value===$t.AREA_2?t.lam=a-V:t.lam=a;else if(this.face===oe.BOTTOM)h=Math.acos(l),t.phi=h-V,u.value===$t.AREA_0?t.lam=-a+V:u.value===$t.AREA_1?t.lam=-a:u.value===$t.AREA_2?t.lam=-a-V:t.lam=a<0?-a-ge:-a+ge;else{var f,p,m;f=l,c=f*f,c>=1?m=0:m=Math.sqrt(1-c)*Math.sin(a),c+=m*m,c>=1?p=0:p=Math.sqrt(1-c),u.value===$t.AREA_1?(c=p,p=-m,m=c):u.value===$t.AREA_2?(p=-p,m=-m):u.value===$t.AREA_3&&(c=p,p=m,m=-c),this.face===oe.RIGHT?(c=f,f=-p,p=c):this.face===oe.BACK?(f=-f,p=-p):this.face===oe.LEFT&&(c=f,f=p,p=-c),t.phi=Math.acos(-m)-V,t.lam=Math.atan2(p,f),this.face===oe.RIGHT?t.lam=Cs(t.lam,-V):this.face===oe.BACK?t.lam=Cs(t.lam,-ge):this.face===oe.LEFT&&(t.lam=Cs(t.lam,+V))}if(this.es!==0){var _,x,v;_=t.phi<0?1:0,x=Math.tan(t.phi),v=this.b/Math.sqrt(x*x+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),_&&(t.phi=-t.phi)}return t.lam+=this.long0,r.x=t.lam,r.y=t.phi,r}function il(r,t,e,n){var i;return r<J?(n.value=$t.AREA_0,i=0):(i=Math.atan2(t,e),Math.abs(i)<=Zt?n.value=$t.AREA_0:i>Zt&&i<=V+Zt?(n.value=$t.AREA_1,i-=V):i>V+Zt||i<=-(V+Zt)?(n.value=$t.AREA_2,i=i>=0?i-ge:i+ge):(n.value=$t.AREA_3,i+=V)),i}function Cs(r,t){var e=r+t;return e<-ge?e+=oa:e>+ge&&(e-=oa),e}var aD=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const lD={init:iD,forward:sD,inverse:oD,names:aD};var xu=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],To=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],x1=.8487,v1=1.3523,w1=en/5,hD=1/w1,vs=18,Hl=function(r,t){return r[0]+t*(r[1]+t*(r[2]+t*r[3]))},cD=function(r,t){return r[1]+t*(2*r[2]+t*3*r[3])};function uD(r,t,e,n){for(var i=t;n;--n){var s=r(i);if(i-=s,Math.abs(s)<e)break}return i}function dD(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function fD(r){var t=rt(r.x-this.long0),e=Math.abs(r.y),n=Math.floor(e*w1);n<0?n=0:n>=vs&&(n=vs-1),e=en*(e-hD*n);var i={x:Hl(xu[n],e)*t,y:Hl(To[n],e)};return r.y<0&&(i.y=-i.y),i.x=i.x*this.a*x1+this.x0,i.y=i.y*this.a*v1+this.y0,i}function gD(r){var t={x:(r.x-this.x0)/(this.a*x1),y:Math.abs(r.y-this.y0)/(this.a*v1)};if(t.y>=1)t.x/=xu[vs][0],t.y=r.y<0?-V:V;else{var e=Math.floor(t.y*vs);for(e<0?e=0:e>=vs&&(e=vs-1);;)if(To[e][0]>t.y)--e;else if(To[e+1][0]<=t.y)++e;else break;var n=To[e],i=5*(t.y-n[0])/(To[e+1][0]-n[0]);i=uD(function(s){return(Hl(n,s)-t.y)/cD(n,s)},i,J,100),t.x/=Hl(xu[e],i),t.y=(5*e+i)*Ie,r.y<0&&(t.y=-t.y)}return t.x=rt(t.x+this.long0),t}var pD=["Robinson","robin"];const mD={init:dD,forward:fD,inverse:gD,names:pD};function _D(){this.name="geocent"}function yD(r){var t=o1(r,this.es,this.a);return t}function xD(r){var t=a1(r,this.es,this.a,this.b);return t}var vD=["Geocentric","geocentric","geocent","Geocent"];const wD={init:_D,forward:yD,inverse:xD,names:vD};var De={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},go={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function bD(){if(Object.keys(go).forEach((function(e){if(typeof this[e]>"u")this[e]=go[e].def;else{if(go[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);go[e].num&&(this[e]=parseFloat(this[e]))}go[e].degrees&&(this[e]=this[e]*Ie)}).bind(this)),Math.abs(Math.abs(this.lat0)-V)<J?this.mode=this.lat0<0?De.S_POLE:De.N_POLE:Math.abs(this.lat0)<J?this.mode=De.EQUIT:(this.mode=De.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var r=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(r),this.sw=Math.sin(r)}function SD(r){r.x-=this.long0;var t=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),i,s;switch(this.mode){case De.OBLIQ:s=this.sinph0*t+this.cosph0*e*n;break;case De.EQUIT:s=e*n;break;case De.S_POLE:s=-t;break;case De.N_POLE:s=t;break}switch(s=this.pn1/(this.p-s),i=s*e*Math.sin(r.x),this.mode){case De.OBLIQ:s*=this.cosph0*t-this.sinph0*e*n;break;case De.EQUIT:s*=t;break;case De.N_POLE:s*=-(e*n);break;case De.S_POLE:s*=e*n;break}var o,a;return o=s*this.cg+i*this.sg,a=1/(o*this.sw*this.h1+this.cw),i=(i*this.cg-s*this.sg)*this.cw*a,s=o*a,r.x=i*this.a,r.y=s*this.a,r}function ED(r){r.x/=this.a,r.y/=this.a;var t={x:r.x,y:r.y},e,n,i;i=1/(this.pn1-r.y*this.sw),e=this.pn1*r.x*i,n=this.pn1*r.y*this.cw*i,r.x=e*this.cg+n*this.sg,r.y=n*this.cg-e*this.sg;var s=Sr(r.x,r.y);if(Math.abs(s)<J)t.x=0,t.y=r.y;else{var o,a;switch(a=1-s*s*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/s+s/this.pn1),o=Math.sqrt(1-a*a),this.mode){case De.OBLIQ:t.y=Math.asin(o*this.sinph0+r.y*a*this.cosph0/s),r.y=(o-this.sinph0*Math.sin(t.y))*s,r.x*=a*this.cosph0;break;case De.EQUIT:t.y=Math.asin(r.y*a/s),r.y=o*s,r.x*=a;break;case De.N_POLE:t.y=Math.asin(o),r.y=-r.y;break;case De.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(r.x,r.y)}return r.x=t.x+this.long0,r.y=t.y,r}var TD=["Tilted_Perspective","tpers"];const MD={init:bD,forward:SD,inverse:ED,names:TD};function RD(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var r=1-this.es,t=1/r;this.radius_p=Math.sqrt(r),this.radius_p2=r,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function CD(r){var t=r.x,e=r.y,n,i,s,o;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var a=this.radius_p/Sr(this.radius_p*Math.cos(e),Math.sin(e));if(i=a*Math.cos(t)*Math.cos(e),s=a*Math.sin(t)*Math.cos(e),o=a*Math.sin(e),(this.radius_g-i)*i-s*s-o*o*this.radius_p_inv2<0)return r.x=Number.NaN,r.y=Number.NaN,r;n=this.radius_g-i,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/Sr(o,n)),r.y=this.radius_g_1*Math.atan(o/n)):(r.x=this.radius_g_1*Math.atan(s/n),r.y=this.radius_g_1*Math.atan(o/Sr(s,n)))}else this.shape==="sphere"&&(n=Math.cos(e),i=Math.cos(t)*n,s=Math.sin(t)*n,o=Math.sin(e),n=this.radius_g-i,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/Sr(o,n)),r.y=this.radius_g_1*Math.atan(o/n)):(r.x=this.radius_g_1*Math.atan(s/n),r.y=this.radius_g_1*Math.atan(o/Sr(s,n))));return r.x=r.x*this.a,r.y=r.y*this.a,r}function ID(r){var t=-1,e=0,n=0,i,s,o,a;if(r.x=r.x/this.a,r.y=r.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*Sr(1,n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*Sr(1,e));var l=n/this.radius_p;if(i=e*e+l*l+t*t,s=2*this.radius_g*t,o=s*s-4*i*this.C,o<0)return r.x=Number.NaN,r.y=Number.NaN,r;a=(-s-Math.sqrt(o))/(2*i),t=this.radius_g+a*t,e*=a,n*=a,r.x=Math.atan2(e,t),r.y=Math.atan(n*Math.cos(r.x)/t),r.y=Math.atan(this.radius_p_inv2*Math.tan(r.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*Math.sqrt(1+n*n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*Math.sqrt(1+e*e)),i=e*e+n*n+t*t,s=2*this.radius_g*t,o=s*s-4*i*this.C,o<0)return r.x=Number.NaN,r.y=Number.NaN,r;a=(-s-Math.sqrt(o))/(2*i),t=this.radius_g+a*t,e*=a,n*=a,r.x=Math.atan2(e,t),r.y=Math.atan(n*Math.cos(r.x)/t)}return r.x=r.x+this.long0,r}var PD=["Geostationary Satellite View","Geostationary_Satellite","geos"];const AD={init:RD,forward:CD,inverse:ID,names:PD};var Do=1.340264,ko=-.081106,Go=893e-6,jo=.003796,Kl=Math.sqrt(3)/2;function LD(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function OD(r){var t=rt(r.x-this.long0),e=r.y,n=Math.asin(Kl*Math.sin(e)),i=n*n,s=i*i*i;return r.x=t*Math.cos(n)/(Kl*(Do+3*ko*i+s*(7*Go+9*jo*i))),r.y=n*(Do+ko*i+s*(Go+jo*i)),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function FD(r){r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a;var t=1e-9,e=12,n=r.y,i,s,o,a,l,h;for(h=0;h<e&&(i=n*n,s=i*i*i,o=n*(Do+ko*i+s*(Go+jo*i))-r.y,a=Do+3*ko*i+s*(7*Go+9*jo*i),n-=l=o/a,!(Math.abs(l)<t));++h);return i=n*n,s=i*i*i,r.x=Kl*r.x*(Do+3*ko*i+s*(7*Go+9*jo*i))/Math.cos(n),r.y=Math.asin(Math.sin(n)/Kl),r.x=rt(r.x+this.long0),r}var ND=["eqearth","Equal Earth","Equal_Earth"];const DD={init:LD,forward:OD,inverse:FD,names:ND};function kD(r){r.Proj.projections.add(dl),r.Proj.projections.add(fl),r.Proj.projections.add(GF),r.Proj.projections.add(VF),r.Proj.projections.add(t3),r.Proj.projections.add(s3),r.Proj.projections.add(u3),r.Proj.projections.add(m3),r.Proj.projections.add(w3),r.Proj.projections.add(M3),r.Proj.projections.add(X3),r.Proj.projections.add(Y3),r.Proj.projections.add(tN),r.Proj.projections.add(oN),r.Proj.projections.add(uN),r.Proj.projections.add(mN),r.Proj.projections.add(wN),r.Proj.projections.add(MN),r.Proj.projections.add(LN),r.Proj.projections.add(kN),r.Proj.projections.add(BN),r.Proj.projections.add($N),r.Proj.projections.add(QN),r.Proj.projections.add(nD),r.Proj.projections.add(lD),r.Proj.projections.add(mD),r.Proj.projections.add(wD),r.Proj.projections.add(MD),r.Proj.projections.add(AD),r.Proj.projections.add(DD)}_r.defaultDatum="WGS84";_r.Proj=sn;_r.WGS84=new _r.Proj("WGS84");_r.Point=Us;_r.toPoint=l1;_r.defs=Xe;_r.nadgrid=zO;_r.transform=Vl;_r.mgrs=rF;_r.version="__VERSION__";kD(_r);Qy(_r);window.eoxMapAdvancedOlLayers={...LI,STAC:Mf};function GD(r){const t=r[0],e=new Array(t);let n=1<<t-1,i,s;for(i=0;i<t;++i)s=48,r[1]&n&&(s+=1),r[2]&n&&(s+=2),e[i]=String.fromCharCode(s),n>>=1;return e.join("")}const jD='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class zD extends Cr{constructor(t){const e=t.hidpi!==void 0?t.hidpi:!1;super({cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:!0,projection:tt("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.hidpi_=e,this.culture_=t.culture!==void 0?t.culture:"en-us",this.maxZoom_=t.maxZoom!==void 0?t.maxZoom:-1,this.apiKey_=t.key,this.imagerySet_=t.imagerySet,this.placeholderTiles_=t.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(t){if(t.statusCode!=200||t.statusDescription!="OK"||t.authenticationResultCode!="ValidCredentials"||t.resourceSets.length!=1||t.resourceSets[0].resources.length!=1){this.setState("error");return}const e=t.resourceSets[0].resources[0],n=this.maxZoom_==-1?e.zoomMax:this.maxZoom_,i=this.getProjection(),s=zn(i),o=this.hidpi_?2:1,a=e.imageWidth==e.imageHeight?e.imageWidth/o:[e.imageWidth/o,e.imageHeight/o],l=Wi({extent:s,minZoom:e.zoomMin,maxZoom:n,tileSize:a});this.tileGrid=l;const h=this.culture_,c=this.hidpi_,u=this.placeholderTiles_;if(this.tileUrlFunction=zs(e.imageUrlSubdomains.map(function(f){const p=[0,0,0],m=e.imageUrl.replace("{subdomain}",f).replace("{culture}",h);return function(_,x,v){if(!_)return;na(_[0],_[1],_[2],p);const w=new URL(m.replace("{quadkey}",GD(p))),S=w.searchParams;return c&&(S.set("dpi","d1"),S.set("device","mobile")),u===!0?S.delete("n"):u===!1&&S.set("n","z"),w.toString()}})),e.imageryProviders){const f=Bi(tt("EPSG:4326"),this.getProjection());this.setAttributions(p=>{const m=[],_=p.viewState,x=this.getTileGrid(),v=x.getZForResolution(_.resolution,this.zDirection),w=x.getTileCoordForCoordAndZ(_.center,v)[0];return e.imageryProviders.map(function(S){let E=!1;const T=S.coverageAreas;for(let R=0,C=T.length;R<C;++R){const I=T[R];if(w>=I.zoomMin&&w<=I.zoomMax){const F=I.bbox,U=[F[1],F[0],F[3],F[2]],j=Ps(U,f);if(Qt(j,p.extent)){E=!0;break}}}E&&m.push(S.attribution)}),m.push(jD),m})}this.setState("ready")}}const UD=zD;class BD extends Di{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:t.maxZoom!==void 0?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection}),this.account_=t.account,this.mapId_=t.map||"",this.config_=t.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(t){Object.assign(this.config_,t),this.initializeMap_()}setConfig(t){this.config_=t||{},this.initializeMap_()}initializeMap_(){const t=JSON.stringify(this.config_);if(this.templateCache_[t]){this.applyTemplate_(this.templateCache_[t]);return}let e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);const n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,t)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",e),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(t,e){const n=e.target;if(!n.status||n.status>=200&&n.status<300){let i;try{i=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[t]=i,this.setState("ready")}else this.setState("error")}handleInitError_(t){this.setState("error")}applyTemplate_(t){const e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)}}const XD=BD;class qD extends Eh{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(e){const n=e.getGeometry();return At(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,n){this.source.loadFeatures(t,e,n),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(Lt.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(Lt.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){const n=t===0?0:Math.min(e,t)/t,i=t!==this.distance||this.interpolationRatio!==n;this.distance=t,this.minDistance=e,this.interpolationRatio=n,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const t=je(),e=this.distance*this.resolution,n=this.source.getFeatures(),i={};for(let s=0,o=n.length;s<o;s++){const a=n[s];if(!(it(a)in i)){const l=this.geometryFunction(a);if(l){const h=l.getCoordinates();Ru(h,t),Mr(t,e,t);const c=this.source.getFeaturesInExtent(t).filter(function(u){const f=it(u);return f in i?!1:(i[f]=!0,!0)});this.features.push(this.createCluster(c,t))}}}}createCluster(t,e){const n=[0,0];for(let a=t.length-1;a>=0;--a){const l=this.geometryFunction(t[a]);l?Cm(n,l.getCoordinates()):t.splice(a,1)}Lx(n,1/t.length);const i=Re(e),s=this.interpolationRatio,o=new Me([n[0]*(1-s)+i[0]*s,n[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,t):new Se({geometry:o,features:t})}}const WD=qD,ZD="https://tile.googleapis.com/v1/createSession",$D="https://tile.googleapis.com/v1/2dtiles",VD="https://tile.googleapis.com/tile/v1/viewport",YD=22;class HD extends Cr{constructor(t){const e=!!t.highDpi,n=t.overlay!==!0;super({attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:n,projection:"EPSG:3857",reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.apiKey_=t.key,this.error_=null;const i={mapType:t.mapType||"roadmap",language:t.language||"en-US",region:t.region||"US"};t.imageFormat&&(i.imageFormat=t.imageFormat),t.scale&&(i.scale=t.scale),e&&(i.highDpi=!0),t.layerTypes&&(i.layerTypes=t.layerTypes),t.styles&&(i.styles=t.styles),t.overlay===!0&&(i.overlay=!0),this.sessionTokenRequest_=i,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(t,e){return fetch(t,e)}async createSession_(){const t=ZD+"?key="+this.apiKey_,e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},n=await this.fetchSessionToken(t,e);if(!n.ok){try{const u=await n.json();this.error_=new Error(u.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await n.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=Wi({extent:zn(this.getProjection()),maxZoom:YD,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_;this.tileUrlFunction=function(u,f,p){const m=u[0],_=u[1],x=u[2];return`${$D}/${m}/${_}/${x}?session=${a}&key=${l}`};const h=parseInt(i.expiry,10)*1e3,c=Math.max(h-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),c),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(t){if(t.viewHints[ee.ANIMATING]||t.viewHints[ee.INTERACTING]||t.animate)return this.previousViewportAttribution_;const[e,n]=tg(da(t.extent),t.viewState.projection),[i,s]=tg(fa(t.extent),t.viewState.projection),o=`zoom=${this.getTileGrid().getZForResolution(t.viewState.resolution,this.zDirection)}&north=${s}&south=${n}&east=${i}&west=${e}`;if(this.previousViewportExtent_==o)return this.previousViewportAttribution_;this.previousViewportExtent_=o;const a=this.sessionTokenValue_,l=this.apiKey_,h=`${VD}?session=${a}&key=${l}&${o}`;return this.previousViewportAttribution_=await fetch(h).then(c=>c.json()).then(c=>c.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const KD=HD;let b1=class extends Ra{constructor(r,t,e,n,i,s,o){super(t,e,n,i,s,o),this.zoomifyImage_=null,this.tileSize_=r}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const r=super.getImage();if(this.state==q.LOADED){const t=this.tileSize_;if(r.width==t[0]&&r.height==t[1])return this.zoomifyImage_=r,r;const e=Jt(t[0],t[1]);return e.drawImage(r,0,0),this.zoomifyImage_=e.canvas,e.canvas}return r}};class QD extends Cr{constructor(t){const e=t.size,n=t.tierSizeCalculation!==void 0?t.tierSizeCalculation:"default",i=t.tilePixelRatio||1,s=e[0],o=e[1],a=[],l=t.tileSize||Ds;let h=l*i;switch(n){case"default":for(;s>h||o>h;)a.push([Math.ceil(s/h),Math.ceil(o/h)]),h+=h;break;case"truncated":let R=s,C=o;for(;R>h||C>h;)a.push([Math.ceil(R/h),Math.ceil(C/h)]),R>>=1,C>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const c=[i],u=[0];for(let R=1,C=a.length;R<C;R++)c.push(i<<R),u.push(a[R-1][0]*a[R-1][1]+u[R-1]);c.reverse();const f=new fi({tileSize:l,extent:t.extent||[0,-o,s,0],resolutions:c});let p=t.url;p&&!p.includes("{TileGroup}")&&!p.includes("{tileIndex}")&&(p+="{TileGroup}/{z}-{x}-{y}.jpg");const m=pf(p);let _=l*i;function x(R){return function(C,I,F){if(!C)return;const U=C[0],j=C[1],B=C[2],d=j+B*a[U][0],g=(d+u[U])/_|0,y={z:U,x:j,y:B,tileIndex:d,TileGroup:"TileGroup"+g};return R.replace(/\{(\w+?)\}/g,function(b,M){return y[M]})}}const v=zs(m.map(x)),w=b1.bind(null,ie(l*i));super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,tilePixelRatio:i,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:w,tileGrid:f,tileUrlFunction:v,transition:t.transition}),this.zDirection=t.zDirection;const S=f.getTileCoordForCoordAndResolution(Re(f.getExtent()),c[c.length-1]),E=v(S,1,null),T=new Image;T.addEventListener("error",()=>{_=l,this.changed()}),T.src=E}}const JD=QD;function po(r){return r.toLocaleString("en",{maximumFractionDigits:10})}class t5 extends Cr{constructor(t){const e=t||{};let n=e.url||"";n=n+(n.lastIndexOf("/")===n.length-1||n===""?"":"/");const i=e.version||_e.VERSION2,s=e.sizes||[],o=e.size;At(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],h=e.tileSize,c=e.tilePixelRatio||1,u=e.format||"jpg",f=e.quality||(e.version==_e.VERSION1?"native":"default");let p=e.resolutions||[];const m=e.supports||[],_=e.extent||[0,-l,a,0],x=s!=null&&Array.isArray(s)&&s.length>0,v=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),w=m!=null&&Array.isArray(m)&&(m.includes("regionByPx")||m.includes("regionByPct"))&&(m.includes("sizeByWh")||m.includes("sizeByH")||m.includes("sizeByW")||m.includes("sizeByPct"));let S,E,T;if(p.sort(function(F,U){return U-F}),v||w)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(S=h,E=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(S=h[0],E=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(S=h[0],E=h[1]):h[0]==null&&Number.isInteger(h[1])&&(S=h[1],E=h[1])))),(S===void 0||E===void 0)&&(S=Ds,E=Ds),p.length==0){T=Math.max(Math.ceil(Math.log(a/S)/Math.LN2),Math.ceil(Math.log(l/E)/Math.LN2));for(let F=T;F>=0;F--)p.push(Math.pow(2,F))}else{const F=Math.max(...p);T=Math.round(Math.log(F)/Math.LN2)}else if(S=a,E=l,p=[],x){s.sort(function(U,j){return U[0]-j[0]}),T=-1;const F=[];for(let U=0;U<s.length;U++){const j=a/s[U][0];if(p.length>0&&p[p.length-1]==j){F.push(U);continue}p.push(j),T++}if(F.length>0)for(let U=0;U<F.length;U++)s.splice(F[U]-U,1)}else p.push(1),s.push([a,l]),T=0;const R=new fi({tileSize:[S,E],extent:_,origin:Dn(_),resolutions:p}),C=function(F,U,j){let B,d;const g=F[0];if(g>T)return;const y=F[1],b=F[2],M=p[g];if(!(y===void 0||b===void 0||M===void 0||y<0||Math.ceil(a/M/S)<=y||b<0||Math.ceil(l/M/E)<=b)){if(w||v){const P=y*S*M,A=b*E*M;let L=S*M,D=E*M,X=S,K=E;if(P+L>a&&(L=a-P),A+D>l&&(D=l-A),P+S*M>a&&(X=Math.floor((a-P+M-1)/M)),A+E*M>l&&(K=Math.floor((l-A+M-1)/M)),P==0&&L==a&&A==0&&D==l)B="full";else if(!w||m.includes("regionByPx"))B=P+","+A+","+L+","+D;else if(m.includes("regionByPct")){const G=po(P/a*100),H=po(A/l*100),Q=po(L/a*100),nt=po(D/l*100);B="pct:"+G+","+H+","+Q+","+nt}i==_e.VERSION3&&(!w||m.includes("sizeByWh"))?d=X+","+K:!w||m.includes("sizeByW")?d=X+",":m.includes("sizeByH")?d=","+K:m.includes("sizeByWh")?d=X+","+K:m.includes("sizeByPct")&&(d="pct:"+po(100/M))}else if(B="full",x){const P=s[g][0],A=s[g][1];i==_e.VERSION3?P==a&&A==l?d="max":d=P+","+A:P==a?d="full":d=P+","}else d=i==_e.VERSION3?"max":"full";return n+B+"/"+d+"/0/"+f+"."+u}},I=b1.bind(null,ie(h||256).map(function(F){return F*c}));super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:e.state,tileClass:I,tileGrid:R,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:C,transition:e.transition}),this.zDirection=e.zDirection}}const e5=t5;function S1(r,t,e,n,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=e/n,l=[gl(yt(t)/a,tn),gl(Vt(t)/a,tn)];s.SIZE=l[0]+","+l[1],s.BBOX=t.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);const h=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return Fn(h,s)}function E1(r){const t=r.load?r.load:di,e=tt(r.projection||"EPSG:3857");return function(n,i,s){s=r.hidpi?s:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,r.params),n=Nh(n,i,s,r.ratio);const a=S1(r.url,n,i,s,e,o),l=new Image;return r.crossOrigin!==null&&(l.crossOrigin=r.crossOrigin),t(l,a).then(h=>{const c=yt(n)/h.width*s;return{image:h,extent:n,resolution:c,pixelRatio:s}})}}class r5 extends pi{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Fh,this.params_=Object.assign({},t.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=E1({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),di(s))})),super.getImageInternal(t,e,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const n5=r5;class i5 extends pi{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5}getImageInternal(t,e,n,i){e=this.findNearestResolution(e);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==e&&s.getPixelRatio()==n&&We(s.getExtent(),t))return s;t=t.slice(),Tm(t,this.ratio_);const o=yt(t)/e,a=Vt(t)/e,l=[o*n,a*n],h=this.canvasFunction_.call(this,t,e,n,l,i);return h&&(s=new Bd(t,e,n,h)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}const s5=i5;function o5(r,t,e,n){const i=yt(r),s=Vt(r),o=t[0],a=t[1],l=.0254/n;return a*i>o*s?i*e/(o*l):s*e/(a*l)}function a5(r,t,e,n,i,s,o){const a=o5(e,n,s,o),l=Re(e),h={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,t),Fn(r,h)}function T1(r){const t=r.load||di;return function(e,n,i){const s=new Image;r.crossOrigin!==null&&(s.crossOrigin=r.crossOrigin),e=Nh(e,n,i,r.ratio);const o=yt(e)/n,a=Vt(e)/n,l=[o*i,a*i],h=a5(r.url,r.params,e,l,r.useOverlay,r.metersPerUnit||1,r.displayDpi||96);return t(s,h).then(c=>({image:c,extent:e,pixelRatio:i}))}}class l5 extends pi{constructor(t){super({interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.displayDpi_=t.displayDpi!==void 0?t.displayDpi:96,this.params_=Object.assign({},t.params),this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Fh,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.metersPerUnit_=t.metersPerUnit!==void 0?t.metersPerUnit:1,this.ratio_=t.ratio!==void 0?t.ratio:1,this.useOverlay_=t.useOverlay!==void 0?t.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=T1({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),di(s))})),super.getImageInternal(t,e,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(t){Object.assign(this.params_,t),this.changed()}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}changed(){this.image=null,super.changed()}}const h5=l5;class c5 extends pi{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Fh,this.params_=Object.assign({},t.params),this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(t,e,n,i){const s=tt(n),o=this.getProjection();o&&o!==s&&(e=ra(o,s,t,e),t=rh(t,s,o));const a={url:this.url_,params:{...this.params_,...i},projection:o||s};return SL(a,t,e)}getLegendUrl(t,e){return EL({url:this.url_,params:{...this.params_,...e}},t)}getParams(){return this.params_}getImageInternal(t,e,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=Ay({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),di(s))})),super.getImageInternal(t,e,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const u5=c5,d5={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},f5={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function g5(r,t){let e,n;for(let i=0;i<r.length;++i){const s=r[i];if(s.rel==="item"){if(s.type===t){e=s.href;break}(d5[s.type]||!n&&s.type.startsWith("image/"))&&(n=s.href)}}if(!e)if(n)e=n;else throw new Error('Could not find "item" link');return e}function p5(r,t,e){let n,i;const s={};for(let o=0;o<r.length;++o){const a=r[o];if(s[a.type]=a.href,a.rel==="item"){if(a.type===t){n=a.href;break}f5[a.type]&&(i=a.href)}}if(!n&&e)for(let o=0;o<e.length;++o){const a=e[o];if(s[a]){n=s[a];break}}if(!n)if(i)n=i;else throw new Error('Could not find "item" link');return n}function pm(r,t,e,n){let i=r.projection;if(!i&&(i=tt(t.crs),!i))throw new Error(`Unsupported CRS: ${t.crs}`);const s=t.orderedAxes,o=(s?s.slice(0,2).map(T=>T.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation().substr(0,2))!=="en",a=t.tileMatrices,l={};for(let T=0;T<a.length;++T){const R=a[T];l[R.id]=R}const h={},c=[];if(n)for(let T=0;T<n.length;++T){const R=n[T],C=R.tileMatrix;c.push(C),h[C]=R}else for(let T=0;T<a.length;++T){const R=a[T].id;c.push(R)}const u=c.length,f=new Array(u),p=new Array(u),m=new Array(u),_=new Array(u),x=[-1/0,-1/0,1/0,1/0];for(let T=0;T<u;++T){const R=c[T],C=l[R],I=C.pointOfOrigin;o?f[T]=[I[1],I[0]]:f[T]=I,p[T]=C.cellSize,m[T]=[C.matrixWidth,C.matrixHeight],_[T]=[C.tileWidth,C.tileHeight];const F=h[R];if(F){const U=C.cellSize*C.tileWidth,j=f[T][0]+F.minTileCol*U,B=f[T][0]+(F.maxTileCol+1)*U,d=C.cellSize*C.tileHeight,g=C.cornerOfOrigin==="bottomLeft";let y,b;g?(y=f[T][1]+F.minTileRow*d,b=f[T][1]+(F.maxTileRow+1)*d):(y=f[T][1]-(F.maxTileRow+1)*d,b=f[T][1]-F.minTileRow*d),we(x,[j,y,B,b],x)}}const v=new fi({origins:f,resolutions:p,sizes:m,tileSizes:_,extent:n?x:void 0}),w=r.context,S=r.url;function E(T,R,C){if(!T)return;const I=c[T[0]],F=l[I],U=F.cornerOfOrigin==="bottomLeft",j={tileMatrix:I,tileCol:T[1],tileRow:U?-T[2]-1:T[2]};if(n){const d=h[F.id];if(j.tileCol<d.minTileCol||j.tileCol>d.maxTileCol||j.tileRow<d.minTileRow||j.tileRow>d.maxTileRow)return}Object.assign(j,w);const B=e.replace(/\{(\w+?)\}/g,function(d,g){return j[g]});return Ry(S,B)}return{grid:v,urlTemplate:e,urlFunction:E}}function m5(r,t){const e=t.tileMatrixSetLimits;let n;if(t.dataType==="map")n=g5(t.links,r.mediaType);else if(t.dataType==="vector")n=p5(t.links,r.mediaType,r.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(t.tileMatrixSet)return pm(r,t.tileMatrixSet,n,e);const i=t.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=Ry(r.url,s);return My(o).then(function(a){return pm(r,a,n,e)})}function M1(r){return My(r.url).then(function(t){return m5(r,t)})}class _5 extends Cr{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,context:t.context||null};M1(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){ml(t),this.setState("error")}}const y5=_5;class x5 extends Dh{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,format:t.format,overlaps:t.overlaps,projection:t.projection,tileClass:t.tileClass,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection,state:"loading"});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,supportedMediaTypes:t.format.supportedMediaTypes,context:t.context||null};M1(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){ml(t),this.setState("error")}}const v5=x5,R1='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class w5 extends Di{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[R1];const n=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",i=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:i,wrapX:t.wrapX,zDirection:t.zDirection})}}const b5=w5,mm=1/0;class S5{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Xs(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(t){At(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=mm?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,i=e.length,s=e[t],o=n[t],a=t;for(;t<i>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<i&&n[h]<n[l]?h:l;e[t]=e[c],n[t]=n[c],t=c}e[t]=s,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,i=this.priorities_,s=n[e],o=i[e];for(;e>t;){const a=this.getParentIndex_(e);if(i[a]>o)n[e]=n[a],i[e]=i[a],e=a;else break}n[e]=s,i[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let i=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==mm?delete this.queuedElements_[this.keyFunction_(o)]:(n[i]=l,e[i++]=o);e.length=i,n.length=i,this.heapify_()}}class E5 extends S5{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Lt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===q.LOADED||n===q.ERROR||n===q.EMPTY){n!==q.ERROR&&e.removeEventListener(Lt.CHANGE,this.boundHandleTileChange_);const i=e.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,i,s,o;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),i=s.getState(),i===q.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}let C1=!0;try{new ImageData(10,10)}catch{C1=!1}let Pc;function T5(r,t,e){if(C1)return new ImageData(r,t,e);Pc||(Pc=document.createElement("canvas").getContext("2d"));const n=Pc.createImageData(t,e);return n.data.set(r),n}function I1(r){let t=!0;try{new ImageData(10,10)}catch{t=!1}function e(n,i,s){return t?new ImageData(n,i,s):{data:n,width:i,height:s}}return function(n){const i=n.buffers,s=n.meta,o=n.imageOps,a=n.width,l=n.height,h=i.length,c=i[0].byteLength;if(o){const m=new Array(h);for(let _=0;_<h;++_)m[_]=e(new Uint8ClampedArray(i[_]),a,l);return r(m,s).data.buffer}const u=new Uint8ClampedArray(c),f=new Array(h),p=new Array(h);for(let m=0;m<h;++m)f[m]=new Uint8ClampedArray(i[m]),p[m]=[0,0,0,0];for(let m=0;m<c;m+=4){for(let x=0;x<h;++x){const v=f[x];p[x][0]=v[m],p[x][1]=v[m+1],p[x][2]=v[m+2],p[x][3]=v[m+3]}const _=r(p,s);u[m]=_[0],u[m+1]=_[1],u[m+2]=_[2],u[m+3]=_[3]}return u.buffer}}function M5(r,t){const e=Object.keys(r.lib||{}).map(function(i){return"const "+i+" = "+r.lib[i].toString()+";"}).concat(["const __minion__ = ("+I1.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(e.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(e,{type:"text/javascript"})));return n.addEventListener("message",t),n}function R5(r,t){const e=I1(r.operation);let n=!1;return{postMessage:function(i){setTimeout(function(){n||t({data:{buffer:e(i),meta:i.meta}})},0)},terminate:function(){n=!0}}}class C5 extends bu{constructor(t){super(),this._imageOps=!!t.imageOps;let e;t.threads===0?e=0:this._imageOps?e=1:e=t.threads||1;const n=new Array(e);if(e)for(let i=0;i<e;++i)n[i]=M5(t,this._onWorkerMessage.bind(this,i));else n[0]=R5(t,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=t.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(t,e,n){this._enqueue({inputs:t,meta:e,callback:n}),this._dispatch()}_enqueue(t){for(this._queue.push(t);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const t=this._queue.shift();this._job=t;const e=t.inputs[0].width,n=t.inputs[0].height,i=t.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:i,meta:t.meta,imageOps:this._imageOps,width:e,height:n},i);return}const o=t.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const h=l*a,c=[];for(let u=0,f=i.length;u<f;++u)c.push(i[u].slice(h,h+a));this._workers[l].postMessage({buffers:c,meta:t.meta,imageOps:this._imageOps,width:e,height:n},c)}}_onWorkerMessage(t,e){this.disposed||(this._dataLookup[t]=e.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const t=this._job,e=this._workers.length;let n,i;if(e===1)n=new Uint8ClampedArray(this._dataLookup[0].buffer),i=this._dataLookup[0].meta;else{const s=t.inputs[0].data.length;n=new Uint8ClampedArray(s),i=new Array(e);const o=4*Math.ceil(s/4/e);for(let a=0;a<e;++a){const l=this._dataLookup[a].buffer,h=a*o;n.set(new Uint8ClampedArray(l),h),i[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},t.callback(null,T5(n,t.inputs[0].width,t.inputs[0].height),i),this._dispatch()}disposeInternal(){for(let t=0;t<this._workers.length;++t)this._workers[t].terminate();this._workers.length=0}}const _m={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class ym extends cn{constructor(t,e,n){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=n}}class P1 extends pi{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=A5(t.sources);const e=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener(Lt.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new E5(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:pe(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:P5(this.layers_),pixelRatio:1,pixelToCoordinateTransform:pe(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:it(this),renderTargets:{}},this.setAttributions(function(n){const i=[];for(let s=0,o=t.sources.length;s<o;++s){const a=t.sources[s],l=a instanceof Qs?a:a.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const c=h(n);i.push.apply(i,c)}}return i.length!==0?i:null}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new C5({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,n){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=Re(t);i.size[0]=Math.ceil(yt(t)/e),i.size[1]=Math.ceil(Vt(t)/e),i.extent=[s[0]-i.size[0]*e/2,s[1]-i.size[1]*e/2,s[0]+i.size[0]*e/2,s[1]+i.size[1]*e/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=n,o.resolution=e,i}allSourcesReady_(){let t=!0,e;for(let n=0,i=this.layers_.length;n<i;++n)if(e=this.layers_[n].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,n,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const s=this.updateFrameState_(t,e,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(e!==o||!An(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,n=new Array(e);for(let s=0;s<e;++s){t.layerIndex=s,t.renderTargets={};const o=I5(this.layers_[s],t);if(o)n[s]=o;else return}const i={};this.dispatchEvent(new ym(_m.BEFOREOPERATIONS,t,i)),this.processor_.process(n,i,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,n,i){if(e||!n)return;const s=t.extent,o=t.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!An(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(yt(s)/o),h=Math.round(Vt(s)/o);a=Jt(l,h),this.renderedImageCanvas_=new Bd(s,o,1,a.canvas)}a.putImageData(n,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new ym(_m.AFTEROPERATIONS,t,i))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let n=0,i=this.layers_.length;n<i&&(e=this.layers_[n].getSource().getResolutions(t),!e);++n);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}P1.prototype.dispose;let xi=null;function I5(r,t){const e=r.getRenderer();if(!e)throw new Error("Unsupported layer type: "+r);if(!e.prepareFrame(t))return null;const n=t.size[0],i=t.size[1];if(n===0||i===0)return null;const s=e.renderFrame(t,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(!xi)xi=Jt(n,i,void 0,{willReadFrequently:!0});else{const a=xi.canvas;a.width!==n||a.height!==i?xi=Jt(n,i,void 0,{willReadFrequently:!0}):xi.clearRect(0,0,n,i)}return xi.drawImage(o,0,0,n,i),xi.getImageData(0,0,n,i)}function P5(r){return r.map(function(t){return t.getLayerState()})}function A5(r){const t=r.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=L5(r[n]);return e}function L5(r){let t;return r instanceof Qs?r instanceof Ia?t=new jl({source:r}):r instanceof pi&&(t=new Ud({source:r})):t=r,t}const O5=P1,F5='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',N5='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',D5='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',k5={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},alidade_satellite:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},G5={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class j5 extends Di{constructor(t){const e=t.layer.indexOf("-"),n=e==-1?t.layer:t.layer.slice(0,e),i=G5[n]||{minZoom:0,maxZoom:20,retina:!0},s=k5[t.layer],o=t.apiKey?"?api_key="+t.apiKey:"",a=i.retina&&t.retina?"@2x":"",l=t.url!==void 0?t.url:"https://tiles.stadiamaps.com/tiles/"+t.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,h=[F5,N5,R1];t.layer.startsWith("stamen_")&&h.splice(1,0,D5),super({attributions:h,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:i.maxZoom,minZoom:t.minZoom!==void 0?t.minZoom:i.minZoom,opaque:s.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:l,tilePixelRatio:a?2:1,wrapX:t.wrapX,zDirection:t.zDirection})}}const z5=j5;class U5 extends Cr{constructor(t){t=t||{},super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.params_=Object.assign({},t.params),this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=je(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}getParams(){return this.params_}getRequestUrl_(t,e,n,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const h=nn(kd(t),a.length);l=a[h]}return S1(l,n,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(t[0]),i,s,o)}getTilePixelRatio(t){return this.hidpi_?t:1}updateParams(t){Object.assign(this.params_,t),this.setKey(this.getKeyForParams_())}tileUrlFunction(t,e,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=t[0])return;e!=1&&!this.hidpi_&&(e=1);const s=i.getTileCoordExtent(t,this.tmpExtent_);let o=ie(i.getTileSize(t[0]),this.tmpSize);e!=1&&(o=s0(o,e,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(t,o,s,e,n,a)}}const B5=U5;class X5 extends Di{constructor(t){t=t||{},super({opaque:!1,projection:t.projection,tileGrid:t.tileGrid,wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection,url:t.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(e,n)=>{const i=e.getTileCoord()[0],s=ie(this.tileGrid.getTileSize(i)),o=Jt(s[0],s[1]);o.strokeStyle="grey",o.strokeRect(.5,.5,s[0]+.5,s[1]+.5),o.fillStyle="grey",o.strokeStyle="white",o.textAlign="center",o.textBaseline="middle",o.font="24px sans-serif",o.lineWidth=4,o.strokeText(n,s[0]/2,s[1]/2,s[0]),o.fillText(n,s[0]/2,s[1]/2,s[0]),e.setImage(o.canvas)}})}}const q5=X5;class W5 extends Js{constructor(t,e,n,i,s,o){super(t,e),this.src_=n,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(t){if(!this.grid_||!this.keys_)return null;const e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(e*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(t,e,n){this.state==q.EMPTY&&n===!0?(this.state=q.IDLE,Uo(this,Lt.CHANGE,function(i){e(this.getData(t))},this),this.loadInternal_()):n===!0?setTimeout(()=>{e(this.getData(t))},0):e(this.getData(t))}getKey(){return this.src_}handleError_(){this.state=q.ERROR,this.changed()}handleLoad_(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=q.LOADED,this.changed()}loadInternal_(){if(this.state==q.IDLE)if(this.state=q.LOADING,this.jsonp_)yf(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleError_();return}this.handleLoad_(n)}else this.handleError_()}onXHRError_(t){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(q.EMPTY)}}class Z5 extends Ia{constructor(t){if(super({projection:tt("EPSG:3857"),state:"loading",wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection}),this.preemptive_=t.preemptive!==void 0?t.preemptive:!0,this.tileUrlFunction_=mL,this.template_=void 0,this.jsonp_=t.jsonp||!1,t.url)if(this.jsonp_)yf(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(t,e,n,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(e,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(t,s);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(t,n,i)}else i===!0?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(t){const e=tt("EPSG:4326"),n=this.getProjection();let i;if(t.bounds!==void 0){const c=Bi(e,n);i=Ps(t.bounds,c)}const s=zn(n),o=t.minzoom||0,a=t.maxzoom||22,l=Wi({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=t.template;const h=t.grids;if(!h){this.setState("error");return}if(this.tileUrlFunction_=gf(h,l),t.attribution){const c=i!==void 0?i:s;this.setAttributions(function(u){return Qt(c,u.extent)?[t.attribution]:null})}this.setState("ready")}getTile(t,e,n,i,s){const o=ln(t,e,n);if(this.tileCache.containsKey(o))return this.tileCache.get(o);const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),h=this.tileUrlFunction_(l,i,s),c=new W5(a,h!==void 0?q.IDLE:q.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(o,c),c}useTile(t,e,n){const i=ln(t,e,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const $5=Z5;function V5(r,t){const e=new Dd(32),n=r.getExtent();return function(i,s){e.expireCache(),n&&(i=we(n,i));const o=r.getZForResolution(s),a=[];return r.forEachTileCoord(i,o,l=>{const h=l.toString();if(!e.containsKey(h)){const c=t(l);e.set(h,c)}a.push(e.get(h))}),a}}const Y5=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:UD,CartoDB:XD,Cluster:WD,DataTile:Yd,GeoTIFF:ff,Google:KD,IIIF:e5,Image:pi,ImageArcGISRest:n5,ImageCanvas:s5,ImageMapGuide:h5,ImageStatic:Ty,ImageWMS:u5,OGCMapTile:y5,OGCVectorTile:v5,OSM:b5,Raster:O5,Source:Qs,StadiaMaps:z5,Tile:Ia,TileArcGISRest:B5,TileDebug:q5,TileImage:Cr,TileJSON:Cy,TileWMS:Ly,UTFGrid:$5,UrlTile:_f,Vector:Eh,VectorTile:Dh,WMTS:Oy,XYZ:Di,Zoomify:JD,createArcGISRestLoader:E1,createMapGuideLoader:T1,createStaticLoader:Ey,createWMSLoader:Ay,sourcesFromTileGrid:V5},Symbol.toStringTag,{value:"Module"}));class H5 extends Cr{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,tilePixelRatio:t.tilePixelRatio,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection,wrapX:t.wrapX}),this.version_=t.version!==void 0?t==null?void 0:t.version:"1.0.0",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,fetch(t.url).then(e=>e.text()).then(e=>new window.DOMParser().parseFromString(e,"application/xml")).then(e=>{this.handleCapabilitiesResponse(e,t)})}handleCapabilitiesResponse(t,e){const n=new vd().read(t),i=Fy(n,e);this.crossOrigin=i.crossOrigin,this.projection=i.projection,this.tileGrid=i.tileGrid,this.requestEncoding_=i.requestEncoding,this.matrixSet_=i.matrixSet,this.style_=i.style,this.format_=i.format,this.dimensions_=i.dimensions,this.setUrls(i.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=zs(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Fn(t,n):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=t;return e=="KVP"?l=Fn(l,a):l=l.replace(/\{(\w+?)\}/g,function(h,c){return a[c]}),l}}}window.eoxMapAdvancedOlSources={...Y5,WMTSCapabilities:H5};const K5={__name:"EodashMap",setup(r){var a;const t=G1(X1),e={class:"fill-height fill-width overflow-none",center:[15,48],layers:[{type:"Tile",source:{type:"OSM"}}]};_i&&_i.value&&_i.value.length===3&&(e.center=[(a=_i.value)==null?void 0:a[0],_i.value[1]],e.zoom=_i.value[2]);const n=()=>Nn(()=>import("./eox-map.B8HGp0MI.js"),[]),i=l=>{const h=l.map,[c,u]=(h==null?void 0:h.getView().getCenter())??[0,0],f=h==null?void 0:h.getView().getZoom();!Number.isNaN(c)&&!Number.isNaN(u)&&!Number.isNaN(f)&&(_i.value=[c,u,f])},s=(l,h)=>{var u;(u=l==null?void 0:l.map)==null||u.on("moveend",i);const{selectedStac:c}=J1(h);U1([c,q1],async([f,p])=>{if(f){const m=Bf(`./${f.id}/collection.json`,t.stacEndpoint),_=Bf(f.links[1].href,m),x=new B1(_);p?l.layers=await x.createLayersJson(new Date(p)):l.layers=await x.createLayersJson()}},{immediate:!0})},o=(l,h)=>{var c;(c=l==null?void 0:l.map)==null||c.un("moveend",i)};return(l,h)=>(j1(),z1(W1,{link:n,"tag-name":"eox-map",properties:e,"on-mounted":s,"on-unmounted":o}))}},pk=Object.freeze(Object.defineProperty({__proto__:null,default:K5},Symbol.toStringTag,{value:"Module"}));export{fk as D,pk as E,gk as G,$s as V};
