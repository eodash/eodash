import"@eox/chart";import"@eox/drawtools";import"@eox/jsonform";import{useSTAcStore as E}from"@/store/stac";import{s as g}from"./pinia.mAAL13OY.js";import{mapEl as k}from"@/store/States";import{useOnLayersUpdate as w}from"@/composables";import{p as a,v as B,B as P,o as u,c as m,e as p,as as _,j,b as S,w as V,au as C,a as b}from"./framework.Gv4KJFRr.js";import{eoxLayersKey as N}from"@/utils/keys";import{initProcess as f,useAutoExec as T,handleProcesses as A}from"@/composables/EodashProcess";const L={class:"process-container"},R=[".schema"],D=[".spec",".dataValues"],Q={__name:"EodashProcess",setup(F){const y=C(N),{selectedStac:c}=g(E()),t=a(null),d=a(null),n=a(!1),s=a(null),o=a(null),r=a(!1),v=a(!1),i=a(!1);B(async()=>{var e;((e=k.value)==null?void 0:e.layers.length)<=1?y.once(async()=>{await f({selectedStac:c,jsonformEl:o,jsonformSchema:s,chartSpec:t,isProcessed:n,loading:r,isPolling:i})}):await f({selectedStac:c,jsonformEl:o,jsonformSchema:s,chartSpec:t,isProcessed:n,loading:r,isPolling:i})}),w(async()=>await f({selectedStac:c,jsonformEl:o,jsonformSchema:s,chartSpec:t,isProcessed:n,loading:r,isPolling:i}));const h=async()=>{var l;const e=(l=o.value)==null?void 0:l.editor.validate();if(e!=null&&e.length){console.warn("[eodash] Form validation failed",e);return}await A({jsonformEl:o,jsonformSchema:s,chartSpec:t,chartData:d,loading:r,selectedStac:c,isProcessed:n,isPolling:i}),n.value=!0};return T(v,o,s,h),(e,l)=>{const x=P("v-btn");return u(),m("div",L,[s.value?(u(),m("eox-jsonform",{key:0,ref_key:"jsonformEl",ref:o,".schema":s.value},null,40,R)):p("",!0),n.value&&t.value?(u(),m("eox-chart",{key:1,class:"chart",".spec":_(t.value),".dataValues":_(d.value)},null,40,D)):p("",!0),j("span",null,[v.value?p("",!0):(u(),S(x,{key:0,loading:r.value,style:{float:"right","margin-right":"20px"},onClick:h,color:"primary"},{default:V(()=>l[0]||(l[0]=[b(" Execute ")])),_:1},8,["loading"]))])])}}};export{Q as default};
