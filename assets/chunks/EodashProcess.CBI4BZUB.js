import"@eox/chart";import"@eox/drawtools";import"@eox/jsonform";import{useSTAcStore as w}from"@/store/stac";import{s as S}from"./pinia.CFKZge00.js";import{mapEl as B}from"@/store/states";import{useOnLayersUpdate as P}from"@/composables";import{ax as j,p as l,v as C,B as V,o as v,c as _,e as h,at as y,j as k,b,w as N,a as T}from"./framework.B09hBYeo.js";import{eoxLayersKey as A}from"@/utils/keys";import{initProcess as g,useAutoExec as L,handleProcesses as M}from"@/composables/EodashProcess";const d=new Map;function R(u){const p=j();function i(t){var e;const o=d.get(u)||new Set;o.add(t),d.set(u,o);const n=()=>f(t);return(e=p==null?void 0:p.cleanups)==null||e.push(n),n}function r(t){function e(...o){f(e),t(...o)}return i(e)}function f(t){const e=d.get(u);e&&(e.delete(t),e.size||s())}function s(){d.delete(u)}function a(t,e){var o;(o=d.get(u))==null||o.forEach(n=>n(t,e))}return{on:i,once:r,off:f,emit:a,reset:s}}const z={class:"process-container"},D=[".schema"],F=[".spec",".dataValues"],X={__name:"EodashProcess",setup(u){const p=R(A),{selectedStac:i}=S(w()),r=l(null),f=l(null),s=l(!1),a=l(null),t=l(null),e=l(!1),o=l(!1),n=l(!1);C(async()=>{var c;((c=B.value)==null?void 0:c.layers.length)<=1?p.once(async()=>{await g({selectedStac:i,jsonformEl:t,jsonformSchema:a,chartSpec:r,isProcessed:s,loading:e,isPolling:n})}):await g({selectedStac:i,jsonformEl:t,jsonformSchema:a,chartSpec:r,isProcessed:s,loading:e,isPolling:n})}),P(async()=>await g({selectedStac:i,jsonformEl:t,jsonformSchema:a,chartSpec:r,isProcessed:s,loading:e,isPolling:n}));const x=async()=>{var m;const c=(m=t.value)==null?void 0:m.editor.validate();if(c!=null&&c.length){console.warn("[eodash] Form validation failed",c);return}await M({jsonformEl:t,jsonformSchema:a,chartSpec:r,chartData:f,loading:e,selectedStac:i,isProcessed:s,isPolling:n}),s.value=!0};return L(o,t,a,x),(c,m)=>{const E=V("v-btn");return v(),_("div",z,[a.value?(v(),_("eox-jsonform",{key:0,ref_key:"jsonformEl",ref:t,".schema":a.value},null,40,D)):h("",!0),s.value&&r.value?(v(),_("eox-chart",{key:1,class:"chart",".spec":y(r.value),".dataValues":y(f.value)},null,40,F)):h("",!0),k("span",null,[o.value?h("",!0):(v(),b(E,{key:0,loading:e.value,style:{float:"right","margin-right":"20px"},onClick:x,color:"primary"},{default:N(()=>m[0]||(m[0]=[T(" Execute ")])),_:1},8,["loading"]))])])}}};export{X as default};
